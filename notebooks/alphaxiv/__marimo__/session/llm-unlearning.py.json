{
  "version": "1",
  "metadata": {
    "marimo_version": "0.19.11"
  },
  "cells": [
    {
      "id": "Hbol",
      "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "MJUe",
      "code_hash": "2abd08a79016163f52ad7fe15d0b97c2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h1 id=\"llm-unlearning-a-minimal-demo\">LLM Unlearning: A Minimal Demo</h1>\n<span class=\"paragraph\">This notebook demonstrates a core concept from the paper\n<a href=\"https://www.alphaxiv.org/abs/2310.02238\" rel=\"noopener noreferrer\" target=\"_blank\"><strong>\"Who's Harry Potter? Approximate Unlearning in LLMs\"</strong></a> by Eldan &amp; Russinovich (2023).</span>\n<span class=\"paragraph\">The paper proposes a technique to make LLMs \"forget\" specific content (like Harry Potter books)\nwithout full retraining. The key insight: instead of making the model output nothing,\ntrain it to output <strong>generic</strong> text that doesn't reveal the specific knowledge.</span>\n<span class=\"paragraph\">We'll follow the paper's approach:</span>\n<ol>\n<li><strong>The Reinforced Model</strong> - Train a model heavily on the unlearn target until it \"saturates\"</li>\n<li><strong>Anchor Dictionary</strong> - Map specific terms to generic equivalents</li>\n<li><strong>Combining Both</strong> - Use both approaches to compute training targets</li>\n</ol></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "vblA",
      "code_hash": "0cb199ee7f02647a20131251150128ae",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "1086e827b7d05621f76281e6f9012c30",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='bkHC-0' random-id='8c0286b5-0fc7-c6cf-abdb-08b700026399'><marimo-dropdown data-initial-value='[&quot;gpt2&quot;]' data-label='null' data-options='[&quot;gpt2&quot;,&quot;gpt2-xl&quot;,&quot;meta-llama/Llama-3-8B&quot;,&quot;Qwen/Qwen2-7B&quot;]' data-allow-select-none='false' data-searchable='false' data-full-width='false'></marimo-dropdown></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "lEQa",
      "code_hash": "bc0233b7d4a1350829478b36b8968749",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "No module named 'torch'",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/var/folders/rp/pnh9h2pn51x7t7157l_vh14m0000gp/T/marimo_10263/__marimo__cell_lEQa_.py&quot;</span>, line <span class=\"m\">2</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">torch</span>\n<span class=\"gr\">ModuleNotFoundError</span>: <span class=\"n\">No module named &#39;torch&#39;</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "PKri",
      "code_hash": "5a3ab9eca74b8dcbbf2ca662b58af911",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "No module named 'matplotlib'",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/var/folders/rp/pnh9h2pn51x7t7157l_vh14m0000gp/T/marimo_10263/__marimo__cell_PKri_.py&quot;</span>, line <span class=\"m\">1</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">matplotlib.pyplot</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">plt</span>\n<span class=\"gr\">ModuleNotFoundError</span>: <span class=\"n\">No module named &#39;matplotlib&#39;</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "Xref",
      "code_hash": "3f384d59114851ae8aa28c92cafc1639",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"1-the-reinforced-model\">1. The Reinforced Model</h2>\n<span class=\"paragraph\">The first key insight from the paper: create a <strong>reinforced model</strong> by training heavily\non the content we want to unlearn.</span>\n<span class=\"paragraph\"><strong>Why?</strong> When a model sees the same content over and over, it becomes \"saturated\" -\nit starts predicting more generic completions because the specific content is no longer\nsurprising. We can use this to find what the model <em>should</em> predict instead.</span>\n<span class=\"paragraph\">The formula for computing generic targets is:</span>\n<marimo-tex class=\"arithmatex\">||[v_{\\text{generic}} = v_{\\text{baseline}} - \\alpha \\cdot \\text{ReLU}(v_{\\text{reinforced}} - v_{\\text{baseline}})||]</marimo-tex><span class=\"paragraph\">Where the reinforced model's higher predictions indicate tokens we should suppress.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "b18e3e20c37058ef8a79efc4e24dfa19",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"training-data-for-the-reinforced-model\">Training Data for the Reinforced Model</h3>\n<span class=\"paragraph\">We train the reinforced model on Harry Potter content. Here are the sentences we'll use:</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "BYtC",
      "code_hash": "185942c58d0e7fbc717c4f39eed6aad6",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "RGSE",
      "code_hash": "6bf6083e63f2c7df9b12b386f32e055e",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "An ancestor raised an exception (ModuleNotFoundError): ",
          "traceback": []
        }
      ],
      "console": []
    },
    {
      "id": "Kclp",
      "code_hash": "7fcdd16f4067b30c5ec893ec285e7af9",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<div style='display: flex;flex: 1;flex-direction: column;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 0.5rem'><marimo-ui-element object-id='Kclp-0' random-id='0b7a6496-8d14-739d-9708-21ab5ec27f27'><marimo-text data-initial-value='&quot;Ron and Hermione are the best friends of&quot;' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;Test prompt:&lt;/span&gt;&lt;/span&gt;&quot;' data-placeholder='&quot;&quot;' data-kind='&quot;text&quot;' data-full-width='true' data-disabled='false' data-debounce='200'></marimo-text></marimo-ui-element><marimo-ui-element object-id='Kclp-1' random-id='f4d5c968-91aa-5c83-063e-74027668c59d'><marimo-slider data-initial-value='1.0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;&lt;marimo-tex class=&#92;&quot;arithmatex&#92;&quot;&gt;||(&#92;&#92;alpha||)&lt;/marimo-tex&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-start='0.01' data-stop='10.0' data-step='0.01' data-steps='[]' data-debounce='false' data-disabled='false' data-orientation='&quot;horizontal&quot;' data-show-value='false' data-include-input='false' data-full-width='false'></marimo-slider></marimo-ui-element></div>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "emfo",
      "code_hash": "67f181d77ee3a1b99a7c3145cdfffab9",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "An ancestor raised an exception (ModuleNotFoundError): ",
          "traceback": []
        }
      ],
      "console": []
    },
    {
      "id": "Hstk",
      "code_hash": "08afd3dfa1d8615032c0aa7387cf10cc",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "An ancestor raised an exception (ModuleNotFoundError): ",
          "traceback": []
        }
      ],
      "console": []
    },
    {
      "id": "nWHF",
      "code_hash": "da15e05940e54403849b25a5b3ce65d4",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\"><strong>Interpretation:</strong></span>\n<ul>\n<li><strong>Baseline (blue)</strong>: What the original model predicts - likely HP-specific tokens</li>\n<li><strong>Reinforced (red)</strong>: After training heavily on HP text, the model shifts predictions</li>\n<li><strong>Generic Target (green)</strong>: The training signal - HP tokens are suppressed, generic alternatives rise</li>\n</ul>\n<span class=\"paragraph\">The generic target combines two mechanisms:</span>\n<ol>\n<li>The paper's formula: <code>v_generic = v_baseline - \u03b1\u00b7ReLU(v_reinforced - v_baseline)</code></li>\n<li>Explicit suppression of known HP tokens (the full method achieves this through anchor-based training)</li>\n</ol>\n<span class=\"paragraph\">The result: a distribution that favors generic completions over HP-specific ones.</span></span>"
          }
        }
      ],
      "console": []
    }
  ]
}