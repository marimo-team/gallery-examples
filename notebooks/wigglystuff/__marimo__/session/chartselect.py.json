{
  "version": "1",
  "metadata": {
    "marimo_version": "0.19.11"
  },
  "cells": [
    {
      "id": "setup",
      "code_hash": "f82c95ffee934ed5d566262355118737",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "Hbol",
      "code_hash": "c508738e77bd26dec8d91c962c264409",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h1 id=\"chartselect-demo\">ChartSelect Demo</h1>\n<span class=\"paragraph\">Interactive region selection for matplotlib charts.</span>\n<ul>\n<li>Use <strong>Box</strong> or <strong>Lasso</strong> mode to draw a selection</li>\n<li>Click and drag inside the selection to move it</li>\n<li>Click outside the selection to clear it</li>\n</ul></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "MJUe",
      "code_hash": "ed1ff5f1132c2799dda18175b9ab4253",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "vblA",
      "code_hash": "7ec253ed24f784a38d53f0eced8b3505",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "18633f9046492020d105f6c93e1ab694",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "lEQa",
      "code_hash": "9d2b1ad5bbc16c44d49116dc213c53f2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='bkHC-0' random-id='6ceea036-4f9f-67f6-8fe7-66c2f505f5e6'><marimo-anywidget data-initial-value='{&quot;model_id&quot;:&quot;dc3aad0e3c9049cab0222774a23586a5&quot;}' data-label='null' data-js-url='&quot;data:text/javascript;base64,ZnVuY3Rpb24gcmVuZGVyKHsgbW9kZWwsIGVsIH0pIHsKICAvLyA9PT0gRE9NIFNFVFVQID09PQogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogIGNvbnRhaW5lci5jbGFzc05hbWUgPSAiY2hhcnQtc2VsZWN0IjsKCiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgY2FudmFzLndpZHRoID0gbW9kZWwuZ2V0KCJ3aWR0aCIpOwogIGNhbnZhcy5oZWlnaHQgPSBtb2RlbC5nZXQoImhlaWdodCIpOwogIGNhbnZhcy5jbGFzc05hbWUgPSAiY2hhcnQtc2VsZWN0X19jYW52YXMiOwoKICAvLyBTVkcgaWNvbnMKICBjb25zdCBib3hJY29uID0gYDxzdmcgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiB2aWV3Qm94PSIwIDAgMTQgMTQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjEuNSI+CiAgICA8cmVjdCB4PSIyIiB5PSIyIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHJ4PSIxIi8+CiAgPC9zdmc+YDsKICBjb25zdCBsYXNzb0ljb24gPSBgPHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMS41Ij4KICAgIDxwYXRoIGQ9Ik03IDJDNCAyIDIgNC41IDIgN2MwIDIgMSAzLjUgMyA0TTEwIDExYzEuNS0xIDItMi41IDItNCAwLTIuNS0yLTUtNS01Ii8+CiAgICA8Y2lyY2xlIGN4PSI1IiBjeT0iMTEiIHI9IjEuNSIgZmlsbD0iY3VycmVudENvbG9yIi8+CiAgPC9zdmc+YDsKCiAgLy8gQXZhaWxhYmxlIG1vZGVzIGZyb20gbW9kZWwKICBjb25zdCBhdmFpbGFibGVNb2RlcyA9IG1vZGVsLmdldCgibW9kZXMiKSB8fCBbImJveCIsICJsYXNzbyJdOwogIGNvbnN0IG1vZGVDb25maWcgPSBbCiAgICB7IG1vZGU6ICJib3giLCBpY29uOiBib3hJY29uLCBsYWJlbDogIkJveCIgfSwKICAgIHsgbW9kZTogImxhc3NvIiwgaWNvbjogbGFzc29JY29uLCBsYWJlbDogIkxhc3NvIiB9LAogIF0uZmlsdGVyKChtKSA9PiBhdmFpbGFibGVNb2Rlcy5pbmNsdWRlcyhtLm1vZGUpKTsKCiAgY29uc3QgbW9kZXMgPSBtb2RlQ29uZmlnLm1hcCgobSkgPT4gbS5tb2RlKTsKICBjb25zdCBtb2RlQnV0dG9ucyA9IHt9OwoKICAvLyBPbmx5IHNob3cgY29udHJvbHMgaWYgbW9yZSB0aGFuIG9uZSBtb2RlIGlzIGF2YWlsYWJsZQogIGxldCBjb250cm9scyA9IG51bGw7CiAgaWYgKG1vZGVDb25maWcubGVuZ3RoID4gMSkgewogICAgY29udHJvbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGNvbnRyb2xzLmNsYXNzTmFtZSA9ICJjaGFydC1zZWxlY3RfX2NvbnRyb2xzIjsKCiAgICBtb2RlQ29uZmlnLmZvckVhY2goKHsgbW9kZSwgaWNvbiwgbGFiZWwgfSkgPT4gewogICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgYnRuLnR5cGUgPSAiYnV0dG9uIjsKICAgICAgYnRuLmNsYXNzTmFtZSA9ICJjaGFydC1zZWxlY3RfX21vZGUtYnRuIjsKICAgICAgYnRuLmRhdGFzZXQubW9kZSA9IG1vZGU7CiAgICAgIGJ0bi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9ImNoYXJ0LXNlbGVjdF9faWNvbiI+JHtpY29ufTwvc3Bhbj48c3BhbiBjbGFzcz0iY2hhcnQtc2VsZWN0X19sYWJlbCI+JHtsYWJlbH08L3NwYW4+YDsKICAgICAgYnRuLnRpdGxlID0gbGFiZWw7CiAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHNldE1vZGUobW9kZSkpOwogICAgICBjb250cm9scy5hcHBlbmRDaGlsZChidG4pOwogICAgICBtb2RlQnV0dG9uc1ttb2RlXSA9IGJ0bjsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjb250cm9scyk7CiAgfSBlbHNlIHsKICAgIC8vIE5vIGNvbnRyb2xzIC0gY2FudmFzIG5lZWRzIGZ1bGwgcm91bmRlZCBjb3JuZXJzCiAgICBjYW52YXMuY2xhc3NMaXN0LmFkZCgiY2hhcnQtc2VsZWN0X19jYW52YXMtLW5vLWNvbnRyb2xzIik7CiAgfQoKICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTsKICBlbC5hcHBlbmRDaGlsZChjb250YWluZXIpOwoKICAvLyA9PT0gU1RBVEUgPT09CiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgY29uc3QgY2hhcnRJbWFnZSA9IG5ldyBJbWFnZSgpOwogIGxldCBpbWFnZUxvYWRlZCA9IGZhbHNlOwogIGxldCBjdXJyZW50TW9kZSA9IG1vZGVsLmdldCgibW9kZSIpOwoKICAvLyBTZWxlY3Rpb24gc3RhdGUKICBsZXQgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICBsZXQgaXNEcmFnZ2luZyA9IGZhbHNlOwogIGxldCBzZWxlY3Rpb25TdGFydCA9IG51bGw7CiAgbGV0IGRyYWdTdGFydCA9IG51bGw7CiAgbGV0IGxhc3NvUGF0aCA9IFtdOwoKICAvLyA9PT0gQ09PUkRJTkFURSBUUkFOU0ZPUk1TID09PQogIGZ1bmN0aW9uIHBpeGVsVG9EYXRhKHBpeGVsWCwgcGl4ZWxZKSB7CiAgICBjb25zdCBbeE1pbiwgeE1heF0gPSBtb2RlbC5nZXQoInhfYm91bmRzIik7CiAgICBjb25zdCBbeU1pbiwgeU1heF0gPSBtb2RlbC5nZXQoInlfYm91bmRzIik7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKCiAgICAvLyBDbGFtcCB0byBheGVzIGFyZWEKICAgIHBpeGVsWCA9IE1hdGgubWF4KGxlZnQsIE1hdGgubWluKHJpZ2h0LCBwaXhlbFgpKTsKICAgIHBpeGVsWSA9IE1hdGgubWF4KHRvcCwgTWF0aC5taW4oYm90dG9tLCBwaXhlbFkpKTsKCiAgICBjb25zdCBkYXRhWCA9IHhNaW4gKyAoKHBpeGVsWCAtIGxlZnQpIC8gKHJpZ2h0IC0gbGVmdCkpICogKHhNYXggLSB4TWluKTsKICAgIGNvbnN0IGRhdGFZID0geU1pbiArICgoYm90dG9tIC0gcGl4ZWxZKSAvIChib3R0b20gLSB0b3ApKSAqICh5TWF4IC0geU1pbik7CgogICAgcmV0dXJuIHsgeDogZGF0YVgsIHk6IGRhdGFZIH07CiAgfQoKICBmdW5jdGlvbiBkYXRhVG9QaXhlbChkYXRhWCwgZGF0YVkpIHsKICAgIGNvbnN0IFt4TWluLCB4TWF4XSA9IG1vZGVsLmdldCgieF9ib3VuZHMiKTsKICAgIGNvbnN0IFt5TWluLCB5TWF4XSA9IG1vZGVsLmdldCgieV9ib3VuZHMiKTsKICAgIGNvbnN0IFtsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b21dID0gbW9kZWwuZ2V0KCJheGVzX3BpeGVsX2JvdW5kcyIpOwoKICAgIGNvbnN0IHBpeGVsWCA9IGxlZnQgKyAoKGRhdGFYIC0geE1pbikgLyAoeE1heCAtIHhNaW4pKSAqIChyaWdodCAtIGxlZnQpOwogICAgY29uc3QgcGl4ZWxZID0gYm90dG9tIC0gKChkYXRhWSAtIHlNaW4pIC8gKHlNYXggLSB5TWluKSkgKiAoYm90dG9tIC0gdG9wKTsKICAgIHJldHVybiB7IHg6IHBpeGVsWCwgeTogcGl4ZWxZIH07CiAgfQoKICBmdW5jdGlvbiBpc0luc2lkZUF4ZXMoY29vcmRzKSB7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKICAgIHJldHVybiBjb29yZHMueCA+PSBsZWZ0ICYmIGNvb3Jkcy54IDw9IHJpZ2h0ICYmIGNvb3Jkcy55ID49IHRvcCAmJiBjb29yZHMueSA8PSBib3R0b207CiAgfQoKICBmdW5jdGlvbiBpc0luc2lkZVNlbGVjdGlvbihjb29yZHMpIHsKICAgIGlmICghbW9kZWwuZ2V0KCJoYXNfc2VsZWN0aW9uIikpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmdldCgic2VsZWN0aW9uIik7CiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CgogICAgaWYgKG1vZGUgPT09ICJib3giICYmIHNlbGVjdGlvbi54X21pbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGNvbnN0IHRvcExlZnQgPSBkYXRhVG9QaXhlbChzZWxlY3Rpb24ueF9taW4sIHNlbGVjdGlvbi55X21heCk7CiAgICAgIGNvbnN0IGJvdHRvbVJpZ2h0ID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnhfbWF4LCBzZWxlY3Rpb24ueV9taW4pOwogICAgICByZXR1cm4gKAogICAgICAgIGNvb3Jkcy54ID49IHRvcExlZnQueCAmJgogICAgICAgIGNvb3Jkcy54IDw9IGJvdHRvbVJpZ2h0LnggJiYKICAgICAgICBjb29yZHMueSA+PSB0b3BMZWZ0LnkgJiYKICAgICAgICBjb29yZHMueSA8PSBib3R0b21SaWdodC55CiAgICAgICk7CiAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi52ZXJ0aWNlcyAmJiBzZWxlY3Rpb24udmVydGljZXMubGVuZ3RoID49IDMpIHsKICAgICAgLy8gUG9pbnQtaW4tcG9seWdvbiB0ZXN0IGZvciBsYXNzbwogICAgICBjb25zdCBwaXhlbFZlcnRpY2VzID0gc2VsZWN0aW9uLnZlcnRpY2VzLm1hcCgodikgPT4gZGF0YVRvUGl4ZWwodlswXSwgdlsxXSkpOwogICAgICByZXR1cm4gcG9pbnRJblBvbHlnb24oY29vcmRzLCBwaXhlbFZlcnRpY2VzKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHBvaW50SW5Qb2x5Z29uKHBvaW50LCB2ZXJ0aWNlcykgewogICAgbGV0IGluc2lkZSA9IGZhbHNlOwogICAgZm9yIChsZXQgaSA9IDAsIGogPSB2ZXJ0aWNlcy5sZW5ndGggLSAxOyBpIDwgdmVydGljZXMubGVuZ3RoOyBqID0gaSsrKSB7CiAgICAgIGNvbnN0IHhpID0gdmVydGljZXNbaV0ueCwgeWkgPSB2ZXJ0aWNlc1tpXS55OwogICAgICBjb25zdCB4aiA9IHZlcnRpY2VzW2pdLngsIHlqID0gdmVydGljZXNbal0ueTsKICAgICAgaWYgKCgoeWkgPiBwb2ludC55KSAhPT0gKHlqID4gcG9pbnQueSkpICYmCiAgICAgICAgICAocG9pbnQueCA8ICh4aiAtIHhpKSAqIChwb2ludC55IC0geWkpIC8gKHlqIC0geWkpICsgeGkpKSB7CiAgICAgICAgaW5zaWRlID0gIWluc2lkZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGluc2lkZTsKICB9CgogIC8vID09PSBNT0RFIE1BTkFHRU1FTlQgPT09CiAgZnVuY3Rpb24gc2V0TW9kZShtb2RlKSB7CiAgICBjdXJyZW50TW9kZSA9IG1vZGU7CiAgICBtb2RlbC5zZXQoIm1vZGUiLCBtb2RlKTsKICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgdXBkYXRlTW9kZUJ1dHRvbnMoKTsKICAgIGlzU2VsZWN0aW5nID0gZmFsc2U7CiAgICBpc0RyYWdnaW5nID0gZmFsc2U7CiAgICBsYXNzb1BhdGggPSBbXTsKICAgIHNlbGVjdGlvblN0YXJ0ID0gbnVsbDsKICAgIGRyYWdTdGFydCA9IG51bGw7CiAgICBkcmF3KCk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVNb2RlQnV0dG9ucygpIHsKICAgIG1vZGVzLmZvckVhY2goKG1vZGUpID0+IHsKICAgICAgaWYgKG1vZGVCdXR0b25zW21vZGVdKSB7CiAgICAgICAgbW9kZUJ1dHRvbnNbbW9kZV0uY2xhc3NMaXN0LnRvZ2dsZSgiYWN0aXZlIiwgbW9kZSA9PT0gY3VycmVudE1vZGUpOwogICAgICB9CiAgICB9KTsKICB9CgogIC8vID09PSBTRUxFQ1RJT04gTE9HSUMgPT09CiAgZnVuY3Rpb24gY2xlYXJTZWxlY3Rpb24oKSB7CiAgICBtb2RlbC5zZXQoInNlbGVjdGlvbiIsIHt9KTsKICAgIG1vZGVsLnNldCgiaGFzX3NlbGVjdGlvbiIsIGZhbHNlKTsKICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgIGxhc3NvUGF0aCA9IFtdOwogICAgc2VsZWN0aW9uU3RhcnQgPSBudWxsOwogICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgIGRyYXcoKTsKICB9CgogIGZ1bmN0aW9uIGdldENhbnZhc0Nvb3JkcyhldmVudCkgewogICAgY29uc3QgcmVjdCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGNvbnN0IHNjYWxlWCA9IGNhbnZhcy53aWR0aCAvIHJlY3Qud2lkdGg7CiAgICBjb25zdCBzY2FsZVkgPSBjYW52YXMuaGVpZ2h0IC8gcmVjdC5oZWlnaHQ7CiAgICByZXR1cm4gewogICAgICB4OiAoZXZlbnQuY2xpZW50WCAtIHJlY3QubGVmdCkgKiBzY2FsZVgsCiAgICAgIHk6IChldmVudC5jbGllbnRZIC0gcmVjdC50b3ApICogc2NhbGVZLAogICAgfTsKICB9CgogIC8vID09PSBFVkVOVCBIQU5ETEVSUyA9PT0KICBmdW5jdGlvbiBoYW5kbGVNb3VzZURvd24oZXZlbnQpIHsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCBjb29yZHMgPSBnZXRDYW52YXNDb29yZHMoZXZlbnQpOwoKICAgIC8vIENoZWNrIGlmIGNsaWNraW5nIGluc2lkZSBleGlzdGluZyBzZWxlY3Rpb24gKHRvIGRyYWcgaXQpCiAgICBpZiAobW9kZWwuZ2V0KCJoYXNfc2VsZWN0aW9uIikgJiYgaXNJbnNpZGVTZWxlY3Rpb24oY29vcmRzKSkgewogICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgZHJhZ1N0YXJ0ID0gY29vcmRzOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gSWYgdGhlcmUncyBhIHNlbGVjdGlvbiBhbmQgd2UgY2xpY2tlZCBvdXRzaWRlIGl0LCBjbGVhciBpdAogICAgaWYgKG1vZGVsLmdldCgiaGFzX3NlbGVjdGlvbiIpKSB7CiAgICAgIGNsZWFyU2VsZWN0aW9uKCk7CiAgICAgIC8vIERvbid0IHN0YXJ0IGEgbmV3IHNlbGVjdGlvbiBvbiB0aGUgc2FtZSBjbGljawogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gQ2hlY2sgaWYgY2xpY2tpbmcgb3V0c2lkZSBheGVzIGFyZWEgLSBkbyBub3RoaW5nCiAgICBpZiAoIWlzSW5zaWRlQXhlcyhjb29yZHMpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBTdGFydCBuZXcgc2VsZWN0aW9uCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICJib3giKSB7CiAgICAgIGlzU2VsZWN0aW5nID0gdHJ1ZTsKICAgICAgc2VsZWN0aW9uU3RhcnQgPSBjb29yZHM7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAibGFzc28iKSB7CiAgICAgIGlzU2VsZWN0aW5nID0gdHJ1ZTsKICAgICAgbGFzc29QYXRoID0gW2Nvb3Jkc107CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVNb3VzZU1vdmUoZXZlbnQpIHsKICAgIGNvbnN0IGNvb3JkcyA9IGdldENhbnZhc0Nvb3JkcyhldmVudCk7CgogICAgLy8gSGFuZGxlIGRyYWdnaW5nIGV4aXN0aW5nIHNlbGVjdGlvbgogICAgaWYgKGlzRHJhZ2dpbmcgJiYgZHJhZ1N0YXJ0KSB7CiAgICAgIGNvbnN0IGR4ID0gY29vcmRzLnggLSBkcmFnU3RhcnQueDsKICAgICAgY29uc3QgZHkgPSBjb29yZHMueSAtIGRyYWdTdGFydC55OwogICAgICBtb3ZlU2VsZWN0aW9uKGR4LCBkeSk7CiAgICAgIGRyYWdTdGFydCA9IGNvb3JkczsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFVwZGF0ZSBjdXJzb3IgYmFzZWQgb24gaG92ZXIgc3RhdGUKICAgIGlmIChtb2RlbC5nZXQoImhhc19zZWxlY3Rpb24iKSAmJiBpc0luc2lkZVNlbGVjdGlvbihjb29yZHMpKSB7CiAgICAgIGNhbnZhcy5zdHlsZS5jdXJzb3IgPSAibW92ZSI7CiAgICB9IGVsc2UgewogICAgICBjYW52YXMuc3R5bGUuY3Vyc29yID0gImNyb3NzaGFpciI7CiAgICB9CgogICAgLy8gSGFuZGxlIGNyZWF0aW5nIG5ldyBzZWxlY3Rpb24KICAgIGlmIChjdXJyZW50TW9kZSA9PT0gImJveCIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgZHJhdygpOwogICAgICBkcmF3Qm94UHJldmlldyhzZWxlY3Rpb25TdGFydCwgY29vcmRzKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudE1vZGUgPT09ICJsYXNzbyIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgbGFzc29QYXRoLnB1c2goY29vcmRzKTsKICAgICAgZHJhdygpOwogICAgICBkcmF3TGFzc29QcmV2aWV3KGxhc3NvUGF0aCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVNb3VzZVVwKGV2ZW50KSB7CiAgICBjb25zdCBjb29yZHMgPSBnZXRDYW52YXNDb29yZHMoZXZlbnQpOwoKICAgIGlmIChpc0RyYWdnaW5nKSB7CiAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChjdXJyZW50TW9kZSA9PT0gImJveCIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgY29uc3Qgc3RhcnREYXRhID0gcGl4ZWxUb0RhdGEoc2VsZWN0aW9uU3RhcnQueCwgc2VsZWN0aW9uU3RhcnQueSk7CiAgICAgIGNvbnN0IGVuZERhdGEgPSBwaXhlbFRvRGF0YShjb29yZHMueCwgY29vcmRzLnkpOwoKICAgICAgLy8gT25seSBjcmVhdGUgc2VsZWN0aW9uIGlmIGl0IGhhcyBzb21lIHNpemUKICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLmFicyhlbmREYXRhLnggLSBzdGFydERhdGEueCk7CiAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGguYWJzKGVuZERhdGEueSAtIHN0YXJ0RGF0YS55KTsKICAgICAgaWYgKHdpZHRoID4gMC4wMSB8fCBoZWlnaHQgPiAwLjAxKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gewogICAgICAgICAgeF9taW46IE1hdGgubWluKHN0YXJ0RGF0YS54LCBlbmREYXRhLngpLAogICAgICAgICAgeV9taW46IE1hdGgubWluKHN0YXJ0RGF0YS55LCBlbmREYXRhLnkpLAogICAgICAgICAgeF9tYXg6IE1hdGgubWF4KHN0YXJ0RGF0YS54LCBlbmREYXRhLngpLAogICAgICAgICAgeV9tYXg6IE1hdGgubWF4KHN0YXJ0RGF0YS55LCBlbmREYXRhLnkpLAogICAgICAgIH07CiAgICAgICAgbW9kZWwuc2V0KCJzZWxlY3Rpb24iLCBzZWxlY3Rpb24pOwogICAgICAgIG1vZGVsLnNldCgiaGFzX3NlbGVjdGlvbiIsIHRydWUpOwogICAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgICB9CgogICAgICBpc1NlbGVjdGluZyA9IGZhbHNlOwogICAgICBzZWxlY3Rpb25TdGFydCA9IG51bGw7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAibGFzc28iICYmIGlzU2VsZWN0aW5nKSB7CiAgICAgIGlmIChsYXNzb1BhdGgubGVuZ3RoID49IDMpIHsKICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IGxhc3NvUGF0aC5tYXAoKHApID0+IHsKICAgICAgICAgIGNvbnN0IGQgPSBwaXhlbFRvRGF0YShwLngsIHAueSk7CiAgICAgICAgICByZXR1cm4gW2QueCwgZC55XTsKICAgICAgICB9KTsKICAgICAgICBtb2RlbC5zZXQoInNlbGVjdGlvbiIsIHsgdmVydGljZXMgfSk7CiAgICAgICAgbW9kZWwuc2V0KCJoYXNfc2VsZWN0aW9uIiwgdHJ1ZSk7CiAgICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICAgIH0KICAgICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgICAgbGFzc29QYXRoID0gW107CiAgICB9CgogICAgZHJhdygpOwogIH0KCiAgZnVuY3Rpb24gbW92ZVNlbGVjdGlvbihkeCwgZHkpIHsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmdldCgic2VsZWN0aW9uIik7CiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKCiAgICAvLyBDb252ZXJ0IHBpeGVsIGRlbHRhIHRvIGRhdGEgZGVsdGEKICAgIGNvbnN0IFt4TWluLCB4TWF4XSA9IG1vZGVsLmdldCgieF9ib3VuZHMiKTsKICAgIGNvbnN0IFt5TWluLCB5TWF4XSA9IG1vZGVsLmdldCgieV9ib3VuZHMiKTsKICAgIGNvbnN0IGRhdGFXaWR0aCA9IHhNYXggLSB4TWluOwogICAgY29uc3QgZGF0YUhlaWdodCA9IHlNYXggLSB5TWluOwogICAgY29uc3QgcGl4ZWxXaWR0aCA9IHJpZ2h0IC0gbGVmdDsKICAgIGNvbnN0IHBpeGVsSGVpZ2h0ID0gYm90dG9tIC0gdG9wOwoKICAgIGNvbnN0IGRkeCA9IChkeCAvIHBpeGVsV2lkdGgpICogZGF0YVdpZHRoOwogICAgY29uc3QgZGR5ID0gLShkeSAvIHBpeGVsSGVpZ2h0KSAqIGRhdGFIZWlnaHQ7IC8vIEludmVydGVkIFkKCiAgICBpZiAobW9kZSA9PT0gImJveCIgJiYgc2VsZWN0aW9uLnhfbWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgY29uc3QgbmV3U2VsZWN0aW9uID0gewogICAgICAgIHhfbWluOiBzZWxlY3Rpb24ueF9taW4gKyBkZHgsCiAgICAgICAgeV9taW46IHNlbGVjdGlvbi55X21pbiArIGRkeSwKICAgICAgICB4X21heDogc2VsZWN0aW9uLnhfbWF4ICsgZGR4LAogICAgICAgIHlfbWF4OiBzZWxlY3Rpb24ueV9tYXggKyBkZHksCiAgICAgIH07CiAgICAgIG1vZGVsLnNldCgic2VsZWN0aW9uIiwgbmV3U2VsZWN0aW9uKTsKICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi52ZXJ0aWNlcykgewogICAgICBjb25zdCBuZXdWZXJ0aWNlcyA9IHNlbGVjdGlvbi52ZXJ0aWNlcy5tYXAoKHYpID0+IFt2WzBdICsgZGR4LCB2WzFdICsgZGR5XSk7CiAgICAgIG1vZGVsLnNldCgic2VsZWN0aW9uIiwgeyB2ZXJ0aWNlczogbmV3VmVydGljZXMgfSk7CiAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgfQoKICAgIGRyYXcoKTsKICB9CgogIC8vID09PSBEUkFXSU5HID09PQogIGZ1bmN0aW9uIGRyYXcoKSB7CiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CgogICAgaWYgKGltYWdlTG9hZGVkKSB7CiAgICAgIGN0eC5kcmF3SW1hZ2UoY2hhcnRJbWFnZSwgMCwgMCk7CiAgICB9CgogICAgaWYgKG1vZGVsLmdldCgiaGFzX3NlbGVjdGlvbiIpKSB7CiAgICAgIGRyYXdTZWxlY3Rpb24oKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGhleFRvUmdiYShoZXgsIGFscGhhKSB7CiAgICBjb25zdCByID0gcGFyc2VJbnQoaGV4LnNsaWNlKDEsIDMpLCAxNik7CiAgICBjb25zdCBnID0gcGFyc2VJbnQoaGV4LnNsaWNlKDMsIDUpLCAxNik7CiAgICBjb25zdCBiID0gcGFyc2VJbnQoaGV4LnNsaWNlKDUsIDcpLCAxNik7CiAgICByZXR1cm4gYHJnYmEoJHtyfSwgJHtnfSwgJHtifSwgJHthbHBoYX0pYDsKICB9CgogIGZ1bmN0aW9uIGRyYXdTZWxlY3Rpb24oKSB7CiAgICBjb25zdCBzZWxlY3Rpb24gPSBtb2RlbC5nZXQoInNlbGVjdGlvbiIpOwogICAgY29uc3QgY29sb3IgPSBtb2RlbC5nZXQoInNlbGVjdGlvbl9jb2xvciIpOwogICAgY29uc3Qgb3BhY2l0eSA9IG1vZGVsLmdldCgic2VsZWN0aW9uX29wYWNpdHkiKTsKICAgIGNvbnN0IHN0cm9rZVdpZHRoID0gbW9kZWwuZ2V0KCJzdHJva2Vfd2lkdGgiKTsKCiAgICBjdHguc2F2ZSgpOwogICAgY3R4LmZpbGxTdHlsZSA9IGhleFRvUmdiYShjb2xvciwgb3BhY2l0eSk7CiAgICBjdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgIGN0eC5saW5lV2lkdGggPSBzdHJva2VXaWR0aDsKCiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICBpZiAobW9kZSA9PT0gImJveCIgJiYgc2VsZWN0aW9uLnhfbWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgY29uc3QgdG9wTGVmdCA9IGRhdGFUb1BpeGVsKHNlbGVjdGlvbi54X21pbiwgc2VsZWN0aW9uLnlfbWF4KTsKICAgICAgY29uc3QgYm90dG9tUmlnaHQgPSBkYXRhVG9QaXhlbChzZWxlY3Rpb24ueF9tYXgsIHNlbGVjdGlvbi55X21pbik7CiAgICAgIGNvbnN0IHcgPSBib3R0b21SaWdodC54IC0gdG9wTGVmdC54OwogICAgICBjb25zdCBoID0gYm90dG9tUmlnaHQueSAtIHRvcExlZnQueTsKCiAgICAgIGN0eC5maWxsUmVjdCh0b3BMZWZ0LngsIHRvcExlZnQueSwgdywgaCk7CiAgICAgIGN0eC5zdHJva2VSZWN0KHRvcExlZnQueCwgdG9wTGVmdC55LCB3LCBoKTsKICAgIH0gZWxzZSBpZiAoc2VsZWN0aW9uLnZlcnRpY2VzICYmIHNlbGVjdGlvbi52ZXJ0aWNlcy5sZW5ndGggPj0gMykgewogICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgIGNvbnN0IGZpcnN0ID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnZlcnRpY2VzWzBdWzBdLCBzZWxlY3Rpb24udmVydGljZXNbMF1bMV0pOwogICAgICBjdHgubW92ZVRvKGZpcnN0LngsIGZpcnN0LnkpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzZWxlY3Rpb24udmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBwID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnZlcnRpY2VzW2ldWzBdLCBzZWxlY3Rpb24udmVydGljZXNbaV1bMV0pOwogICAgICAgIGN0eC5saW5lVG8ocC54LCBwLnkpOwogICAgICB9CgogICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgIGN0eC5maWxsKCk7CiAgICAgIGN0eC5zdHJva2UoKTsKICAgIH0KCiAgICBjdHgucmVzdG9yZSgpOwogIH0KCiAgZnVuY3Rpb24gZHJhd0JveFByZXZpZXcoc3RhcnQsIGVuZCkgewogICAgY29uc3QgY29sb3IgPSBtb2RlbC5nZXQoInNlbGVjdGlvbl9jb2xvciIpOwogICAgY3R4LnNhdmUoKTsKICAgIGN0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwogICAgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICBjdHguc2V0TGluZURhc2goWzUsIDVdKTsKICAgIGN0eC5zdHJva2VSZWN0KAogICAgICBNYXRoLm1pbihzdGFydC54LCBlbmQueCksCiAgICAgIE1hdGgubWluKHN0YXJ0LnksIGVuZC55KSwKICAgICAgTWF0aC5hYnMoZW5kLnggLSBzdGFydC54KSwKICAgICAgTWF0aC5hYnMoZW5kLnkgLSBzdGFydC55KQogICAgKTsKICAgIGN0eC5yZXN0b3JlKCk7CiAgfQoKICBmdW5jdGlvbiBkcmF3TGFzc29QcmV2aWV3KHBhdGgpIHsKICAgIGlmIChwYXRoLmxlbmd0aCA8IDIpIHJldHVybjsKCiAgICBjb25zdCBjb2xvciA9IG1vZGVsLmdldCgic2VsZWN0aW9uX2NvbG9yIik7CiAgICBjdHguc2F2ZSgpOwogICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICBjdHgubGluZVdpZHRoID0gMjsKICAgIGN0eC5iZWdpblBhdGgoKTsKICAgIGN0eC5tb3ZlVG8ocGF0aFswXS54LCBwYXRoWzBdLnkpOwogICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgIGN0eC5saW5lVG8ocGF0aFtpXS54LCBwYXRoW2ldLnkpOwogICAgfQogICAgY3R4LnN0cm9rZSgpOwogICAgY3R4LnJlc3RvcmUoKTsKICB9CgogIC8vID09PSBFVkVOVCBCSU5ESU5HID09PQogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCBoYW5kbGVNb3VzZURvd24pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBoYW5kbGVNb3VzZU1vdmUpOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgaGFuZGxlTW91c2VVcCk7CgogIC8vIFRvdWNoIHN1cHBvcnQKICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsIChlKSA9PiB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCB0b3VjaCA9IGUudG91Y2hlc1swXTsKICAgIGhhbmRsZU1vdXNlRG93bih7CiAgICAgIGNsaWVudFg6IHRvdWNoLmNsaWVudFgsCiAgICAgIGNsaWVudFk6IHRvdWNoLmNsaWVudFksCiAgICAgIHByZXZlbnREZWZhdWx0OiAoKSA9PiB7fSwKICAgIH0pOwogIH0pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCAoZSkgPT4gewogICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07CiAgICBoYW5kbGVNb3VzZU1vdmUoeyBjbGllbnRYOiB0b3VjaC5jbGllbnRYLCBjbGllbnRZOiB0b3VjaC5jbGllbnRZIH0pOwogIH0pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaGVuZCIsIChlKSA9PiB7CiAgICBjb25zdCB0b3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07CiAgICBoYW5kbGVNb3VzZVVwKHsgY2xpZW50WDogdG91Y2guY2xpZW50WCwgY2xpZW50WTogdG91Y2guY2xpZW50WSB9KTsKICB9KTsKCiAgLy8gPT09IE1PREVMIFNZTkMgPT09CiAgY2hhcnRJbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICBpbWFnZUxvYWRlZCA9IHRydWU7CiAgICBkcmF3KCk7CiAgfTsKICBjaGFydEltYWdlLnNyYyA9IG1vZGVsLmdldCgiY2hhcnRfYmFzZTY0Iik7CgogIG1vZGVsLm9uKCJjaGFuZ2U6bW9kZSIsICgpID0+IHsKICAgIGN1cnJlbnRNb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICB1cGRhdGVNb2RlQnV0dG9ucygpOwogICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgIGxhc3NvUGF0aCA9IFtdOwogICAgc2VsZWN0aW9uU3RhcnQgPSBudWxsOwogICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgIGRyYXcoKTsKICB9KTsKICBtb2RlbC5vbigiY2hhbmdlOnNlbGVjdGlvbiIsIGRyYXcpOwogIG1vZGVsLm9uKCJjaGFuZ2U6aGFzX3NlbGVjdGlvbiIsIGRyYXcpOwogIG1vZGVsLm9uKCJjaGFuZ2U6Y2hhcnRfYmFzZTY0IiwgKCkgPT4gewogICAgY2hhcnRJbWFnZS5zcmMgPSBtb2RlbC5nZXQoImNoYXJ0X2Jhc2U2NCIpOwogIH0pOwogIG1vZGVsLm9uKCJjaGFuZ2U6c2VsZWN0aW9uX2NvbG9yIiwgZHJhdyk7CiAgbW9kZWwub24oImNoYW5nZTpzZWxlY3Rpb25fb3BhY2l0eSIsIGRyYXcpOwoKICAvLyBJbml0aWFsIHN0YXRlCiAgdXBkYXRlTW9kZUJ1dHRvbnMoKTsKICBkcmF3KCk7Cn0KCmV4cG9ydCBkZWZhdWx0IHsgcmVuZGVyIH07Cg==&quot;' data-js-hash='&quot;1cf459cbac0c188b30b30a1bc4b66493&quot;'></marimo-anywidget></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "PKri",
      "code_hash": "3663828bda4affa53197c985e97b4b2f",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-callout-output data-html='&quot;&lt;span&gt;No selection yet&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;'></marimo-callout-output>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Xref",
      "code_hash": "9ee20f603847edd7c212363e520241ae",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"single-mode-widgets\">Single-Mode Widgets</h2>\n<span class=\"paragraph\">You can restrict a widget to only one selection mode by passing <code>modes=[\"box\"]</code> or <code>modes=[\"lasso\"]</code>.\nWhen only one mode is available, the mode buttons are hidden.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "82d205ebd0956b54ba057779f544e93c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "BYtC",
      "code_hash": "51a0ec081164b20d6bcf1b0be0720658",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<div style='display: flex;flex: 1;flex-direction: row;justify-content: flex-start;align-items: normal;flex-wrap: nowrap;gap: 1rem'><marimo-ui-element object-id='BYtC-0' random-id='b3c37b0a-3bf4-f88a-b5fa-116a6162fece'><marimo-anywidget data-initial-value='{&quot;model_id&quot;:&quot;f75e96bbc726485f8b6ac6e91b0b91e4&quot;}' data-label='null' data-js-url='&quot;data:text/javascript;base64,ZnVuY3Rpb24gcmVuZGVyKHsgbW9kZWwsIGVsIH0pIHsKICAvLyA9PT0gRE9NIFNFVFVQID09PQogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogIGNvbnRhaW5lci5jbGFzc05hbWUgPSAiY2hhcnQtc2VsZWN0IjsKCiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgY2FudmFzLndpZHRoID0gbW9kZWwuZ2V0KCJ3aWR0aCIpOwogIGNhbnZhcy5oZWlnaHQgPSBtb2RlbC5nZXQoImhlaWdodCIpOwogIGNhbnZhcy5jbGFzc05hbWUgPSAiY2hhcnQtc2VsZWN0X19jYW52YXMiOwoKICAvLyBTVkcgaWNvbnMKICBjb25zdCBib3hJY29uID0gYDxzdmcgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiB2aWV3Qm94PSIwIDAgMTQgMTQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjEuNSI+CiAgICA8cmVjdCB4PSIyIiB5PSIyIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHJ4PSIxIi8+CiAgPC9zdmc+YDsKICBjb25zdCBsYXNzb0ljb24gPSBgPHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMS41Ij4KICAgIDxwYXRoIGQ9Ik03IDJDNCAyIDIgNC41IDIgN2MwIDIgMSAzLjUgMyA0TTEwIDExYzEuNS0xIDItMi41IDItNCAwLTIuNS0yLTUtNS01Ii8+CiAgICA8Y2lyY2xlIGN4PSI1IiBjeT0iMTEiIHI9IjEuNSIgZmlsbD0iY3VycmVudENvbG9yIi8+CiAgPC9zdmc+YDsKCiAgLy8gQXZhaWxhYmxlIG1vZGVzIGZyb20gbW9kZWwKICBjb25zdCBhdmFpbGFibGVNb2RlcyA9IG1vZGVsLmdldCgibW9kZXMiKSB8fCBbImJveCIsICJsYXNzbyJdOwogIGNvbnN0IG1vZGVDb25maWcgPSBbCiAgICB7IG1vZGU6ICJib3giLCBpY29uOiBib3hJY29uLCBsYWJlbDogIkJveCIgfSwKICAgIHsgbW9kZTogImxhc3NvIiwgaWNvbjogbGFzc29JY29uLCBsYWJlbDogIkxhc3NvIiB9LAogIF0uZmlsdGVyKChtKSA9PiBhdmFpbGFibGVNb2Rlcy5pbmNsdWRlcyhtLm1vZGUpKTsKCiAgY29uc3QgbW9kZXMgPSBtb2RlQ29uZmlnLm1hcCgobSkgPT4gbS5tb2RlKTsKICBjb25zdCBtb2RlQnV0dG9ucyA9IHt9OwoKICAvLyBPbmx5IHNob3cgY29udHJvbHMgaWYgbW9yZSB0aGFuIG9uZSBtb2RlIGlzIGF2YWlsYWJsZQogIGxldCBjb250cm9scyA9IG51bGw7CiAgaWYgKG1vZGVDb25maWcubGVuZ3RoID4gMSkgewogICAgY29udHJvbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGNvbnRyb2xzLmNsYXNzTmFtZSA9ICJjaGFydC1zZWxlY3RfX2NvbnRyb2xzIjsKCiAgICBtb2RlQ29uZmlnLmZvckVhY2goKHsgbW9kZSwgaWNvbiwgbGFiZWwgfSkgPT4gewogICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgYnRuLnR5cGUgPSAiYnV0dG9uIjsKICAgICAgYnRuLmNsYXNzTmFtZSA9ICJjaGFydC1zZWxlY3RfX21vZGUtYnRuIjsKICAgICAgYnRuLmRhdGFzZXQubW9kZSA9IG1vZGU7CiAgICAgIGJ0bi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9ImNoYXJ0LXNlbGVjdF9faWNvbiI+JHtpY29ufTwvc3Bhbj48c3BhbiBjbGFzcz0iY2hhcnQtc2VsZWN0X19sYWJlbCI+JHtsYWJlbH08L3NwYW4+YDsKICAgICAgYnRuLnRpdGxlID0gbGFiZWw7CiAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHNldE1vZGUobW9kZSkpOwogICAgICBjb250cm9scy5hcHBlbmRDaGlsZChidG4pOwogICAgICBtb2RlQnV0dG9uc1ttb2RlXSA9IGJ0bjsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjb250cm9scyk7CiAgfSBlbHNlIHsKICAgIC8vIE5vIGNvbnRyb2xzIC0gY2FudmFzIG5lZWRzIGZ1bGwgcm91bmRlZCBjb3JuZXJzCiAgICBjYW52YXMuY2xhc3NMaXN0LmFkZCgiY2hhcnQtc2VsZWN0X19jYW52YXMtLW5vLWNvbnRyb2xzIik7CiAgfQoKICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTsKICBlbC5hcHBlbmRDaGlsZChjb250YWluZXIpOwoKICAvLyA9PT0gU1RBVEUgPT09CiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgY29uc3QgY2hhcnRJbWFnZSA9IG5ldyBJbWFnZSgpOwogIGxldCBpbWFnZUxvYWRlZCA9IGZhbHNlOwogIGxldCBjdXJyZW50TW9kZSA9IG1vZGVsLmdldCgibW9kZSIpOwoKICAvLyBTZWxlY3Rpb24gc3RhdGUKICBsZXQgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICBsZXQgaXNEcmFnZ2luZyA9IGZhbHNlOwogIGxldCBzZWxlY3Rpb25TdGFydCA9IG51bGw7CiAgbGV0IGRyYWdTdGFydCA9IG51bGw7CiAgbGV0IGxhc3NvUGF0aCA9IFtdOwoKICAvLyA9PT0gQ09PUkRJTkFURSBUUkFOU0ZPUk1TID09PQogIGZ1bmN0aW9uIHBpeGVsVG9EYXRhKHBpeGVsWCwgcGl4ZWxZKSB7CiAgICBjb25zdCBbeE1pbiwgeE1heF0gPSBtb2RlbC5nZXQoInhfYm91bmRzIik7CiAgICBjb25zdCBbeU1pbiwgeU1heF0gPSBtb2RlbC5nZXQoInlfYm91bmRzIik7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKCiAgICAvLyBDbGFtcCB0byBheGVzIGFyZWEKICAgIHBpeGVsWCA9IE1hdGgubWF4KGxlZnQsIE1hdGgubWluKHJpZ2h0LCBwaXhlbFgpKTsKICAgIHBpeGVsWSA9IE1hdGgubWF4KHRvcCwgTWF0aC5taW4oYm90dG9tLCBwaXhlbFkpKTsKCiAgICBjb25zdCBkYXRhWCA9IHhNaW4gKyAoKHBpeGVsWCAtIGxlZnQpIC8gKHJpZ2h0IC0gbGVmdCkpICogKHhNYXggLSB4TWluKTsKICAgIGNvbnN0IGRhdGFZID0geU1pbiArICgoYm90dG9tIC0gcGl4ZWxZKSAvIChib3R0b20gLSB0b3ApKSAqICh5TWF4IC0geU1pbik7CgogICAgcmV0dXJuIHsgeDogZGF0YVgsIHk6IGRhdGFZIH07CiAgfQoKICBmdW5jdGlvbiBkYXRhVG9QaXhlbChkYXRhWCwgZGF0YVkpIHsKICAgIGNvbnN0IFt4TWluLCB4TWF4XSA9IG1vZGVsLmdldCgieF9ib3VuZHMiKTsKICAgIGNvbnN0IFt5TWluLCB5TWF4XSA9IG1vZGVsLmdldCgieV9ib3VuZHMiKTsKICAgIGNvbnN0IFtsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b21dID0gbW9kZWwuZ2V0KCJheGVzX3BpeGVsX2JvdW5kcyIpOwoKICAgIGNvbnN0IHBpeGVsWCA9IGxlZnQgKyAoKGRhdGFYIC0geE1pbikgLyAoeE1heCAtIHhNaW4pKSAqIChyaWdodCAtIGxlZnQpOwogICAgY29uc3QgcGl4ZWxZID0gYm90dG9tIC0gKChkYXRhWSAtIHlNaW4pIC8gKHlNYXggLSB5TWluKSkgKiAoYm90dG9tIC0gdG9wKTsKICAgIHJldHVybiB7IHg6IHBpeGVsWCwgeTogcGl4ZWxZIH07CiAgfQoKICBmdW5jdGlvbiBpc0luc2lkZUF4ZXMoY29vcmRzKSB7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKICAgIHJldHVybiBjb29yZHMueCA+PSBsZWZ0ICYmIGNvb3Jkcy54IDw9IHJpZ2h0ICYmIGNvb3Jkcy55ID49IHRvcCAmJiBjb29yZHMueSA8PSBib3R0b207CiAgfQoKICBmdW5jdGlvbiBpc0luc2lkZVNlbGVjdGlvbihjb29yZHMpIHsKICAgIGlmICghbW9kZWwuZ2V0KCJoYXNfc2VsZWN0aW9uIikpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmdldCgic2VsZWN0aW9uIik7CiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CgogICAgaWYgKG1vZGUgPT09ICJib3giICYmIHNlbGVjdGlvbi54X21pbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGNvbnN0IHRvcExlZnQgPSBkYXRhVG9QaXhlbChzZWxlY3Rpb24ueF9taW4sIHNlbGVjdGlvbi55X21heCk7CiAgICAgIGNvbnN0IGJvdHRvbVJpZ2h0ID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnhfbWF4LCBzZWxlY3Rpb24ueV9taW4pOwogICAgICByZXR1cm4gKAogICAgICAgIGNvb3Jkcy54ID49IHRvcExlZnQueCAmJgogICAgICAgIGNvb3Jkcy54IDw9IGJvdHRvbVJpZ2h0LnggJiYKICAgICAgICBjb29yZHMueSA+PSB0b3BMZWZ0LnkgJiYKICAgICAgICBjb29yZHMueSA8PSBib3R0b21SaWdodC55CiAgICAgICk7CiAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi52ZXJ0aWNlcyAmJiBzZWxlY3Rpb24udmVydGljZXMubGVuZ3RoID49IDMpIHsKICAgICAgLy8gUG9pbnQtaW4tcG9seWdvbiB0ZXN0IGZvciBsYXNzbwogICAgICBjb25zdCBwaXhlbFZlcnRpY2VzID0gc2VsZWN0aW9uLnZlcnRpY2VzLm1hcCgodikgPT4gZGF0YVRvUGl4ZWwodlswXSwgdlsxXSkpOwogICAgICByZXR1cm4gcG9pbnRJblBvbHlnb24oY29vcmRzLCBwaXhlbFZlcnRpY2VzKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHBvaW50SW5Qb2x5Z29uKHBvaW50LCB2ZXJ0aWNlcykgewogICAgbGV0IGluc2lkZSA9IGZhbHNlOwogICAgZm9yIChsZXQgaSA9IDAsIGogPSB2ZXJ0aWNlcy5sZW5ndGggLSAxOyBpIDwgdmVydGljZXMubGVuZ3RoOyBqID0gaSsrKSB7CiAgICAgIGNvbnN0IHhpID0gdmVydGljZXNbaV0ueCwgeWkgPSB2ZXJ0aWNlc1tpXS55OwogICAgICBjb25zdCB4aiA9IHZlcnRpY2VzW2pdLngsIHlqID0gdmVydGljZXNbal0ueTsKICAgICAgaWYgKCgoeWkgPiBwb2ludC55KSAhPT0gKHlqID4gcG9pbnQueSkpICYmCiAgICAgICAgICAocG9pbnQueCA8ICh4aiAtIHhpKSAqIChwb2ludC55IC0geWkpIC8gKHlqIC0geWkpICsgeGkpKSB7CiAgICAgICAgaW5zaWRlID0gIWluc2lkZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGluc2lkZTsKICB9CgogIC8vID09PSBNT0RFIE1BTkFHRU1FTlQgPT09CiAgZnVuY3Rpb24gc2V0TW9kZShtb2RlKSB7CiAgICBjdXJyZW50TW9kZSA9IG1vZGU7CiAgICBtb2RlbC5zZXQoIm1vZGUiLCBtb2RlKTsKICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgdXBkYXRlTW9kZUJ1dHRvbnMoKTsKICAgIGlzU2VsZWN0aW5nID0gZmFsc2U7CiAgICBpc0RyYWdnaW5nID0gZmFsc2U7CiAgICBsYXNzb1BhdGggPSBbXTsKICAgIHNlbGVjdGlvblN0YXJ0ID0gbnVsbDsKICAgIGRyYWdTdGFydCA9IG51bGw7CiAgICBkcmF3KCk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVNb2RlQnV0dG9ucygpIHsKICAgIG1vZGVzLmZvckVhY2goKG1vZGUpID0+IHsKICAgICAgaWYgKG1vZGVCdXR0b25zW21vZGVdKSB7CiAgICAgICAgbW9kZUJ1dHRvbnNbbW9kZV0uY2xhc3NMaXN0LnRvZ2dsZSgiYWN0aXZlIiwgbW9kZSA9PT0gY3VycmVudE1vZGUpOwogICAgICB9CiAgICB9KTsKICB9CgogIC8vID09PSBTRUxFQ1RJT04gTE9HSUMgPT09CiAgZnVuY3Rpb24gY2xlYXJTZWxlY3Rpb24oKSB7CiAgICBtb2RlbC5zZXQoInNlbGVjdGlvbiIsIHt9KTsKICAgIG1vZGVsLnNldCgiaGFzX3NlbGVjdGlvbiIsIGZhbHNlKTsKICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgIGxhc3NvUGF0aCA9IFtdOwogICAgc2VsZWN0aW9uU3RhcnQgPSBudWxsOwogICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgIGRyYXcoKTsKICB9CgogIGZ1bmN0aW9uIGdldENhbnZhc0Nvb3JkcyhldmVudCkgewogICAgY29uc3QgcmVjdCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGNvbnN0IHNjYWxlWCA9IGNhbnZhcy53aWR0aCAvIHJlY3Qud2lkdGg7CiAgICBjb25zdCBzY2FsZVkgPSBjYW52YXMuaGVpZ2h0IC8gcmVjdC5oZWlnaHQ7CiAgICByZXR1cm4gewogICAgICB4OiAoZXZlbnQuY2xpZW50WCAtIHJlY3QubGVmdCkgKiBzY2FsZVgsCiAgICAgIHk6IChldmVudC5jbGllbnRZIC0gcmVjdC50b3ApICogc2NhbGVZLAogICAgfTsKICB9CgogIC8vID09PSBFVkVOVCBIQU5ETEVSUyA9PT0KICBmdW5jdGlvbiBoYW5kbGVNb3VzZURvd24oZXZlbnQpIHsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCBjb29yZHMgPSBnZXRDYW52YXNDb29yZHMoZXZlbnQpOwoKICAgIC8vIENoZWNrIGlmIGNsaWNraW5nIGluc2lkZSBleGlzdGluZyBzZWxlY3Rpb24gKHRvIGRyYWcgaXQpCiAgICBpZiAobW9kZWwuZ2V0KCJoYXNfc2VsZWN0aW9uIikgJiYgaXNJbnNpZGVTZWxlY3Rpb24oY29vcmRzKSkgewogICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgZHJhZ1N0YXJ0ID0gY29vcmRzOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gSWYgdGhlcmUncyBhIHNlbGVjdGlvbiBhbmQgd2UgY2xpY2tlZCBvdXRzaWRlIGl0LCBjbGVhciBpdAogICAgaWYgKG1vZGVsLmdldCgiaGFzX3NlbGVjdGlvbiIpKSB7CiAgICAgIGNsZWFyU2VsZWN0aW9uKCk7CiAgICAgIC8vIERvbid0IHN0YXJ0IGEgbmV3IHNlbGVjdGlvbiBvbiB0aGUgc2FtZSBjbGljawogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gQ2hlY2sgaWYgY2xpY2tpbmcgb3V0c2lkZSBheGVzIGFyZWEgLSBkbyBub3RoaW5nCiAgICBpZiAoIWlzSW5zaWRlQXhlcyhjb29yZHMpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBTdGFydCBuZXcgc2VsZWN0aW9uCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICJib3giKSB7CiAgICAgIGlzU2VsZWN0aW5nID0gdHJ1ZTsKICAgICAgc2VsZWN0aW9uU3RhcnQgPSBjb29yZHM7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAibGFzc28iKSB7CiAgICAgIGlzU2VsZWN0aW5nID0gdHJ1ZTsKICAgICAgbGFzc29QYXRoID0gW2Nvb3Jkc107CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVNb3VzZU1vdmUoZXZlbnQpIHsKICAgIGNvbnN0IGNvb3JkcyA9IGdldENhbnZhc0Nvb3JkcyhldmVudCk7CgogICAgLy8gSGFuZGxlIGRyYWdnaW5nIGV4aXN0aW5nIHNlbGVjdGlvbgogICAgaWYgKGlzRHJhZ2dpbmcgJiYgZHJhZ1N0YXJ0KSB7CiAgICAgIGNvbnN0IGR4ID0gY29vcmRzLnggLSBkcmFnU3RhcnQueDsKICAgICAgY29uc3QgZHkgPSBjb29yZHMueSAtIGRyYWdTdGFydC55OwogICAgICBtb3ZlU2VsZWN0aW9uKGR4LCBkeSk7CiAgICAgIGRyYWdTdGFydCA9IGNvb3JkczsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFVwZGF0ZSBjdXJzb3IgYmFzZWQgb24gaG92ZXIgc3RhdGUKICAgIGlmIChtb2RlbC5nZXQoImhhc19zZWxlY3Rpb24iKSAmJiBpc0luc2lkZVNlbGVjdGlvbihjb29yZHMpKSB7CiAgICAgIGNhbnZhcy5zdHlsZS5jdXJzb3IgPSAibW92ZSI7CiAgICB9IGVsc2UgewogICAgICBjYW52YXMuc3R5bGUuY3Vyc29yID0gImNyb3NzaGFpciI7CiAgICB9CgogICAgLy8gSGFuZGxlIGNyZWF0aW5nIG5ldyBzZWxlY3Rpb24KICAgIGlmIChjdXJyZW50TW9kZSA9PT0gImJveCIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgZHJhdygpOwogICAgICBkcmF3Qm94UHJldmlldyhzZWxlY3Rpb25TdGFydCwgY29vcmRzKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudE1vZGUgPT09ICJsYXNzbyIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgbGFzc29QYXRoLnB1c2goY29vcmRzKTsKICAgICAgZHJhdygpOwogICAgICBkcmF3TGFzc29QcmV2aWV3KGxhc3NvUGF0aCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVNb3VzZVVwKGV2ZW50KSB7CiAgICBjb25zdCBjb29yZHMgPSBnZXRDYW52YXNDb29yZHMoZXZlbnQpOwoKICAgIGlmIChpc0RyYWdnaW5nKSB7CiAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChjdXJyZW50TW9kZSA9PT0gImJveCIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgY29uc3Qgc3RhcnREYXRhID0gcGl4ZWxUb0RhdGEoc2VsZWN0aW9uU3RhcnQueCwgc2VsZWN0aW9uU3RhcnQueSk7CiAgICAgIGNvbnN0IGVuZERhdGEgPSBwaXhlbFRvRGF0YShjb29yZHMueCwgY29vcmRzLnkpOwoKICAgICAgLy8gT25seSBjcmVhdGUgc2VsZWN0aW9uIGlmIGl0IGhhcyBzb21lIHNpemUKICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLmFicyhlbmREYXRhLnggLSBzdGFydERhdGEueCk7CiAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGguYWJzKGVuZERhdGEueSAtIHN0YXJ0RGF0YS55KTsKICAgICAgaWYgKHdpZHRoID4gMC4wMSB8fCBoZWlnaHQgPiAwLjAxKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gewogICAgICAgICAgeF9taW46IE1hdGgubWluKHN0YXJ0RGF0YS54LCBlbmREYXRhLngpLAogICAgICAgICAgeV9taW46IE1hdGgubWluKHN0YXJ0RGF0YS55LCBlbmREYXRhLnkpLAogICAgICAgICAgeF9tYXg6IE1hdGgubWF4KHN0YXJ0RGF0YS54LCBlbmREYXRhLngpLAogICAgICAgICAgeV9tYXg6IE1hdGgubWF4KHN0YXJ0RGF0YS55LCBlbmREYXRhLnkpLAogICAgICAgIH07CiAgICAgICAgbW9kZWwuc2V0KCJzZWxlY3Rpb24iLCBzZWxlY3Rpb24pOwogICAgICAgIG1vZGVsLnNldCgiaGFzX3NlbGVjdGlvbiIsIHRydWUpOwogICAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgICB9CgogICAgICBpc1NlbGVjdGluZyA9IGZhbHNlOwogICAgICBzZWxlY3Rpb25TdGFydCA9IG51bGw7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAibGFzc28iICYmIGlzU2VsZWN0aW5nKSB7CiAgICAgIGlmIChsYXNzb1BhdGgubGVuZ3RoID49IDMpIHsKICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IGxhc3NvUGF0aC5tYXAoKHApID0+IHsKICAgICAgICAgIGNvbnN0IGQgPSBwaXhlbFRvRGF0YShwLngsIHAueSk7CiAgICAgICAgICByZXR1cm4gW2QueCwgZC55XTsKICAgICAgICB9KTsKICAgICAgICBtb2RlbC5zZXQoInNlbGVjdGlvbiIsIHsgdmVydGljZXMgfSk7CiAgICAgICAgbW9kZWwuc2V0KCJoYXNfc2VsZWN0aW9uIiwgdHJ1ZSk7CiAgICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICAgIH0KICAgICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgICAgbGFzc29QYXRoID0gW107CiAgICB9CgogICAgZHJhdygpOwogIH0KCiAgZnVuY3Rpb24gbW92ZVNlbGVjdGlvbihkeCwgZHkpIHsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmdldCgic2VsZWN0aW9uIik7CiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKCiAgICAvLyBDb252ZXJ0IHBpeGVsIGRlbHRhIHRvIGRhdGEgZGVsdGEKICAgIGNvbnN0IFt4TWluLCB4TWF4XSA9IG1vZGVsLmdldCgieF9ib3VuZHMiKTsKICAgIGNvbnN0IFt5TWluLCB5TWF4XSA9IG1vZGVsLmdldCgieV9ib3VuZHMiKTsKICAgIGNvbnN0IGRhdGFXaWR0aCA9IHhNYXggLSB4TWluOwogICAgY29uc3QgZGF0YUhlaWdodCA9IHlNYXggLSB5TWluOwogICAgY29uc3QgcGl4ZWxXaWR0aCA9IHJpZ2h0IC0gbGVmdDsKICAgIGNvbnN0IHBpeGVsSGVpZ2h0ID0gYm90dG9tIC0gdG9wOwoKICAgIGNvbnN0IGRkeCA9IChkeCAvIHBpeGVsV2lkdGgpICogZGF0YVdpZHRoOwogICAgY29uc3QgZGR5ID0gLShkeSAvIHBpeGVsSGVpZ2h0KSAqIGRhdGFIZWlnaHQ7IC8vIEludmVydGVkIFkKCiAgICBpZiAobW9kZSA9PT0gImJveCIgJiYgc2VsZWN0aW9uLnhfbWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgY29uc3QgbmV3U2VsZWN0aW9uID0gewogICAgICAgIHhfbWluOiBzZWxlY3Rpb24ueF9taW4gKyBkZHgsCiAgICAgICAgeV9taW46IHNlbGVjdGlvbi55X21pbiArIGRkeSwKICAgICAgICB4X21heDogc2VsZWN0aW9uLnhfbWF4ICsgZGR4LAogICAgICAgIHlfbWF4OiBzZWxlY3Rpb24ueV9tYXggKyBkZHksCiAgICAgIH07CiAgICAgIG1vZGVsLnNldCgic2VsZWN0aW9uIiwgbmV3U2VsZWN0aW9uKTsKICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi52ZXJ0aWNlcykgewogICAgICBjb25zdCBuZXdWZXJ0aWNlcyA9IHNlbGVjdGlvbi52ZXJ0aWNlcy5tYXAoKHYpID0+IFt2WzBdICsgZGR4LCB2WzFdICsgZGR5XSk7CiAgICAgIG1vZGVsLnNldCgic2VsZWN0aW9uIiwgeyB2ZXJ0aWNlczogbmV3VmVydGljZXMgfSk7CiAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgfQoKICAgIGRyYXcoKTsKICB9CgogIC8vID09PSBEUkFXSU5HID09PQogIGZ1bmN0aW9uIGRyYXcoKSB7CiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CgogICAgaWYgKGltYWdlTG9hZGVkKSB7CiAgICAgIGN0eC5kcmF3SW1hZ2UoY2hhcnRJbWFnZSwgMCwgMCk7CiAgICB9CgogICAgaWYgKG1vZGVsLmdldCgiaGFzX3NlbGVjdGlvbiIpKSB7CiAgICAgIGRyYXdTZWxlY3Rpb24oKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGhleFRvUmdiYShoZXgsIGFscGhhKSB7CiAgICBjb25zdCByID0gcGFyc2VJbnQoaGV4LnNsaWNlKDEsIDMpLCAxNik7CiAgICBjb25zdCBnID0gcGFyc2VJbnQoaGV4LnNsaWNlKDMsIDUpLCAxNik7CiAgICBjb25zdCBiID0gcGFyc2VJbnQoaGV4LnNsaWNlKDUsIDcpLCAxNik7CiAgICByZXR1cm4gYHJnYmEoJHtyfSwgJHtnfSwgJHtifSwgJHthbHBoYX0pYDsKICB9CgogIGZ1bmN0aW9uIGRyYXdTZWxlY3Rpb24oKSB7CiAgICBjb25zdCBzZWxlY3Rpb24gPSBtb2RlbC5nZXQoInNlbGVjdGlvbiIpOwogICAgY29uc3QgY29sb3IgPSBtb2RlbC5nZXQoInNlbGVjdGlvbl9jb2xvciIpOwogICAgY29uc3Qgb3BhY2l0eSA9IG1vZGVsLmdldCgic2VsZWN0aW9uX29wYWNpdHkiKTsKICAgIGNvbnN0IHN0cm9rZVdpZHRoID0gbW9kZWwuZ2V0KCJzdHJva2Vfd2lkdGgiKTsKCiAgICBjdHguc2F2ZSgpOwogICAgY3R4LmZpbGxTdHlsZSA9IGhleFRvUmdiYShjb2xvciwgb3BhY2l0eSk7CiAgICBjdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgIGN0eC5saW5lV2lkdGggPSBzdHJva2VXaWR0aDsKCiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICBpZiAobW9kZSA9PT0gImJveCIgJiYgc2VsZWN0aW9uLnhfbWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgY29uc3QgdG9wTGVmdCA9IGRhdGFUb1BpeGVsKHNlbGVjdGlvbi54X21pbiwgc2VsZWN0aW9uLnlfbWF4KTsKICAgICAgY29uc3QgYm90dG9tUmlnaHQgPSBkYXRhVG9QaXhlbChzZWxlY3Rpb24ueF9tYXgsIHNlbGVjdGlvbi55X21pbik7CiAgICAgIGNvbnN0IHcgPSBib3R0b21SaWdodC54IC0gdG9wTGVmdC54OwogICAgICBjb25zdCBoID0gYm90dG9tUmlnaHQueSAtIHRvcExlZnQueTsKCiAgICAgIGN0eC5maWxsUmVjdCh0b3BMZWZ0LngsIHRvcExlZnQueSwgdywgaCk7CiAgICAgIGN0eC5zdHJva2VSZWN0KHRvcExlZnQueCwgdG9wTGVmdC55LCB3LCBoKTsKICAgIH0gZWxzZSBpZiAoc2VsZWN0aW9uLnZlcnRpY2VzICYmIHNlbGVjdGlvbi52ZXJ0aWNlcy5sZW5ndGggPj0gMykgewogICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgIGNvbnN0IGZpcnN0ID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnZlcnRpY2VzWzBdWzBdLCBzZWxlY3Rpb24udmVydGljZXNbMF1bMV0pOwogICAgICBjdHgubW92ZVRvKGZpcnN0LngsIGZpcnN0LnkpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzZWxlY3Rpb24udmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBwID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnZlcnRpY2VzW2ldWzBdLCBzZWxlY3Rpb24udmVydGljZXNbaV1bMV0pOwogICAgICAgIGN0eC5saW5lVG8ocC54LCBwLnkpOwogICAgICB9CgogICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgIGN0eC5maWxsKCk7CiAgICAgIGN0eC5zdHJva2UoKTsKICAgIH0KCiAgICBjdHgucmVzdG9yZSgpOwogIH0KCiAgZnVuY3Rpb24gZHJhd0JveFByZXZpZXcoc3RhcnQsIGVuZCkgewogICAgY29uc3QgY29sb3IgPSBtb2RlbC5nZXQoInNlbGVjdGlvbl9jb2xvciIpOwogICAgY3R4LnNhdmUoKTsKICAgIGN0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwogICAgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICBjdHguc2V0TGluZURhc2goWzUsIDVdKTsKICAgIGN0eC5zdHJva2VSZWN0KAogICAgICBNYXRoLm1pbihzdGFydC54LCBlbmQueCksCiAgICAgIE1hdGgubWluKHN0YXJ0LnksIGVuZC55KSwKICAgICAgTWF0aC5hYnMoZW5kLnggLSBzdGFydC54KSwKICAgICAgTWF0aC5hYnMoZW5kLnkgLSBzdGFydC55KQogICAgKTsKICAgIGN0eC5yZXN0b3JlKCk7CiAgfQoKICBmdW5jdGlvbiBkcmF3TGFzc29QcmV2aWV3KHBhdGgpIHsKICAgIGlmIChwYXRoLmxlbmd0aCA8IDIpIHJldHVybjsKCiAgICBjb25zdCBjb2xvciA9IG1vZGVsLmdldCgic2VsZWN0aW9uX2NvbG9yIik7CiAgICBjdHguc2F2ZSgpOwogICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICBjdHgubGluZVdpZHRoID0gMjsKICAgIGN0eC5iZWdpblBhdGgoKTsKICAgIGN0eC5tb3ZlVG8ocGF0aFswXS54LCBwYXRoWzBdLnkpOwogICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgIGN0eC5saW5lVG8ocGF0aFtpXS54LCBwYXRoW2ldLnkpOwogICAgfQogICAgY3R4LnN0cm9rZSgpOwogICAgY3R4LnJlc3RvcmUoKTsKICB9CgogIC8vID09PSBFVkVOVCBCSU5ESU5HID09PQogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCBoYW5kbGVNb3VzZURvd24pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBoYW5kbGVNb3VzZU1vdmUpOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgaGFuZGxlTW91c2VVcCk7CgogIC8vIFRvdWNoIHN1cHBvcnQKICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsIChlKSA9PiB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCB0b3VjaCA9IGUudG91Y2hlc1swXTsKICAgIGhhbmRsZU1vdXNlRG93bih7CiAgICAgIGNsaWVudFg6IHRvdWNoLmNsaWVudFgsCiAgICAgIGNsaWVudFk6IHRvdWNoLmNsaWVudFksCiAgICAgIHByZXZlbnREZWZhdWx0OiAoKSA9PiB7fSwKICAgIH0pOwogIH0pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCAoZSkgPT4gewogICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07CiAgICBoYW5kbGVNb3VzZU1vdmUoeyBjbGllbnRYOiB0b3VjaC5jbGllbnRYLCBjbGllbnRZOiB0b3VjaC5jbGllbnRZIH0pOwogIH0pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaGVuZCIsIChlKSA9PiB7CiAgICBjb25zdCB0b3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07CiAgICBoYW5kbGVNb3VzZVVwKHsgY2xpZW50WDogdG91Y2guY2xpZW50WCwgY2xpZW50WTogdG91Y2guY2xpZW50WSB9KTsKICB9KTsKCiAgLy8gPT09IE1PREVMIFNZTkMgPT09CiAgY2hhcnRJbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICBpbWFnZUxvYWRlZCA9IHRydWU7CiAgICBkcmF3KCk7CiAgfTsKICBjaGFydEltYWdlLnNyYyA9IG1vZGVsLmdldCgiY2hhcnRfYmFzZTY0Iik7CgogIG1vZGVsLm9uKCJjaGFuZ2U6bW9kZSIsICgpID0+IHsKICAgIGN1cnJlbnRNb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICB1cGRhdGVNb2RlQnV0dG9ucygpOwogICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgIGxhc3NvUGF0aCA9IFtdOwogICAgc2VsZWN0aW9uU3RhcnQgPSBudWxsOwogICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgIGRyYXcoKTsKICB9KTsKICBtb2RlbC5vbigiY2hhbmdlOnNlbGVjdGlvbiIsIGRyYXcpOwogIG1vZGVsLm9uKCJjaGFuZ2U6aGFzX3NlbGVjdGlvbiIsIGRyYXcpOwogIG1vZGVsLm9uKCJjaGFuZ2U6Y2hhcnRfYmFzZTY0IiwgKCkgPT4gewogICAgY2hhcnRJbWFnZS5zcmMgPSBtb2RlbC5nZXQoImNoYXJ0X2Jhc2U2NCIpOwogIH0pOwogIG1vZGVsLm9uKCJjaGFuZ2U6c2VsZWN0aW9uX2NvbG9yIiwgZHJhdyk7CiAgbW9kZWwub24oImNoYW5nZTpzZWxlY3Rpb25fb3BhY2l0eSIsIGRyYXcpOwoKICAvLyBJbml0aWFsIHN0YXRlCiAgdXBkYXRlTW9kZUJ1dHRvbnMoKTsKICBkcmF3KCk7Cn0KCmV4cG9ydCBkZWZhdWx0IHsgcmVuZGVyIH07Cg==&quot;' data-js-hash='&quot;1cf459cbac0c188b30b30a1bc4b66493&quot;'></marimo-anywidget></marimo-ui-element><marimo-ui-element object-id='BYtC-1' random-id='e023d1cb-4f34-9175-f778-d494837c99c6'><marimo-anywidget data-initial-value='{&quot;model_id&quot;:&quot;d0d32c504fcb49e0a1270695a2e9226b&quot;}' data-label='null' data-js-url='&quot;data:text/javascript;base64,ZnVuY3Rpb24gcmVuZGVyKHsgbW9kZWwsIGVsIH0pIHsKICAvLyA9PT0gRE9NIFNFVFVQID09PQogIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogIGNvbnRhaW5lci5jbGFzc05hbWUgPSAiY2hhcnQtc2VsZWN0IjsKCiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgY2FudmFzLndpZHRoID0gbW9kZWwuZ2V0KCJ3aWR0aCIpOwogIGNhbnZhcy5oZWlnaHQgPSBtb2RlbC5nZXQoImhlaWdodCIpOwogIGNhbnZhcy5jbGFzc05hbWUgPSAiY2hhcnQtc2VsZWN0X19jYW52YXMiOwoKICAvLyBTVkcgaWNvbnMKICBjb25zdCBib3hJY29uID0gYDxzdmcgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIiB2aWV3Qm94PSIwIDAgMTQgMTQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjEuNSI+CiAgICA8cmVjdCB4PSIyIiB5PSIyIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIHJ4PSIxIi8+CiAgPC9zdmc+YDsKICBjb25zdCBsYXNzb0ljb24gPSBgPHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJjdXJyZW50Q29sb3IiIHN0cm9rZS13aWR0aD0iMS41Ij4KICAgIDxwYXRoIGQ9Ik03IDJDNCAyIDIgNC41IDIgN2MwIDIgMSAzLjUgMyA0TTEwIDExYzEuNS0xIDItMi41IDItNCAwLTIuNS0yLTUtNS01Ii8+CiAgICA8Y2lyY2xlIGN4PSI1IiBjeT0iMTEiIHI9IjEuNSIgZmlsbD0iY3VycmVudENvbG9yIi8+CiAgPC9zdmc+YDsKCiAgLy8gQXZhaWxhYmxlIG1vZGVzIGZyb20gbW9kZWwKICBjb25zdCBhdmFpbGFibGVNb2RlcyA9IG1vZGVsLmdldCgibW9kZXMiKSB8fCBbImJveCIsICJsYXNzbyJdOwogIGNvbnN0IG1vZGVDb25maWcgPSBbCiAgICB7IG1vZGU6ICJib3giLCBpY29uOiBib3hJY29uLCBsYWJlbDogIkJveCIgfSwKICAgIHsgbW9kZTogImxhc3NvIiwgaWNvbjogbGFzc29JY29uLCBsYWJlbDogIkxhc3NvIiB9LAogIF0uZmlsdGVyKChtKSA9PiBhdmFpbGFibGVNb2Rlcy5pbmNsdWRlcyhtLm1vZGUpKTsKCiAgY29uc3QgbW9kZXMgPSBtb2RlQ29uZmlnLm1hcCgobSkgPT4gbS5tb2RlKTsKICBjb25zdCBtb2RlQnV0dG9ucyA9IHt9OwoKICAvLyBPbmx5IHNob3cgY29udHJvbHMgaWYgbW9yZSB0aGFuIG9uZSBtb2RlIGlzIGF2YWlsYWJsZQogIGxldCBjb250cm9scyA9IG51bGw7CiAgaWYgKG1vZGVDb25maWcubGVuZ3RoID4gMSkgewogICAgY29udHJvbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGNvbnRyb2xzLmNsYXNzTmFtZSA9ICJjaGFydC1zZWxlY3RfX2NvbnRyb2xzIjsKCiAgICBtb2RlQ29uZmlnLmZvckVhY2goKHsgbW9kZSwgaWNvbiwgbGFiZWwgfSkgPT4gewogICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgYnRuLnR5cGUgPSAiYnV0dG9uIjsKICAgICAgYnRuLmNsYXNzTmFtZSA9ICJjaGFydC1zZWxlY3RfX21vZGUtYnRuIjsKICAgICAgYnRuLmRhdGFzZXQubW9kZSA9IG1vZGU7CiAgICAgIGJ0bi5pbm5lckhUTUwgPSBgPHNwYW4gY2xhc3M9ImNoYXJ0LXNlbGVjdF9faWNvbiI+JHtpY29ufTwvc3Bhbj48c3BhbiBjbGFzcz0iY2hhcnQtc2VsZWN0X19sYWJlbCI+JHtsYWJlbH08L3NwYW4+YDsKICAgICAgYnRuLnRpdGxlID0gbGFiZWw7CiAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHNldE1vZGUobW9kZSkpOwogICAgICBjb250cm9scy5hcHBlbmRDaGlsZChidG4pOwogICAgICBtb2RlQnV0dG9uc1ttb2RlXSA9IGJ0bjsKICAgIH0pOwoKICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChjb250cm9scyk7CiAgfSBlbHNlIHsKICAgIC8vIE5vIGNvbnRyb2xzIC0gY2FudmFzIG5lZWRzIGZ1bGwgcm91bmRlZCBjb3JuZXJzCiAgICBjYW52YXMuY2xhc3NMaXN0LmFkZCgiY2hhcnQtc2VsZWN0X19jYW52YXMtLW5vLWNvbnRyb2xzIik7CiAgfQoKICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTsKICBlbC5hcHBlbmRDaGlsZChjb250YWluZXIpOwoKICAvLyA9PT0gU1RBVEUgPT09CiAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgY29uc3QgY2hhcnRJbWFnZSA9IG5ldyBJbWFnZSgpOwogIGxldCBpbWFnZUxvYWRlZCA9IGZhbHNlOwogIGxldCBjdXJyZW50TW9kZSA9IG1vZGVsLmdldCgibW9kZSIpOwoKICAvLyBTZWxlY3Rpb24gc3RhdGUKICBsZXQgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICBsZXQgaXNEcmFnZ2luZyA9IGZhbHNlOwogIGxldCBzZWxlY3Rpb25TdGFydCA9IG51bGw7CiAgbGV0IGRyYWdTdGFydCA9IG51bGw7CiAgbGV0IGxhc3NvUGF0aCA9IFtdOwoKICAvLyA9PT0gQ09PUkRJTkFURSBUUkFOU0ZPUk1TID09PQogIGZ1bmN0aW9uIHBpeGVsVG9EYXRhKHBpeGVsWCwgcGl4ZWxZKSB7CiAgICBjb25zdCBbeE1pbiwgeE1heF0gPSBtb2RlbC5nZXQoInhfYm91bmRzIik7CiAgICBjb25zdCBbeU1pbiwgeU1heF0gPSBtb2RlbC5nZXQoInlfYm91bmRzIik7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKCiAgICAvLyBDbGFtcCB0byBheGVzIGFyZWEKICAgIHBpeGVsWCA9IE1hdGgubWF4KGxlZnQsIE1hdGgubWluKHJpZ2h0LCBwaXhlbFgpKTsKICAgIHBpeGVsWSA9IE1hdGgubWF4KHRvcCwgTWF0aC5taW4oYm90dG9tLCBwaXhlbFkpKTsKCiAgICBjb25zdCBkYXRhWCA9IHhNaW4gKyAoKHBpeGVsWCAtIGxlZnQpIC8gKHJpZ2h0IC0gbGVmdCkpICogKHhNYXggLSB4TWluKTsKICAgIGNvbnN0IGRhdGFZID0geU1pbiArICgoYm90dG9tIC0gcGl4ZWxZKSAvIChib3R0b20gLSB0b3ApKSAqICh5TWF4IC0geU1pbik7CgogICAgcmV0dXJuIHsgeDogZGF0YVgsIHk6IGRhdGFZIH07CiAgfQoKICBmdW5jdGlvbiBkYXRhVG9QaXhlbChkYXRhWCwgZGF0YVkpIHsKICAgIGNvbnN0IFt4TWluLCB4TWF4XSA9IG1vZGVsLmdldCgieF9ib3VuZHMiKTsKICAgIGNvbnN0IFt5TWluLCB5TWF4XSA9IG1vZGVsLmdldCgieV9ib3VuZHMiKTsKICAgIGNvbnN0IFtsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b21dID0gbW9kZWwuZ2V0KCJheGVzX3BpeGVsX2JvdW5kcyIpOwoKICAgIGNvbnN0IHBpeGVsWCA9IGxlZnQgKyAoKGRhdGFYIC0geE1pbikgLyAoeE1heCAtIHhNaW4pKSAqIChyaWdodCAtIGxlZnQpOwogICAgY29uc3QgcGl4ZWxZID0gYm90dG9tIC0gKChkYXRhWSAtIHlNaW4pIC8gKHlNYXggLSB5TWluKSkgKiAoYm90dG9tIC0gdG9wKTsKICAgIHJldHVybiB7IHg6IHBpeGVsWCwgeTogcGl4ZWxZIH07CiAgfQoKICBmdW5jdGlvbiBpc0luc2lkZUF4ZXMoY29vcmRzKSB7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKICAgIHJldHVybiBjb29yZHMueCA+PSBsZWZ0ICYmIGNvb3Jkcy54IDw9IHJpZ2h0ICYmIGNvb3Jkcy55ID49IHRvcCAmJiBjb29yZHMueSA8PSBib3R0b207CiAgfQoKICBmdW5jdGlvbiBpc0luc2lkZVNlbGVjdGlvbihjb29yZHMpIHsKICAgIGlmICghbW9kZWwuZ2V0KCJoYXNfc2VsZWN0aW9uIikpIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmdldCgic2VsZWN0aW9uIik7CiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CgogICAgaWYgKG1vZGUgPT09ICJib3giICYmIHNlbGVjdGlvbi54X21pbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGNvbnN0IHRvcExlZnQgPSBkYXRhVG9QaXhlbChzZWxlY3Rpb24ueF9taW4sIHNlbGVjdGlvbi55X21heCk7CiAgICAgIGNvbnN0IGJvdHRvbVJpZ2h0ID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnhfbWF4LCBzZWxlY3Rpb24ueV9taW4pOwogICAgICByZXR1cm4gKAogICAgICAgIGNvb3Jkcy54ID49IHRvcExlZnQueCAmJgogICAgICAgIGNvb3Jkcy54IDw9IGJvdHRvbVJpZ2h0LnggJiYKICAgICAgICBjb29yZHMueSA+PSB0b3BMZWZ0LnkgJiYKICAgICAgICBjb29yZHMueSA8PSBib3R0b21SaWdodC55CiAgICAgICk7CiAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi52ZXJ0aWNlcyAmJiBzZWxlY3Rpb24udmVydGljZXMubGVuZ3RoID49IDMpIHsKICAgICAgLy8gUG9pbnQtaW4tcG9seWdvbiB0ZXN0IGZvciBsYXNzbwogICAgICBjb25zdCBwaXhlbFZlcnRpY2VzID0gc2VsZWN0aW9uLnZlcnRpY2VzLm1hcCgodikgPT4gZGF0YVRvUGl4ZWwodlswXSwgdlsxXSkpOwogICAgICByZXR1cm4gcG9pbnRJblBvbHlnb24oY29vcmRzLCBwaXhlbFZlcnRpY2VzKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIHBvaW50SW5Qb2x5Z29uKHBvaW50LCB2ZXJ0aWNlcykgewogICAgbGV0IGluc2lkZSA9IGZhbHNlOwogICAgZm9yIChsZXQgaSA9IDAsIGogPSB2ZXJ0aWNlcy5sZW5ndGggLSAxOyBpIDwgdmVydGljZXMubGVuZ3RoOyBqID0gaSsrKSB7CiAgICAgIGNvbnN0IHhpID0gdmVydGljZXNbaV0ueCwgeWkgPSB2ZXJ0aWNlc1tpXS55OwogICAgICBjb25zdCB4aiA9IHZlcnRpY2VzW2pdLngsIHlqID0gdmVydGljZXNbal0ueTsKICAgICAgaWYgKCgoeWkgPiBwb2ludC55KSAhPT0gKHlqID4gcG9pbnQueSkpICYmCiAgICAgICAgICAocG9pbnQueCA8ICh4aiAtIHhpKSAqIChwb2ludC55IC0geWkpIC8gKHlqIC0geWkpICsgeGkpKSB7CiAgICAgICAgaW5zaWRlID0gIWluc2lkZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGluc2lkZTsKICB9CgogIC8vID09PSBNT0RFIE1BTkFHRU1FTlQgPT09CiAgZnVuY3Rpb24gc2V0TW9kZShtb2RlKSB7CiAgICBjdXJyZW50TW9kZSA9IG1vZGU7CiAgICBtb2RlbC5zZXQoIm1vZGUiLCBtb2RlKTsKICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgdXBkYXRlTW9kZUJ1dHRvbnMoKTsKICAgIGlzU2VsZWN0aW5nID0gZmFsc2U7CiAgICBpc0RyYWdnaW5nID0gZmFsc2U7CiAgICBsYXNzb1BhdGggPSBbXTsKICAgIHNlbGVjdGlvblN0YXJ0ID0gbnVsbDsKICAgIGRyYWdTdGFydCA9IG51bGw7CiAgICBkcmF3KCk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVNb2RlQnV0dG9ucygpIHsKICAgIG1vZGVzLmZvckVhY2goKG1vZGUpID0+IHsKICAgICAgaWYgKG1vZGVCdXR0b25zW21vZGVdKSB7CiAgICAgICAgbW9kZUJ1dHRvbnNbbW9kZV0uY2xhc3NMaXN0LnRvZ2dsZSgiYWN0aXZlIiwgbW9kZSA9PT0gY3VycmVudE1vZGUpOwogICAgICB9CiAgICB9KTsKICB9CgogIC8vID09PSBTRUxFQ1RJT04gTE9HSUMgPT09CiAgZnVuY3Rpb24gY2xlYXJTZWxlY3Rpb24oKSB7CiAgICBtb2RlbC5zZXQoInNlbGVjdGlvbiIsIHt9KTsKICAgIG1vZGVsLnNldCgiaGFzX3NlbGVjdGlvbiIsIGZhbHNlKTsKICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgIGxhc3NvUGF0aCA9IFtdOwogICAgc2VsZWN0aW9uU3RhcnQgPSBudWxsOwogICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgIGRyYXcoKTsKICB9CgogIGZ1bmN0aW9uIGdldENhbnZhc0Nvb3JkcyhldmVudCkgewogICAgY29uc3QgcmVjdCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGNvbnN0IHNjYWxlWCA9IGNhbnZhcy53aWR0aCAvIHJlY3Qud2lkdGg7CiAgICBjb25zdCBzY2FsZVkgPSBjYW52YXMuaGVpZ2h0IC8gcmVjdC5oZWlnaHQ7CiAgICByZXR1cm4gewogICAgICB4OiAoZXZlbnQuY2xpZW50WCAtIHJlY3QubGVmdCkgKiBzY2FsZVgsCiAgICAgIHk6IChldmVudC5jbGllbnRZIC0gcmVjdC50b3ApICogc2NhbGVZLAogICAgfTsKICB9CgogIC8vID09PSBFVkVOVCBIQU5ETEVSUyA9PT0KICBmdW5jdGlvbiBoYW5kbGVNb3VzZURvd24oZXZlbnQpIHsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCBjb29yZHMgPSBnZXRDYW52YXNDb29yZHMoZXZlbnQpOwoKICAgIC8vIENoZWNrIGlmIGNsaWNraW5nIGluc2lkZSBleGlzdGluZyBzZWxlY3Rpb24gKHRvIGRyYWcgaXQpCiAgICBpZiAobW9kZWwuZ2V0KCJoYXNfc2VsZWN0aW9uIikgJiYgaXNJbnNpZGVTZWxlY3Rpb24oY29vcmRzKSkgewogICAgICBpc0RyYWdnaW5nID0gdHJ1ZTsKICAgICAgZHJhZ1N0YXJ0ID0gY29vcmRzOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gSWYgdGhlcmUncyBhIHNlbGVjdGlvbiBhbmQgd2UgY2xpY2tlZCBvdXRzaWRlIGl0LCBjbGVhciBpdAogICAgaWYgKG1vZGVsLmdldCgiaGFzX3NlbGVjdGlvbiIpKSB7CiAgICAgIGNsZWFyU2VsZWN0aW9uKCk7CiAgICAgIC8vIERvbid0IHN0YXJ0IGEgbmV3IHNlbGVjdGlvbiBvbiB0aGUgc2FtZSBjbGljawogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gQ2hlY2sgaWYgY2xpY2tpbmcgb3V0c2lkZSBheGVzIGFyZWEgLSBkbyBub3RoaW5nCiAgICBpZiAoIWlzSW5zaWRlQXhlcyhjb29yZHMpKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBTdGFydCBuZXcgc2VsZWN0aW9uCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICJib3giKSB7CiAgICAgIGlzU2VsZWN0aW5nID0gdHJ1ZTsKICAgICAgc2VsZWN0aW9uU3RhcnQgPSBjb29yZHM7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAibGFzc28iKSB7CiAgICAgIGlzU2VsZWN0aW5nID0gdHJ1ZTsKICAgICAgbGFzc29QYXRoID0gW2Nvb3Jkc107CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVNb3VzZU1vdmUoZXZlbnQpIHsKICAgIGNvbnN0IGNvb3JkcyA9IGdldENhbnZhc0Nvb3JkcyhldmVudCk7CgogICAgLy8gSGFuZGxlIGRyYWdnaW5nIGV4aXN0aW5nIHNlbGVjdGlvbgogICAgaWYgKGlzRHJhZ2dpbmcgJiYgZHJhZ1N0YXJ0KSB7CiAgICAgIGNvbnN0IGR4ID0gY29vcmRzLnggLSBkcmFnU3RhcnQueDsKICAgICAgY29uc3QgZHkgPSBjb29yZHMueSAtIGRyYWdTdGFydC55OwogICAgICBtb3ZlU2VsZWN0aW9uKGR4LCBkeSk7CiAgICAgIGRyYWdTdGFydCA9IGNvb3JkczsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFVwZGF0ZSBjdXJzb3IgYmFzZWQgb24gaG92ZXIgc3RhdGUKICAgIGlmIChtb2RlbC5nZXQoImhhc19zZWxlY3Rpb24iKSAmJiBpc0luc2lkZVNlbGVjdGlvbihjb29yZHMpKSB7CiAgICAgIGNhbnZhcy5zdHlsZS5jdXJzb3IgPSAibW92ZSI7CiAgICB9IGVsc2UgewogICAgICBjYW52YXMuc3R5bGUuY3Vyc29yID0gImNyb3NzaGFpciI7CiAgICB9CgogICAgLy8gSGFuZGxlIGNyZWF0aW5nIG5ldyBzZWxlY3Rpb24KICAgIGlmIChjdXJyZW50TW9kZSA9PT0gImJveCIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgZHJhdygpOwogICAgICBkcmF3Qm94UHJldmlldyhzZWxlY3Rpb25TdGFydCwgY29vcmRzKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudE1vZGUgPT09ICJsYXNzbyIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgbGFzc29QYXRoLnB1c2goY29vcmRzKTsKICAgICAgZHJhdygpOwogICAgICBkcmF3TGFzc29QcmV2aWV3KGxhc3NvUGF0aCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBoYW5kbGVNb3VzZVVwKGV2ZW50KSB7CiAgICBjb25zdCBjb29yZHMgPSBnZXRDYW52YXNDb29yZHMoZXZlbnQpOwoKICAgIGlmIChpc0RyYWdnaW5nKSB7CiAgICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmIChjdXJyZW50TW9kZSA9PT0gImJveCIgJiYgaXNTZWxlY3RpbmcpIHsKICAgICAgY29uc3Qgc3RhcnREYXRhID0gcGl4ZWxUb0RhdGEoc2VsZWN0aW9uU3RhcnQueCwgc2VsZWN0aW9uU3RhcnQueSk7CiAgICAgIGNvbnN0IGVuZERhdGEgPSBwaXhlbFRvRGF0YShjb29yZHMueCwgY29vcmRzLnkpOwoKICAgICAgLy8gT25seSBjcmVhdGUgc2VsZWN0aW9uIGlmIGl0IGhhcyBzb21lIHNpemUKICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLmFicyhlbmREYXRhLnggLSBzdGFydERhdGEueCk7CiAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGguYWJzKGVuZERhdGEueSAtIHN0YXJ0RGF0YS55KTsKICAgICAgaWYgKHdpZHRoID4gMC4wMSB8fCBoZWlnaHQgPiAwLjAxKSB7CiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gewogICAgICAgICAgeF9taW46IE1hdGgubWluKHN0YXJ0RGF0YS54LCBlbmREYXRhLngpLAogICAgICAgICAgeV9taW46IE1hdGgubWluKHN0YXJ0RGF0YS55LCBlbmREYXRhLnkpLAogICAgICAgICAgeF9tYXg6IE1hdGgubWF4KHN0YXJ0RGF0YS54LCBlbmREYXRhLngpLAogICAgICAgICAgeV9tYXg6IE1hdGgubWF4KHN0YXJ0RGF0YS55LCBlbmREYXRhLnkpLAogICAgICAgIH07CiAgICAgICAgbW9kZWwuc2V0KCJzZWxlY3Rpb24iLCBzZWxlY3Rpb24pOwogICAgICAgIG1vZGVsLnNldCgiaGFzX3NlbGVjdGlvbiIsIHRydWUpOwogICAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgICB9CgogICAgICBpc1NlbGVjdGluZyA9IGZhbHNlOwogICAgICBzZWxlY3Rpb25TdGFydCA9IG51bGw7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAibGFzc28iICYmIGlzU2VsZWN0aW5nKSB7CiAgICAgIGlmIChsYXNzb1BhdGgubGVuZ3RoID49IDMpIHsKICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IGxhc3NvUGF0aC5tYXAoKHApID0+IHsKICAgICAgICAgIGNvbnN0IGQgPSBwaXhlbFRvRGF0YShwLngsIHAueSk7CiAgICAgICAgICByZXR1cm4gW2QueCwgZC55XTsKICAgICAgICB9KTsKICAgICAgICBtb2RlbC5zZXQoInNlbGVjdGlvbiIsIHsgdmVydGljZXMgfSk7CiAgICAgICAgbW9kZWwuc2V0KCJoYXNfc2VsZWN0aW9uIiwgdHJ1ZSk7CiAgICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICAgIH0KICAgICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgICAgbGFzc29QYXRoID0gW107CiAgICB9CgogICAgZHJhdygpOwogIH0KCiAgZnVuY3Rpb24gbW92ZVNlbGVjdGlvbihkeCwgZHkpIHsKICAgIGNvbnN0IHNlbGVjdGlvbiA9IG1vZGVsLmdldCgic2VsZWN0aW9uIik7CiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICBjb25zdCBbbGVmdCwgdG9wLCByaWdodCwgYm90dG9tXSA9IG1vZGVsLmdldCgiYXhlc19waXhlbF9ib3VuZHMiKTsKCiAgICAvLyBDb252ZXJ0IHBpeGVsIGRlbHRhIHRvIGRhdGEgZGVsdGEKICAgIGNvbnN0IFt4TWluLCB4TWF4XSA9IG1vZGVsLmdldCgieF9ib3VuZHMiKTsKICAgIGNvbnN0IFt5TWluLCB5TWF4XSA9IG1vZGVsLmdldCgieV9ib3VuZHMiKTsKICAgIGNvbnN0IGRhdGFXaWR0aCA9IHhNYXggLSB4TWluOwogICAgY29uc3QgZGF0YUhlaWdodCA9IHlNYXggLSB5TWluOwogICAgY29uc3QgcGl4ZWxXaWR0aCA9IHJpZ2h0IC0gbGVmdDsKICAgIGNvbnN0IHBpeGVsSGVpZ2h0ID0gYm90dG9tIC0gdG9wOwoKICAgIGNvbnN0IGRkeCA9IChkeCAvIHBpeGVsV2lkdGgpICogZGF0YVdpZHRoOwogICAgY29uc3QgZGR5ID0gLShkeSAvIHBpeGVsSGVpZ2h0KSAqIGRhdGFIZWlnaHQ7IC8vIEludmVydGVkIFkKCiAgICBpZiAobW9kZSA9PT0gImJveCIgJiYgc2VsZWN0aW9uLnhfbWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgY29uc3QgbmV3U2VsZWN0aW9uID0gewogICAgICAgIHhfbWluOiBzZWxlY3Rpb24ueF9taW4gKyBkZHgsCiAgICAgICAgeV9taW46IHNlbGVjdGlvbi55X21pbiArIGRkeSwKICAgICAgICB4X21heDogc2VsZWN0aW9uLnhfbWF4ICsgZGR4LAogICAgICAgIHlfbWF4OiBzZWxlY3Rpb24ueV9tYXggKyBkZHksCiAgICAgIH07CiAgICAgIG1vZGVsLnNldCgic2VsZWN0aW9uIiwgbmV3U2VsZWN0aW9uKTsKICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi52ZXJ0aWNlcykgewogICAgICBjb25zdCBuZXdWZXJ0aWNlcyA9IHNlbGVjdGlvbi52ZXJ0aWNlcy5tYXAoKHYpID0+IFt2WzBdICsgZGR4LCB2WzFdICsgZGR5XSk7CiAgICAgIG1vZGVsLnNldCgic2VsZWN0aW9uIiwgeyB2ZXJ0aWNlczogbmV3VmVydGljZXMgfSk7CiAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgfQoKICAgIGRyYXcoKTsKICB9CgogIC8vID09PSBEUkFXSU5HID09PQogIGZ1bmN0aW9uIGRyYXcoKSB7CiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CgogICAgaWYgKGltYWdlTG9hZGVkKSB7CiAgICAgIGN0eC5kcmF3SW1hZ2UoY2hhcnRJbWFnZSwgMCwgMCk7CiAgICB9CgogICAgaWYgKG1vZGVsLmdldCgiaGFzX3NlbGVjdGlvbiIpKSB7CiAgICAgIGRyYXdTZWxlY3Rpb24oKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGhleFRvUmdiYShoZXgsIGFscGhhKSB7CiAgICBjb25zdCByID0gcGFyc2VJbnQoaGV4LnNsaWNlKDEsIDMpLCAxNik7CiAgICBjb25zdCBnID0gcGFyc2VJbnQoaGV4LnNsaWNlKDMsIDUpLCAxNik7CiAgICBjb25zdCBiID0gcGFyc2VJbnQoaGV4LnNsaWNlKDUsIDcpLCAxNik7CiAgICByZXR1cm4gYHJnYmEoJHtyfSwgJHtnfSwgJHtifSwgJHthbHBoYX0pYDsKICB9CgogIGZ1bmN0aW9uIGRyYXdTZWxlY3Rpb24oKSB7CiAgICBjb25zdCBzZWxlY3Rpb24gPSBtb2RlbC5nZXQoInNlbGVjdGlvbiIpOwogICAgY29uc3QgY29sb3IgPSBtb2RlbC5nZXQoInNlbGVjdGlvbl9jb2xvciIpOwogICAgY29uc3Qgb3BhY2l0eSA9IG1vZGVsLmdldCgic2VsZWN0aW9uX29wYWNpdHkiKTsKICAgIGNvbnN0IHN0cm9rZVdpZHRoID0gbW9kZWwuZ2V0KCJzdHJva2Vfd2lkdGgiKTsKCiAgICBjdHguc2F2ZSgpOwogICAgY3R4LmZpbGxTdHlsZSA9IGhleFRvUmdiYShjb2xvciwgb3BhY2l0eSk7CiAgICBjdHguc3Ryb2tlU3R5bGUgPSBjb2xvcjsKICAgIGN0eC5saW5lV2lkdGggPSBzdHJva2VXaWR0aDsKCiAgICBjb25zdCBtb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICBpZiAobW9kZSA9PT0gImJveCIgJiYgc2VsZWN0aW9uLnhfbWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgY29uc3QgdG9wTGVmdCA9IGRhdGFUb1BpeGVsKHNlbGVjdGlvbi54X21pbiwgc2VsZWN0aW9uLnlfbWF4KTsKICAgICAgY29uc3QgYm90dG9tUmlnaHQgPSBkYXRhVG9QaXhlbChzZWxlY3Rpb24ueF9tYXgsIHNlbGVjdGlvbi55X21pbik7CiAgICAgIGNvbnN0IHcgPSBib3R0b21SaWdodC54IC0gdG9wTGVmdC54OwogICAgICBjb25zdCBoID0gYm90dG9tUmlnaHQueSAtIHRvcExlZnQueTsKCiAgICAgIGN0eC5maWxsUmVjdCh0b3BMZWZ0LngsIHRvcExlZnQueSwgdywgaCk7CiAgICAgIGN0eC5zdHJva2VSZWN0KHRvcExlZnQueCwgdG9wTGVmdC55LCB3LCBoKTsKICAgIH0gZWxzZSBpZiAoc2VsZWN0aW9uLnZlcnRpY2VzICYmIHNlbGVjdGlvbi52ZXJ0aWNlcy5sZW5ndGggPj0gMykgewogICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgIGNvbnN0IGZpcnN0ID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnZlcnRpY2VzWzBdWzBdLCBzZWxlY3Rpb24udmVydGljZXNbMF1bMV0pOwogICAgICBjdHgubW92ZVRvKGZpcnN0LngsIGZpcnN0LnkpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzZWxlY3Rpb24udmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBwID0gZGF0YVRvUGl4ZWwoc2VsZWN0aW9uLnZlcnRpY2VzW2ldWzBdLCBzZWxlY3Rpb24udmVydGljZXNbaV1bMV0pOwogICAgICAgIGN0eC5saW5lVG8ocC54LCBwLnkpOwogICAgICB9CgogICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgIGN0eC5maWxsKCk7CiAgICAgIGN0eC5zdHJva2UoKTsKICAgIH0KCiAgICBjdHgucmVzdG9yZSgpOwogIH0KCiAgZnVuY3Rpb24gZHJhd0JveFByZXZpZXcoc3RhcnQsIGVuZCkgewogICAgY29uc3QgY29sb3IgPSBtb2RlbC5nZXQoInNlbGVjdGlvbl9jb2xvciIpOwogICAgY3R4LnNhdmUoKTsKICAgIGN0eC5zdHJva2VTdHlsZSA9IGNvbG9yOwogICAgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICBjdHguc2V0TGluZURhc2goWzUsIDVdKTsKICAgIGN0eC5zdHJva2VSZWN0KAogICAgICBNYXRoLm1pbihzdGFydC54LCBlbmQueCksCiAgICAgIE1hdGgubWluKHN0YXJ0LnksIGVuZC55KSwKICAgICAgTWF0aC5hYnMoZW5kLnggLSBzdGFydC54KSwKICAgICAgTWF0aC5hYnMoZW5kLnkgLSBzdGFydC55KQogICAgKTsKICAgIGN0eC5yZXN0b3JlKCk7CiAgfQoKICBmdW5jdGlvbiBkcmF3TGFzc29QcmV2aWV3KHBhdGgpIHsKICAgIGlmIChwYXRoLmxlbmd0aCA8IDIpIHJldHVybjsKCiAgICBjb25zdCBjb2xvciA9IG1vZGVsLmdldCgic2VsZWN0aW9uX2NvbG9yIik7CiAgICBjdHguc2F2ZSgpOwogICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7CiAgICBjdHgubGluZVdpZHRoID0gMjsKICAgIGN0eC5iZWdpblBhdGgoKTsKICAgIGN0eC5tb3ZlVG8ocGF0aFswXS54LCBwYXRoWzBdLnkpOwogICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7CiAgICAgIGN0eC5saW5lVG8ocGF0aFtpXS54LCBwYXRoW2ldLnkpOwogICAgfQogICAgY3R4LnN0cm9rZSgpOwogICAgY3R4LnJlc3RvcmUoKTsKICB9CgogIC8vID09PSBFVkVOVCBCSU5ESU5HID09PQogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLCBoYW5kbGVNb3VzZURvd24pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLCBoYW5kbGVNb3VzZU1vdmUpOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgaGFuZGxlTW91c2VVcCk7CgogIC8vIFRvdWNoIHN1cHBvcnQKICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsIChlKSA9PiB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCB0b3VjaCA9IGUudG91Y2hlc1swXTsKICAgIGhhbmRsZU1vdXNlRG93bih7CiAgICAgIGNsaWVudFg6IHRvdWNoLmNsaWVudFgsCiAgICAgIGNsaWVudFk6IHRvdWNoLmNsaWVudFksCiAgICAgIHByZXZlbnREZWZhdWx0OiAoKSA9PiB7fSwKICAgIH0pOwogIH0pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaG1vdmUiLCAoZSkgPT4gewogICAgY29uc3QgdG91Y2ggPSBlLnRvdWNoZXNbMF07CiAgICBoYW5kbGVNb3VzZU1vdmUoeyBjbGllbnRYOiB0b3VjaC5jbGllbnRYLCBjbGllbnRZOiB0b3VjaC5jbGllbnRZIH0pOwogIH0pOwogIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaGVuZCIsIChlKSA9PiB7CiAgICBjb25zdCB0b3VjaCA9IGUuY2hhbmdlZFRvdWNoZXNbMF07CiAgICBoYW5kbGVNb3VzZVVwKHsgY2xpZW50WDogdG91Y2guY2xpZW50WCwgY2xpZW50WTogdG91Y2guY2xpZW50WSB9KTsKICB9KTsKCiAgLy8gPT09IE1PREVMIFNZTkMgPT09CiAgY2hhcnRJbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICBpbWFnZUxvYWRlZCA9IHRydWU7CiAgICBkcmF3KCk7CiAgfTsKICBjaGFydEltYWdlLnNyYyA9IG1vZGVsLmdldCgiY2hhcnRfYmFzZTY0Iik7CgogIG1vZGVsLm9uKCJjaGFuZ2U6bW9kZSIsICgpID0+IHsKICAgIGN1cnJlbnRNb2RlID0gbW9kZWwuZ2V0KCJtb2RlIik7CiAgICB1cGRhdGVNb2RlQnV0dG9ucygpOwogICAgaXNTZWxlY3RpbmcgPSBmYWxzZTsKICAgIGlzRHJhZ2dpbmcgPSBmYWxzZTsKICAgIGxhc3NvUGF0aCA9IFtdOwogICAgc2VsZWN0aW9uU3RhcnQgPSBudWxsOwogICAgZHJhZ1N0YXJ0ID0gbnVsbDsKICAgIGRyYXcoKTsKICB9KTsKICBtb2RlbC5vbigiY2hhbmdlOnNlbGVjdGlvbiIsIGRyYXcpOwogIG1vZGVsLm9uKCJjaGFuZ2U6aGFzX3NlbGVjdGlvbiIsIGRyYXcpOwogIG1vZGVsLm9uKCJjaGFuZ2U6Y2hhcnRfYmFzZTY0IiwgKCkgPT4gewogICAgY2hhcnRJbWFnZS5zcmMgPSBtb2RlbC5nZXQoImNoYXJ0X2Jhc2U2NCIpOwogIH0pOwogIG1vZGVsLm9uKCJjaGFuZ2U6c2VsZWN0aW9uX2NvbG9yIiwgZHJhdyk7CiAgbW9kZWwub24oImNoYW5nZTpzZWxlY3Rpb25fb3BhY2l0eSIsIGRyYXcpOwoKICAvLyBJbml0aWFsIHN0YXRlCiAgdXBkYXRlTW9kZUJ1dHRvbnMoKTsKICBkcmF3KCk7Cn0KCmV4cG9ydCBkZWZhdWx0IHsgcmVuZGVyIH07Cg==&quot;' data-js-hash='&quot;1cf459cbac0c188b30b30a1bc4b66493&quot;'></marimo-anywidget></marimo-ui-element></div>"
          }
        }
      ],
      "console": []
    }
  ]
}