{
  "version": "1",
  "metadata": {
    "marimo_version": "0.19.11"
  },
  "cells": [
    {
      "id": "setup",
      "code_hash": "20afe162d808127faa21f0045f93a1b7",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "Hbol",
      "code_hash": "d6fc0aa6b03db9d8758a911b4a5366da",
      "outputs": [
        {
          "type": "data",
          "data": {
            "application/json": "[{\"element\": \".marimo-cell\", \"index\": 0, \"popover\": {\"title\": \"Welcome!\", \"description\": \"In this first cell we do a bunch of imports.\", \"position\": \"center\"}}, {\"element\": \".marimo-cell\", \"index\": 1, \"popover\": {\"title\": \"Fancy!\", \"description\": \"But in this cell we define a tour! Fancy that!\", \"position\": \"center\"}}, {\"element\": \".marimo-cell\", \"index\": 2, \"popover\": {\"title\": \"Steps\", \"description\": \"You can also inspect the steps at the end here.\", \"position\": \"center\"}}]"
          }
        }
      ],
      "console": []
    },
    {
      "id": "MJUe",
      "code_hash": "f3acc17e8143305b87a45f936848e5a4",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='MJUe-0' random-id='2eef2f55-efdb-9d2e-7bf1-0ed21ce22268'><marimo-anywidget data-initial-value='{&quot;model_id&quot;:&quot;12c7e02a6d2a41bfaa6e685b91138da4&quot;}' data-label='null' data-js-url='&quot;data:text/javascript;base64,Ly8gbm9kZV9tb2R1bGVzL2RyaXZlci5qcy9kaXN0L2RyaXZlci5qcy5tanMKdmFyIEYgPSB7fTsKZnVuY3Rpb24gRChlID0ge30pIHsKICBGID0gewogICAgYW5pbWF0ZTogdHJ1ZSwKICAgIGFsbG93Q2xvc2U6IHRydWUsCiAgICBvdmVybGF5T3BhY2l0eTogMC43LAogICAgc21vb3RoU2Nyb2xsOiBmYWxzZSwKICAgIGRpc2FibGVBY3RpdmVJbnRlcmFjdGlvbjogZmFsc2UsCiAgICBzaG93UHJvZ3Jlc3M6IGZhbHNlLAogICAgc3RhZ2VQYWRkaW5nOiAxMCwKICAgIHN0YWdlUmFkaXVzOiA1LAogICAgcG9wb3Zlck9mZnNldDogMTAsCiAgICBzaG93QnV0dG9uczogWyJuZXh0IiwgInByZXZpb3VzIiwgImNsb3NlIl0sCiAgICBkaXNhYmxlQnV0dG9uczogW10sCiAgICBvdmVybGF5Q29sb3I6ICIjMDAwIiwKICAgIC4uLmUKICB9Owp9CmZ1bmN0aW9uIGEoZSkgewogIHJldHVybiBlID8gRltlXSA6IEY7Cn0KZnVuY3Rpb24gVyhlLCBvLCB0LCBpKSB7CiAgcmV0dXJuIChlIC89IGkgLyAyKSA8IDEgPyB0IC8gMiAqIGUgKiBlICsgbyA6IC10IC8gMiAqICgtLWUgKiAoZSAtIDIpIC0gMSkgKyBvOwp9CmZ1bmN0aW9uIFEoZSkgewogIGNvbnN0IG8gPSAnYVtocmVmXTpub3QoW2Rpc2FibGVkXSksIGJ1dHRvbjpub3QoW2Rpc2FibGVkXSksIHRleHRhcmVhOm5vdChbZGlzYWJsZWRdKSwgaW5wdXRbdHlwZT0idGV4dCJdOm5vdChbZGlzYWJsZWRdKSwgaW5wdXRbdHlwZT0icmFkaW8iXTpub3QoW2Rpc2FibGVkXSksIGlucHV0W3R5cGU9ImNoZWNrYm94Il06bm90KFtkaXNhYmxlZF0pLCBzZWxlY3Q6bm90KFtkaXNhYmxlZF0pJzsKICByZXR1cm4gZS5mbGF0TWFwKCh0KSA9PiB7CiAgICBjb25zdCBpID0gdC5tYXRjaGVzKG8pLCBwID0gQXJyYXkuZnJvbSh0LnF1ZXJ5U2VsZWN0b3JBbGwobykpOwogICAgcmV0dXJuIFsuLi5pID8gW3RdIDogW10sIC4uLnBdOwogIH0pLmZpbHRlcigodCkgPT4gZ2V0Q29tcHV0ZWRTdHlsZSh0KS5wb2ludGVyRXZlbnRzICE9PSAibm9uZSIgJiYgYWUodCkpOwp9CmZ1bmN0aW9uIFooZSkgewogIGlmICghZSB8fCBzZShlKSkKICAgIHJldHVybjsKICBjb25zdCBvID0gYSgic21vb3RoU2Nyb2xsIik7CiAgZS5zY3JvbGxJbnRvVmlldyh7CiAgICAvLyBSZW1vdmluZyB0aGUgc21vb3RoIHNjcm9sbGluZyBmb3IgZWxlbWVudHMgd2hpY2ggZXhpc3QgaW5zaWRlIHRoZSBzY3JvbGxhYmxlIHBhcmVudAogICAgLy8gVGhpcyB3YXMgY2F1c2luZyB0aGUgaGlnaGxpZ2h0IHRvIG5vdCBwcm9wZXJseSByZW5kZXIKICAgIGJlaGF2aW9yOiAhbyB8fCByZShlKSA/ICJhdXRvIiA6ICJzbW9vdGgiLAogICAgaW5saW5lOiAiY2VudGVyIiwKICAgIGJsb2NrOiAiY2VudGVyIgogIH0pOwp9CmZ1bmN0aW9uIHJlKGUpIHsKICBpZiAoIWUgfHwgIWUucGFyZW50RWxlbWVudCkKICAgIHJldHVybjsKICBjb25zdCBvID0gZS5wYXJlbnRFbGVtZW50OwogIHJldHVybiBvLnNjcm9sbEhlaWdodCA+IG8uY2xpZW50SGVpZ2h0Owp9CmZ1bmN0aW9uIHNlKGUpIHsKICBjb25zdCBvID0gZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICByZXR1cm4gby50b3AgPj0gMCAmJiBvLmxlZnQgPj0gMCAmJiBvLmJvdHRvbSA8PSAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpICYmIG8ucmlnaHQgPD0gKHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCk7Cn0KZnVuY3Rpb24gYWUoZSkgewogIHJldHVybiAhIShlLm9mZnNldFdpZHRoIHx8IGUub2Zmc2V0SGVpZ2h0IHx8IGUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgpOwp9CnZhciBPID0ge307CmZ1bmN0aW9uIGIoZSwgbykgewogIE9bZV0gPSBvOwp9CmZ1bmN0aW9uIGwoZSkgewogIHJldHVybiBlID8gT1tlXSA6IE87Cn0KZnVuY3Rpb24gVigpIHsKICBPID0ge307Cn0KdmFyIFIgPSB7fTsKZnVuY3Rpb24gTihlLCBvKSB7CiAgUltlXSA9IG87Cn0KZnVuY3Rpb24gTChlKSB7CiAgdmFyIG87CiAgKG8gPSBSW2VdKSA9PSBudWxsIHx8IG8uY2FsbChSKTsKfQpmdW5jdGlvbiBjZSgpIHsKICBSID0ge307Cn0KZnVuY3Rpb24gbGUoZSwgbywgdCwgaSkgewogIGxldCBwID0gbCgiX19hY3RpdmVTdGFnZVBvc2l0aW9uIik7CiAgY29uc3QgbiA9IHAgfHwgdC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgZiA9IGkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIHcgPSBXKGUsIG4ueCwgZi54IC0gbi54LCBvKSwgciA9IFcoZSwgbi55LCBmLnkgLSBuLnksIG8pLCB2ID0gVyhlLCBuLndpZHRoLCBmLndpZHRoIC0gbi53aWR0aCwgbyksIHMgPSBXKGUsIG4uaGVpZ2h0LCBmLmhlaWdodCAtIG4uaGVpZ2h0LCBvKTsKICBwID0gewogICAgeDogdywKICAgIHk6IHIsCiAgICB3aWR0aDogdiwKICAgIGhlaWdodDogcwogIH0sIEoocCksIGIoIl9fYWN0aXZlU3RhZ2VQb3NpdGlvbiIsIHApOwp9CmZ1bmN0aW9uIEcoZSkgewogIGlmICghZSkKICAgIHJldHVybjsKICBjb25zdCBvID0gZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgdCA9IHsKICAgIHg6IG8ueCwKICAgIHk6IG8ueSwKICAgIHdpZHRoOiBvLndpZHRoLAogICAgaGVpZ2h0OiBvLmhlaWdodAogIH07CiAgYigiX19hY3RpdmVTdGFnZVBvc2l0aW9uIiwgdCksIEoodCk7Cn0KZnVuY3Rpb24gZGUoKSB7CiAgY29uc3QgZSA9IGwoIl9fYWN0aXZlU3RhZ2VQb3NpdGlvbiIpLCBvID0gbCgiX19vdmVybGF5U3ZnIik7CiAgaWYgKCFlKQogICAgcmV0dXJuOwogIGlmICghbykgewogICAgY29uc29sZS53YXJuKCJObyBzdGFnZSBzdmcgZm91bmQuIik7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IHQgPSB3aW5kb3cuaW5uZXJXaWR0aCwgaSA9IHdpbmRvdy5pbm5lckhlaWdodDsKICBvLnNldEF0dHJpYnV0ZSgidmlld0JveCIsIGAwIDAgJHt0fSAke2l9YCk7Cn0KZnVuY3Rpb24gcGUoZSkgewogIGNvbnN0IG8gPSB1ZShlKTsKICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG8pLCB0ZShvLCAodCkgPT4gewogICAgdC50YXJnZXQudGFnTmFtZSA9PT0gInBhdGgiICYmIEwoIm92ZXJsYXlDbGljayIpOwogIH0pLCBiKCJfX292ZXJsYXlTdmciLCBvKTsKfQpmdW5jdGlvbiBKKGUpIHsKICBjb25zdCBvID0gbCgiX19vdmVybGF5U3ZnIik7CiAgaWYgKCFvKSB7CiAgICBwZShlKTsKICAgIHJldHVybjsKICB9CiAgY29uc3QgdCA9IG8uZmlyc3RFbGVtZW50Q2hpbGQ7CiAgaWYgKCh0ID09IG51bGwgPyB2b2lkIDAgOiB0LnRhZ05hbWUpICE9PSAicGF0aCIpCiAgICB0aHJvdyBuZXcgRXJyb3IoIm5vIHBhdGggZWxlbWVudCBmb3VuZCBpbiBzdGFnZSBzdmciKTsKICB0LnNldEF0dHJpYnV0ZSgiZCIsIFUoZSkpOwp9CmZ1bmN0aW9uIHVlKGUpIHsKICBjb25zdCBvID0gd2luZG93LmlubmVyV2lkdGgsIHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQsIGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgInN2ZyIpOwogIGkuY2xhc3NMaXN0LmFkZCgiZHJpdmVyLW92ZXJsYXkiLCAiZHJpdmVyLW92ZXJsYXktYW5pbWF0ZWQiKSwgaS5zZXRBdHRyaWJ1dGUoInZpZXdCb3giLCBgMCAwICR7b30gJHt0fWApLCBpLnNldEF0dHJpYnV0ZSgieG1sU3BhY2UiLCAicHJlc2VydmUiKSwgaS5zZXRBdHRyaWJ1dGUoInhtbG5zWGxpbmsiLCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIpLCBpLnNldEF0dHJpYnV0ZSgidmVyc2lvbiIsICIxLjEiKSwgaS5zZXRBdHRyaWJ1dGUoInByZXNlcnZlQXNwZWN0UmF0aW8iLCAieE1pbllNaW4gc2xpY2UiKSwgaS5zdHlsZS5maWxsUnVsZSA9ICJldmVub2RkIiwgaS5zdHlsZS5jbGlwUnVsZSA9ICJldmVub2RkIiwgaS5zdHlsZS5zdHJva2VMaW5lam9pbiA9ICJyb3VuZCIsIGkuc3R5bGUuc3Ryb2tlTWl0ZXJsaW1pdCA9ICIyIiwgaS5zdHlsZS56SW5kZXggPSAiMTAwMDAiLCBpLnN0eWxlLnBvc2l0aW9uID0gImZpeGVkIiwgaS5zdHlsZS50b3AgPSAiMCIsIGkuc3R5bGUubGVmdCA9ICIwIiwgaS5zdHlsZS53aWR0aCA9ICIxMDAlIiwgaS5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgY29uc3QgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLCAicGF0aCIpOwogIHJldHVybiBwLnNldEF0dHJpYnV0ZSgiZCIsIFUoZSkpLCBwLnN0eWxlLmZpbGwgPSBhKCJvdmVybGF5Q29sb3IiKSB8fCAicmdiKDAsMCwwKSIsIHAuc3R5bGUub3BhY2l0eSA9IGAke2EoIm92ZXJsYXlPcGFjaXR5Iil9YCwgcC5zdHlsZS5wb2ludGVyRXZlbnRzID0gImF1dG8iLCBwLnN0eWxlLmN1cnNvciA9ICJhdXRvIiwgaS5hcHBlbmRDaGlsZChwKSwgaTsKfQpmdW5jdGlvbiBVKGUpIHsKICBjb25zdCBvID0gd2luZG93LmlubmVyV2lkdGgsIHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQsIGkgPSBhKCJzdGFnZVBhZGRpbmciKSB8fCAwLCBwID0gYSgic3RhZ2VSYWRpdXMiKSB8fCAwLCBuID0gZS53aWR0aCArIGkgKiAyLCBmID0gZS5oZWlnaHQgKyBpICogMiwgdyA9IE1hdGgubWluKHAsIG4gLyAyLCBmIC8gMiksIHIgPSBNYXRoLmZsb29yKE1hdGgubWF4KHcsIDApKSwgdiA9IGUueCAtIGkgKyByLCBzID0gZS55IC0gaSwgYyA9IG4gLSByICogMiwgZCA9IGYgLSByICogMjsKICByZXR1cm4gYE0ke299LDBMMCwwTDAsJHt0fUwke299LCR7dH1MJHtvfSwwWgogICAgTSR7dn0sJHtzfSBoJHtjfSBhJHtyfSwke3J9IDAgMCAxICR7cn0sJHtyfSB2JHtkfSBhJHtyfSwke3J9IDAgMCAxIC0ke3J9LCR7cn0gaC0ke2N9IGEke3J9LCR7cn0gMCAwIDEgLSR7cn0sLSR7cn0gdi0ke2R9IGEke3J9LCR7cn0gMCAwIDEgJHtyfSwtJHtyfSB6YDsKfQpmdW5jdGlvbiB2ZSgpIHsKICBjb25zdCBlID0gbCgiX19vdmVybGF5U3ZnIik7CiAgZSAmJiBlLnJlbW92ZSgpOwp9CmZ1bmN0aW9uIGZlKCkgewogIGNvbnN0IGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZHJpdmVyLWR1bW15LWVsZW1lbnQiKTsKICBpZiAoZSkKICAgIHJldHVybiBlOwogIGxldCBvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgcmV0dXJuIG8uaWQgPSAiZHJpdmVyLWR1bW15LWVsZW1lbnQiLCBvLnN0eWxlLndpZHRoID0gIjAiLCBvLnN0eWxlLmhlaWdodCA9ICIwIiwgby5zdHlsZS5wb2ludGVyRXZlbnRzID0gIm5vbmUiLCBvLnN0eWxlLm9wYWNpdHkgPSAiMCIsIG8uc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiLCBvLnN0eWxlLnRvcCA9ICI1MCUiLCBvLnN0eWxlLmxlZnQgPSAiNTAlIiwgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvKSwgbzsKfQpmdW5jdGlvbiBLKGUpIHsKICBjb25zdCB7IGVsZW1lbnQ6IG8gfSA9IGU7CiAgbGV0IHQgPSB0eXBlb2YgbyA9PSAic3RyaW5nIiA/IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobykgOiBvOwogIHQgfHwgKHQgPSBmZSgpKSwgZ2UodCwgZSk7Cn0KZnVuY3Rpb24gaGUoKSB7CiAgY29uc3QgZSA9IGwoIl9fYWN0aXZlRWxlbWVudCIpLCBvID0gbCgiX19hY3RpdmVTdGVwIik7CiAgZSAmJiAoRyhlKSwgZGUoKSwgaWUoZSwgbykpOwp9CmZ1bmN0aW9uIGdlKGUsIG8pIHsKICBjb25zdCBpID0gRGF0ZS5ub3coKSwgcCA9IGwoIl9fYWN0aXZlU3RlcCIpLCBuID0gbCgiX19hY3RpdmVFbGVtZW50IikgfHwgZSwgZiA9ICFuIHx8IG4gPT09IGUsIHcgPSBlLmlkID09PSAiZHJpdmVyLWR1bW15LWVsZW1lbnQiLCByID0gbi5pZCA9PT0gImRyaXZlci1kdW1teS1lbGVtZW50IiwgdiA9IGEoImFuaW1hdGUiKSwgcyA9IG8ub25IaWdobGlnaHRTdGFydGVkIHx8IGEoIm9uSGlnaGxpZ2h0U3RhcnRlZCIpLCBjID0gKG8gPT0gbnVsbCA/IHZvaWQgMCA6IG8ub25IaWdobGlnaHRlZCkgfHwgYSgib25IaWdobGlnaHRlZCIpLCBkID0gKHAgPT0gbnVsbCA/IHZvaWQgMCA6IHAub25EZXNlbGVjdGVkKSB8fCBhKCJvbkRlc2VsZWN0ZWQiKSwgbSA9IGEoKSwgZyA9IGwoKTsKICAhZiAmJiBkICYmIGQociA/IHZvaWQgMCA6IG4sIHAsIHsKICAgIGNvbmZpZzogbSwKICAgIHN0YXRlOiBnCiAgfSksIHMgJiYgcyh3ID8gdm9pZCAwIDogZSwgbywgewogICAgY29uZmlnOiBtLAogICAgc3RhdGU6IGcKICB9KTsKICBjb25zdCB1ID0gIWYgJiYgdjsKICBsZXQgaCA9IGZhbHNlOwogIHhlKCksIGIoInByZXZpb3VzU3RlcCIsIHApLCBiKCJwcmV2aW91c0VsZW1lbnQiLCBuKSwgYigiYWN0aXZlU3RlcCIsIG8pLCBiKCJhY3RpdmVFbGVtZW50IiwgZSk7CiAgY29uc3QgUCA9ICgpID0+IHsKICAgIGlmIChsKCJfX3RyYW5zaXRpb25DYWxsYmFjayIpICE9PSBQKQogICAgICByZXR1cm47CiAgICBjb25zdCB4ID0gRGF0ZS5ub3coKSAtIGksIHkgPSA0MDAgLSB4IDw9IDQwMCAvIDI7CiAgICBvLnBvcG92ZXIgJiYgeSAmJiAhaCAmJiB1ICYmIChYKGUsIG8pLCBoID0gdHJ1ZSksIGEoImFuaW1hdGUiKSAmJiB4IDwgNDAwID8gbGUoeCwgNDAwLCBuLCBlKSA6IChHKGUpLCBjICYmIGModyA/IHZvaWQgMCA6IGUsIG8sIHsKICAgICAgY29uZmlnOiBhKCksCiAgICAgIHN0YXRlOiBsKCkKICAgIH0pLCBiKCJfX3RyYW5zaXRpb25DYWxsYmFjayIsIHZvaWQgMCksIGIoIl9fcHJldmlvdXNTdGVwIiwgcCksIGIoIl9fcHJldmlvdXNFbGVtZW50IiwgbiksIGIoIl9fYWN0aXZlU3RlcCIsIG8pLCBiKCJfX2FjdGl2ZUVsZW1lbnQiLCBlKSksIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoUCk7CiAgfTsKICBiKCJfX3RyYW5zaXRpb25DYWxsYmFjayIsIFApLCB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKFApLCBaKGUpLCAhdSAmJiBvLnBvcG92ZXIgJiYgWChlLCBvKSwgbi5jbGFzc0xpc3QucmVtb3ZlKCJkcml2ZXItYWN0aXZlLWVsZW1lbnQiLCAiZHJpdmVyLW5vLWludGVyYWN0aW9uIiksIG4ucmVtb3ZlQXR0cmlidXRlKCJhcmlhLWhhc3BvcHVwIiksIG4ucmVtb3ZlQXR0cmlidXRlKCJhcmlhLWV4cGFuZGVkIiksIG4ucmVtb3ZlQXR0cmlidXRlKCJhcmlhLWNvbnRyb2xzIiksIGEoImRpc2FibGVBY3RpdmVJbnRlcmFjdGlvbiIpICYmIGUuY2xhc3NMaXN0LmFkZCgiZHJpdmVyLW5vLWludGVyYWN0aW9uIiksIGUuY2xhc3NMaXN0LmFkZCgiZHJpdmVyLWFjdGl2ZS1lbGVtZW50IiksIGUuc2V0QXR0cmlidXRlKCJhcmlhLWhhc3BvcHVwIiwgImRpYWxvZyIpLCBlLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsICJ0cnVlIiksIGUuc2V0QXR0cmlidXRlKCJhcmlhLWNvbnRyb2xzIiwgImRyaXZlci1wb3BvdmVyLWNvbnRlbnQiKTsKfQpmdW5jdGlvbiB3ZSgpIHsKICB2YXIgZTsKICAoZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJkcml2ZXItZHVtbXktZWxlbWVudCIpKSA9PSBudWxsIHx8IGUucmVtb3ZlKCksIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5kcml2ZXItYWN0aXZlLWVsZW1lbnQiKS5mb3JFYWNoKChvKSA9PiB7CiAgICBvLmNsYXNzTGlzdC5yZW1vdmUoImRyaXZlci1hY3RpdmUtZWxlbWVudCIsICJkcml2ZXItbm8taW50ZXJhY3Rpb24iKSwgby5yZW1vdmVBdHRyaWJ1dGUoImFyaWEtaGFzcG9wdXAiKSwgby5yZW1vdmVBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiKSwgby5yZW1vdmVBdHRyaWJ1dGUoImFyaWEtY29udHJvbHMiKTsKICB9KTsKfQpmdW5jdGlvbiBJKCkgewogIGNvbnN0IGUgPSBsKCJfX3Jlc2l6ZVRpbWVvdXQiKTsKICBlICYmIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZShlKSwgYigiX19yZXNpemVUaW1lb3V0Iiwgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShoZSkpOwp9CmZ1bmN0aW9uIG1lKGUpIHsKICB2YXIgcjsKICBpZiAoIWwoImlzSW5pdGlhbGl6ZWQiKSB8fCAhKGUua2V5ID09PSAiVGFiIiB8fCBlLmtleUNvZGUgPT09IDkpKQogICAgcmV0dXJuOwogIGNvbnN0IGkgPSBsKCJfX2FjdGl2ZUVsZW1lbnQiKSwgcCA9IChyID0gbCgicG9wb3ZlciIpKSA9PSBudWxsID8gdm9pZCAwIDogci53cmFwcGVyLCBuID0gUShbCiAgICAuLi5wID8gW3BdIDogW10sCiAgICAuLi5pID8gW2ldIDogW10KICBdKSwgZiA9IG5bMF0sIHcgPSBuW24ubGVuZ3RoIC0gMV07CiAgaWYgKGUucHJldmVudERlZmF1bHQoKSwgZS5zaGlmdEtleSkgewogICAgY29uc3QgdiA9IG5bbi5pbmRleE9mKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIC0gMV0gfHwgdzsKICAgIHYgPT0gbnVsbCB8fCB2LmZvY3VzKCk7CiAgfSBlbHNlIHsKICAgIGNvbnN0IHYgPSBuW24uaW5kZXhPZihkb2N1bWVudC5hY3RpdmVFbGVtZW50KSArIDFdIHx8IGY7CiAgICB2ID09IG51bGwgfHwgdi5mb2N1cygpOwogIH0KfQpmdW5jdGlvbiBlZShlKSB7CiAgdmFyIHQ7CiAgKCh0ID0gYSgiYWxsb3dLZXlib2FyZENvbnRyb2wiKSkgPT0gbnVsbCB8fCB0KSAmJiAoZS5rZXkgPT09ICJFc2NhcGUiID8gTCgiZXNjYXBlUHJlc3MiKSA6IGUua2V5ID09PSAiQXJyb3dSaWdodCIgPyBMKCJhcnJvd1JpZ2h0UHJlc3MiKSA6IGUua2V5ID09PSAiQXJyb3dMZWZ0IiAmJiBMKCJhcnJvd0xlZnRQcmVzcyIpKTsKfQpmdW5jdGlvbiB0ZShlLCBvLCB0KSB7CiAgY29uc3QgaSA9IChuLCBmKSA9PiB7CiAgICBjb25zdCB3ID0gbi50YXJnZXQ7CiAgICBlLmNvbnRhaW5zKHcpICYmICgoIXQgfHwgdCh3KSkgJiYgKG4ucHJldmVudERlZmF1bHQoKSwgbi5zdG9wUHJvcGFnYXRpb24oKSwgbi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSksIGYgPT0gbnVsbCB8fCBmKG4pKTsKICB9OwogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInBvaW50ZXJkb3duIiwgaSwgdHJ1ZSksIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIGksIHRydWUpLCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJwb2ludGVydXAiLCBpLCB0cnVlKSwgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2V1cCIsIGksIHRydWUpLCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKAogICAgImNsaWNrIiwKICAgIChuKSA9PiB7CiAgICAgIGkobiwgbyk7CiAgICB9LAogICAgdHJ1ZQogICk7Cn0KZnVuY3Rpb24geWUoKSB7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZWUsIGZhbHNlKSwgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBtZSwgZmFsc2UpLCB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgSSksIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJzY3JvbGwiLCBJKTsKfQpmdW5jdGlvbiBiZSgpIHsKICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigia2V5dXAiLCBlZSksIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJyZXNpemUiLCBJKSwgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIEkpOwp9CmZ1bmN0aW9uIHhlKCkgewogIGNvbnN0IGUgPSBsKCJwb3BvdmVyIik7CiAgZSAmJiAoZS53cmFwcGVyLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIpOwp9CmZ1bmN0aW9uIFgoZSwgbykgewogIHZhciBDLCB5OwogIGxldCB0ID0gbCgicG9wb3ZlciIpOwogIHQgJiYgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0LndyYXBwZXIpLCB0ID0gUGUoKSwgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0LndyYXBwZXIpOwogIGNvbnN0IHsKICAgIHRpdGxlOiBpLAogICAgZGVzY3JpcHRpb246IHAsCiAgICBzaG93QnV0dG9uczogbiwKICAgIGRpc2FibGVCdXR0b25zOiBmLAogICAgc2hvd1Byb2dyZXNzOiB3LAogICAgbmV4dEJ0blRleHQ6IHIgPSBhKCJuZXh0QnRuVGV4dCIpIHx8ICJOZXh0ICZyYXJyOyIsCiAgICBwcmV2QnRuVGV4dDogdiA9IGEoInByZXZCdG5UZXh0IikgfHwgIiZsYXJyOyBQcmV2aW91cyIsCiAgICBwcm9ncmVzc1RleHQ6IHMgPSBhKCJwcm9ncmVzc1RleHQiKSB8fCAie2N1cnJlbnR9IG9mIHt0b3RhbH0iCiAgfSA9IG8ucG9wb3ZlciB8fCB7fTsKICB0Lm5leHRCdXR0b24uaW5uZXJIVE1MID0gciwgdC5wcmV2aW91c0J1dHRvbi5pbm5lckhUTUwgPSB2LCB0LnByb2dyZXNzLmlubmVySFRNTCA9IHMsIGkgPyAodC50aXRsZS5pbm5lckhUTUwgPSBpLCB0LnRpdGxlLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siKSA6IHQudGl0bGUuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgcCA/ICh0LmRlc2NyaXB0aW9uLmlubmVySFRNTCA9IHAsIHQuZGVzY3JpcHRpb24uc3R5bGUuZGlzcGxheSA9ICJibG9jayIpIDogdC5kZXNjcmlwdGlvbi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogIGNvbnN0IGMgPSBuIHx8IGEoInNob3dCdXR0b25zIiksIGQgPSB3IHx8IGEoInNob3dQcm9ncmVzcyIpIHx8IGZhbHNlLCBtID0gKGMgPT0gbnVsbCA/IHZvaWQgMCA6IGMuaW5jbHVkZXMoIm5leHQiKSkgfHwgKGMgPT0gbnVsbCA/IHZvaWQgMCA6IGMuaW5jbHVkZXMoInByZXZpb3VzIikpIHx8IGQ7CiAgdC5jbG9zZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gYy5pbmNsdWRlcygiY2xvc2UiKSA/ICJibG9jayIgOiAibm9uZSIsIG0gPyAodC5mb290ZXIuc3R5bGUuZGlzcGxheSA9ICJmbGV4IiwgdC5wcm9ncmVzcy5zdHlsZS5kaXNwbGF5ID0gZCA/ICJibG9jayIgOiAibm9uZSIsIHQubmV4dEJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gYy5pbmNsdWRlcygibmV4dCIpID8gImJsb2NrIiA6ICJub25lIiwgdC5wcmV2aW91c0J1dHRvbi5zdHlsZS5kaXNwbGF5ID0gYy5pbmNsdWRlcygicHJldmlvdXMiKSA/ICJibG9jayIgOiAibm9uZSIpIDogdC5mb290ZXIuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICBjb25zdCBnID0gZiB8fCBhKCJkaXNhYmxlQnV0dG9ucyIpIHx8IFtdOwogIGcgIT0gbnVsbCAmJiBnLmluY2x1ZGVzKCJuZXh0IikgJiYgKHQubmV4dEJ1dHRvbi5kaXNhYmxlZCA9IHRydWUsIHQubmV4dEJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJkcml2ZXItcG9wb3Zlci1idG4tZGlzYWJsZWQiKSksIGcgIT0gbnVsbCAmJiBnLmluY2x1ZGVzKCJwcmV2aW91cyIpICYmICh0LnByZXZpb3VzQnV0dG9uLmRpc2FibGVkID0gdHJ1ZSwgdC5wcmV2aW91c0J1dHRvbi5jbGFzc0xpc3QuYWRkKCJkcml2ZXItcG9wb3Zlci1idG4tZGlzYWJsZWQiKSksIGcgIT0gbnVsbCAmJiBnLmluY2x1ZGVzKCJjbG9zZSIpICYmICh0LmNsb3NlQnV0dG9uLmRpc2FibGVkID0gdHJ1ZSwgdC5jbG9zZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJkcml2ZXItcG9wb3Zlci1idG4tZGlzYWJsZWQiKSk7CiAgY29uc3QgdSA9IHQud3JhcHBlcjsKICB1LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siLCB1LnN0eWxlLmxlZnQgPSAiIiwgdS5zdHlsZS50b3AgPSAiIiwgdS5zdHlsZS5ib3R0b20gPSAiIiwgdS5zdHlsZS5yaWdodCA9ICIiLCB1LmlkID0gImRyaXZlci1wb3BvdmVyLWNvbnRlbnQiLCB1LnNldEF0dHJpYnV0ZSgicm9sZSIsICJkaWFsb2ciKSwgdS5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWxsZWRieSIsICJkcml2ZXItcG9wb3Zlci10aXRsZSIpLCB1LnNldEF0dHJpYnV0ZSgiYXJpYS1kZXNjcmliZWRieSIsICJkcml2ZXItcG9wb3Zlci1kZXNjcmlwdGlvbiIpOwogIGNvbnN0IGggPSB0LmFycm93OwogIGguY2xhc3NOYW1lID0gImRyaXZlci1wb3BvdmVyLWFycm93IjsKICBjb25zdCBQID0gKChDID0gby5wb3BvdmVyKSA9PSBudWxsID8gdm9pZCAwIDogQy5wb3BvdmVyQ2xhc3MpIHx8IGEoInBvcG92ZXJDbGFzcyIpIHx8ICIiOwogIHUuY2xhc3NOYW1lID0gYGRyaXZlci1wb3BvdmVyICR7UH1gLnRyaW0oKSwgdGUoCiAgICB0LndyYXBwZXIsCiAgICAoaykgPT4gewogICAgICB2YXIgJCwgQiwgTTsKICAgICAgY29uc3QgVCA9IGsudGFyZ2V0LCBFID0gKCgkID0gby5wb3BvdmVyKSA9PSBudWxsID8gdm9pZCAwIDogJC5vbk5leHRDbGljaykgfHwgYSgib25OZXh0Q2xpY2siKSwgQSA9ICgoQiA9IG8ucG9wb3ZlcikgPT0gbnVsbCA/IHZvaWQgMCA6IEIub25QcmV2Q2xpY2spIHx8IGEoIm9uUHJldkNsaWNrIiksIEggPSAoKE0gPSBvLnBvcG92ZXIpID09IG51bGwgPyB2b2lkIDAgOiBNLm9uQ2xvc2VDbGljaykgfHwgYSgib25DbG9zZUNsaWNrIik7CiAgICAgIGlmIChULmNsYXNzTGlzdC5jb250YWlucygiZHJpdmVyLXBvcG92ZXItbmV4dC1idG4iKSkKICAgICAgICByZXR1cm4gRSA/IEUoZSwgbywgewogICAgICAgICAgY29uZmlnOiBhKCksCiAgICAgICAgICBzdGF0ZTogbCgpCiAgICAgICAgfSkgOiBMKCJuZXh0Q2xpY2siKTsKICAgICAgaWYgKFQuY2xhc3NMaXN0LmNvbnRhaW5zKCJkcml2ZXItcG9wb3Zlci1wcmV2LWJ0biIpKQogICAgICAgIHJldHVybiBBID8gQShlLCBvLCB7CiAgICAgICAgICBjb25maWc6IGEoKSwKICAgICAgICAgIHN0YXRlOiBsKCkKICAgICAgICB9KSA6IEwoInByZXZDbGljayIpOwogICAgICBpZiAoVC5jbGFzc0xpc3QuY29udGFpbnMoImRyaXZlci1wb3BvdmVyLWNsb3NlLWJ0biIpKQogICAgICAgIHJldHVybiBIID8gSChlLCBvLCB7CiAgICAgICAgICBjb25maWc6IGEoKSwKICAgICAgICAgIHN0YXRlOiBsKCkKICAgICAgICB9KSA6IEwoImNsb3NlQ2xpY2siKTsKICAgIH0sCiAgICAoaykgPT4gISh0ICE9IG51bGwgJiYgdC5kZXNjcmlwdGlvbi5jb250YWlucyhrKSkgJiYgISh0ICE9IG51bGwgJiYgdC50aXRsZS5jb250YWlucyhrKSkgJiYgdHlwZW9mIGsuY2xhc3NOYW1lID09ICJzdHJpbmciICYmIGsuY2xhc3NOYW1lLmluY2x1ZGVzKCJkcml2ZXItcG9wb3ZlciIpCiAgKSwgYigicG9wb3ZlciIsIHQpOwogIGNvbnN0IFMgPSAoKHkgPSBvLnBvcG92ZXIpID09IG51bGwgPyB2b2lkIDAgOiB5Lm9uUG9wb3ZlclJlbmRlcikgfHwgYSgib25Qb3BvdmVyUmVuZGVyIik7CiAgUyAmJiBTKHQsIHsKICAgIGNvbmZpZzogYSgpLAogICAgc3RhdGU6IGwoKQogIH0pLCBpZShlLCBvKSwgWih1KTsKICBjb25zdCBfID0gZS5jbGFzc0xpc3QuY29udGFpbnMoImRyaXZlci1kdW1teS1lbGVtZW50IiksIHggPSBRKFt1LCAuLi5fID8gW10gOiBbZV1dKTsKICB4Lmxlbmd0aCA+IDAgJiYgeFswXS5mb2N1cygpOwp9CmZ1bmN0aW9uIG9lKCkgewogIGNvbnN0IGUgPSBsKCJwb3BvdmVyIik7CiAgaWYgKCEoZSAhPSBudWxsICYmIGUud3JhcHBlcikpCiAgICByZXR1cm47CiAgY29uc3QgbyA9IGUud3JhcHBlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgdCA9IGEoInN0YWdlUGFkZGluZyIpIHx8IDAsIGkgPSBhKCJwb3BvdmVyT2Zmc2V0IikgfHwgMDsKICByZXR1cm4gewogICAgd2lkdGg6IG8ud2lkdGggKyB0ICsgaSwKICAgIGhlaWdodDogby5oZWlnaHQgKyB0ICsgaSwKICAgIHJlYWxXaWR0aDogby53aWR0aCwKICAgIHJlYWxIZWlnaHQ6IG8uaGVpZ2h0CiAgfTsKfQpmdW5jdGlvbiBZKGUsIG8pIHsKICBjb25zdCB7IGVsZW1lbnREaW1lbnNpb25zOiB0LCBwb3BvdmVyRGltZW5zaW9uczogaSwgcG9wb3ZlclBhZGRpbmc6IHAsIHBvcG92ZXJBcnJvd0RpbWVuc2lvbnM6IG4gfSA9IG87CiAgcmV0dXJuIGUgPT09ICJzdGFydCIgPyBNYXRoLm1heCgKICAgIE1hdGgubWluKAogICAgICB0LnRvcCAtIHAsCiAgICAgIHdpbmRvdy5pbm5lckhlaWdodCAtIGkucmVhbEhlaWdodCAtIG4ud2lkdGgKICAgICksCiAgICBuLndpZHRoCiAgKSA6IGUgPT09ICJlbmQiID8gTWF0aC5tYXgoCiAgICBNYXRoLm1pbigKICAgICAgdC50b3AgLSAoaSA9PSBudWxsID8gdm9pZCAwIDogaS5yZWFsSGVpZ2h0KSArIHQuaGVpZ2h0ICsgcCwKICAgICAgd2luZG93LmlubmVySGVpZ2h0IC0gKGkgPT0gbnVsbCA/IHZvaWQgMCA6IGkucmVhbEhlaWdodCkgLSBuLndpZHRoCiAgICApLAogICAgbi53aWR0aAogICkgOiBlID09PSAiY2VudGVyIiA/IE1hdGgubWF4KAogICAgTWF0aC5taW4oCiAgICAgIHQudG9wICsgdC5oZWlnaHQgLyAyIC0gKGkgPT0gbnVsbCA/IHZvaWQgMCA6IGkucmVhbEhlaWdodCkgLyAyLAogICAgICB3aW5kb3cuaW5uZXJIZWlnaHQgLSAoaSA9PSBudWxsID8gdm9pZCAwIDogaS5yZWFsSGVpZ2h0KSAtIG4ud2lkdGgKICAgICksCiAgICBuLndpZHRoCiAgKSA6IDA7Cn0KZnVuY3Rpb24gaihlLCBvKSB7CiAgY29uc3QgeyBlbGVtZW50RGltZW5zaW9uczogdCwgcG9wb3ZlckRpbWVuc2lvbnM6IGksIHBvcG92ZXJQYWRkaW5nOiBwLCBwb3BvdmVyQXJyb3dEaW1lbnNpb25zOiBuIH0gPSBvOwogIHJldHVybiBlID09PSAic3RhcnQiID8gTWF0aC5tYXgoCiAgICBNYXRoLm1pbigKICAgICAgdC5sZWZ0IC0gcCwKICAgICAgd2luZG93LmlubmVyV2lkdGggLSBpLnJlYWxXaWR0aCAtIG4ud2lkdGgKICAgICksCiAgICBuLndpZHRoCiAgKSA6IGUgPT09ICJlbmQiID8gTWF0aC5tYXgoCiAgICBNYXRoLm1pbigKICAgICAgdC5sZWZ0IC0gKGkgPT0gbnVsbCA/IHZvaWQgMCA6IGkucmVhbFdpZHRoKSArIHQud2lkdGggKyBwLAogICAgICB3aW5kb3cuaW5uZXJXaWR0aCAtIChpID09IG51bGwgPyB2b2lkIDAgOiBpLnJlYWxXaWR0aCkgLSBuLndpZHRoCiAgICApLAogICAgbi53aWR0aAogICkgOiBlID09PSAiY2VudGVyIiA/IE1hdGgubWF4KAogICAgTWF0aC5taW4oCiAgICAgIHQubGVmdCArIHQud2lkdGggLyAyIC0gKGkgPT0gbnVsbCA/IHZvaWQgMCA6IGkucmVhbFdpZHRoKSAvIDIsCiAgICAgIHdpbmRvdy5pbm5lcldpZHRoIC0gKGkgPT0gbnVsbCA/IHZvaWQgMCA6IGkucmVhbFdpZHRoKSAtIG4ud2lkdGgKICAgICksCiAgICBuLndpZHRoCiAgKSA6IDA7Cn0KZnVuY3Rpb24gaWUoZSwgbykgewogIGNvbnN0IHQgPSBsKCJwb3BvdmVyIik7CiAgaWYgKCF0KQogICAgcmV0dXJuOwogIGNvbnN0IHsgYWxpZ246IGkgPSAic3RhcnQiLCBzaWRlOiBwID0gImxlZnQiIH0gPSAobyA9PSBudWxsID8gdm9pZCAwIDogby5wb3BvdmVyKSB8fCB7fSwgbiA9IGksIGYgPSBlLmlkID09PSAiZHJpdmVyLWR1bW15LWVsZW1lbnQiID8gIm92ZXIiIDogcCwgdyA9IGEoInN0YWdlUGFkZGluZyIpIHx8IDAsIHIgPSBvZSgpLCB2ID0gdC5hcnJvdy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgcyA9IGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGMgPSBzLnRvcCAtIHIuaGVpZ2h0OwogIGxldCBkID0gYyA+PSAwOwogIGNvbnN0IG0gPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAocy5ib3R0b20gKyByLmhlaWdodCk7CiAgbGV0IGcgPSBtID49IDA7CiAgY29uc3QgdSA9IHMubGVmdCAtIHIud2lkdGg7CiAgbGV0IGggPSB1ID49IDA7CiAgY29uc3QgUCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gKHMucmlnaHQgKyByLndpZHRoKTsKICBsZXQgUyA9IFAgPj0gMDsKICBjb25zdCBfID0gIWQgJiYgIWcgJiYgIWggJiYgIVM7CiAgbGV0IHggPSBmOwogIGlmIChmID09PSAidG9wIiAmJiBkID8gUyA9IGggPSBnID0gZmFsc2UgOiBmID09PSAiYm90dG9tIiAmJiBnID8gUyA9IGggPSBkID0gZmFsc2UgOiBmID09PSAibGVmdCIgJiYgaCA/IFMgPSBkID0gZyA9IGZhbHNlIDogZiA9PT0gInJpZ2h0IiAmJiBTICYmIChoID0gZCA9IGcgPSBmYWxzZSksIGYgPT09ICJvdmVyIikgewogICAgY29uc3QgQyA9IHdpbmRvdy5pbm5lcldpZHRoIC8gMiAtIHIucmVhbFdpZHRoIC8gMiwgeSA9IHdpbmRvdy5pbm5lckhlaWdodCAvIDIgLSByLnJlYWxIZWlnaHQgLyAyOwogICAgdC53cmFwcGVyLnN0eWxlLmxlZnQgPSBgJHtDfXB4YCwgdC53cmFwcGVyLnN0eWxlLnJpZ2h0ID0gImF1dG8iLCB0LndyYXBwZXIuc3R5bGUudG9wID0gYCR7eX1weGAsIHQud3JhcHBlci5zdHlsZS5ib3R0b20gPSAiYXV0byI7CiAgfSBlbHNlIGlmIChfKSB7CiAgICBjb25zdCBDID0gd2luZG93LmlubmVyV2lkdGggLyAyIC0gKHIgPT0gbnVsbCA/IHZvaWQgMCA6IHIucmVhbFdpZHRoKSAvIDIsIHkgPSAxMDsKICAgIHQud3JhcHBlci5zdHlsZS5sZWZ0ID0gYCR7Q31weGAsIHQud3JhcHBlci5zdHlsZS5yaWdodCA9ICJhdXRvIiwgdC53cmFwcGVyLnN0eWxlLmJvdHRvbSA9IGAke3l9cHhgLCB0LndyYXBwZXIuc3R5bGUudG9wID0gImF1dG8iOwogIH0gZWxzZSBpZiAoaCkgewogICAgY29uc3QgQyA9IE1hdGgubWluKAogICAgICB1LAogICAgICB3aW5kb3cuaW5uZXJXaWR0aCAtIChyID09IG51bGwgPyB2b2lkIDAgOiByLnJlYWxXaWR0aCkgLSB2LndpZHRoCiAgICApLCB5ID0gWShuLCB7CiAgICAgIGVsZW1lbnREaW1lbnNpb25zOiBzLAogICAgICBwb3BvdmVyRGltZW5zaW9uczogciwKICAgICAgcG9wb3ZlclBhZGRpbmc6IHcsCiAgICAgIHBvcG92ZXJBcnJvd0RpbWVuc2lvbnM6IHYKICAgIH0pOwogICAgdC53cmFwcGVyLnN0eWxlLmxlZnQgPSBgJHtDfXB4YCwgdC53cmFwcGVyLnN0eWxlLnRvcCA9IGAke3l9cHhgLCB0LndyYXBwZXIuc3R5bGUuYm90dG9tID0gImF1dG8iLCB0LndyYXBwZXIuc3R5bGUucmlnaHQgPSAiYXV0byIsIHggPSAibGVmdCI7CiAgfSBlbHNlIGlmIChTKSB7CiAgICBjb25zdCBDID0gTWF0aC5taW4oCiAgICAgIFAsCiAgICAgIHdpbmRvdy5pbm5lcldpZHRoIC0gKHIgPT0gbnVsbCA/IHZvaWQgMCA6IHIucmVhbFdpZHRoKSAtIHYud2lkdGgKICAgICksIHkgPSBZKG4sIHsKICAgICAgZWxlbWVudERpbWVuc2lvbnM6IHMsCiAgICAgIHBvcG92ZXJEaW1lbnNpb25zOiByLAogICAgICBwb3BvdmVyUGFkZGluZzogdywKICAgICAgcG9wb3ZlckFycm93RGltZW5zaW9uczogdgogICAgfSk7CiAgICB0LndyYXBwZXIuc3R5bGUucmlnaHQgPSBgJHtDfXB4YCwgdC53cmFwcGVyLnN0eWxlLnRvcCA9IGAke3l9cHhgLCB0LndyYXBwZXIuc3R5bGUuYm90dG9tID0gImF1dG8iLCB0LndyYXBwZXIuc3R5bGUubGVmdCA9ICJhdXRvIiwgeCA9ICJyaWdodCI7CiAgfSBlbHNlIGlmIChkKSB7CiAgICBjb25zdCBDID0gTWF0aC5taW4oCiAgICAgIGMsCiAgICAgIHdpbmRvdy5pbm5lckhlaWdodCAtIHIucmVhbEhlaWdodCAtIHYud2lkdGgKICAgICk7CiAgICBsZXQgeSA9IGoobiwgewogICAgICBlbGVtZW50RGltZW5zaW9uczogcywKICAgICAgcG9wb3ZlckRpbWVuc2lvbnM6IHIsCiAgICAgIHBvcG92ZXJQYWRkaW5nOiB3LAogICAgICBwb3BvdmVyQXJyb3dEaW1lbnNpb25zOiB2CiAgICB9KTsKICAgIHQud3JhcHBlci5zdHlsZS50b3AgPSBgJHtDfXB4YCwgdC53cmFwcGVyLnN0eWxlLmxlZnQgPSBgJHt5fXB4YCwgdC53cmFwcGVyLnN0eWxlLmJvdHRvbSA9ICJhdXRvIiwgdC53cmFwcGVyLnN0eWxlLnJpZ2h0ID0gImF1dG8iLCB4ID0gInRvcCI7CiAgfSBlbHNlIGlmIChnKSB7CiAgICBjb25zdCBDID0gTWF0aC5taW4oCiAgICAgIG0sCiAgICAgIHdpbmRvdy5pbm5lckhlaWdodCAtIChyID09IG51bGwgPyB2b2lkIDAgOiByLnJlYWxIZWlnaHQpIC0gdi53aWR0aAogICAgKTsKICAgIGxldCB5ID0gaihuLCB7CiAgICAgIGVsZW1lbnREaW1lbnNpb25zOiBzLAogICAgICBwb3BvdmVyRGltZW5zaW9uczogciwKICAgICAgcG9wb3ZlclBhZGRpbmc6IHcsCiAgICAgIHBvcG92ZXJBcnJvd0RpbWVuc2lvbnM6IHYKICAgIH0pOwogICAgdC53cmFwcGVyLnN0eWxlLmxlZnQgPSBgJHt5fXB4YCwgdC53cmFwcGVyLnN0eWxlLmJvdHRvbSA9IGAke0N9cHhgLCB0LndyYXBwZXIuc3R5bGUudG9wID0gImF1dG8iLCB0LndyYXBwZXIuc3R5bGUucmlnaHQgPSAiYXV0byIsIHggPSAiYm90dG9tIjsKICB9CiAgXyA/IHQuYXJyb3cuY2xhc3NMaXN0LmFkZCgiZHJpdmVyLXBvcG92ZXItYXJyb3ctbm9uZSIpIDogQ2UobiwgeCwgZSk7Cn0KZnVuY3Rpb24gQ2UoZSwgbywgdCkgewogIGNvbnN0IGkgPSBsKCJwb3BvdmVyIik7CiAgaWYgKCFpKQogICAgcmV0dXJuOwogIGNvbnN0IHAgPSB0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCBuID0gb2UoKSwgZiA9IGkuYXJyb3csIHcgPSBuLndpZHRoLCByID0gd2luZG93LmlubmVyV2lkdGgsIHYgPSBwLndpZHRoLCBzID0gcC5sZWZ0LCBjID0gbi5oZWlnaHQsIGQgPSB3aW5kb3cuaW5uZXJIZWlnaHQsIG0gPSBwLnRvcCwgZyA9IHAuaGVpZ2h0OwogIGYuY2xhc3NOYW1lID0gImRyaXZlci1wb3BvdmVyLWFycm93IjsKICBsZXQgdSA9IG8sIGggPSBlOwogIG8gPT09ICJ0b3AiID8gKHMgKyB2IDw9IDAgPyAodSA9ICJyaWdodCIsIGggPSAiZW5kIikgOiBzICsgdiAtIHcgPD0gMCAmJiAodSA9ICJ0b3AiLCBoID0gInN0YXJ0IiksIHMgPj0gciA/ICh1ID0gImxlZnQiLCBoID0gImVuZCIpIDogcyArIHcgPj0gciAmJiAodSA9ICJ0b3AiLCBoID0gImVuZCIpKSA6IG8gPT09ICJib3R0b20iID8gKHMgKyB2IDw9IDAgPyAodSA9ICJyaWdodCIsIGggPSAic3RhcnQiKSA6IHMgKyB2IC0gdyA8PSAwICYmICh1ID0gImJvdHRvbSIsIGggPSAic3RhcnQiKSwgcyA+PSByID8gKHUgPSAibGVmdCIsIGggPSAic3RhcnQiKSA6IHMgKyB3ID49IHIgJiYgKHUgPSAiYm90dG9tIiwgaCA9ICJlbmQiKSkgOiBvID09PSAibGVmdCIgPyAobSArIGcgPD0gMCA/ICh1ID0gImJvdHRvbSIsIGggPSAiZW5kIikgOiBtICsgZyAtIGMgPD0gMCAmJiAodSA9ICJsZWZ0IiwgaCA9ICJzdGFydCIpLCBtID49IGQgPyAodSA9ICJ0b3AiLCBoID0gImVuZCIpIDogbSArIGMgPj0gZCAmJiAodSA9ICJsZWZ0IiwgaCA9ICJlbmQiKSkgOiBvID09PSAicmlnaHQiICYmIChtICsgZyA8PSAwID8gKHUgPSAiYm90dG9tIiwgaCA9ICJzdGFydCIpIDogbSArIGcgLSBjIDw9IDAgJiYgKHUgPSAicmlnaHQiLCBoID0gInN0YXJ0IiksIG0gPj0gZCA/ICh1ID0gInRvcCIsIGggPSAic3RhcnQiKSA6IG0gKyBjID49IGQgJiYgKHUgPSAicmlnaHQiLCBoID0gImVuZCIpKSwgdSA/IChmLmNsYXNzTGlzdC5hZGQoYGRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtJHt1fWApLCBmLmNsYXNzTGlzdC5hZGQoYGRyaXZlci1wb3BvdmVyLWFycm93LWFsaWduLSR7aH1gKSkgOiBmLmNsYXNzTGlzdC5hZGQoImRyaXZlci1wb3BvdmVyLWFycm93LW5vbmUiKTsKfQpmdW5jdGlvbiBQZSgpIHsKICBjb25zdCBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgZS5jbGFzc0xpc3QuYWRkKCJkcml2ZXItcG9wb3ZlciIpOwogIGNvbnN0IG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICBvLmNsYXNzTGlzdC5hZGQoImRyaXZlci1wb3BvdmVyLWFycm93Iik7CiAgY29uc3QgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImhlYWRlciIpOwogIHQuaWQgPSAiZHJpdmVyLXBvcG92ZXItdGl0bGUiLCB0LmNsYXNzTGlzdC5hZGQoImRyaXZlci1wb3BvdmVyLXRpdGxlIiksIHQuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgdC5pbm5lclRleHQgPSAiUG9wb3ZlciBUaXRsZSI7CiAgY29uc3QgaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogIGkuaWQgPSAiZHJpdmVyLXBvcG92ZXItZGVzY3JpcHRpb24iLCBpLmNsYXNzTGlzdC5hZGQoImRyaXZlci1wb3BvdmVyLWRlc2NyaXB0aW9uIiksIGkuc3R5bGUuZGlzcGxheSA9ICJub25lIiwgaS5pbm5lclRleHQgPSAiUG9wb3ZlciBkZXNjcmlwdGlvbiBpcyBoZXJlIjsKICBjb25zdCBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgcC50eXBlID0gImJ1dHRvbiIsIHAuY2xhc3NMaXN0LmFkZCgiZHJpdmVyLXBvcG92ZXItY2xvc2UtYnRuIiksIHAuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiwgIkNsb3NlIiksIHAuaW5uZXJIVE1MID0gIiZ0aW1lczsiOwogIGNvbnN0IG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJmb290ZXIiKTsKICBuLmNsYXNzTGlzdC5hZGQoImRyaXZlci1wb3BvdmVyLWZvb3RlciIpOwogIGNvbnN0IGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgZi5jbGFzc0xpc3QuYWRkKCJkcml2ZXItcG9wb3Zlci1wcm9ncmVzcy10ZXh0IiksIGYuaW5uZXJUZXh0ID0gIiI7CiAgY29uc3QgdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICB3LmNsYXNzTGlzdC5hZGQoImRyaXZlci1wb3BvdmVyLW5hdmlnYXRpb24tYnRucyIpOwogIGNvbnN0IHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICByLnR5cGUgPSAiYnV0dG9uIiwgci5jbGFzc0xpc3QuYWRkKCJkcml2ZXItcG9wb3Zlci1wcmV2LWJ0biIpLCByLmlubmVySFRNTCA9ICImbGFycjsgUHJldmlvdXMiOwogIGNvbnN0IHYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICByZXR1cm4gdi50eXBlID0gImJ1dHRvbiIsIHYuY2xhc3NMaXN0LmFkZCgiZHJpdmVyLXBvcG92ZXItbmV4dC1idG4iKSwgdi5pbm5lckhUTUwgPSAiTmV4dCAmcmFycjsiLCB3LmFwcGVuZENoaWxkKHIpLCB3LmFwcGVuZENoaWxkKHYpLCBuLmFwcGVuZENoaWxkKGYpLCBuLmFwcGVuZENoaWxkKHcpLCBlLmFwcGVuZENoaWxkKHApLCBlLmFwcGVuZENoaWxkKG8pLCBlLmFwcGVuZENoaWxkKHQpLCBlLmFwcGVuZENoaWxkKGkpLCBlLmFwcGVuZENoaWxkKG4pLCB7CiAgICB3cmFwcGVyOiBlLAogICAgYXJyb3c6IG8sCiAgICB0aXRsZTogdCwKICAgIGRlc2NyaXB0aW9uOiBpLAogICAgZm9vdGVyOiBuLAogICAgcHJldmlvdXNCdXR0b246IHIsCiAgICBuZXh0QnV0dG9uOiB2LAogICAgY2xvc2VCdXR0b246IHAsCiAgICBmb290ZXJCdXR0b25zOiB3LAogICAgcHJvZ3Jlc3M6IGYKICB9Owp9CmZ1bmN0aW9uIFNlKCkgewogIHZhciBvOwogIGNvbnN0IGUgPSBsKCJwb3BvdmVyIik7CiAgZSAmJiAoKG8gPSBlLndyYXBwZXIucGFyZW50RWxlbWVudCkgPT0gbnVsbCB8fCBvLnJlbW92ZUNoaWxkKGUud3JhcHBlcikpOwp9CmZ1bmN0aW9uIGtlKGUgPSB7fSkgewogIEQoZSk7CiAgZnVuY3Rpb24gbygpIHsKICAgIGEoImFsbG93Q2xvc2UiKSAmJiB2KCk7CiAgfQogIGZ1bmN0aW9uIHQoKSB7CiAgICBjb25zdCBzID0gbCgiYWN0aXZlSW5kZXgiKSwgYyA9IGEoInN0ZXBzIikgfHwgW107CiAgICBpZiAodHlwZW9mIHMgPT0gInVuZGVmaW5lZCIpCiAgICAgIHJldHVybjsKICAgIGNvbnN0IGQgPSBzICsgMTsKICAgIGNbZF0gPyByKGQpIDogdigpOwogIH0KICBmdW5jdGlvbiBpKCkgewogICAgY29uc3QgcyA9IGwoImFjdGl2ZUluZGV4IiksIGMgPSBhKCJzdGVwcyIpIHx8IFtdOwogICAgaWYgKHR5cGVvZiBzID09ICJ1bmRlZmluZWQiKQogICAgICByZXR1cm47CiAgICBjb25zdCBkID0gcyAtIDE7CiAgICBjW2RdID8gcihkKSA6IHYoKTsKICB9CiAgZnVuY3Rpb24gcChzKSB7CiAgICAoYSgic3RlcHMiKSB8fCBbXSlbc10gPyByKHMpIDogdigpOwogIH0KICBmdW5jdGlvbiBuKCkgewogICAgdmFyIGg7CiAgICBpZiAobCgiX190cmFuc2l0aW9uQ2FsbGJhY2siKSkKICAgICAgcmV0dXJuOwogICAgY29uc3QgYyA9IGwoImFjdGl2ZUluZGV4IiksIGQgPSBsKCJfX2FjdGl2ZVN0ZXAiKSwgbSA9IGwoIl9fYWN0aXZlRWxlbWVudCIpOwogICAgaWYgKHR5cGVvZiBjID09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBkID09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBsKCJhY3RpdmVJbmRleCIpID09ICJ1bmRlZmluZWQiKQogICAgICByZXR1cm47CiAgICBjb25zdCB1ID0gKChoID0gZC5wb3BvdmVyKSA9PSBudWxsID8gdm9pZCAwIDogaC5vblByZXZDbGljaykgfHwgYSgib25QcmV2Q2xpY2siKTsKICAgIGlmICh1KQogICAgICByZXR1cm4gdShtLCBkLCB7CiAgICAgICAgY29uZmlnOiBhKCksCiAgICAgICAgc3RhdGU6IGwoKQogICAgICB9KTsKICAgIGkoKTsKICB9CiAgZnVuY3Rpb24gZigpIHsKICAgIHZhciB1OwogICAgaWYgKGwoIl9fdHJhbnNpdGlvbkNhbGxiYWNrIikpCiAgICAgIHJldHVybjsKICAgIGNvbnN0IGMgPSBsKCJhY3RpdmVJbmRleCIpLCBkID0gbCgiX19hY3RpdmVTdGVwIiksIG0gPSBsKCJfX2FjdGl2ZUVsZW1lbnQiKTsKICAgIGlmICh0eXBlb2YgYyA9PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgZCA9PSAidW5kZWZpbmVkIikKICAgICAgcmV0dXJuOwogICAgY29uc3QgZyA9ICgodSA9IGQucG9wb3ZlcikgPT0gbnVsbCA/IHZvaWQgMCA6IHUub25OZXh0Q2xpY2spIHx8IGEoIm9uTmV4dENsaWNrIik7CiAgICBpZiAoZykKICAgICAgcmV0dXJuIGcobSwgZCwgewogICAgICAgIGNvbmZpZzogYSgpLAogICAgICAgIHN0YXRlOiBsKCkKICAgICAgfSk7CiAgICB0KCk7CiAgfQogIGZ1bmN0aW9uIHcoKSB7CiAgICBsKCJpc0luaXRpYWxpemVkIikgfHwgKGIoImlzSW5pdGlhbGl6ZWQiLCB0cnVlKSwgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCJkcml2ZXItYWN0aXZlIiwgYSgiYW5pbWF0ZSIpID8gImRyaXZlci1mYWRlIiA6ICJkcml2ZXItc2ltcGxlIiksIHllKCksIE4oIm92ZXJsYXlDbGljayIsIG8pLCBOKCJlc2NhcGVQcmVzcyIsIG8pLCBOKCJhcnJvd0xlZnRQcmVzcyIsIG4pLCBOKCJhcnJvd1JpZ2h0UHJlc3MiLCBmKSk7CiAgfQogIGZ1bmN0aW9uIHIocyA9IDApIHsKICAgIHZhciBFLCBBLCBILCAkLCBCLCBNLCB6LCBxOwogICAgY29uc3QgYyA9IGEoInN0ZXBzIik7CiAgICBpZiAoIWMpIHsKICAgICAgY29uc29sZS5lcnJvcigiTm8gc3RlcHMgdG8gZHJpdmUgdGhyb3VnaCIpLCB2KCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghY1tzXSkgewogICAgICB2KCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGIoIl9fYWN0aXZlT25EZXN0cm95ZWQiLCBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSwgYigiYWN0aXZlSW5kZXgiLCBzKTsKICAgIGNvbnN0IGQgPSBjW3NdLCBtID0gY1tzICsgMV0sIGcgPSBjW3MgLSAxXSwgdSA9ICgoRSA9IGQucG9wb3ZlcikgPT0gbnVsbCA/IHZvaWQgMCA6IEUuZG9uZUJ0blRleHQpIHx8IGEoImRvbmVCdG5UZXh0IikgfHwgIkRvbmUiLCBoID0gYSgiYWxsb3dDbG9zZSIpLCBQID0gdHlwZW9mICgoQSA9IGQucG9wb3ZlcikgPT0gbnVsbCA/IHZvaWQgMCA6IEEuc2hvd1Byb2dyZXNzKSAhPSAidW5kZWZpbmVkIiA/IChIID0gZC5wb3BvdmVyKSA9PSBudWxsID8gdm9pZCAwIDogSC5zaG93UHJvZ3Jlc3MgOiBhKCJzaG93UHJvZ3Jlc3MiKSwgXyA9ICgoKCQgPSBkLnBvcG92ZXIpID09IG51bGwgPyB2b2lkIDAgOiAkLnByb2dyZXNzVGV4dCkgfHwgYSgicHJvZ3Jlc3NUZXh0IikgfHwgInt7Y3VycmVudH19IG9mIHt7dG90YWx9fSIpLnJlcGxhY2UoInt7Y3VycmVudH19IiwgYCR7cyArIDF9YCkucmVwbGFjZSgie3t0b3RhbH19IiwgYCR7Yy5sZW5ndGh9YCksIHggPSAoKEIgPSBkLnBvcG92ZXIpID09IG51bGwgPyB2b2lkIDAgOiBCLnNob3dCdXR0b25zKSB8fCBhKCJzaG93QnV0dG9ucyIpLCBDID0gWwogICAgICAibmV4dCIsCiAgICAgICJwcmV2aW91cyIsCiAgICAgIC4uLmggPyBbImNsb3NlIl0gOiBbXQogICAgXS5maWx0ZXIoKG5lKSA9PiAhKHggIT0gbnVsbCAmJiB4Lmxlbmd0aCkgfHwgeC5pbmNsdWRlcyhuZSkpLCB5ID0gKChNID0gZC5wb3BvdmVyKSA9PSBudWxsID8gdm9pZCAwIDogTS5vbk5leHRDbGljaykgfHwgYSgib25OZXh0Q2xpY2siKSwgayA9ICgoeiA9IGQucG9wb3ZlcikgPT0gbnVsbCA/IHZvaWQgMCA6IHoub25QcmV2Q2xpY2spIHx8IGEoIm9uUHJldkNsaWNrIiksIFQgPSAoKHEgPSBkLnBvcG92ZXIpID09IG51bGwgPyB2b2lkIDAgOiBxLm9uQ2xvc2VDbGljaykgfHwgYSgib25DbG9zZUNsaWNrIik7CiAgICBLKHsKICAgICAgLi4uZCwKICAgICAgcG9wb3ZlcjogewogICAgICAgIHNob3dCdXR0b25zOiBDLAogICAgICAgIG5leHRCdG5UZXh0OiBtID8gdm9pZCAwIDogdSwKICAgICAgICBkaXNhYmxlQnV0dG9uczogWy4uLmcgPyBbXSA6IFsicHJldmlvdXMiXV0sCiAgICAgICAgc2hvd1Byb2dyZXNzOiBQLAogICAgICAgIHByb2dyZXNzVGV4dDogXywKICAgICAgICBvbk5leHRDbGljazogeSB8fCAoKCkgPT4gewogICAgICAgICAgbSA/IHIocyArIDEpIDogdigpOwogICAgICAgIH0pLAogICAgICAgIG9uUHJldkNsaWNrOiBrIHx8ICgoKSA9PiB7CiAgICAgICAgICByKHMgLSAxKTsKICAgICAgICB9KSwKICAgICAgICBvbkNsb3NlQ2xpY2s6IFQgfHwgKCgpID0+IHsKICAgICAgICAgIHYoKTsKICAgICAgICB9KSwKICAgICAgICAuLi4oZCA9PSBudWxsID8gdm9pZCAwIDogZC5wb3BvdmVyKSB8fCB7fQogICAgICB9CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gdihzID0gdHJ1ZSkgewogICAgY29uc3QgYyA9IGwoIl9fYWN0aXZlRWxlbWVudCIpLCBkID0gbCgiX19hY3RpdmVTdGVwIiksIG0gPSBsKCJfX2FjdGl2ZU9uRGVzdHJveWVkIiksIGcgPSBhKCJvbkRlc3Ryb3lTdGFydGVkIik7CiAgICBpZiAocyAmJiBnKSB7CiAgICAgIGNvbnN0IFAgPSAhYyB8fCAoYyA9PSBudWxsID8gdm9pZCAwIDogYy5pZCkgPT09ICJkcml2ZXItZHVtbXktZWxlbWVudCI7CiAgICAgIGcoUCA/IHZvaWQgMCA6IGMsIGQsIHsKICAgICAgICBjb25maWc6IGEoKSwKICAgICAgICBzdGF0ZTogbCgpCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB1ID0gKGQgPT0gbnVsbCA/IHZvaWQgMCA6IGQub25EZXNlbGVjdGVkKSB8fCBhKCJvbkRlc2VsZWN0ZWQiKSwgaCA9IGEoIm9uRGVzdHJveWVkIik7CiAgICBpZiAoZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCJkcml2ZXItYWN0aXZlIiwgImRyaXZlci1mYWRlIiwgImRyaXZlci1zaW1wbGUiKSwgYmUoKSwgU2UoKSwgd2UoKSwgdmUoKSwgY2UoKSwgVigpLCBjICYmIGQpIHsKICAgICAgY29uc3QgUCA9IGMuaWQgPT09ICJkcml2ZXItZHVtbXktZWxlbWVudCI7CiAgICAgIHUgJiYgdShQID8gdm9pZCAwIDogYywgZCwgewogICAgICAgIGNvbmZpZzogYSgpLAogICAgICAgIHN0YXRlOiBsKCkKICAgICAgfSksIGggJiYgaChQID8gdm9pZCAwIDogYywgZCwgewogICAgICAgIGNvbmZpZzogYSgpLAogICAgICAgIHN0YXRlOiBsKCkKICAgICAgfSk7CiAgICB9CiAgICBtICYmIG0uZm9jdXMoKTsKICB9CiAgcmV0dXJuIHsKICAgIGlzQWN0aXZlOiAoKSA9PiBsKCJpc0luaXRpYWxpemVkIikgfHwgZmFsc2UsCiAgICByZWZyZXNoOiBJLAogICAgZHJpdmU6IChzID0gMCkgPT4gewogICAgICB3KCksIHIocyk7CiAgICB9LAogICAgc2V0Q29uZmlnOiBELAogICAgc2V0U3RlcHM6IChzKSA9PiB7CiAgICAgIFYoKSwgRCh7CiAgICAgICAgLi4uYSgpLAogICAgICAgIHN0ZXBzOiBzCiAgICAgIH0pOwogICAgfSwKICAgIGdldENvbmZpZzogYSwKICAgIGdldFN0YXRlOiBsLAogICAgZ2V0QWN0aXZlSW5kZXg6ICgpID0+IGwoImFjdGl2ZUluZGV4IiksCiAgICBpc0ZpcnN0U3RlcDogKCkgPT4gbCgiYWN0aXZlSW5kZXgiKSA9PT0gMCwKICAgIGlzTGFzdFN0ZXA6ICgpID0+IHsKICAgICAgY29uc3QgcyA9IGEoInN0ZXBzIikgfHwgW10sIGMgPSBsKCJhY3RpdmVJbmRleCIpOwogICAgICByZXR1cm4gYyAhPT0gdm9pZCAwICYmIGMgPT09IHMubGVuZ3RoIC0gMTsKICAgIH0sCiAgICBnZXRBY3RpdmVTdGVwOiAoKSA9PiBsKCJhY3RpdmVTdGVwIiksCiAgICBnZXRBY3RpdmVFbGVtZW50OiAoKSA9PiBsKCJhY3RpdmVFbGVtZW50IiksCiAgICBnZXRQcmV2aW91c0VsZW1lbnQ6ICgpID0+IGwoInByZXZpb3VzRWxlbWVudCIpLAogICAgZ2V0UHJldmlvdXNTdGVwOiAoKSA9PiBsKCJwcmV2aW91c1N0ZXAiKSwKICAgIG1vdmVOZXh0OiB0LAogICAgbW92ZVByZXZpb3VzOiBpLAogICAgbW92ZVRvOiBwLAogICAgaGFzTmV4dFN0ZXA6ICgpID0+IHsKICAgICAgY29uc3QgcyA9IGEoInN0ZXBzIikgfHwgW10sIGMgPSBsKCJhY3RpdmVJbmRleCIpOwogICAgICByZXR1cm4gYyAhPT0gdm9pZCAwICYmIHNbYyArIDFdOwogICAgfSwKICAgIGhhc1ByZXZpb3VzU3RlcDogKCkgPT4gewogICAgICBjb25zdCBzID0gYSgic3RlcHMiKSB8fCBbXSwgYyA9IGwoImFjdGl2ZUluZGV4Iik7CiAgICAgIHJldHVybiBjICE9PSB2b2lkIDAgJiYgc1tjIC0gMV07CiAgICB9LAogICAgaGlnaGxpZ2h0OiAocykgPT4gewogICAgICB3KCksIEsoewogICAgICAgIC4uLnMsCiAgICAgICAgcG9wb3Zlcjogcy5wb3BvdmVyID8gewogICAgICAgICAgc2hvd0J1dHRvbnM6IFtdLAogICAgICAgICAgc2hvd1Byb2dyZXNzOiBmYWxzZSwKICAgICAgICAgIHByb2dyZXNzVGV4dDogIiIsCiAgICAgICAgICAuLi5zLnBvcG92ZXIKICAgICAgICB9IDogdm9pZCAwCiAgICAgIH0pOwogICAgfSwKICAgIGRlc3Ryb3k6ICgpID0+IHsKICAgICAgdihmYWxzZSk7CiAgICB9CiAgfTsKfQoKLy8gbm9kZV9tb2R1bGVzL2RyaXZlci5qcy9kaXN0L2RyaXZlci5jc3MKdmFyIGRyaXZlcl9kZWZhdWx0ID0gJy5kcml2ZXItYWN0aXZlIC5kcml2ZXItb3ZlcmxheSwuZHJpdmVyLWFjdGl2ZSAqe3BvaW50ZXItZXZlbnRzOm5vbmV9LmRyaXZlci1hY3RpdmUgLmRyaXZlci1hY3RpdmUtZWxlbWVudCwuZHJpdmVyLWFjdGl2ZSAuZHJpdmVyLWFjdGl2ZS1lbGVtZW50ICosLmRyaXZlci1wb3BvdmVyLC5kcml2ZXItcG9wb3ZlciAqe3BvaW50ZXItZXZlbnRzOmF1dG99QGtleWZyYW1lcyBhbmltYXRlLWZhZGUtaW57MCV7b3BhY2l0eTowfXRve29wYWNpdHk6MX19LmRyaXZlci1mYWRlIC5kcml2ZXItb3ZlcmxheXthbmltYXRpb246YW5pbWF0ZS1mYWRlLWluIC4ycyBlYXNlLWluLW91dH0uZHJpdmVyLWZhZGUgLmRyaXZlci1wb3BvdmVye2FuaW1hdGlvbjphbmltYXRlLWZhZGUtaW4gLjJzfS5kcml2ZXItcG9wb3ZlcnthbGw6dW5zZXQ7Ym94LXNpemluZzpib3JkZXItYm94O2NvbG9yOiMyZDJkMmQ7bWFyZ2luOjA7cGFkZGluZzoxNXB4O2JvcmRlci1yYWRpdXM6NXB4O21pbi13aWR0aDoyNTBweDttYXgtd2lkdGg6MzAwcHg7Ym94LXNoYWRvdzowIDFweCAxMHB4ICMwMDA2O3otaW5kZXg6MTAwMDAwMDAwMDtwb3NpdGlvbjpmaXhlZDt0b3A6MDtyaWdodDowO2JhY2tncm91bmQtY29sb3I6I2ZmZn0uZHJpdmVyLXBvcG92ZXIgKntmb250LWZhbWlseTpIZWx2ZXRpY2EgTmV1ZSxJbnRlcix1aS1zYW5zLXNlcmlmLCJBcHBsZSBDb2xvciBFbW9qaSIsSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWZ9LmRyaXZlci1wb3BvdmVyLXRpdGxle2ZvbnQ6MTlweC9ub3JtYWwgc2Fucy1zZXJpZjtmb250LXdlaWdodDo3MDA7ZGlzcGxheTpibG9jaztwb3NpdGlvbjpyZWxhdGl2ZTtsaW5lLWhlaWdodDoxLjU7em9vbToxO21hcmdpbjowfS5kcml2ZXItcG9wb3Zlci1jbG9zZS1idG57YWxsOnVuc2V0O3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO3JpZ2h0OjA7d2lkdGg6MzJweDtoZWlnaHQ6MjhweDtjdXJzb3I6cG9pbnRlcjtmb250LXNpemU6MThweDtmb250LXdlaWdodDo1MDA7Y29sb3I6I2QyZDJkMjt6LWluZGV4OjE7dGV4dC1hbGlnbjpjZW50ZXI7dHJhbnNpdGlvbjpjb2xvcjt0cmFuc2l0aW9uLWR1cmF0aW9uOi4yc30uZHJpdmVyLXBvcG92ZXItY2xvc2UtYnRuOmhvdmVyLC5kcml2ZXItcG9wb3Zlci1jbG9zZS1idG46Zm9jdXN7Y29sb3I6IzJkMmQyZH0uZHJpdmVyLXBvcG92ZXItdGl0bGVbc3R5bGUqPWJsb2NrXSsuZHJpdmVyLXBvcG92ZXItZGVzY3JpcHRpb257bWFyZ2luLXRvcDo1cHh9LmRyaXZlci1wb3BvdmVyLWRlc2NyaXB0aW9ue21hcmdpbi1ib3R0b206MDtmb250OjE0cHgvbm9ybWFsIHNhbnMtc2VyaWY7bGluZS1oZWlnaHQ6MS41O2ZvbnQtd2VpZ2h0OjQwMDt6b29tOjF9LmRyaXZlci1wb3BvdmVyLWZvb3RlcnttYXJnaW4tdG9wOjE1cHg7dGV4dC1hbGlnbjpyaWdodDt6b29tOjE7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbn0uZHJpdmVyLXBvcG92ZXItcHJvZ3Jlc3MtdGV4dHtmb250LXNpemU6MTNweDtmb250LXdlaWdodDo0MDA7Y29sb3I6IzcyNzI3Mjt6b29tOjF9LmRyaXZlci1wb3BvdmVyLWZvb3RlciBidXR0b257YWxsOnVuc2V0O2Rpc3BsYXk6aW5saW5lLWJsb2NrO2JveC1zaXppbmc6Ym9yZGVyLWJveDtwYWRkaW5nOjNweCA3cHg7dGV4dC1kZWNvcmF0aW9uOm5vbmU7dGV4dC1zaGFkb3c6MXB4IDFweCAwICNmZmY7YmFja2dyb3VuZC1jb2xvcjojZmZmO2NvbG9yOiMyZDJkMmQ7Zm9udDoxMnB4L25vcm1hbCBzYW5zLXNlcmlmO2N1cnNvcjpwb2ludGVyO291dGxpbmU6MDt6b29tOjE7bGluZS1oZWlnaHQ6MS4zO2JvcmRlcjoxcHggc29saWQgI2NjYztib3JkZXItcmFkaXVzOjNweH0uZHJpdmVyLXBvcG92ZXItZm9vdGVyIC5kcml2ZXItcG9wb3Zlci1idG4tZGlzYWJsZWR7b3BhY2l0eTouNTtwb2ludGVyLWV2ZW50czpub25lfTpub3QoYm9keSk6aGFzKD4uZHJpdmVyLWFjdGl2ZS1lbGVtZW50KXtvdmVyZmxvdzpoaWRkZW4haW1wb3J0YW50fS5kcml2ZXItbm8taW50ZXJhY3Rpb24sLmRyaXZlci1uby1pbnRlcmFjdGlvbiAqe3BvaW50ZXItZXZlbnRzOm5vbmUhaW1wb3J0YW50fS5kcml2ZXItcG9wb3Zlci1mb290ZXIgYnV0dG9uOmhvdmVyLC5kcml2ZXItcG9wb3Zlci1mb290ZXIgYnV0dG9uOmZvY3Vze2JhY2tncm91bmQtY29sb3I6I2Y3ZjdmN30uZHJpdmVyLXBvcG92ZXItbmF2aWdhdGlvbi1idG5ze2Rpc3BsYXk6ZmxleDtmbGV4LWdyb3c6MTtqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1lbmR9LmRyaXZlci1wb3BvdmVyLW5hdmlnYXRpb24tYnRucyBidXR0b24rYnV0dG9ue21hcmdpbi1sZWZ0OjRweH0uZHJpdmVyLXBvcG92ZXItYXJyb3d7Y29udGVudDoiIjtwb3NpdGlvbjphYnNvbHV0ZTtib3JkZXI6NXB4IHNvbGlkICNmZmZ9LmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtb3ZlcntkaXNwbGF5Om5vbmV9LmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtbGVmdHtsZWZ0OjEwMCU7Ym9yZGVyLXJpZ2h0LWNvbG9yOnRyYW5zcGFyZW50O2JvcmRlci1ib3R0b20tY29sb3I6dHJhbnNwYXJlbnQ7Ym9yZGVyLXRvcC1jb2xvcjp0cmFuc3BhcmVudH0uZHJpdmVyLXBvcG92ZXItYXJyb3ctc2lkZS1yaWdodHtyaWdodDoxMDAlO2JvcmRlci1sZWZ0LWNvbG9yOnRyYW5zcGFyZW50O2JvcmRlci1ib3R0b20tY29sb3I6dHJhbnNwYXJlbnQ7Ym9yZGVyLXRvcC1jb2xvcjp0cmFuc3BhcmVudH0uZHJpdmVyLXBvcG92ZXItYXJyb3ctc2lkZS10b3B7dG9wOjEwMCU7Ym9yZGVyLXJpZ2h0LWNvbG9yOnRyYW5zcGFyZW50O2JvcmRlci1ib3R0b20tY29sb3I6dHJhbnNwYXJlbnQ7Ym9yZGVyLWxlZnQtY29sb3I6dHJhbnNwYXJlbnR9LmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtYm90dG9te2JvdHRvbToxMDAlO2JvcmRlci1sZWZ0LWNvbG9yOnRyYW5zcGFyZW50O2JvcmRlci10b3AtY29sb3I6dHJhbnNwYXJlbnQ7Ym9yZGVyLXJpZ2h0LWNvbG9yOnRyYW5zcGFyZW50fS5kcml2ZXItcG9wb3Zlci1hcnJvdy1zaWRlLWNlbnRlcntkaXNwbGF5Om5vbmV9LmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtbGVmdC5kcml2ZXItcG9wb3Zlci1hcnJvdy1hbGlnbi1zdGFydCwuZHJpdmVyLXBvcG92ZXItYXJyb3ctc2lkZS1yaWdodC5kcml2ZXItcG9wb3Zlci1hcnJvdy1hbGlnbi1zdGFydHt0b3A6MTVweH0uZHJpdmVyLXBvcG92ZXItYXJyb3ctc2lkZS10b3AuZHJpdmVyLXBvcG92ZXItYXJyb3ctYWxpZ24tc3RhcnQsLmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtYm90dG9tLmRyaXZlci1wb3BvdmVyLWFycm93LWFsaWduLXN0YXJ0e2xlZnQ6MTVweH0uZHJpdmVyLXBvcG92ZXItYXJyb3ctYWxpZ24tZW5kLmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtbGVmdCwuZHJpdmVyLXBvcG92ZXItYXJyb3ctYWxpZ24tZW5kLmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtcmlnaHR7Ym90dG9tOjE1cHh9LmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtdG9wLmRyaXZlci1wb3BvdmVyLWFycm93LWFsaWduLWVuZCwuZHJpdmVyLXBvcG92ZXItYXJyb3ctc2lkZS1ib3R0b20uZHJpdmVyLXBvcG92ZXItYXJyb3ctYWxpZ24tZW5ke3JpZ2h0OjE1cHh9LmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtbGVmdC5kcml2ZXItcG9wb3Zlci1hcnJvdy1hbGlnbi1jZW50ZXIsLmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtcmlnaHQuZHJpdmVyLXBvcG92ZXItYXJyb3ctYWxpZ24tY2VudGVye3RvcDo1MCU7bWFyZ2luLXRvcDotNXB4fS5kcml2ZXItcG9wb3Zlci1hcnJvdy1zaWRlLXRvcC5kcml2ZXItcG9wb3Zlci1hcnJvdy1hbGlnbi1jZW50ZXIsLmRyaXZlci1wb3BvdmVyLWFycm93LXNpZGUtYm90dG9tLmRyaXZlci1wb3BvdmVyLWFycm93LWFsaWduLWNlbnRlcntsZWZ0OjUwJTttYXJnaW4tbGVmdDotNXB4fS5kcml2ZXItcG9wb3Zlci1hcnJvdy1ub25le2Rpc3BsYXk6bm9uZX1cbic7CgovLyBqcy9kcml2ZXItdG91ci93aWRnZXQuanMKZnVuY3Rpb24gaW5qZWN0RHJpdmVyQ1NTKCkgewogIGlmICghZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic3R5bGVbZGF0YS1kcml2ZXItY3NzXSIpKSB7CiAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CiAgICBzdHlsZS5zZXRBdHRyaWJ1dGUoImRhdGEtZHJpdmVyLWNzcyIsICJ0cnVlIik7CiAgICBzdHlsZS50ZXh0Q29udGVudCA9IGRyaXZlcl9kZWZhdWx0OwogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7CiAgfQp9CmZ1bmN0aW9uIHJlbmRlcih7IG1vZGVsLCBlbCB9KSB7CiAgaW5qZWN0RHJpdmVyQ1NTKCk7CiAgbGV0IGRyaXZlck9iaiA9IG51bGw7CiAgbGV0IHN0YXJ0QnV0dG9uID0gbnVsbDsKICBlbC5jbGFzc0xpc3QuYWRkKCJkcml2ZXItdG91ci13cmFwcGVyIik7CiAgZnVuY3Rpb24gaW5pdGlhbGl6ZURyaXZlcigpIHsKICAgIGNvbnN0IHN0ZXBzID0gbW9kZWwuZ2V0KCJzdGVwcyIpOwogICAgY29uc3Qgc2hvd1Byb2dyZXNzID0gbW9kZWwuZ2V0KCJzaG93X3Byb2dyZXNzIik7CiAgICBpZiAoIXN0ZXBzIHx8IHN0ZXBzLmxlbmd0aCA9PT0gMCkgewogICAgICBlbC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iZHJpdmVyLXRvdXItZW1wdHkiPk5vIHRvdXIgc3RlcHMgZGVmaW5lZDwvZGl2Pic7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGRyaXZlck9iaiA9IGtlKHsKICAgICAgc2hvd1Byb2dyZXNzLAogICAgICBhbGxvd0Nsb3NlOiB0cnVlLAogICAgICBzaG93QnV0dG9uczogWyJuZXh0IiwgInByZXZpb3VzIiwgImNsb3NlIl0sCiAgICAgIG9uRGVzdHJveVN0YXJ0ZWQ6ICgpID0+IHsKICAgICAgICBpZiAoZHJpdmVyT2JqKSB7CiAgICAgICAgICBkcml2ZXJPYmouZGVzdHJveSgpOwogICAgICAgICAgbW9kZWwuc2V0KCJhY3RpdmUiLCBmYWxzZSk7CiAgICAgICAgICBtb2RlbC5zZXQoImN1cnJlbnRfc3RlcCIsIDApOwogICAgICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICAgICAgICByZW5kZXJCdXR0b24oKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9uTmV4dENsaWNrOiAoKSA9PiB7CiAgICAgICAgZHJpdmVyT2JqLm1vdmVOZXh0KCk7CiAgICAgICAgbW9kZWwuc2V0KCJjdXJyZW50X3N0ZXAiLCBkcml2ZXJPYmouZ2V0QWN0aXZlSW5kZXgoKSk7CiAgICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICAgIH0sCiAgICAgIG9uUHJldkNsaWNrOiAoKSA9PiB7CiAgICAgICAgZHJpdmVyT2JqLm1vdmVQcmV2aW91cygpOwogICAgICAgIG1vZGVsLnNldCgiY3VycmVudF9zdGVwIiwgZHJpdmVyT2JqLmdldEFjdGl2ZUluZGV4KCkpOwogICAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgICB9LAogICAgICBzdGVwczogc3RlcHMubWFwKChzdGVwKSA9PiB7CiAgICAgICAgbGV0IGVsZW1lbnQgPSBzdGVwLmVsZW1lbnQgfHwgbnVsbDsKICAgICAgICBpZiAoZWxlbWVudCAmJiBzdGVwLmluZGV4ICE9PSB2b2lkIDApIHsKICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChlbGVtZW50KTsKICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50c1tzdGVwLmluZGV4XSB8fCBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgZWxlbWVudCwKICAgICAgICAgIHBvcG92ZXI6IHsKICAgICAgICAgICAgdGl0bGU6IHN0ZXAucG9wb3Zlcj8udGl0bGUgfHwgIiIsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBzdGVwLnBvcG92ZXI/LmRlc2NyaXB0aW9uIHx8ICIiLAogICAgICAgICAgICBzaWRlOiBzdGVwLnBvcG92ZXI/LnBvc2l0aW9uIHx8ICJib3R0b20iLAogICAgICAgICAgICBhbGlnbjogc3RlcC5wb3BvdmVyPy5hbGlnbiB8fCAic3RhcnQiCiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfSkKICAgIH0pOwogICAgcmV0dXJuIGRyaXZlck9iajsKICB9CiAgZnVuY3Rpb24gcmVuZGVyQnV0dG9uKCkgewogICAgZWwuaW5uZXJIVE1MID0gIiI7CiAgICBzdGFydEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgc3RhcnRCdXR0b24uY2xhc3NOYW1lID0gImRyaXZlci10b3VyLXN0YXJ0LWJ1dHRvbiI7CiAgICBzdGFydEJ1dHRvbi50ZXh0Q29udGVudCA9ICJTdGFydCBUb3VyIjsKICAgIHN0YXJ0QnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgIGlmICghZHJpdmVyT2JqKSB7CiAgICAgICAgaW5pdGlhbGl6ZURyaXZlcigpOwogICAgICB9CiAgICAgIGlmIChkcml2ZXJPYmopIHsKICAgICAgICBkcml2ZXJPYmouZHJpdmUoKTsKICAgICAgICBtb2RlbC5zZXQoImFjdGl2ZSIsIHRydWUpOwogICAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgICAgIGVsLmlubmVySFRNTCA9ICIiOwogICAgICB9CiAgICB9OwogICAgZWwuYXBwZW5kQ2hpbGQoc3RhcnRCdXR0b24pOwogIH0KICBmdW5jdGlvbiBpbml0aWFsaXplKCkgewogICAgaW5pdGlhbGl6ZURyaXZlcigpOwogICAgaWYgKG1vZGVsLmdldCgiYXV0b19zdGFydCIpKSB7CiAgICAgIGlmIChkcml2ZXJPYmopIHsKICAgICAgICBkcml2ZXJPYmouZHJpdmUoKTsKICAgICAgICBtb2RlbC5zZXQoImFjdGl2ZSIsIHRydWUpOwogICAgICAgIG1vZGVsLnNhdmVfY2hhbmdlcygpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICByZW5kZXJCdXR0b24oKTsKICAgIH0KICB9CiAgbW9kZWwub24oImNoYW5nZTpzdGVwcyIsICgpID0+IHsKICAgIGlmIChkcml2ZXJPYmopIHsKICAgICAgZHJpdmVyT2JqLmRlc3Ryb3koKTsKICAgICAgZHJpdmVyT2JqID0gbnVsbDsKICAgIH0KICAgIGluaXRpYWxpemUoKTsKICB9KTsKICBtb2RlbC5vbigiY2hhbmdlOmF1dG9fc3RhcnQiLCAoKSA9PiB7CiAgICBpZiAobW9kZWwuZ2V0KCJhdXRvX3N0YXJ0IikgJiYgIW1vZGVsLmdldCgiYWN0aXZlIikpIHsKICAgICAgaWYgKHN0YXJ0QnV0dG9uKSB7CiAgICAgICAgc3RhcnRCdXR0b24uY2xpY2soKTsKICAgICAgfQogICAgfQogIH0pOwogIGluaXRpYWxpemUoKTsKfQp2YXIgd2lkZ2V0X2RlZmF1bHQgPSB7IHJlbmRlciB9OwpleHBvcnQgewogIHdpZGdldF9kZWZhdWx0IGFzIGRlZmF1bHQKfTsK&quot;' data-js-hash='&quot;3fd1c7a139296117313cec7b2d7a632d&quot;'></marimo-anywidget></marimo-ui-element>"
          }
        }
      ],
      "console": []
    }
  ]
}