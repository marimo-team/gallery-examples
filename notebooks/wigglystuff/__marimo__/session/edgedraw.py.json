{
  "version": "1",
  "metadata": {
    "marimo_version": "0.19.11"
  },
  "cells": [
    {
      "id": "Hbol",
      "code_hash": "1d0db38904205bec4d6f6f6a1f6cec3e",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "MJUe",
      "code_hash": "df36c8a307eeb4855b9ff657a6112829",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"edgedraw\">EdgeDraw</h2>\n<span class=\"paragraph\">We created this widget to make it easy to dynamically draw a graph.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "vblA",
      "code_hash": "0f29fe2342d1316be45a4f24439dfe48",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='vblA-0' random-id='6f3b7f2a-bfa3-bb5b-e05d-01434b669d15'><marimo-anywidget data-initial-value='{&quot;model_id&quot;:&quot;905f3c080480495b87bc6d853bb6a19d&quot;}' data-label='null' data-js-url='&quot;data:text/javascript;base64,dmFyIF9fY3JlYXRlID0gT2JqZWN0LmNyZWF0ZTsKdmFyIF9fZGVmUHJvcCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKdmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwp2YXIgX19nZXRPd25Qcm9wTmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lczsKdmFyIF9fZ2V0UHJvdG9PZiA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsKdmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CnZhciBfX2NvbW1vbkpTID0gKGNiLCBtb2QpID0+IGZ1bmN0aW9uIF9fcmVxdWlyZSgpIHsKICByZXR1cm4gbW9kIHx8ICgwLCBjYltfX2dldE93blByb3BOYW1lcyhjYilbMF1dKSgobW9kID0geyBleHBvcnRzOiB7fSB9KS5leHBvcnRzLCBtb2QpLCBtb2QuZXhwb3J0czsKfTsKdmFyIF9fY29weVByb3BzID0gKHRvLCBmcm9tLCBleGNlcHQsIGRlc2MpID0+IHsKICBpZiAoZnJvbSAmJiB0eXBlb2YgZnJvbSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGZyb20gPT09ICJmdW5jdGlvbiIpIHsKICAgIGZvciAobGV0IGtleSBvZiBfX2dldE93blByb3BOYW1lcyhmcm9tKSkKICAgICAgaWYgKCFfX2hhc093blByb3AuY2FsbCh0bywga2V5KSAmJiBrZXkgIT09IGV4Y2VwdCkKICAgICAgICBfX2RlZlByb3AodG8sIGtleSwgeyBnZXQ6ICgpID0+IGZyb21ba2V5XSwgZW51bWVyYWJsZTogIShkZXNjID0gX19nZXRPd25Qcm9wRGVzYyhmcm9tLCBrZXkpKSB8fCBkZXNjLmVudW1lcmFibGUgfSk7CiAgfQogIHJldHVybiB0bzsKfTsKdmFyIF9fdG9FU00gPSAobW9kLCBpc05vZGVNb2RlLCB0YXJnZXQpID0+ICh0YXJnZXQgPSBtb2QgIT0gbnVsbCA/IF9fY3JlYXRlKF9fZ2V0UHJvdG9PZihtb2QpKSA6IHt9LCBfX2NvcHlQcm9wcygKICAvLyBJZiB0aGUgaW1wb3J0ZXIgaXMgaW4gbm9kZSBjb21wYXRpYmlsaXR5IG1vZGUgb3IgdGhpcyBpcyBub3QgYW4gRVNNCiAgLy8gZmlsZSB0aGF0IGhhcyBiZWVuIGNvbnZlcnRlZCB0byBhIENvbW1vbkpTIGZpbGUgdXNpbmcgYSBCYWJlbC0KICAvLyBjb21wYXRpYmxlIHRyYW5zZm9ybSAoaS5lLiAiX19lc01vZHVsZSIgaGFzIG5vdCBiZWVuIHNldCksIHRoZW4gc2V0CiAgLy8gImRlZmF1bHQiIHRvIHRoZSBDb21tb25KUyAibW9kdWxlLmV4cG9ydHMiIGZvciBub2RlIGNvbXBhdGliaWxpdHkuCiAgaXNOb2RlTW9kZSB8fCAhbW9kIHx8ICFtb2QuX19lc01vZHVsZSA/IF9fZGVmUHJvcCh0YXJnZXQsICJkZWZhdWx0IiwgeyB2YWx1ZTogbW9kLCBlbnVtZXJhYmxlOiB0cnVlIH0pIDogdGFyZ2V0LAogIG1vZAopKTsKCi8vIGpzL2QzLm1pbi5qcwp2YXIgcmVxdWlyZV9kM19taW4gPSBfX2NvbW1vbkpTKHsKICAianMvZDMubWluLmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICFmdW5jdGlvbih0LCBuKSB7CiAgICAgICJvYmplY3QiID09IHR5cGVvZiBleHBvcnRzICYmICJ1bmRlZmluZWQiICE9IHR5cGVvZiBtb2R1bGUgPyBuKGV4cG9ydHMpIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZGVmaW5lICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoWyJleHBvcnRzIl0sIG4pIDogbigodCA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBnbG9iYWxUaGlzID8gZ2xvYmFsVGhpcyA6IHQgfHwgc2VsZikuZDMgPSB0LmQzIHx8IHt9KTsKICAgIH0oZXhwb3J0cywgZnVuY3Rpb24odCkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIG4odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdDIgfHwgbnVsbCA9PSBuMiA/IE5hTiA6IHQyIDwgbjIgPyAtMSA6IHQyID4gbjIgPyAxIDogdDIgPj0gbjIgPyAwIDogTmFOOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGUodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdDIgfHwgbnVsbCA9PSBuMiA/IE5hTiA6IG4yIDwgdDIgPyAtMSA6IG4yID4gdDIgPyAxIDogbjIgPj0gdDIgPyAwIDogTmFOOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHIodDIpIHsKICAgICAgICBsZXQgcjIsIG8yLCBhMjsKICAgICAgICBmdW5jdGlvbiB1Mih0MywgbjIsIGUyID0gMCwgaTIgPSB0My5sZW5ndGgpIHsKICAgICAgICAgIGlmIChlMiA8IGkyKSB7CiAgICAgICAgICAgIGlmICgwICE9PSByMihuMiwgbjIpKQogICAgICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGNvbnN0IHIzID0gZTIgKyBpMiA+Pj4gMTsKICAgICAgICAgICAgICBvMih0M1tyM10sIG4yKSA8IDAgPyBlMiA9IHIzICsgMSA6IGkyID0gcjM7CiAgICAgICAgICAgIH0gd2hpbGUgKGUyIDwgaTIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMiAhPT0gdDIubGVuZ3RoID8gKHIyID0gbiwgbzIgPSAoZTIsIHIzKSA9PiBuKHQyKGUyKSwgcjMpLCBhMiA9IChuMiwgZTIpID0+IHQyKG4yKSAtIGUyKSA6IChyMiA9IHQyID09PSBuIHx8IHQyID09PSBlID8gdDIgOiBpLCBvMiA9IHQyLCBhMiA9IHQyKSwgeyBsZWZ0OiB1MiwgY2VudGVyOiBmdW5jdGlvbih0MywgbjIsIGUyID0gMCwgcjMgPSB0My5sZW5ndGgpIHsKICAgICAgICAgIGNvbnN0IGkyID0gdTIodDMsIG4yLCBlMiwgcjMgLSAxKTsKICAgICAgICAgIHJldHVybiBpMiA+IGUyICYmIGEyKHQzW2kyIC0gMV0sIG4yKSA+IC1hMih0M1tpMl0sIG4yKSA/IGkyIC0gMSA6IGkyOwogICAgICAgIH0sIHJpZ2h0OiBmdW5jdGlvbih0MywgbjIsIGUyID0gMCwgaTIgPSB0My5sZW5ndGgpIHsKICAgICAgICAgIGlmIChlMiA8IGkyKSB7CiAgICAgICAgICAgIGlmICgwICE9PSByMihuMiwgbjIpKQogICAgICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGNvbnN0IHIzID0gZTIgKyBpMiA+Pj4gMTsKICAgICAgICAgICAgICBvMih0M1tyM10sIG4yKSA8PSAwID8gZTIgPSByMyArIDEgOiBpMiA9IHIzOwogICAgICAgICAgICB9IHdoaWxlIChlMiA8IGkyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICB9IH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaSgpIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICBmdW5jdGlvbiBvKHQyKSB7CiAgICAgICAgcmV0dXJuIG51bGwgPT09IHQyID8gTmFOIDogK3QyOwogICAgICB9CiAgICAgIGNvbnN0IGEgPSByKG4pLCB1ID0gYS5yaWdodCwgYyA9IGEubGVmdCwgZiA9IHIobykuY2VudGVyOwogICAgICB2YXIgcyA9IHU7CiAgICAgIGNvbnN0IGwgPSBkKHkpLCBoID0gZChmdW5jdGlvbih0MikgewogICAgICAgIGNvbnN0IG4yID0geSh0Mik7CiAgICAgICAgcmV0dXJuICh0MywgZTIsIHIyLCBpMiwgbzIpID0+IHsKICAgICAgICAgIG4yKHQzLCBlMiwgKHIyIDw8PSAyKSArIDAsIChpMiA8PD0gMikgKyAwLCBvMiA8PD0gMiksIG4yKHQzLCBlMiwgcjIgKyAxLCBpMiArIDEsIG8yKSwgbjIodDMsIGUyLCByMiArIDIsIGkyICsgMiwgbzIpLCBuMih0MywgZTIsIHIyICsgMywgaTIgKyAzLCBvMik7CiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIGZ1bmN0aW9uIGQodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24objIsIGUyLCByMiA9IGUyKSB7CiAgICAgICAgICBpZiAoISgoZTIgPSArZTIpID49IDApKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCByeCIpOwogICAgICAgICAgaWYgKCEoKHIyID0gK3IyKSA+PSAwKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgcnkiKTsKICAgICAgICAgIGxldCB7IGRhdGE6IGkyLCB3aWR0aDogbzIsIGhlaWdodDogYTIgfSA9IG4yOwogICAgICAgICAgaWYgKCEoKG8yID0gTWF0aC5mbG9vcihvMikpID49IDApKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCB3aWR0aCIpOwogICAgICAgICAgaWYgKCEoKGEyID0gTWF0aC5mbG9vcih2b2lkIDAgIT09IGEyID8gYTIgOiBpMi5sZW5ndGggLyBvMikpID49IDApKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBoZWlnaHQiKTsKICAgICAgICAgIGlmICghbzIgfHwgIWEyIHx8ICFlMiAmJiAhcjIpCiAgICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICAgIGNvbnN0IHUyID0gZTIgJiYgdDIoZTIpLCBjMiA9IHIyICYmIHQyKHIyKSwgZjIgPSBpMi5zbGljZSgpOwogICAgICAgICAgcmV0dXJuIHUyICYmIGMyID8gKHAodTIsIGYyLCBpMiwgbzIsIGEyKSwgcCh1MiwgaTIsIGYyLCBvMiwgYTIpLCBwKHUyLCBmMiwgaTIsIG8yLCBhMiksIGcoYzIsIGkyLCBmMiwgbzIsIGEyKSwgZyhjMiwgZjIsIGkyLCBvMiwgYTIpLCBnKGMyLCBpMiwgZjIsIG8yLCBhMikpIDogdTIgPyAocCh1MiwgaTIsIGYyLCBvMiwgYTIpLCBwKHUyLCBmMiwgaTIsIG8yLCBhMiksIHAodTIsIGkyLCBmMiwgbzIsIGEyKSkgOiBjMiAmJiAoZyhjMiwgaTIsIGYyLCBvMiwgYTIpLCBnKGMyLCBmMiwgaTIsIG8yLCBhMiksIGcoYzIsIGkyLCBmMiwgbzIsIGEyKSksIG4yOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcCh0MiwgbjIsIGUyLCByMiwgaTIpIHsKICAgICAgICBmb3IgKGxldCBvMiA9IDAsIGEyID0gcjIgKiBpMjsgbzIgPCBhMjsgKQogICAgICAgICAgdDIobjIsIGUyLCBvMiwgbzIgKz0gcjIsIDEpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGcodDIsIG4yLCBlMiwgcjIsIGkyKSB7CiAgICAgICAgZm9yIChsZXQgbzIgPSAwLCBhMiA9IHIyICogaTI7IG8yIDwgcjI7ICsrbzIpCiAgICAgICAgICB0MihuMiwgZTIsIG8yLCBvMiArIGEyLCByMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24geSh0MikgewogICAgICAgIGNvbnN0IG4yID0gTWF0aC5mbG9vcih0Mik7CiAgICAgICAgaWYgKG4yID09PSB0MikKICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0MykgewogICAgICAgICAgICBjb25zdCBuMyA9IDIgKiB0MyArIDE7CiAgICAgICAgICAgIHJldHVybiAoZTMsIHIzLCBpMiwgbzIsIGEyKSA9PiB7CiAgICAgICAgICAgICAgaWYgKCEoKG8yIC09IGEyKSA+PSBpMikpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgbGV0IHUyID0gdDMgKiByM1tpMl07CiAgICAgICAgICAgICAgY29uc3QgYzIgPSBhMiAqIHQzOwogICAgICAgICAgICAgIGZvciAobGV0IHQ0ID0gaTIsIG40ID0gaTIgKyBjMjsgdDQgPCBuNDsgdDQgKz0gYTIpCiAgICAgICAgICAgICAgICB1MiArPSByM1tNYXRoLm1pbihvMiwgdDQpXTsKICAgICAgICAgICAgICBmb3IgKGxldCB0NCA9IGkyLCBmMiA9IG8yOyB0NCA8PSBmMjsgdDQgKz0gYTIpCiAgICAgICAgICAgICAgICB1MiArPSByM1tNYXRoLm1pbihvMiwgdDQgKyBjMildLCBlM1t0NF0gPSB1MiAvIG4zLCB1MiAtPSByM1tNYXRoLm1heChpMiwgdDQgLSBjMildOwogICAgICAgICAgICB9OwogICAgICAgICAgfSh0Mik7CiAgICAgICAgY29uc3QgZTIgPSB0MiAtIG4yLCByMiA9IDIgKiB0MiArIDE7CiAgICAgICAgcmV0dXJuICh0MywgaTIsIG8yLCBhMiwgdTIpID0+IHsKICAgICAgICAgIGlmICghKChhMiAtPSB1MikgPj0gbzIpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBsZXQgYzIgPSBuMiAqIGkyW28yXTsKICAgICAgICAgIGNvbnN0IGYyID0gdTIgKiBuMiwgczIgPSBmMiArIHUyOwogICAgICAgICAgZm9yIChsZXQgdDQgPSBvMiwgbjMgPSBvMiArIGYyOyB0NCA8IG4zOyB0NCArPSB1MikKICAgICAgICAgICAgYzIgKz0gaTJbTWF0aC5taW4oYTIsIHQ0KV07CiAgICAgICAgICBmb3IgKGxldCBuMyA9IG8yLCBsMiA9IGEyOyBuMyA8PSBsMjsgbjMgKz0gdTIpCiAgICAgICAgICAgIGMyICs9IGkyW01hdGgubWluKGEyLCBuMyArIGYyKV0sIHQzW24zXSA9IChjMiArIGUyICogKGkyW01hdGgubWF4KG8yLCBuMyAtIHMyKV0gKyBpMltNYXRoLm1pbihhMiwgbjMgKyBzMildKSkgLyByMiwgYzIgLT0gaTJbTWF0aC5tYXgobzIsIG4zIC0gZjIpXTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHYodDIsIG4yKSB7CiAgICAgICAgbGV0IGUyID0gMDsKICAgICAgICBpZiAodm9pZCAwID09PSBuMikKICAgICAgICAgIGZvciAobGV0IG4zIG9mIHQyKQogICAgICAgICAgICBudWxsICE9IG4zICYmIChuMyA9ICtuMykgPj0gbjMgJiYgKytlMjsKICAgICAgICBlbHNlIHsKICAgICAgICAgIGxldCByMiA9IC0xOwogICAgICAgICAgZm9yIChsZXQgaTIgb2YgdDIpCiAgICAgICAgICAgIG51bGwgIT0gKGkyID0gbjIoaTIsICsrcjIsIHQyKSkgJiYgKGkyID0gK2kyKSA+PSBpMiAmJiArK2UyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gXyh0MikgewogICAgICAgIHJldHVybiAwIHwgdDIubGVuZ3RoOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGIodDIpIHsKICAgICAgICByZXR1cm4gISh0MiA+IDApOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG0odDIpIHsKICAgICAgICByZXR1cm4gIm9iamVjdCIgIT0gdHlwZW9mIHQyIHx8ICJsZW5ndGgiIGluIHQyID8gdDIgOiBBcnJheS5mcm9tKHQyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB4KHQyLCBuMikgewogICAgICAgIGxldCBlMiwgcjIgPSAwLCBpMiA9IDAsIG8yID0gMDsKICAgICAgICBpZiAodm9pZCAwID09PSBuMikKICAgICAgICAgIGZvciAobGV0IG4zIG9mIHQyKQogICAgICAgICAgICBudWxsICE9IG4zICYmIChuMyA9ICtuMykgPj0gbjMgJiYgKGUyID0gbjMgLSBpMiwgaTIgKz0gZTIgLyArK3IyLCBvMiArPSBlMiAqIChuMyAtIGkyKSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBsZXQgYTIgPSAtMTsKICAgICAgICAgIGZvciAobGV0IHUyIG9mIHQyKQogICAgICAgICAgICBudWxsICE9ICh1MiA9IG4yKHUyLCArK2EyLCB0MikpICYmICh1MiA9ICt1MikgPj0gdTIgJiYgKGUyID0gdTIgLSBpMiwgaTIgKz0gZTIgLyArK3IyLCBvMiArPSBlMiAqICh1MiAtIGkyKSk7CiAgICAgICAgfQogICAgICAgIGlmIChyMiA+IDEpCiAgICAgICAgICByZXR1cm4gbzIgLyAocjIgLSAxKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB3KHQyLCBuMikgewogICAgICAgIGNvbnN0IGUyID0geCh0MiwgbjIpOwogICAgICAgIHJldHVybiBlMiA/IE1hdGguc3FydChlMikgOiBlMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBNKHQyLCBuMikgewogICAgICAgIGxldCBlMiwgcjI7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbjIpCiAgICAgICAgICBmb3IgKGNvbnN0IG4zIG9mIHQyKQogICAgICAgICAgICBudWxsICE9IG4zICYmICh2b2lkIDAgPT09IGUyID8gbjMgPj0gbjMgJiYgKGUyID0gcjIgPSBuMykgOiAoZTIgPiBuMyAmJiAoZTIgPSBuMyksIHIyIDwgbjMgJiYgKHIyID0gbjMpKSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBsZXQgaTIgPSAtMTsKICAgICAgICAgIGZvciAobGV0IG8yIG9mIHQyKQogICAgICAgICAgICBudWxsICE9IChvMiA9IG4yKG8yLCArK2kyLCB0MikpICYmICh2b2lkIDAgPT09IGUyID8gbzIgPj0gbzIgJiYgKGUyID0gcjIgPSBvMikgOiAoZTIgPiBvMiAmJiAoZTIgPSBvMiksIHIyIDwgbzIgJiYgKHIyID0gbzIpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBbZTIsIHIyXTsKICAgICAgfQogICAgICBjbGFzcyBUIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICAgIHRoaXMuX3BhcnRpYWxzID0gbmV3IEZsb2F0NjRBcnJheSgzMiksIHRoaXMuX24gPSAwOwogICAgICAgIH0KICAgICAgICBhZGQodDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gdGhpcy5fcGFydGlhbHM7CiAgICAgICAgICBsZXQgZTIgPSAwOwogICAgICAgICAgZm9yIChsZXQgcjIgPSAwOyByMiA8IHRoaXMuX24gJiYgcjIgPCAzMjsgcjIrKykgewogICAgICAgICAgICBjb25zdCBpMiA9IG4yW3IyXSwgbzIgPSB0MiArIGkyLCBhMiA9IE1hdGguYWJzKHQyKSA8IE1hdGguYWJzKGkyKSA/IHQyIC0gKG8yIC0gaTIpIDogaTIgLSAobzIgLSB0Mik7CiAgICAgICAgICAgIGEyICYmIChuMltlMisrXSA9IGEyKSwgdDIgPSBvMjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuMltlMl0gPSB0MiwgdGhpcy5fbiA9IGUyICsgMSwgdGhpczsKICAgICAgICB9CiAgICAgICAgdmFsdWVPZigpIHsKICAgICAgICAgIGNvbnN0IHQyID0gdGhpcy5fcGFydGlhbHM7CiAgICAgICAgICBsZXQgbjIsIGUyLCByMiwgaTIgPSB0aGlzLl9uLCBvMiA9IDA7CiAgICAgICAgICBpZiAoaTIgPiAwKSB7CiAgICAgICAgICAgIGZvciAobzIgPSB0MlstLWkyXTsgaTIgPiAwICYmIChuMiA9IG8yLCBlMiA9IHQyWy0taTJdLCBvMiA9IG4yICsgZTIsIHIyID0gZTIgLSAobzIgLSBuMiksICFyMik7ICkKICAgICAgICAgICAgICA7CiAgICAgICAgICAgIGkyID4gMCAmJiAocjIgPCAwICYmIHQyW2kyIC0gMV0gPCAwIHx8IHIyID4gMCAmJiB0MltpMiAtIDFdID4gMCkgJiYgKGUyID0gMiAqIHIyLCBuMiA9IG8yICsgZTIsIGUyID09IG4yIC0gbzIgJiYgKG8yID0gbjIpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICB9CiAgICAgIH0KICAgICAgY2xhc3MgSW50ZXJuTWFwIGV4dGVuZHMgTWFwIHsKICAgICAgICBjb25zdHJ1Y3Rvcih0MiwgbjIgPSBOKSB7CiAgICAgICAgICBpZiAoc3VwZXIoKSwgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgeyBfaW50ZXJuOiB7IHZhbHVlOiAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpIH0sIF9rZXk6IHsgdmFsdWU6IG4yIH0gfSksIG51bGwgIT0gdDIpCiAgICAgICAgICAgIGZvciAoY29uc3QgW24zLCBlMl0gb2YgdDIpCiAgICAgICAgICAgICAgdGhpcy5zZXQobjMsIGUyKTsKICAgICAgICB9CiAgICAgICAgZ2V0KHQyKSB7CiAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0KEEodGhpcywgdDIpKTsKICAgICAgICB9CiAgICAgICAgaGFzKHQyKSB7CiAgICAgICAgICByZXR1cm4gc3VwZXIuaGFzKEEodGhpcywgdDIpKTsKICAgICAgICB9CiAgICAgICAgc2V0KHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIHN1cGVyLnNldChTKHRoaXMsIHQyKSwgbjIpOwogICAgICAgIH0KICAgICAgICBkZWxldGUodDIpIHsKICAgICAgICAgIHJldHVybiBzdXBlci5kZWxldGUoRSh0aGlzLCB0MikpOwogICAgICAgIH0KICAgICAgfQogICAgICBjbGFzcyBJbnRlcm5TZXQgZXh0ZW5kcyBTZXQgewogICAgICAgIGNvbnN0cnVjdG9yKHQyLCBuMiA9IE4pIHsKICAgICAgICAgIGlmIChzdXBlcigpLCBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7IF9pbnRlcm46IHsgdmFsdWU6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCkgfSwgX2tleTogeyB2YWx1ZTogbjIgfSB9KSwgbnVsbCAhPSB0MikKICAgICAgICAgICAgZm9yIChjb25zdCBuMyBvZiB0MikKICAgICAgICAgICAgICB0aGlzLmFkZChuMyk7CiAgICAgICAgfQogICAgICAgIGhhcyh0MikgewogICAgICAgICAgcmV0dXJuIHN1cGVyLmhhcyhBKHRoaXMsIHQyKSk7CiAgICAgICAgfQogICAgICAgIGFkZCh0MikgewogICAgICAgICAgcmV0dXJuIHN1cGVyLmFkZChTKHRoaXMsIHQyKSk7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSh0MikgewogICAgICAgICAgcmV0dXJuIHN1cGVyLmRlbGV0ZShFKHRoaXMsIHQyKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEEoeyBfaW50ZXJuOiB0MiwgX2tleTogbjIgfSwgZTIpIHsKICAgICAgICBjb25zdCByMiA9IG4yKGUyKTsKICAgICAgICByZXR1cm4gdDIuaGFzKHIyKSA/IHQyLmdldChyMikgOiBlMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBTKHsgX2ludGVybjogdDIsIF9rZXk6IG4yIH0sIGUyKSB7CiAgICAgICAgY29uc3QgcjIgPSBuMihlMik7CiAgICAgICAgcmV0dXJuIHQyLmhhcyhyMikgPyB0Mi5nZXQocjIpIDogKHQyLnNldChyMiwgZTIpLCBlMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRSh7IF9pbnRlcm46IHQyLCBfa2V5OiBuMiB9LCBlMikgewogICAgICAgIGNvbnN0IHIyID0gbjIoZTIpOwogICAgICAgIHJldHVybiB0Mi5oYXMocjIpICYmIChlMiA9IHQyLmdldChyMiksIHQyLmRlbGV0ZShyMikpLCBlMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBOKHQyKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT09IHQyICYmICJvYmplY3QiID09IHR5cGVvZiB0MiA/IHQyLnZhbHVlT2YoKSA6IHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGsodDIpIHsKICAgICAgICByZXR1cm4gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQyh0MiwgLi4ubjIpIHsKICAgICAgICByZXR1cm4gRih0MiwgaywgaywgbjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFAodDIsIC4uLm4yKSB7CiAgICAgICAgcmV0dXJuIEYodDIsIEFycmF5LmZyb20sIGssIG4yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB6KHQyLCBuMikgewogICAgICAgIGZvciAobGV0IGUyID0gMSwgcjIgPSBuMi5sZW5ndGg7IGUyIDwgcjI7ICsrZTIpCiAgICAgICAgICB0MiA9IHQyLmZsYXRNYXAoKHQzKSA9PiB0My5wb3AoKS5tYXAoKFtuMywgZTNdKSA9PiBbLi4udDMsIG4zLCBlM10pKTsKICAgICAgICByZXR1cm4gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gJCh0MiwgbjIsIC4uLmUyKSB7CiAgICAgICAgcmV0dXJuIEYodDIsIGssIG4yLCBlMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRCh0MiwgbjIsIC4uLmUyKSB7CiAgICAgICAgcmV0dXJuIEYodDIsIEFycmF5LmZyb20sIG4yLCBlMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUih0MikgewogICAgICAgIGlmICgxICE9PSB0Mi5sZW5ndGgpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImR1cGxpY2F0ZSBrZXkiKTsKICAgICAgICByZXR1cm4gdDJbMF07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRih0MiwgbjIsIGUyLCByMikgewogICAgICAgIHJldHVybiBmdW5jdGlvbiB0MyhpMiwgbzIpIHsKICAgICAgICAgIGlmIChvMiA+PSByMi5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBlMihpMik7CiAgICAgICAgICBjb25zdCBhMiA9IG5ldyBJbnRlcm5NYXAoKSwgdTIgPSByMltvMisrXTsKICAgICAgICAgIGxldCBjMiA9IC0xOwogICAgICAgICAgZm9yIChjb25zdCB0NCBvZiBpMikgewogICAgICAgICAgICBjb25zdCBuMyA9IHUyKHQ0LCArK2MyLCBpMiksIGUzID0gYTIuZ2V0KG4zKTsKICAgICAgICAgICAgZTMgPyBlMy5wdXNoKHQ0KSA6IGEyLnNldChuMywgW3Q0XSk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGNvbnN0IFtuMywgZTNdIG9mIGEyKQogICAgICAgICAgICBhMi5zZXQobjMsIHQzKGUzLCBvMikpOwogICAgICAgICAgcmV0dXJuIG4yKGEyKTsKICAgICAgICB9KHQyLCAwKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBxKHQyLCBuMikgewogICAgICAgIHJldHVybiBBcnJheS5mcm9tKG4yLCAobjMpID0+IHQyW24zXSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVSh0MiwgLi4ubjIpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgdDJbU3ltYm9sLml0ZXJhdG9yXSkKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInZhbHVlcyBpcyBub3QgaXRlcmFibGUiKTsKICAgICAgICB0MiA9IEFycmF5LmZyb20odDIpOwogICAgICAgIGxldCBbZTJdID0gbjI7CiAgICAgICAgaWYgKGUyICYmIDIgIT09IGUyLmxlbmd0aCB8fCBuMi5sZW5ndGggPiAxKSB7CiAgICAgICAgICBjb25zdCByMiA9IFVpbnQzMkFycmF5LmZyb20odDIsICh0MywgbjMpID0+IG4zKTsKICAgICAgICAgIHJldHVybiBuMi5sZW5ndGggPiAxID8gKG4yID0gbjIubWFwKChuMykgPT4gdDIubWFwKG4zKSksIHIyLnNvcnQoKHQzLCBlMykgPT4gewogICAgICAgICAgICBmb3IgKGNvbnN0IHIzIG9mIG4yKSB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSBPKHIzW3QzXSwgcjNbZTNdKTsKICAgICAgICAgICAgICBpZiAobjMpCiAgICAgICAgICAgICAgICByZXR1cm4gbjM7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKSA6IChlMiA9IHQyLm1hcChlMiksIHIyLnNvcnQoKHQzLCBuMykgPT4gTyhlMlt0M10sIGUyW24zXSkpKSwgcSh0MiwgcjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDIuc29ydChJKGUyKSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSSh0MiA9IG4pIHsKICAgICAgICBpZiAodDIgPT09IG4pCiAgICAgICAgICByZXR1cm4gTzsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgdDIpCiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJjb21wYXJlIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgcmV0dXJuIChuMiwgZTIpID0+IHsKICAgICAgICAgIGNvbnN0IHIyID0gdDIobjIsIGUyKTsKICAgICAgICAgIHJldHVybiByMiB8fCAwID09PSByMiA/IHIyIDogKDAgPT09IHQyKGUyLCBlMikpIC0gKDAgPT09IHQyKG4yLCBuMikpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gKG51bGwgPT0gdDIgfHwgISh0MiA+PSB0MikpIC0gKG51bGwgPT0gbjIgfHwgIShuMiA+PSBuMikpIHx8ICh0MiA8IG4yID8gLTEgOiB0MiA+IG4yID8gMSA6IDApOwogICAgICB9CiAgICAgIHZhciBCID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwogICAgICBmdW5jdGlvbiBZKHQyKSB7CiAgICAgICAgcmV0dXJuICgpID0+IHQyOwogICAgICB9CiAgICAgIGNvbnN0IEwgPSBNYXRoLnNxcnQoNTApLCBqID0gTWF0aC5zcXJ0KDEwKSwgSCA9IE1hdGguc3FydCgyKTsKICAgICAgZnVuY3Rpb24gWCh0MiwgbjIsIGUyKSB7CiAgICAgICAgY29uc3QgcjIgPSAobjIgLSB0MikgLyBNYXRoLm1heCgwLCBlMiksIGkyID0gTWF0aC5mbG9vcihNYXRoLmxvZzEwKHIyKSksIG8yID0gcjIgLyBNYXRoLnBvdygxMCwgaTIpLCBhMiA9IG8yID49IEwgPyAxMCA6IG8yID49IGogPyA1IDogbzIgPj0gSCA/IDIgOiAxOwogICAgICAgIGxldCB1MiwgYzIsIGYyOwogICAgICAgIHJldHVybiBpMiA8IDAgPyAoZjIgPSBNYXRoLnBvdygxMCwgLWkyKSAvIGEyLCB1MiA9IE1hdGgucm91bmQodDIgKiBmMiksIGMyID0gTWF0aC5yb3VuZChuMiAqIGYyKSwgdTIgLyBmMiA8IHQyICYmICsrdTIsIGMyIC8gZjIgPiBuMiAmJiAtLWMyLCBmMiA9IC1mMikgOiAoZjIgPSBNYXRoLnBvdygxMCwgaTIpICogYTIsIHUyID0gTWF0aC5yb3VuZCh0MiAvIGYyKSwgYzIgPSBNYXRoLnJvdW5kKG4yIC8gZjIpLCB1MiAqIGYyIDwgdDIgJiYgKyt1MiwgYzIgKiBmMiA+IG4yICYmIC0tYzIpLCBjMiA8IHUyICYmIDAuNSA8PSBlMiAmJiBlMiA8IDIgPyBYKHQyLCBuMiwgMiAqIGUyKSA6IFt1MiwgYzIsIGYyXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBHKHQyLCBuMiwgZTIpIHsKICAgICAgICBpZiAoISgoZTIgPSArZTIpID4gMCkpCiAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgaWYgKCh0MiA9ICt0MikgPT09IChuMiA9ICtuMikpCiAgICAgICAgICByZXR1cm4gW3QyXTsKICAgICAgICBjb25zdCByMiA9IG4yIDwgdDIsIFtpMiwgbzIsIGEyXSA9IHIyID8gWChuMiwgdDIsIGUyKSA6IFgodDIsIG4yLCBlMik7CiAgICAgICAgaWYgKCEobzIgPj0gaTIpKQogICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIGNvbnN0IHUyID0gbzIgLSBpMiArIDEsIGMyID0gbmV3IEFycmF5KHUyKTsKICAgICAgICBpZiAocjIpCiAgICAgICAgICBpZiAoYTIgPCAwKQogICAgICAgICAgICBmb3IgKGxldCB0MyA9IDA7IHQzIDwgdTI7ICsrdDMpCiAgICAgICAgICAgICAgYzJbdDNdID0gKG8yIC0gdDMpIC8gLWEyOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKGxldCB0MyA9IDA7IHQzIDwgdTI7ICsrdDMpCiAgICAgICAgICAgICAgYzJbdDNdID0gKG8yIC0gdDMpICogYTI7CiAgICAgICAgZWxzZSBpZiAoYTIgPCAwKQogICAgICAgICAgZm9yIChsZXQgdDMgPSAwOyB0MyA8IHUyOyArK3QzKQogICAgICAgICAgICBjMlt0M10gPSAoaTIgKyB0MykgLyAtYTI7CiAgICAgICAgZWxzZQogICAgICAgICAgZm9yIChsZXQgdDMgPSAwOyB0MyA8IHUyOyArK3QzKQogICAgICAgICAgICBjMlt0M10gPSAoaTIgKyB0MykgKiBhMjsKICAgICAgICByZXR1cm4gYzI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVih0MiwgbjIsIGUyKSB7CiAgICAgICAgcmV0dXJuIFgodDIgPSArdDIsIG4yID0gK24yLCBlMiA9ICtlMilbMl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVyh0MiwgbjIsIGUyKSB7CiAgICAgICAgZTIgPSArZTI7CiAgICAgICAgY29uc3QgcjIgPSAobjIgPSArbjIpIDwgKHQyID0gK3QyKSwgaTIgPSByMiA/IFYobjIsIHQyLCBlMikgOiBWKHQyLCBuMiwgZTIpOwogICAgICAgIHJldHVybiAocjIgPyAtMSA6IDEpICogKGkyIDwgMCA/IDEgLyAtaTIgOiBpMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWih0MiwgbjIsIGUyKSB7CiAgICAgICAgbGV0IHIyOwogICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgY29uc3QgaTIgPSBWKHQyLCBuMiwgZTIpOwogICAgICAgICAgaWYgKGkyID09PSByMiB8fCAwID09PSBpMiB8fCAhaXNGaW5pdGUoaTIpKQogICAgICAgICAgICByZXR1cm4gW3QyLCBuMl07CiAgICAgICAgICBpMiA+IDAgPyAodDIgPSBNYXRoLmZsb29yKHQyIC8gaTIpICogaTIsIG4yID0gTWF0aC5jZWlsKG4yIC8gaTIpICogaTIpIDogaTIgPCAwICYmICh0MiA9IE1hdGguY2VpbCh0MiAqIGkyKSAvIGkyLCBuMiA9IE1hdGguZmxvb3IobjIgKiBpMikgLyBpMiksIHIyID0gaTI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIEsodDIpIHsKICAgICAgICByZXR1cm4gTWF0aC5tYXgoMSwgTWF0aC5jZWlsKE1hdGgubG9nKHYodDIpKSAvIE1hdGguTE4yKSArIDEpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFEoKSB7CiAgICAgICAgdmFyIHQyID0gaywgbjIgPSBNLCBlMiA9IEs7CiAgICAgICAgZnVuY3Rpb24gcjIocjMpIHsKICAgICAgICAgIEFycmF5LmlzQXJyYXkocjMpIHx8IChyMyA9IEFycmF5LmZyb20ocjMpKTsKICAgICAgICAgIHZhciBpMiwgbzIsIGEyLCB1MiA9IHIzLmxlbmd0aCwgYzIgPSBuZXcgQXJyYXkodTIpOwogICAgICAgICAgZm9yIChpMiA9IDA7IGkyIDwgdTI7ICsraTIpCiAgICAgICAgICAgIGMyW2kyXSA9IHQyKHIzW2kyXSwgaTIsIHIzKTsKICAgICAgICAgIHZhciBmMiA9IG4yKGMyKSwgbDIgPSBmMlswXSwgaDIgPSBmMlsxXSwgZDIgPSBlMihjMiwgbDIsIGgyKTsKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShkMikpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBoMiwgZTMgPSArZDI7CiAgICAgICAgICAgIGlmIChuMiA9PT0gTSAmJiAoW2wyLCBoMl0gPSBaKGwyLCBoMiwgZTMpKSwgKGQyID0gRyhsMiwgaDIsIGUzKSlbMF0gPD0gbDIgJiYgKGEyID0gVihsMiwgaDIsIGUzKSksIGQyW2QyLmxlbmd0aCAtIDFdID49IGgyKQogICAgICAgICAgICAgIGlmICh0MyA+PSBoMiAmJiBuMiA9PT0gTSkgewogICAgICAgICAgICAgICAgY29uc3QgdDQgPSBWKGwyLCBoMiwgZTMpOwogICAgICAgICAgICAgICAgaXNGaW5pdGUodDQpICYmICh0NCA+IDAgPyBoMiA9IChNYXRoLmZsb29yKGgyIC8gdDQpICsgMSkgKiB0NCA6IHQ0IDwgMCAmJiAoaDIgPSAoTWF0aC5jZWlsKGgyICogLXQ0KSArIDEpIC8gLXQ0KSk7CiAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICBkMi5wb3AoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIHAyID0gZDIubGVuZ3RoLCBnMiA9IDAsIHkyID0gcDI7IGQyW2cyXSA8PSBsMjsgKQogICAgICAgICAgICArK2cyOwogICAgICAgICAgZm9yICg7IGQyW3kyIC0gMV0gPiBoMjsgKQogICAgICAgICAgICAtLXkyOwogICAgICAgICAgKGcyIHx8IHkyIDwgcDIpICYmIChkMiA9IGQyLnNsaWNlKGcyLCB5MiksIHAyID0geTIgLSBnMik7CiAgICAgICAgICB2YXIgdjIsIF8yID0gbmV3IEFycmF5KHAyICsgMSk7CiAgICAgICAgICBmb3IgKGkyID0gMDsgaTIgPD0gcDI7ICsraTIpCiAgICAgICAgICAgICh2MiA9IF8yW2kyXSA9IFtdKS54MCA9IGkyID4gMCA/IGQyW2kyIC0gMV0gOiBsMiwgdjIueDEgPSBpMiA8IHAyID8gZDJbaTJdIDogaDI7CiAgICAgICAgICBpZiAoaXNGaW5pdGUoYTIpKSB7CiAgICAgICAgICAgIGlmIChhMiA+IDApCiAgICAgICAgICAgICAgZm9yIChpMiA9IDA7IGkyIDwgdTI7ICsraTIpCiAgICAgICAgICAgICAgICBudWxsICE9IChvMiA9IGMyW2kyXSkgJiYgbDIgPD0gbzIgJiYgbzIgPD0gaDIgJiYgXzJbTWF0aC5taW4ocDIsIE1hdGguZmxvb3IoKG8yIC0gbDIpIC8gYTIpKV0ucHVzaChyM1tpMl0pOwogICAgICAgICAgICBlbHNlIGlmIChhMiA8IDApIHsKICAgICAgICAgICAgICBmb3IgKGkyID0gMDsgaTIgPCB1MjsgKytpMikKICAgICAgICAgICAgICAgIGlmIChudWxsICE9IChvMiA9IGMyW2kyXSkgJiYgbDIgPD0gbzIgJiYgbzIgPD0gaDIpIHsKICAgICAgICAgICAgICAgICAgY29uc3QgdDMgPSBNYXRoLmZsb29yKChsMiAtIG8yKSAqIGEyKTsKICAgICAgICAgICAgICAgICAgXzJbTWF0aC5taW4ocDIsIHQzICsgKGQyW3QzXSA8PSBvMikpXS5wdXNoKHIzW2kyXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBmb3IgKGkyID0gMDsgaTIgPCB1MjsgKytpMikKICAgICAgICAgICAgICBudWxsICE9IChvMiA9IGMyW2kyXSkgJiYgbDIgPD0gbzIgJiYgbzIgPD0gaDIgJiYgXzJbcyhkMiwgbzIsIDAsIHAyKV0ucHVzaChyM1tpMl0pOwogICAgICAgICAgcmV0dXJuIF8yOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjIudmFsdWUgPSBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodDIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBuMyA/IG4zIDogWShuMyksIHIyKSA6IHQyOwogICAgICAgIH0sIHIyLmRvbWFpbiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChuMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBZKFt0M1swXSwgdDNbMV1dKSwgcjIpIDogbjI7CiAgICAgICAgfSwgcjIudGhyZXNob2xkcyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBZKEFycmF5LmlzQXJyYXkodDMpID8gQi5jYWxsKHQzKSA6IHQzKSwgcjIpIDogZTI7CiAgICAgICAgfSwgcjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSih0MiwgbjIpIHsKICAgICAgICBsZXQgZTI7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbjIpCiAgICAgICAgICBmb3IgKGNvbnN0IG4zIG9mIHQyKQogICAgICAgICAgICBudWxsICE9IG4zICYmIChlMiA8IG4zIHx8IHZvaWQgMCA9PT0gZTIgJiYgbjMgPj0gbjMpICYmIChlMiA9IG4zKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgIGxldCByMiA9IC0xOwogICAgICAgICAgZm9yIChsZXQgaTIgb2YgdDIpCiAgICAgICAgICAgIG51bGwgIT0gKGkyID0gbjIoaTIsICsrcjIsIHQyKSkgJiYgKGUyIDwgaTIgfHwgdm9pZCAwID09PSBlMiAmJiBpMiA+PSBpMikgJiYgKGUyID0gaTIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdHQodDIsIG4yKSB7CiAgICAgICAgbGV0IGUyLCByMiA9IC0xLCBpMiA9IC0xOwogICAgICAgIGlmICh2b2lkIDAgPT09IG4yKQogICAgICAgICAgZm9yIChjb25zdCBuMyBvZiB0MikKICAgICAgICAgICAgKytpMiwgbnVsbCAhPSBuMyAmJiAoZTIgPCBuMyB8fCB2b2lkIDAgPT09IGUyICYmIG4zID49IG4zKSAmJiAoZTIgPSBuMywgcjIgPSBpMik7CiAgICAgICAgZWxzZQogICAgICAgICAgZm9yIChsZXQgbzIgb2YgdDIpCiAgICAgICAgICAgIG51bGwgIT0gKG8yID0gbjIobzIsICsraTIsIHQyKSkgJiYgKGUyIDwgbzIgfHwgdm9pZCAwID09PSBlMiAmJiBvMiA+PSBvMikgJiYgKGUyID0gbzIsIHIyID0gaTIpOwogICAgICAgIHJldHVybiByMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBudCh0MiwgbjIpIHsKICAgICAgICBsZXQgZTI7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbjIpCiAgICAgICAgICBmb3IgKGNvbnN0IG4zIG9mIHQyKQogICAgICAgICAgICBudWxsICE9IG4zICYmIChlMiA+IG4zIHx8IHZvaWQgMCA9PT0gZTIgJiYgbjMgPj0gbjMpICYmIChlMiA9IG4zKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgIGxldCByMiA9IC0xOwogICAgICAgICAgZm9yIChsZXQgaTIgb2YgdDIpCiAgICAgICAgICAgIG51bGwgIT0gKGkyID0gbjIoaTIsICsrcjIsIHQyKSkgJiYgKGUyID4gaTIgfHwgdm9pZCAwID09PSBlMiAmJiBpMiA+PSBpMikgJiYgKGUyID0gaTIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZXQodDIsIG4yKSB7CiAgICAgICAgbGV0IGUyLCByMiA9IC0xLCBpMiA9IC0xOwogICAgICAgIGlmICh2b2lkIDAgPT09IG4yKQogICAgICAgICAgZm9yIChjb25zdCBuMyBvZiB0MikKICAgICAgICAgICAgKytpMiwgbnVsbCAhPSBuMyAmJiAoZTIgPiBuMyB8fCB2b2lkIDAgPT09IGUyICYmIG4zID49IG4zKSAmJiAoZTIgPSBuMywgcjIgPSBpMik7CiAgICAgICAgZWxzZQogICAgICAgICAgZm9yIChsZXQgbzIgb2YgdDIpCiAgICAgICAgICAgIG51bGwgIT0gKG8yID0gbjIobzIsICsraTIsIHQyKSkgJiYgKGUyID4gbzIgfHwgdm9pZCAwID09PSBlMiAmJiBvMiA+PSBvMikgJiYgKGUyID0gbzIsIHIyID0gaTIpOwogICAgICAgIHJldHVybiByMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBydCh0MiwgbjIsIGUyID0gMCwgcjIgPSAxIC8gMCwgaTIpIHsKICAgICAgICBpZiAobjIgPSBNYXRoLmZsb29yKG4yKSwgZTIgPSBNYXRoLmZsb29yKE1hdGgubWF4KDAsIGUyKSksIHIyID0gTWF0aC5mbG9vcihNYXRoLm1pbih0Mi5sZW5ndGggLSAxLCByMikpLCAhKGUyIDw9IG4yICYmIG4yIDw9IHIyKSkKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICBmb3IgKGkyID0gdm9pZCAwID09PSBpMiA/IE8gOiBJKGkyKTsgcjIgPiBlMjsgKSB7CiAgICAgICAgICBpZiAocjIgLSBlMiA+IDYwMCkgewogICAgICAgICAgICBjb25zdCBvMyA9IHIyIC0gZTIgKyAxLCBhMyA9IG4yIC0gZTIgKyAxLCB1MyA9IE1hdGgubG9nKG8zKSwgYzIgPSAwLjUgKiBNYXRoLmV4cCgyICogdTMgLyAzKSwgZjIgPSAwLjUgKiBNYXRoLnNxcnQodTMgKiBjMiAqIChvMyAtIGMyKSAvIG8zKSAqIChhMyAtIG8zIC8gMiA8IDAgPyAtMSA6IDEpOwogICAgICAgICAgICBydCh0MiwgbjIsIE1hdGgubWF4KGUyLCBNYXRoLmZsb29yKG4yIC0gYTMgKiBjMiAvIG8zICsgZjIpKSwgTWF0aC5taW4ocjIsIE1hdGguZmxvb3IobjIgKyAobzMgLSBhMykgKiBjMiAvIG8zICsgZjIpKSwgaTIpOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgbzIgPSB0MltuMl07CiAgICAgICAgICBsZXQgYTIgPSBlMiwgdTIgPSByMjsKICAgICAgICAgIGZvciAoaXQodDIsIGUyLCBuMiksIGkyKHQyW3IyXSwgbzIpID4gMCAmJiBpdCh0MiwgZTIsIHIyKTsgYTIgPCB1MjsgKSB7CiAgICAgICAgICAgIGZvciAoaXQodDIsIGEyLCB1MiksICsrYTIsIC0tdTI7IGkyKHQyW2EyXSwgbzIpIDwgMDsgKQogICAgICAgICAgICAgICsrYTI7CiAgICAgICAgICAgIGZvciAoOyBpMih0Mlt1Ml0sIG8yKSA+IDA7ICkKICAgICAgICAgICAgICAtLXUyOwogICAgICAgICAgfQogICAgICAgICAgMCA9PT0gaTIodDJbZTJdLCBvMikgPyBpdCh0MiwgZTIsIHUyKSA6ICgrK3UyLCBpdCh0MiwgdTIsIHIyKSksIHUyIDw9IG4yICYmIChlMiA9IHUyICsgMSksIG4yIDw9IHUyICYmIChyMiA9IHUyIC0gMSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBpdCh0MiwgbjIsIGUyKSB7CiAgICAgICAgY29uc3QgcjIgPSB0MltuMl07CiAgICAgICAgdDJbbjJdID0gdDJbZTJdLCB0MltlMl0gPSByMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBvdCh0MiwgZTIgPSBuKSB7CiAgICAgICAgbGV0IHIyLCBpMiA9IGZhbHNlOwogICAgICAgIGlmICgxID09PSBlMi5sZW5ndGgpIHsKICAgICAgICAgIGxldCBvMjsKICAgICAgICAgIGZvciAoY29uc3QgYTIgb2YgdDIpIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBlMihhMik7CiAgICAgICAgICAgIChpMiA/IG4odDMsIG8yKSA+IDAgOiAwID09PSBuKHQzLCB0MykpICYmIChyMiA9IGEyLCBvMiA9IHQzLCBpMiA9IHRydWUpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZQogICAgICAgICAgZm9yIChjb25zdCBuMiBvZiB0MikKICAgICAgICAgICAgKGkyID8gZTIobjIsIHIyKSA+IDAgOiAwID09PSBlMihuMiwgbjIpKSAmJiAocjIgPSBuMiwgaTIgPSB0cnVlKTsKICAgICAgICByZXR1cm4gcjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYXQodDIsIG4yLCBlMikgewogICAgICAgIGlmICh0MiA9IEZsb2F0NjRBcnJheS5mcm9tKGZ1bmN0aW9uKiAodDMsIG4zKSB7CiAgICAgICAgICBpZiAodm9pZCAwID09PSBuMykKICAgICAgICAgICAgZm9yIChsZXQgbjQgb2YgdDMpCiAgICAgICAgICAgICAgbnVsbCAhPSBuNCAmJiAobjQgPSArbjQpID49IG40ICYmICh5aWVsZCBuNCk7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbGV0IGUzID0gLTE7CiAgICAgICAgICAgIGZvciAobGV0IHIzIG9mIHQzKQogICAgICAgICAgICAgIG51bGwgIT0gKHIzID0gbjMocjMsICsrZTMsIHQzKSkgJiYgKHIzID0gK3IzKSA+PSByMyAmJiAoeWllbGQgcjMpOwogICAgICAgICAgfQogICAgICAgIH0odDIsIGUyKSksIChyMiA9IHQyLmxlbmd0aCkgJiYgIWlzTmFOKG4yID0gK24yKSkgewogICAgICAgICAgaWYgKG4yIDw9IDAgfHwgcjIgPCAyKQogICAgICAgICAgICByZXR1cm4gbnQodDIpOwogICAgICAgICAgaWYgKG4yID49IDEpCiAgICAgICAgICAgIHJldHVybiBKKHQyKTsKICAgICAgICAgIHZhciByMiwgaTIgPSAocjIgLSAxKSAqIG4yLCBvMiA9IE1hdGguZmxvb3IoaTIpLCBhMiA9IEoocnQodDIsIG8yKS5zdWJhcnJheSgwLCBvMiArIDEpKTsKICAgICAgICAgIHJldHVybiBhMiArIChudCh0Mi5zdWJhcnJheShvMiArIDEpKSAtIGEyKSAqIChpMiAtIG8yKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdXQodDIsIG4yLCBlMiA9IG8pIHsKICAgICAgICBpZiAoKHIyID0gdDIubGVuZ3RoKSAmJiAhaXNOYU4objIgPSArbjIpKSB7CiAgICAgICAgICBpZiAobjIgPD0gMCB8fCByMiA8IDIpCiAgICAgICAgICAgIHJldHVybiArZTIodDJbMF0sIDAsIHQyKTsKICAgICAgICAgIGlmIChuMiA+PSAxKQogICAgICAgICAgICByZXR1cm4gK2UyKHQyW3IyIC0gMV0sIHIyIC0gMSwgdDIpOwogICAgICAgICAgdmFyIHIyLCBpMiA9IChyMiAtIDEpICogbjIsIGEyID0gTWF0aC5mbG9vcihpMiksIHUyID0gK2UyKHQyW2EyXSwgYTIsIHQyKTsKICAgICAgICAgIHJldHVybiB1MiArICgrZTIodDJbYTIgKyAxXSwgYTIgKyAxLCB0MikgLSB1MikgKiAoaTIgLSBhMik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGN0KHQyLCBuMiwgZTIgPSBvKSB7CiAgICAgICAgaWYgKCFpc05hTihuMiA9ICtuMikpIHsKICAgICAgICAgIGlmIChyMiA9IEZsb2F0NjRBcnJheS5mcm9tKHQyLCAobjMsIHIzKSA9PiBvKGUyKHQyW3IzXSwgcjMsIHQyKSkpLCBuMiA8PSAwKQogICAgICAgICAgICByZXR1cm4gZXQocjIpOwogICAgICAgICAgaWYgKG4yID49IDEpCiAgICAgICAgICAgIHJldHVybiB0dChyMik7CiAgICAgICAgICB2YXIgcjIsIGkyID0gVWludDMyQXJyYXkuZnJvbSh0MiwgKHQzLCBuMykgPT4gbjMpLCBhMiA9IHIyLmxlbmd0aCAtIDEsIHUyID0gTWF0aC5mbG9vcihhMiAqIG4yKTsKICAgICAgICAgIHJldHVybiBydChpMiwgdTIsIDAsIGEyLCAodDMsIG4zKSA9PiBPKHIyW3QzXSwgcjJbbjNdKSksICh1MiA9IG90KGkyLnN1YmFycmF5KDAsIHUyICsgMSksICh0MykgPT4gcjJbdDNdKSkgPj0gMCA/IHUyIDogLTE7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZ0KHQyKSB7CiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oZnVuY3Rpb24qICh0MykgewogICAgICAgICAgZm9yIChjb25zdCBuMiBvZiB0MykKICAgICAgICAgICAgeWllbGQqIG4yOwogICAgICAgIH0odDIpKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBzdCh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gW3QyLCBuMl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbHQodDIsIG4yLCBlMikgewogICAgICAgIHQyID0gK3QyLCBuMiA9ICtuMiwgZTIgPSAoaTIgPSBhcmd1bWVudHMubGVuZ3RoKSA8IDIgPyAobjIgPSB0MiwgdDIgPSAwLCAxKSA6IGkyIDwgMyA/IDEgOiArZTI7CiAgICAgICAgZm9yICh2YXIgcjIgPSAtMSwgaTIgPSAwIHwgTWF0aC5tYXgoMCwgTWF0aC5jZWlsKChuMiAtIHQyKSAvIGUyKSksIG8yID0gbmV3IEFycmF5KGkyKTsgKytyMiA8IGkyOyApCiAgICAgICAgICBvMltyMl0gPSB0MiArIHIyICogZTI7CiAgICAgICAgcmV0dXJuIG8yOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGh0KHQyLCBlMiA9IG4pIHsKICAgICAgICBpZiAoMSA9PT0gZTIubGVuZ3RoKQogICAgICAgICAgcmV0dXJuIGV0KHQyLCBlMik7CiAgICAgICAgbGV0IHIyLCBpMiA9IC0xLCBvMiA9IC0xOwogICAgICAgIGZvciAoY29uc3QgbjIgb2YgdDIpCiAgICAgICAgICArK28yLCAoaTIgPCAwID8gMCA9PT0gZTIobjIsIG4yKSA6IGUyKG4yLCByMikgPCAwKSAmJiAocjIgPSBuMiwgaTIgPSBvMik7CiAgICAgICAgcmV0dXJuIGkyOwogICAgICB9CiAgICAgIHZhciBkdCA9IHB0KE1hdGgucmFuZG9tKTsKICAgICAgZnVuY3Rpb24gcHQodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24objIsIGUyID0gMCwgcjIgPSBuMi5sZW5ndGgpIHsKICAgICAgICAgIGxldCBpMiA9IHIyIC0gKGUyID0gK2UyKTsKICAgICAgICAgIGZvciAoOyBpMjsgKSB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gdDIoKSAqIGkyLS0gfCAwLCBvMiA9IG4yW2kyICsgZTJdOwogICAgICAgICAgICBuMltpMiArIGUyXSA9IG4yW3IzICsgZTJdLCBuMltyMyArIGUyXSA9IG8yOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZ3QodDIpIHsKICAgICAgICBpZiAoIShpMiA9IHQyLmxlbmd0aCkpCiAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgZm9yICh2YXIgbjIgPSAtMSwgZTIgPSBudCh0MiwgeXQpLCByMiA9IG5ldyBBcnJheShlMik7ICsrbjIgPCBlMjsgKQogICAgICAgICAgZm9yICh2YXIgaTIsIG8yID0gLTEsIGEyID0gcjJbbjJdID0gbmV3IEFycmF5KGkyKTsgKytvMiA8IGkyOyApCiAgICAgICAgICAgIGEyW28yXSA9IHQyW28yXVtuMl07CiAgICAgICAgcmV0dXJuIHIyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHl0KHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLmxlbmd0aDsKICAgICAgfQogICAgICBmdW5jdGlvbiB2dCh0MikgewogICAgICAgIHJldHVybiB0MiBpbnN0YW5jZW9mIEludGVyblNldCA/IHQyIDogbmV3IEludGVyblNldCh0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX3QodDIsIG4yKSB7CiAgICAgICAgY29uc3QgZTIgPSB0MltTeW1ib2wuaXRlcmF0b3JdKCksIHIyID0gLyogQF9fUFVSRV9fICovIG5ldyBTZXQoKTsKICAgICAgICBmb3IgKGNvbnN0IHQzIG9mIG4yKSB7CiAgICAgICAgICBjb25zdCBuMyA9IGJ0KHQzKTsKICAgICAgICAgIGlmIChyMi5oYXMobjMpKQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGxldCBpMiwgbzI7CiAgICAgICAgICBmb3IgKDsgeyB2YWx1ZTogaTIsIGRvbmU6IG8yIH0gPSBlMi5uZXh0KCk7ICkgewogICAgICAgICAgICBpZiAobzIpCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjb25zdCB0NCA9IGJ0KGkyKTsKICAgICAgICAgICAgaWYgKHIyLmFkZCh0NCksIE9iamVjdC5pcyhuMywgdDQpKQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBidCh0MikgewogICAgICAgIHJldHVybiBudWxsICE9PSB0MiAmJiAib2JqZWN0IiA9PSB0eXBlb2YgdDIgPyB0Mi52YWx1ZU9mKCkgOiB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBtdCh0MikgewogICAgICAgIHJldHVybiB0MjsKICAgICAgfQogICAgICB2YXIgeHQgPSAxLCB3dCA9IDIsIE10ID0gMywgVHQgPSA0LCBBdCA9IDFlLTY7CiAgICAgIGZ1bmN0aW9uIFN0KHQyKSB7CiAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoIiArIHQyICsgIiwwKSI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRXQodDIpIHsKICAgICAgICByZXR1cm4gInRyYW5zbGF0ZSgwLCIgKyB0MiArICIpIjsKICAgICAgfQogICAgICBmdW5jdGlvbiBOdCh0MikgewogICAgICAgIHJldHVybiAobjIpID0+ICt0MihuMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24ga3QodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIG4yID0gTWF0aC5tYXgoMCwgdDIuYmFuZHdpZHRoKCkgLSAyICogbjIpIC8gMiwgdDIucm91bmQoKSAmJiAobjIgPSBNYXRoLnJvdW5kKG4yKSksIChlMikgPT4gK3QyKGUyKSArIG4yOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEN0KCkgewogICAgICAgIHJldHVybiAhdGhpcy5fX2F4aXM7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUHQodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gW10sIHIyID0gbnVsbCwgaTIgPSBudWxsLCBvMiA9IDYsIGEyID0gNiwgdTIgPSAzLCBjMiA9ICJ1bmRlZmluZWQiICE9IHR5cGVvZiB3aW5kb3cgJiYgd2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxID8gMCA6IDAuNSwgZjIgPSB0MiA9PT0geHQgfHwgdDIgPT09IFR0ID8gLTEgOiAxLCBzMiA9IHQyID09PSBUdCB8fCB0MiA9PT0gd3QgPyAieCIgOiAieSIsIGwyID0gdDIgPT09IHh0IHx8IHQyID09PSBNdCA/IFN0IDogRXQ7CiAgICAgICAgZnVuY3Rpb24gaDIoaDMpIHsKICAgICAgICAgIHZhciBkMiA9IG51bGwgPT0gcjIgPyBuMi50aWNrcyA/IG4yLnRpY2tzLmFwcGx5KG4yLCBlMikgOiBuMi5kb21haW4oKSA6IHIyLCBwMiA9IG51bGwgPT0gaTIgPyBuMi50aWNrRm9ybWF0ID8gbjIudGlja0Zvcm1hdC5hcHBseShuMiwgZTIpIDogbXQgOiBpMiwgZzIgPSBNYXRoLm1heChvMiwgMCkgKyB1MiwgeTIgPSBuMi5yYW5nZSgpLCB2MiA9ICt5MlswXSArIGMyLCBfMiA9ICt5Mlt5Mi5sZW5ndGggLSAxXSArIGMyLCBiMiA9IChuMi5iYW5kd2lkdGggPyBrdCA6IE50KShuMi5jb3B5KCksIGMyKSwgbTIgPSBoMy5zZWxlY3Rpb24gPyBoMy5zZWxlY3Rpb24oKSA6IGgzLCB4MiA9IG0yLnNlbGVjdEFsbCgiLmRvbWFpbiIpLmRhdGEoW251bGxdKSwgdzIgPSBtMi5zZWxlY3RBbGwoIi50aWNrIikuZGF0YShkMiwgbjIpLm9yZGVyKCksIE0yID0gdzIuZXhpdCgpLCBUMiA9IHcyLmVudGVyKCkuYXBwZW5kKCJnIikuYXR0cigiY2xhc3MiLCAidGljayIpLCBBMiA9IHcyLnNlbGVjdCgibGluZSIpLCBTMiA9IHcyLnNlbGVjdCgidGV4dCIpOwogICAgICAgICAgeDIgPSB4Mi5tZXJnZSh4Mi5lbnRlcigpLmluc2VydCgicGF0aCIsICIudGljayIpLmF0dHIoImNsYXNzIiwgImRvbWFpbiIpLmF0dHIoInN0cm9rZSIsICJjdXJyZW50Q29sb3IiKSksIHcyID0gdzIubWVyZ2UoVDIpLCBBMiA9IEEyLm1lcmdlKFQyLmFwcGVuZCgibGluZSIpLmF0dHIoInN0cm9rZSIsICJjdXJyZW50Q29sb3IiKS5hdHRyKHMyICsgIjIiLCBmMiAqIG8yKSksIFMyID0gUzIubWVyZ2UoVDIuYXBwZW5kKCJ0ZXh0IikuYXR0cigiZmlsbCIsICJjdXJyZW50Q29sb3IiKS5hdHRyKHMyLCBmMiAqIGcyKS5hdHRyKCJkeSIsIHQyID09PSB4dCA/ICIwZW0iIDogdDIgPT09IE10ID8gIjAuNzFlbSIgOiAiMC4zMmVtIikpLCBoMyAhPT0gbTIgJiYgKHgyID0geDIudHJhbnNpdGlvbihoMyksIHcyID0gdzIudHJhbnNpdGlvbihoMyksIEEyID0gQTIudHJhbnNpdGlvbihoMyksIFMyID0gUzIudHJhbnNpdGlvbihoMyksIE0yID0gTTIudHJhbnNpdGlvbihoMykuYXR0cigib3BhY2l0eSIsIEF0KS5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gaXNGaW5pdGUodDMgPSBiMih0MykpID8gbDIodDMgKyBjMikgOiB0aGlzLmdldEF0dHJpYnV0ZSgidHJhbnNmb3JtIik7CiAgICAgICAgICB9KSwgVDIuYXR0cigib3BhY2l0eSIsIEF0KS5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICB2YXIgbjMgPSB0aGlzLnBhcmVudE5vZGUuX19heGlzOwogICAgICAgICAgICByZXR1cm4gbDIoKG4zICYmIGlzRmluaXRlKG4zID0gbjModDMpKSA/IG4zIDogYjIodDMpKSArIGMyKTsKICAgICAgICAgIH0pKSwgTTIucmVtb3ZlKCksIHgyLmF0dHIoImQiLCB0MiA9PT0gVHQgfHwgdDIgPT09IHd0ID8gYTIgPyAiTSIgKyBmMiAqIGEyICsgIiwiICsgdjIgKyAiSCIgKyBjMiArICJWIiArIF8yICsgIkgiICsgZjIgKiBhMiA6ICJNIiArIGMyICsgIiwiICsgdjIgKyAiViIgKyBfMiA6IGEyID8gIk0iICsgdjIgKyAiLCIgKyBmMiAqIGEyICsgIlYiICsgYzIgKyAiSCIgKyBfMiArICJWIiArIGYyICogYTIgOiAiTSIgKyB2MiArICIsIiArIGMyICsgIkgiICsgXzIpLCB3Mi5hdHRyKCJvcGFjaXR5IiwgMSkuYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgcmV0dXJuIGwyKGIyKHQzKSArIGMyKTsKICAgICAgICAgIH0pLCBBMi5hdHRyKHMyICsgIjIiLCBmMiAqIG8yKSwgUzIuYXR0cihzMiwgZjIgKiBnMikudGV4dChwMiksIG0yLmZpbHRlcihDdCkuYXR0cigiZmlsbCIsICJub25lIikuYXR0cigiZm9udC1zaXplIiwgMTApLmF0dHIoImZvbnQtZmFtaWx5IiwgInNhbnMtc2VyaWYiKS5hdHRyKCJ0ZXh0LWFuY2hvciIsIHQyID09PSB3dCA/ICJzdGFydCIgOiB0MiA9PT0gVHQgPyAiZW5kIiA6ICJtaWRkbGUiKSwgbTIuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy5fX2F4aXMgPSBiMjsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaDIuc2NhbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobjIgPSB0MywgaDIpIDogbjI7CiAgICAgICAgfSwgaDIudGlja3MgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBlMiA9IEFycmF5LmZyb20oYXJndW1lbnRzKSwgaDI7CiAgICAgICAgfSwgaDIudGlja0FyZ3VtZW50cyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9IG51bGwgPT0gdDMgPyBbXSA6IEFycmF5LmZyb20odDMpLCBoMikgOiBlMi5zbGljZSgpOwogICAgICAgIH0sIGgyLnRpY2tWYWx1ZXMgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSBudWxsID09IHQzID8gbnVsbCA6IEFycmF5LmZyb20odDMpLCBoMikgOiByMiAmJiByMi5zbGljZSgpOwogICAgICAgIH0sIGgyLnRpY2tGb3JtYXQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaTIgPSB0MywgaDIpIDogaTI7CiAgICAgICAgfSwgaDIudGlja1NpemUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobzIgPSBhMiA9ICt0MywgaDIpIDogbzI7CiAgICAgICAgfSwgaDIudGlja1NpemVJbm5lciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChvMiA9ICt0MywgaDIpIDogbzI7CiAgICAgICAgfSwgaDIudGlja1NpemVPdXRlciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhMiA9ICt0MywgaDIpIDogYTI7CiAgICAgICAgfSwgaDIudGlja1BhZGRpbmcgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodTIgPSArdDMsIGgyKSA6IHUyOwogICAgICAgIH0sIGgyLm9mZnNldCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjMiA9ICt0MywgaDIpIDogYzI7CiAgICAgICAgfSwgaDI7CiAgICAgIH0KICAgICAgdmFyIHp0ID0geyB2YWx1ZTogKCkgPT4gewogICAgICB9IH07CiAgICAgIGZ1bmN0aW9uICR0KCkgewogICAgICAgIGZvciAodmFyIHQyLCBuMiA9IDAsIGUyID0gYXJndW1lbnRzLmxlbmd0aCwgcjIgPSB7fTsgbjIgPCBlMjsgKytuMikgewogICAgICAgICAgaWYgKCEodDIgPSBhcmd1bWVudHNbbjJdICsgIiIpIHx8IHQyIGluIHIyIHx8IC9bXHMuXS8udGVzdCh0MikpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaWxsZWdhbCB0eXBlOiAiICsgdDIpOwogICAgICAgICAgcjJbdDJdID0gW107CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgRHQocjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIER0KHQyKSB7CiAgICAgICAgdGhpcy5fID0gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUnQodDIsIG4yKSB7CiAgICAgICAgZm9yICh2YXIgZTIsIHIyID0gMCwgaTIgPSB0Mi5sZW5ndGg7IHIyIDwgaTI7ICsrcjIpCiAgICAgICAgICBpZiAoKGUyID0gdDJbcjJdKS5uYW1lID09PSBuMikKICAgICAgICAgICAgcmV0dXJuIGUyLnZhbHVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEZ0KHQyLCBuMiwgZTIpIHsKICAgICAgICBmb3IgKHZhciByMiA9IDAsIGkyID0gdDIubGVuZ3RoOyByMiA8IGkyOyArK3IyKQogICAgICAgICAgaWYgKHQyW3IyXS5uYW1lID09PSBuMikgewogICAgICAgICAgICB0MltyMl0gPSB6dCwgdDIgPSB0Mi5zbGljZSgwLCByMikuY29uY2F0KHQyLnNsaWNlKHIyICsgMSkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbCAhPSBlMiAmJiB0Mi5wdXNoKHsgbmFtZTogbjIsIHZhbHVlOiBlMiB9KSwgdDI7CiAgICAgIH0KICAgICAgRHQucHJvdG90eXBlID0gJHQucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogRHQsIG9uOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICB2YXIgZTIsIHIyLCBpMiA9IHRoaXMuXywgbzIgPSAocjIgPSBpMiwgKHQyICsgIiIpLnRyaW0oKS5zcGxpdCgvXnxccysvKS5tYXAoZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHZhciBuMyA9ICIiLCBlMyA9IHQzLmluZGV4T2YoIi4iKTsKICAgICAgICAgIGlmIChlMyA+PSAwICYmIChuMyA9IHQzLnNsaWNlKGUzICsgMSksIHQzID0gdDMuc2xpY2UoMCwgZTMpKSwgdDMgJiYgIXIyLmhhc093blByb3BlcnR5KHQzKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bmtub3duIHR5cGU6ICIgKyB0Myk7CiAgICAgICAgICByZXR1cm4geyB0eXBlOiB0MywgbmFtZTogbjMgfTsKICAgICAgICB9KSksIGEyID0gLTEsIHUyID0gbzIubGVuZ3RoOwogICAgICAgIGlmICghKGFyZ3VtZW50cy5sZW5ndGggPCAyKSkgewogICAgICAgICAgaWYgKG51bGwgIT0gbjIgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgbjIpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBjYWxsYmFjazogIiArIG4yKTsKICAgICAgICAgIGZvciAoOyArK2EyIDwgdTI7ICkKICAgICAgICAgICAgaWYgKGUyID0gKHQyID0gbzJbYTJdKS50eXBlKQogICAgICAgICAgICAgIGkyW2UyXSA9IEZ0KGkyW2UyXSwgdDIubmFtZSwgbjIpOwogICAgICAgICAgICBlbHNlIGlmIChudWxsID09IG4yKQogICAgICAgICAgICAgIGZvciAoZTIgaW4gaTIpCiAgICAgICAgICAgICAgICBpMltlMl0gPSBGdChpMltlMl0sIHQyLm5hbWUsIG51bGwpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGZvciAoOyArK2EyIDwgdTI7ICkKICAgICAgICAgIGlmICgoZTIgPSAodDIgPSBvMlthMl0pLnR5cGUpICYmIChlMiA9IFJ0KGkyW2UyXSwgdDIubmFtZSkpKQogICAgICAgICAgICByZXR1cm4gZTI7CiAgICAgIH0sIGNvcHk6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0MiA9IHt9LCBuMiA9IHRoaXMuXzsKICAgICAgICBmb3IgKHZhciBlMiBpbiBuMikKICAgICAgICAgIHQyW2UyXSA9IG4yW2UyXS5zbGljZSgpOwogICAgICAgIHJldHVybiBuZXcgRHQodDIpOwogICAgICB9LCBjYWxsOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBpZiAoKGUyID0gYXJndW1lbnRzLmxlbmd0aCAtIDIpID4gMCkKICAgICAgICAgIGZvciAodmFyIGUyLCByMiwgaTIgPSBuZXcgQXJyYXkoZTIpLCBvMiA9IDA7IG8yIDwgZTI7ICsrbzIpCiAgICAgICAgICAgIGkyW28yXSA9IGFyZ3VtZW50c1tvMiArIDJdOwogICAgICAgIGlmICghdGhpcy5fLmhhc093blByb3BlcnR5KHQyKSkKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5rbm93biB0eXBlOiAiICsgdDIpOwogICAgICAgIGZvciAobzIgPSAwLCBlMiA9IChyMiA9IHRoaXMuX1t0Ml0pLmxlbmd0aDsgbzIgPCBlMjsgKytvMikKICAgICAgICAgIHIyW28yXS52YWx1ZS5hcHBseShuMiwgaTIpOwogICAgICB9LCBhcHBseTogZnVuY3Rpb24odDIsIG4yLCBlMikgewogICAgICAgIGlmICghdGhpcy5fLmhhc093blByb3BlcnR5KHQyKSkKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidW5rbm93biB0eXBlOiAiICsgdDIpOwogICAgICAgIGZvciAodmFyIHIyID0gdGhpcy5fW3QyXSwgaTIgPSAwLCBvMiA9IHIyLmxlbmd0aDsgaTIgPCBvMjsgKytpMikKICAgICAgICAgIHIyW2kyXS52YWx1ZS5hcHBseShuMiwgZTIpOwogICAgICB9IH07CiAgICAgIHZhciBxdCA9ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiwgVXQgPSB7IHN2ZzogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiwgeGh0bWw6IHF0LCB4bGluazogImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCB4bWw6ICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiLCB4bWxuczogImh0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvIiB9OwogICAgICBmdW5jdGlvbiBJdCh0MikgewogICAgICAgIHZhciBuMiA9IHQyICs9ICIiLCBlMiA9IG4yLmluZGV4T2YoIjoiKTsKICAgICAgICByZXR1cm4gZTIgPj0gMCAmJiAieG1sbnMiICE9PSAobjIgPSB0Mi5zbGljZSgwLCBlMikpICYmICh0MiA9IHQyLnNsaWNlKGUyICsgMSkpLCBVdC5oYXNPd25Qcm9wZXJ0eShuMikgPyB7IHNwYWNlOiBVdFtuMl0sIGxvY2FsOiB0MiB9IDogdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gT3QodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgbjIgPSB0aGlzLm93bmVyRG9jdW1lbnQsIGUyID0gdGhpcy5uYW1lc3BhY2VVUkk7CiAgICAgICAgICByZXR1cm4gZTIgPT09IHF0ICYmIG4yLmRvY3VtZW50RWxlbWVudC5uYW1lc3BhY2VVUkkgPT09IHF0ID8gbjIuY3JlYXRlRWxlbWVudCh0MikgOiBuMi5jcmVhdGVFbGVtZW50TlMoZTIsIHQyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEJ0KHQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50TlModDIuc3BhY2UsIHQyLmxvY2FsKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFl0KHQyKSB7CiAgICAgICAgdmFyIG4yID0gSXQodDIpOwogICAgICAgIHJldHVybiAobjIubG9jYWwgPyBCdCA6IE90KShuMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTHQoKSB7CiAgICAgIH0KICAgICAgZnVuY3Rpb24ganQodDIpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PSB0MiA/IEx0IDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5xdWVyeVNlbGVjdG9yKHQyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEh0KHQyKSB7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdDIgPyBbXSA6IEFycmF5LmlzQXJyYXkodDIpID8gdDIgOiBBcnJheS5mcm9tKHQyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBYdCgpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgICAgZnVuY3Rpb24gR3QodDIpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PSB0MiA/IFh0IDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5xdWVyeVNlbGVjdG9yQWxsKHQyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFZ0KHQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2hlcyh0Mik7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXdCh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihuMikgewogICAgICAgICAgcmV0dXJuIG4yLm1hdGNoZXModDIpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgdmFyIFp0ID0gQXJyYXkucHJvdG90eXBlLmZpbmQ7CiAgICAgIGZ1bmN0aW9uIEt0KCkgewogICAgICAgIHJldHVybiB0aGlzLmZpcnN0RWxlbWVudENoaWxkOwogICAgICB9CiAgICAgIHZhciBRdCA9IEFycmF5LnByb3RvdHlwZS5maWx0ZXI7CiAgICAgIGZ1bmN0aW9uIEp0KCkgewogICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuY2hpbGRyZW4pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHRuKHQyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBcnJheSh0Mi5sZW5ndGgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG5uKHQyLCBuMikgewogICAgICAgIHRoaXMub3duZXJEb2N1bWVudCA9IHQyLm93bmVyRG9jdW1lbnQsIHRoaXMubmFtZXNwYWNlVVJJID0gdDIubmFtZXNwYWNlVVJJLCB0aGlzLl9uZXh0ID0gbnVsbCwgdGhpcy5fcGFyZW50ID0gdDIsIHRoaXMuX19kYXRhX18gPSBuMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBlbih0MiwgbjIsIGUyLCByMiwgaTIsIG8yKSB7CiAgICAgICAgZm9yICh2YXIgYTIsIHUyID0gMCwgYzIgPSBuMi5sZW5ndGgsIGYyID0gbzIubGVuZ3RoOyB1MiA8IGYyOyArK3UyKQogICAgICAgICAgKGEyID0gbjJbdTJdKSA/IChhMi5fX2RhdGFfXyA9IG8yW3UyXSwgcjJbdTJdID0gYTIpIDogZTJbdTJdID0gbmV3IG5uKHQyLCBvMlt1Ml0pOwogICAgICAgIGZvciAoOyB1MiA8IGMyOyArK3UyKQogICAgICAgICAgKGEyID0gbjJbdTJdKSAmJiAoaTJbdTJdID0gYTIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJuKHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIsIGEyKSB7CiAgICAgICAgdmFyIHUyLCBjMiwgZjIsIHMyID0gLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSwgbDIgPSBuMi5sZW5ndGgsIGgyID0gbzIubGVuZ3RoLCBkMiA9IG5ldyBBcnJheShsMik7CiAgICAgICAgZm9yICh1MiA9IDA7IHUyIDwgbDI7ICsrdTIpCiAgICAgICAgICAoYzIgPSBuMlt1Ml0pICYmIChkMlt1Ml0gPSBmMiA9IGEyLmNhbGwoYzIsIGMyLl9fZGF0YV9fLCB1MiwgbjIpICsgIiIsIHMyLmhhcyhmMikgPyBpMlt1Ml0gPSBjMiA6IHMyLnNldChmMiwgYzIpKTsKICAgICAgICBmb3IgKHUyID0gMDsgdTIgPCBoMjsgKyt1MikKICAgICAgICAgIGYyID0gYTIuY2FsbCh0MiwgbzJbdTJdLCB1MiwgbzIpICsgIiIsIChjMiA9IHMyLmdldChmMikpID8gKHIyW3UyXSA9IGMyLCBjMi5fX2RhdGFfXyA9IG8yW3UyXSwgczIuZGVsZXRlKGYyKSkgOiBlMlt1Ml0gPSBuZXcgbm4odDIsIG8yW3UyXSk7CiAgICAgICAgZm9yICh1MiA9IDA7IHUyIDwgbDI7ICsrdTIpCiAgICAgICAgICAoYzIgPSBuMlt1Ml0pICYmIHMyLmdldChkMlt1Ml0pID09PSBjMiAmJiAoaTJbdTJdID0gYzIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLl9fZGF0YV9fOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFuKHQyKSB7CiAgICAgICAgcmV0dXJuICJvYmplY3QiID09IHR5cGVvZiB0MiAmJiAibGVuZ3RoIiBpbiB0MiA/IHQyIDogQXJyYXkuZnJvbSh0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdW4odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHQyIDwgbjIgPyAtMSA6IHQyID4gbjIgPyAxIDogdDIgPj0gbjIgPyAwIDogTmFOOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGNuKHQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGUodDIpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZm4odDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZU5TKHQyLnNwYWNlLCB0Mi5sb2NhbCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBzbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSh0MiwgbjIpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbG4odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGVOUyh0Mi5zcGFjZSwgdDIubG9jYWwsIG4yKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGhuKHQyLCBuMikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlMiA9IG4yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICBudWxsID09IGUyID8gdGhpcy5yZW1vdmVBdHRyaWJ1dGUodDIpIDogdGhpcy5zZXRBdHRyaWJ1dGUodDIsIGUyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRuKHQyLCBuMikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlMiA9IG4yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICBudWxsID09IGUyID8gdGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyh0Mi5zcGFjZSwgdDIubG9jYWwpIDogdGhpcy5zZXRBdHRyaWJ1dGVOUyh0Mi5zcGFjZSwgdDIubG9jYWwsIGUyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHBuKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLm93bmVyRG9jdW1lbnQgJiYgdDIub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldyB8fCB0Mi5kb2N1bWVudCAmJiB0MiB8fCB0Mi5kZWZhdWx0VmlldzsKICAgICAgfQogICAgICBmdW5jdGlvbiBnbih0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuc3R5bGUucmVtb3ZlUHJvcGVydHkodDIpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24geW4odDIsIG4yLCBlMikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuc3R5bGUuc2V0UHJvcGVydHkodDIsIG4yLCBlMik7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiB2bih0MiwgbjIsIGUyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHIyID0gbjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIG51bGwgPT0gcjIgPyB0aGlzLnN0eWxlLnJlbW92ZVByb3BlcnR5KHQyKSA6IHRoaXMuc3R5bGUuc2V0UHJvcGVydHkodDIsIHIyLCBlMik7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gdDIuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShuMikgfHwgcG4odDIpLmdldENvbXB1dGVkU3R5bGUodDIsIG51bGwpLmdldFByb3BlcnR5VmFsdWUobjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJuKHQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgZGVsZXRlIHRoaXNbdDJdOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbW4odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpc1t0Ml0gPSBuMjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHhuKHQyLCBuMikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBlMiA9IG4yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICBudWxsID09IGUyID8gZGVsZXRlIHRoaXNbdDJdIDogdGhpc1t0Ml0gPSBlMjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHduKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLnRyaW0oKS5zcGxpdCgvXnxccysvKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBNbih0MikgewogICAgICAgIHJldHVybiB0Mi5jbGFzc0xpc3QgfHwgbmV3IFRuKHQyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUbih0MikgewogICAgICAgIHRoaXMuX25vZGUgPSB0MiwgdGhpcy5fbmFtZXMgPSB3bih0Mi5nZXRBdHRyaWJ1dGUoImNsYXNzIikgfHwgIiIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEFuKHQyLCBuMikgewogICAgICAgIGZvciAodmFyIGUyID0gTW4odDIpLCByMiA9IC0xLCBpMiA9IG4yLmxlbmd0aDsgKytyMiA8IGkyOyApCiAgICAgICAgICBlMi5hZGQobjJbcjJdKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBTbih0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiA9IE1uKHQyKSwgcjIgPSAtMSwgaTIgPSBuMi5sZW5ndGg7ICsrcjIgPCBpMjsgKQogICAgICAgICAgZTIucmVtb3ZlKG4yW3IyXSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRW4odDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICBBbih0aGlzLCB0Mik7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBObih0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIFNuKHRoaXMsIHQyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGtuKHQyLCBuMikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIChuMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpID8gQW4gOiBTbikodGhpcywgdDIpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQ24oKSB7CiAgICAgICAgdGhpcy50ZXh0Q29udGVudCA9ICIiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFBuKHQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy50ZXh0Q29udGVudCA9IHQyOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gem4odDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgbjIgPSB0Mi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgdGhpcy50ZXh0Q29udGVudCA9IG51bGwgPT0gbjIgPyAiIiA6IG4yOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gJG4oKSB7CiAgICAgICAgdGhpcy5pbm5lckhUTUwgPSAiIjsKICAgICAgfQogICAgICBmdW5jdGlvbiBEbih0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMuaW5uZXJIVE1MID0gdDI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSbih0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBuMiA9IHQyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB0aGlzLmlubmVySFRNTCA9IG51bGwgPT0gbjIgPyAiIiA6IG4yOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRm4oKSB7CiAgICAgICAgdGhpcy5uZXh0U2libGluZyAmJiB0aGlzLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQodGhpcyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcW4oKSB7CiAgICAgICAgdGhpcy5wcmV2aW91c1NpYmxpbmcgJiYgdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLCB0aGlzLnBhcmVudE5vZGUuZmlyc3RDaGlsZCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVW4oKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSW4oKSB7CiAgICAgICAgdmFyIHQyID0gdGhpcy5wYXJlbnROb2RlOwogICAgICAgIHQyICYmIHQyLnJlbW92ZUNoaWxkKHRoaXMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE9uKCkgewogICAgICAgIHZhciB0MiA9IHRoaXMuY2xvbmVOb2RlKGZhbHNlKSwgbjIgPSB0aGlzLnBhcmVudE5vZGU7CiAgICAgICAgcmV0dXJuIG4yID8gbjIuaW5zZXJ0QmVmb3JlKHQyLCB0aGlzLm5leHRTaWJsaW5nKSA6IHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEJuKCkgewogICAgICAgIHZhciB0MiA9IHRoaXMuY2xvbmVOb2RlKHRydWUpLCBuMiA9IHRoaXMucGFyZW50Tm9kZTsKICAgICAgICByZXR1cm4gbjIgPyBuMi5pbnNlcnRCZWZvcmUodDIsIHRoaXMubmV4dFNpYmxpbmcpIDogdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWW4odDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgbjIgPSB0aGlzLl9fb247CiAgICAgICAgICBpZiAobjIpIHsKICAgICAgICAgICAgZm9yICh2YXIgZTIsIHIyID0gMCwgaTIgPSAtMSwgbzIgPSBuMi5sZW5ndGg7IHIyIDwgbzI7ICsrcjIpCiAgICAgICAgICAgICAgZTIgPSBuMltyMl0sIHQyLnR5cGUgJiYgZTIudHlwZSAhPT0gdDIudHlwZSB8fCBlMi5uYW1lICE9PSB0Mi5uYW1lID8gbjJbKytpMl0gPSBlMiA6IHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcihlMi50eXBlLCBlMi5saXN0ZW5lciwgZTIub3B0aW9ucyk7CiAgICAgICAgICAgICsraTIgPyBuMi5sZW5ndGggPSBpMiA6IGRlbGV0ZSB0aGlzLl9fb247CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBMbih0MiwgbjIsIGUyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHIyLCBpMiA9IHRoaXMuX19vbiwgbzIgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICAgICAgdDMuY2FsbCh0aGlzLCBuMywgdGhpcy5fX2RhdGFfXyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KG4yKTsKICAgICAgICAgIGlmIChpMikgewogICAgICAgICAgICBmb3IgKHZhciBhMiA9IDAsIHUyID0gaTIubGVuZ3RoOyBhMiA8IHUyOyArK2EyKQogICAgICAgICAgICAgIGlmICgocjIgPSBpMlthMl0pLnR5cGUgPT09IHQyLnR5cGUgJiYgcjIubmFtZSA9PT0gdDIubmFtZSkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIocjIudHlwZSwgcjIubGlzdGVuZXIsIHIyLm9wdGlvbnMpLCB0aGlzLmFkZEV2ZW50TGlzdGVuZXIocjIudHlwZSwgcjIubGlzdGVuZXIgPSBvMiwgcjIub3B0aW9ucyA9IGUyKSwgdm9pZCAocjIudmFsdWUgPSBuMik7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIodDIudHlwZSwgbzIsIGUyKSwgcjIgPSB7IHR5cGU6IHQyLnR5cGUsIG5hbWU6IHQyLm5hbWUsIHZhbHVlOiBuMiwgbGlzdGVuZXI6IG8yLCBvcHRpb25zOiBlMiB9LCBpMiA/IGkyLnB1c2gocjIpIDogdGhpcy5fX29uID0gW3IyXTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGpuKHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSBwbih0MiksIGkyID0gcjIuQ3VzdG9tRXZlbnQ7CiAgICAgICAgImZ1bmN0aW9uIiA9PSB0eXBlb2YgaTIgPyBpMiA9IG5ldyBpMihuMiwgZTIpIDogKGkyID0gcjIuZG9jdW1lbnQuY3JlYXRlRXZlbnQoIkV2ZW50IiksIGUyID8gKGkyLmluaXRFdmVudChuMiwgZTIuYnViYmxlcywgZTIuY2FuY2VsYWJsZSksIGkyLmRldGFpbCA9IGUyLmRldGFpbCkgOiBpMi5pbml0RXZlbnQobjIsIGZhbHNlLCBmYWxzZSkpLCB0Mi5kaXNwYXRjaEV2ZW50KGkyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBIbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gam4odGhpcywgdDIsIG4yKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFhuKHQyLCBuMikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBqbih0aGlzLCB0MiwgbjIuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBubi5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiBubiwgYXBwZW5kQ2hpbGQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudC5pbnNlcnRCZWZvcmUodDIsIHRoaXMuX25leHQpOwogICAgICB9LCBpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQuaW5zZXJ0QmVmb3JlKHQyLCBuMik7CiAgICAgIH0sIHF1ZXJ5U2VsZWN0b3I6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudC5xdWVyeVNlbGVjdG9yKHQyKTsKICAgICAgfSwgcXVlcnlTZWxlY3RvckFsbDogZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwodDIpOwogICAgICB9IH0sIFRuLnByb3RvdHlwZSA9IHsgYWRkOiBmdW5jdGlvbih0MikgewogICAgICAgIHRoaXMuX25hbWVzLmluZGV4T2YodDIpIDwgMCAmJiAodGhpcy5fbmFtZXMucHVzaCh0MiksIHRoaXMuX25vZGUuc2V0QXR0cmlidXRlKCJjbGFzcyIsIHRoaXMuX25hbWVzLmpvaW4oIiAiKSkpOwogICAgICB9LCByZW1vdmU6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgdmFyIG4yID0gdGhpcy5fbmFtZXMuaW5kZXhPZih0Mik7CiAgICAgICAgbjIgPj0gMCAmJiAodGhpcy5fbmFtZXMuc3BsaWNlKG4yLCAxKSwgdGhpcy5fbm9kZS5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgdGhpcy5fbmFtZXMuam9pbigiICIpKSk7CiAgICAgIH0sIGNvbnRhaW5zOiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0aGlzLl9uYW1lcy5pbmRleE9mKHQyKSA+PSAwOwogICAgICB9IH07CiAgICAgIHZhciBHbiA9IFtudWxsXTsKICAgICAgZnVuY3Rpb24gVm4odDIsIG4yKSB7CiAgICAgICAgdGhpcy5fZ3JvdXBzID0gdDIsIHRoaXMuX3BhcmVudHMgPSBuMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBXbigpIHsKICAgICAgICByZXR1cm4gbmV3IFZuKFtbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50XV0sIEduKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBabih0MikgewogICAgICAgIHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgdDIgPyBuZXcgVm4oW1tkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHQyKV1dLCBbZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50XSkgOiBuZXcgVm4oW1t0Ml1dLCBHbik7CiAgICAgIH0KICAgICAgVm4ucHJvdG90eXBlID0gV24ucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogVm4sIHNlbGVjdDogZnVuY3Rpb24odDIpIHsKICAgICAgICAiZnVuY3Rpb24iICE9IHR5cGVvZiB0MiAmJiAodDIgPSBqdCh0MikpOwogICAgICAgIGZvciAodmFyIG4yID0gdGhpcy5fZ3JvdXBzLCBlMiA9IG4yLmxlbmd0aCwgcjIgPSBuZXcgQXJyYXkoZTIpLCBpMiA9IDA7IGkyIDwgZTI7ICsraTIpCiAgICAgICAgICBmb3IgKHZhciBvMiwgYTIsIHUyID0gbjJbaTJdLCBjMiA9IHUyLmxlbmd0aCwgZjIgPSByMltpMl0gPSBuZXcgQXJyYXkoYzIpLCBzMiA9IDA7IHMyIDwgYzI7ICsrczIpCiAgICAgICAgICAgIChvMiA9IHUyW3MyXSkgJiYgKGEyID0gdDIuY2FsbChvMiwgbzIuX19kYXRhX18sIHMyLCB1MikpICYmICgiX19kYXRhX18iIGluIG8yICYmIChhMi5fX2RhdGFfXyA9IG8yLl9fZGF0YV9fKSwgZjJbczJdID0gYTIpOwogICAgICAgIHJldHVybiBuZXcgVm4ocjIsIHRoaXMuX3BhcmVudHMpOwogICAgICB9LCBzZWxlY3RBbGw6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgdDIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MiA/IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gSHQodDMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICAgICAgICB9OwogICAgICAgIH0odDIpIDogR3QodDIpOwogICAgICAgIGZvciAodmFyIG4yID0gdGhpcy5fZ3JvdXBzLCBlMiA9IG4yLmxlbmd0aCwgcjIgPSBbXSwgaTIgPSBbXSwgbzIgPSAwOyBvMiA8IGUyOyArK28yKQogICAgICAgICAgZm9yICh2YXIgYTIsIHUyID0gbjJbbzJdLCBjMiA9IHUyLmxlbmd0aCwgZjIgPSAwOyBmMiA8IGMyOyArK2YyKQogICAgICAgICAgICAoYTIgPSB1MltmMl0pICYmIChyMi5wdXNoKHQyLmNhbGwoYTIsIGEyLl9fZGF0YV9fLCBmMiwgdTIpKSwgaTIucHVzaChhMikpOwogICAgICAgIHJldHVybiBuZXcgVm4ocjIsIGkyKTsKICAgICAgfSwgc2VsZWN0Q2hpbGQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0KG51bGwgPT0gdDIgPyBLdCA6IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gWnQuY2FsbCh0aGlzLmNoaWxkcmVuLCB0Myk7CiAgICAgICAgICB9OwogICAgICAgIH0oImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDIgPyB0MiA6IFd0KHQyKSkpOwogICAgICB9LCBzZWxlY3RDaGlsZHJlbjogZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RBbGwobnVsbCA9PSB0MiA/IEp0IDogLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBRdC5jYWxsKHRoaXMuY2hpbGRyZW4sIHQzKTsKICAgICAgICAgIH07CiAgICAgICAgfSgiZnVuY3Rpb24iID09IHR5cGVvZiB0MiA/IHQyIDogV3QodDIpKSk7CiAgICAgIH0sIGZpbHRlcjogZnVuY3Rpb24odDIpIHsKICAgICAgICAiZnVuY3Rpb24iICE9IHR5cGVvZiB0MiAmJiAodDIgPSBWdCh0MikpOwogICAgICAgIGZvciAodmFyIG4yID0gdGhpcy5fZ3JvdXBzLCBlMiA9IG4yLmxlbmd0aCwgcjIgPSBuZXcgQXJyYXkoZTIpLCBpMiA9IDA7IGkyIDwgZTI7ICsraTIpCiAgICAgICAgICBmb3IgKHZhciBvMiwgYTIgPSBuMltpMl0sIHUyID0gYTIubGVuZ3RoLCBjMiA9IHIyW2kyXSA9IFtdLCBmMiA9IDA7IGYyIDwgdTI7ICsrZjIpCiAgICAgICAgICAgIChvMiA9IGEyW2YyXSkgJiYgdDIuY2FsbChvMiwgbzIuX19kYXRhX18sIGYyLCBhMikgJiYgYzIucHVzaChvMik7CiAgICAgICAgcmV0dXJuIG5ldyBWbihyMiwgdGhpcy5fcGFyZW50cyk7CiAgICAgIH0sIGRhdGE6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMsIG9uKTsKICAgICAgICB2YXIgZTIgPSBuMiA/IHJuIDogZW4sIHIyID0gdGhpcy5fcGFyZW50cywgaTIgPSB0aGlzLl9ncm91cHM7CiAgICAgICAgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdDIgJiYgKHQyID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgIH07CiAgICAgICAgfSh0MikpOwogICAgICAgIGZvciAodmFyIG8yID0gaTIubGVuZ3RoLCBhMiA9IG5ldyBBcnJheShvMiksIHUyID0gbmV3IEFycmF5KG8yKSwgYzIgPSBuZXcgQXJyYXkobzIpLCBmMiA9IDA7IGYyIDwgbzI7ICsrZjIpIHsKICAgICAgICAgIHZhciBzMiA9IHIyW2YyXSwgbDIgPSBpMltmMl0sIGgyID0gbDIubGVuZ3RoLCBkMiA9IGFuKHQyLmNhbGwoczIsIHMyICYmIHMyLl9fZGF0YV9fLCBmMiwgcjIpKSwgcDIgPSBkMi5sZW5ndGgsIGcyID0gdTJbZjJdID0gbmV3IEFycmF5KHAyKSwgeTIgPSBhMltmMl0gPSBuZXcgQXJyYXkocDIpOwogICAgICAgICAgZTIoczIsIGwyLCBnMiwgeTIsIGMyW2YyXSA9IG5ldyBBcnJheShoMiksIGQyLCBuMik7CiAgICAgICAgICBmb3IgKHZhciB2MiwgXzIsIGIyID0gMCwgbTIgPSAwOyBiMiA8IHAyOyArK2IyKQogICAgICAgICAgICBpZiAodjIgPSBnMltiMl0pIHsKICAgICAgICAgICAgICBmb3IgKGIyID49IG0yICYmIChtMiA9IGIyICsgMSk7ICEoXzIgPSB5MlttMl0pICYmICsrbTIgPCBwMjsgKQogICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgIHYyLl9uZXh0ID0gXzIgfHwgbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gKGEyID0gbmV3IFZuKGEyLCByMikpLl9lbnRlciA9IHUyLCBhMi5fZXhpdCA9IGMyLCBhMjsKICAgICAgfSwgZW50ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgVm4odGhpcy5fZW50ZXIgfHwgdGhpcy5fZ3JvdXBzLm1hcCh0biksIHRoaXMuX3BhcmVudHMpOwogICAgICB9LCBleGl0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFZuKHRoaXMuX2V4aXQgfHwgdGhpcy5fZ3JvdXBzLm1hcCh0biksIHRoaXMuX3BhcmVudHMpOwogICAgICB9LCBqb2luOiBmdW5jdGlvbih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gdGhpcy5lbnRlcigpLCBpMiA9IHRoaXMsIG8yID0gdGhpcy5leGl0KCk7CiAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQyID8gKHIyID0gdDIocjIpKSAmJiAocjIgPSByMi5zZWxlY3Rpb24oKSkgOiByMiA9IHIyLmFwcGVuZCh0MiArICIiKSwgbnVsbCAhPSBuMiAmJiAoaTIgPSBuMihpMikpICYmIChpMiA9IGkyLnNlbGVjdGlvbigpKSwgbnVsbCA9PSBlMiA/IG8yLnJlbW92ZSgpIDogZTIobzIpLCByMiAmJiBpMiA/IHIyLm1lcmdlKGkyKS5vcmRlcigpIDogaTI7CiAgICAgIH0sIG1lcmdlOiBmdW5jdGlvbih0MikgewogICAgICAgIGZvciAodmFyIG4yID0gdDIuc2VsZWN0aW9uID8gdDIuc2VsZWN0aW9uKCkgOiB0MiwgZTIgPSB0aGlzLl9ncm91cHMsIHIyID0gbjIuX2dyb3VwcywgaTIgPSBlMi5sZW5ndGgsIG8yID0gcjIubGVuZ3RoLCBhMiA9IE1hdGgubWluKGkyLCBvMiksIHUyID0gbmV3IEFycmF5KGkyKSwgYzIgPSAwOyBjMiA8IGEyOyArK2MyKQogICAgICAgICAgZm9yICh2YXIgZjIsIHMyID0gZTJbYzJdLCBsMiA9IHIyW2MyXSwgaDIgPSBzMi5sZW5ndGgsIGQyID0gdTJbYzJdID0gbmV3IEFycmF5KGgyKSwgcDIgPSAwOyBwMiA8IGgyOyArK3AyKQogICAgICAgICAgICAoZjIgPSBzMltwMl0gfHwgbDJbcDJdKSAmJiAoZDJbcDJdID0gZjIpOwogICAgICAgIGZvciAoOyBjMiA8IGkyOyArK2MyKQogICAgICAgICAgdTJbYzJdID0gZTJbYzJdOwogICAgICAgIHJldHVybiBuZXcgVm4odTIsIHRoaXMuX3BhcmVudHMpOwogICAgICB9LCBzZWxlY3Rpb246IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LCBvcmRlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yICh2YXIgdDIgPSB0aGlzLl9ncm91cHMsIG4yID0gLTEsIGUyID0gdDIubGVuZ3RoOyArK24yIDwgZTI7ICkKICAgICAgICAgIGZvciAodmFyIHIyLCBpMiA9IHQyW24yXSwgbzIgPSBpMi5sZW5ndGggLSAxLCBhMiA9IGkyW28yXTsgLS1vMiA+PSAwOyApCiAgICAgICAgICAgIChyMiA9IGkyW28yXSkgJiYgKGEyICYmIDQgXiByMi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihhMikgJiYgYTIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUocjIsIGEyKSwgYTIgPSByMik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sIHNvcnQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgZnVuY3Rpb24gbjIobjMsIGUzKSB7CiAgICAgICAgICByZXR1cm4gbjMgJiYgZTMgPyB0MihuMy5fX2RhdGFfXywgZTMuX19kYXRhX18pIDogIW4zIC0gIWUzOwogICAgICAgIH0KICAgICAgICB0MiB8fCAodDIgPSB1bik7CiAgICAgICAgZm9yICh2YXIgZTIgPSB0aGlzLl9ncm91cHMsIHIyID0gZTIubGVuZ3RoLCBpMiA9IG5ldyBBcnJheShyMiksIG8yID0gMDsgbzIgPCByMjsgKytvMikgewogICAgICAgICAgZm9yICh2YXIgYTIsIHUyID0gZTJbbzJdLCBjMiA9IHUyLmxlbmd0aCwgZjIgPSBpMltvMl0gPSBuZXcgQXJyYXkoYzIpLCBzMiA9IDA7IHMyIDwgYzI7ICsrczIpCiAgICAgICAgICAgIChhMiA9IHUyW3MyXSkgJiYgKGYyW3MyXSA9IGEyKTsKICAgICAgICAgIGYyLnNvcnQobjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFZuKGkyLCB0aGlzLl9wYXJlbnRzKS5vcmRlcigpOwogICAgICB9LCBjYWxsOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBhcmd1bWVudHNbMF07CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50c1swXSA9IHRoaXMsIHQyLmFwcGx5KG51bGwsIGFyZ3VtZW50cyksIHRoaXM7CiAgICAgIH0sIG5vZGVzOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzKTsKICAgICAgfSwgbm9kZTogZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yICh2YXIgdDIgPSB0aGlzLl9ncm91cHMsIG4yID0gMCwgZTIgPSB0Mi5sZW5ndGg7IG4yIDwgZTI7ICsrbjIpCiAgICAgICAgICBmb3IgKHZhciByMiA9IHQyW24yXSwgaTIgPSAwLCBvMiA9IHIyLmxlbmd0aDsgaTIgPCBvMjsgKytpMikgewogICAgICAgICAgICB2YXIgYTIgPSByMltpMl07CiAgICAgICAgICAgIGlmIChhMikKICAgICAgICAgICAgICByZXR1cm4gYTI7CiAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0sIHNpemU6IGZ1bmN0aW9uKCkgewogICAgICAgIGxldCB0MiA9IDA7CiAgICAgICAgZm9yIChjb25zdCBuMiBvZiB0aGlzKQogICAgICAgICAgKyt0MjsKICAgICAgICByZXR1cm4gdDI7CiAgICAgIH0sIGVtcHR5OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gIXRoaXMubm9kZSgpOwogICAgICB9LCBlYWNoOiBmdW5jdGlvbih0MikgewogICAgICAgIGZvciAodmFyIG4yID0gdGhpcy5fZ3JvdXBzLCBlMiA9IDAsIHIyID0gbjIubGVuZ3RoOyBlMiA8IHIyOyArK2UyKQogICAgICAgICAgZm9yICh2YXIgaTIsIG8yID0gbjJbZTJdLCBhMiA9IDAsIHUyID0gbzIubGVuZ3RoOyBhMiA8IHUyOyArK2EyKQogICAgICAgICAgICAoaTIgPSBvMlthMl0pICYmIHQyLmNhbGwoaTIsIGkyLl9fZGF0YV9fLCBhMiwgbzIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LCBhdHRyOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSBJdCh0Mik7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSB7CiAgICAgICAgICB2YXIgcjIgPSB0aGlzLm5vZGUoKTsKICAgICAgICAgIHJldHVybiBlMi5sb2NhbCA/IHIyLmdldEF0dHJpYnV0ZU5TKGUyLnNwYWNlLCBlMi5sb2NhbCkgOiByMi5nZXRBdHRyaWJ1dGUoZTIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5lYWNoKChudWxsID09IG4yID8gZTIubG9jYWwgPyBmbiA6IGNuIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjIgPyBlMi5sb2NhbCA/IGRuIDogaG4gOiBlMi5sb2NhbCA/IGxuIDogc24pKGUyLCBuMikpOwogICAgICB9LCBzdHlsZTogZnVuY3Rpb24odDIsIG4yLCBlMikgewogICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID4gMSA/IHRoaXMuZWFjaCgobnVsbCA9PSBuMiA/IGduIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjIgPyB2biA6IHluKSh0MiwgbjIsIG51bGwgPT0gZTIgPyAiIiA6IGUyKSkgOiBfbih0aGlzLm5vZGUoKSwgdDIpOwogICAgICB9LCBwcm9wZXJ0eTogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gdGhpcy5lYWNoKChudWxsID09IG4yID8gYm4gOiAiZnVuY3Rpb24iID09IHR5cGVvZiBuMiA/IHhuIDogbW4pKHQyLCBuMikpIDogdGhpcy5ub2RlKClbdDJdOwogICAgICB9LCBjbGFzc2VkOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSB3bih0MiArICIiKTsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHsKICAgICAgICAgIGZvciAodmFyIHIyID0gTW4odGhpcy5ub2RlKCkpLCBpMiA9IC0xLCBvMiA9IGUyLmxlbmd0aDsgKytpMiA8IG8yOyApCiAgICAgICAgICAgIGlmICghcjIuY29udGFpbnMoZTJbaTJdKSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCgoImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjIgPyBrbiA6IG4yID8gRW4gOiBObikoZTIsIG4yKSk7CiAgICAgIH0sIHRleHQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLmVhY2gobnVsbCA9PSB0MiA/IENuIDogKCJmdW5jdGlvbiIgPT0gdHlwZW9mIHQyID8gem4gOiBQbikodDIpKSA6IHRoaXMubm9kZSgpLnRleHRDb250ZW50OwogICAgICB9LCBodG1sOiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gdGhpcy5lYWNoKG51bGwgPT0gdDIgPyAkbiA6ICgiZnVuY3Rpb24iID09IHR5cGVvZiB0MiA/IFJuIDogRG4pKHQyKSkgOiB0aGlzLm5vZGUoKS5pbm5lckhUTUw7CiAgICAgIH0sIHJhaXNlOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5lYWNoKEZuKTsKICAgICAgfSwgbG93ZXI6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmVhY2gocW4pOwogICAgICB9LCBhcHBlbmQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgdmFyIG4yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDIgPyB0MiA6IFl0KHQyKTsKICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3QoZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5hcHBlbmRDaGlsZChuMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgICAgICB9KTsKICAgICAgfSwgaW5zZXJ0OiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MiA/IHQyIDogWXQodDIpLCByMiA9IG51bGwgPT0gbjIgPyBVbiA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4yID8gbjIgOiBqdChuMik7CiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0KGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0QmVmb3JlKGUyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgbnVsbCk7CiAgICAgICAgfSk7CiAgICAgIH0sIHJlbW92ZTogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChJbik7CiAgICAgIH0sIGNsb25lOiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0aGlzLnNlbGVjdCh0MiA/IEJuIDogT24pOwogICAgICB9LCBkYXR1bTogZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IHRoaXMucHJvcGVydHkoIl9fZGF0YV9fIiwgdDIpIDogdGhpcy5ub2RlKCkuX19kYXRhX187CiAgICAgIH0sIG9uOiBmdW5jdGlvbih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyLCBpMiwgbzIgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIHQzLnRyaW0oKS5zcGxpdCgvXnxccysvKS5tYXAoZnVuY3Rpb24odDQpIHsKICAgICAgICAgICAgdmFyIG4zID0gIiIsIGUzID0gdDQuaW5kZXhPZigiLiIpOwogICAgICAgICAgICByZXR1cm4gZTMgPj0gMCAmJiAobjMgPSB0NC5zbGljZShlMyArIDEpLCB0NCA9IHQ0LnNsaWNlKDAsIGUzKSksIHsgdHlwZTogdDQsIG5hbWU6IG4zIH07CiAgICAgICAgICB9KTsKICAgICAgICB9KHQyICsgIiIpLCBhMiA9IG8yLmxlbmd0aDsKICAgICAgICBpZiAoIShhcmd1bWVudHMubGVuZ3RoIDwgMikpIHsKICAgICAgICAgIGZvciAodTIgPSBuMiA/IExuIDogWW4sIHIyID0gMDsgcjIgPCBhMjsgKytyMikKICAgICAgICAgICAgdGhpcy5lYWNoKHUyKG8yW3IyXSwgbjIsIGUyKSk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgdmFyIHUyID0gdGhpcy5ub2RlKCkuX19vbjsKICAgICAgICBpZiAodTIpIHsKICAgICAgICAgIGZvciAodmFyIGMyLCBmMiA9IDAsIHMyID0gdTIubGVuZ3RoOyBmMiA8IHMyOyArK2YyKQogICAgICAgICAgICBmb3IgKHIyID0gMCwgYzIgPSB1MltmMl07IHIyIDwgYTI7ICsrcjIpCiAgICAgICAgICAgICAgaWYgKChpMiA9IG8yW3IyXSkudHlwZSA9PT0gYzIudHlwZSAmJiBpMi5uYW1lID09PSBjMi5uYW1lKQogICAgICAgICAgICAgICAgcmV0dXJuIGMyLnZhbHVlOwogICAgICAgIH0KICAgICAgfSwgZGlzcGF0Y2g6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiB0aGlzLmVhY2goKCJmdW5jdGlvbiIgPT0gdHlwZW9mIG4yID8gWG4gOiBIbikodDIsIG4yKSk7CiAgICAgIH0sIFtTeW1ib2wuaXRlcmF0b3JdOiBmdW5jdGlvbiogKCkgewogICAgICAgIGZvciAodmFyIHQyID0gdGhpcy5fZ3JvdXBzLCBuMiA9IDAsIGUyID0gdDIubGVuZ3RoOyBuMiA8IGUyOyArK24yKQogICAgICAgICAgZm9yICh2YXIgcjIsIGkyID0gdDJbbjJdLCBvMiA9IDAsIGEyID0gaTIubGVuZ3RoOyBvMiA8IGEyOyArK28yKQogICAgICAgICAgICAocjIgPSBpMltvMl0pICYmICh5aWVsZCByMik7CiAgICAgIH0gfTsKICAgICAgdmFyIEtuID0gMDsKICAgICAgZnVuY3Rpb24gUW4oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBKbigpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEpuKCkgewogICAgICAgIHRoaXMuXyA9ICJAIiArICgrK0tuKS50b1N0cmluZygzNik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdGUodDIpIHsKICAgICAgICBsZXQgbjI7CiAgICAgICAgZm9yICg7IG4yID0gdDIuc291cmNlRXZlbnQ7ICkKICAgICAgICAgIHQyID0gbjI7CiAgICAgICAgcmV0dXJuIHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG5lKHQyLCBuMikgewogICAgICAgIGlmICh0MiA9IHRlKHQyKSwgdm9pZCAwID09PSBuMiAmJiAobjIgPSB0Mi5jdXJyZW50VGFyZ2V0KSwgbjIpIHsKICAgICAgICAgIHZhciBlMiA9IG4yLm93bmVyU1ZHRWxlbWVudCB8fCBuMjsKICAgICAgICAgIGlmIChlMi5jcmVhdGVTVkdQb2ludCkgewogICAgICAgICAgICB2YXIgcjIgPSBlMi5jcmVhdGVTVkdQb2ludCgpOwogICAgICAgICAgICByZXR1cm4gcjIueCA9IHQyLmNsaWVudFgsIHIyLnkgPSB0Mi5jbGllbnRZLCBbKHIyID0gcjIubWF0cml4VHJhbnNmb3JtKG4yLmdldFNjcmVlbkNUTSgpLmludmVyc2UoKSkpLngsIHIyLnldOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG4yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCkgewogICAgICAgICAgICB2YXIgaTIgPSBuMi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgcmV0dXJuIFt0Mi5jbGllbnRYIC0gaTIubGVmdCAtIG4yLmNsaWVudExlZnQsIHQyLmNsaWVudFkgLSBpMi50b3AgLSBuMi5jbGllbnRUb3BdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gW3QyLnBhZ2VYLCB0Mi5wYWdlWV07CiAgICAgIH0KICAgICAgSm4ucHJvdG90eXBlID0gUW4ucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogSm4sIGdldDogZnVuY3Rpb24odDIpIHsKICAgICAgICBmb3IgKHZhciBuMiA9IHRoaXMuXzsgIShuMiBpbiB0Mik7ICkKICAgICAgICAgIGlmICghKHQyID0gdDIucGFyZW50Tm9kZSkpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICByZXR1cm4gdDJbbjJdOwogICAgICB9LCBzZXQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiB0Mlt0aGlzLl9dID0gbjI7CiAgICAgIH0sIHJlbW92ZTogZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gdGhpcy5fIGluIHQyICYmIGRlbGV0ZSB0Mlt0aGlzLl9dOwogICAgICB9LCB0b1N0cmluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuXzsKICAgICAgfSB9OwogICAgICBjb25zdCBlZSA9IHsgcGFzc2l2ZTogZmFsc2UgfSwgcmUgPSB7IGNhcHR1cmU6IHRydWUsIHBhc3NpdmU6IGZhbHNlIH07CiAgICAgIGZ1bmN0aW9uIGllKHQyKSB7CiAgICAgICAgdDIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gb2UodDIpIHsKICAgICAgICB0Mi5wcmV2ZW50RGVmYXVsdCgpLCB0Mi5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBhZSh0MikgewogICAgICAgIHZhciBuMiA9IHQyLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgZTIgPSBabih0Mikub24oImRyYWdzdGFydC5kcmFnIiwgb2UsIHJlKTsKICAgICAgICAib25zZWxlY3RzdGFydCIgaW4gbjIgPyBlMi5vbigic2VsZWN0c3RhcnQuZHJhZyIsIG9lLCByZSkgOiAobjIuX19ub3NlbGVjdCA9IG4yLnN0eWxlLk1velVzZXJTZWxlY3QsIG4yLnN0eWxlLk1velVzZXJTZWxlY3QgPSAibm9uZSIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVlKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IHQyLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgcjIgPSBabih0Mikub24oImRyYWdzdGFydC5kcmFnIiwgbnVsbCk7CiAgICAgICAgbjIgJiYgKHIyLm9uKCJjbGljay5kcmFnIiwgb2UsIHJlKSwgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgIHIyLm9uKCJjbGljay5kcmFnIiwgbnVsbCk7CiAgICAgICAgfSwgMCkpLCAib25zZWxlY3RzdGFydCIgaW4gZTIgPyByMi5vbigic2VsZWN0c3RhcnQuZHJhZyIsIG51bGwpIDogKGUyLnN0eWxlLk1velVzZXJTZWxlY3QgPSBlMi5fX25vc2VsZWN0LCBkZWxldGUgZTIuX19ub3NlbGVjdCk7CiAgICAgIH0KICAgICAgdmFyIGNlID0gKHQyKSA9PiAoKSA9PiB0MjsKICAgICAgZnVuY3Rpb24gZmUodDIsIHsgc291cmNlRXZlbnQ6IG4yLCBzdWJqZWN0OiBlMiwgdGFyZ2V0OiByMiwgaWRlbnRpZmllcjogaTIsIGFjdGl2ZTogbzIsIHg6IGEyLCB5OiB1MiwgZHg6IGMyLCBkeTogZjIsIGRpc3BhdGNoOiBzMiB9KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgeyB0eXBlOiB7IHZhbHVlOiB0MiwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0sIHNvdXJjZUV2ZW50OiB7IHZhbHVlOiBuMiwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0sIHN1YmplY3Q6IHsgdmFsdWU6IGUyLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSwgdGFyZ2V0OiB7IHZhbHVlOiByMiwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0sIGlkZW50aWZpZXI6IHsgdmFsdWU6IGkyLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSwgYWN0aXZlOiB7IHZhbHVlOiBvMiwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0sIHg6IHsgdmFsdWU6IGEyLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSwgeTogeyB2YWx1ZTogdTIsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LCBkeDogeyB2YWx1ZTogYzIsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LCBkeTogeyB2YWx1ZTogZjIsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LCBfOiB7IHZhbHVlOiBzMiB9IH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHNlKHQyKSB7CiAgICAgICAgcmV0dXJuICF0Mi5jdHJsS2V5ICYmICF0Mi5idXR0b247CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Tm9kZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBoZSh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PSBuMiA/IHsgeDogdDIueCwgeTogdDIueSB9IDogbjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGUoKSB7CiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyB8fCAib250b3VjaHN0YXJ0IiBpbiB0aGlzOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHBlKHQyLCBuMiwgZTIpIHsKICAgICAgICB0Mi5wcm90b3R5cGUgPSBuMi5wcm90b3R5cGUgPSBlMiwgZTIuY29uc3RydWN0b3IgPSB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBnZSh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSBPYmplY3QuY3JlYXRlKHQyLnByb3RvdHlwZSk7CiAgICAgICAgZm9yICh2YXIgcjIgaW4gbjIpCiAgICAgICAgICBlMltyMl0gPSBuMltyMl07CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHllKCkgewogICAgICB9CiAgICAgIGZlLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0MiA9IHRoaXMuXy5vbi5hcHBseSh0aGlzLl8sIGFyZ3VtZW50cyk7CiAgICAgICAgcmV0dXJuIHQyID09PSB0aGlzLl8gPyB0aGlzIDogdDI7CiAgICAgIH07CiAgICAgIHZhciB2ZSA9IDAuNywgX2UgPSAxIC8gdmUsIGJlID0gIlxccyooWystXT9cXGQrKVxccyoiLCBtZSA9ICJcXHMqKFsrLV0/KD86XFxkKlxcLik/XFxkKyg/OltlRV1bKy1dP1xcZCspPylcXHMqIiwgeGUgPSAiXFxzKihbKy1dPyg/OlxcZCpcXC4pP1xcZCsoPzpbZUVdWystXT9cXGQrKT8pJVxccyoiLCB3ZSA9IC9eIyhbMC05YS1mXXszLDh9KSQvLCBNZSA9IG5ldyBSZWdFeHAoYF5yZ2JcXCgke2JlfSwke2JlfSwke2JlfVxcKSRgKSwgVGUgPSBuZXcgUmVnRXhwKGBecmdiXFwoJHt4ZX0sJHt4ZX0sJHt4ZX1cXCkkYCksIEFlID0gbmV3IFJlZ0V4cChgXnJnYmFcXCgke2JlfSwke2JlfSwke2JlfSwke21lfVxcKSRgKSwgU2UgPSBuZXcgUmVnRXhwKGBecmdiYVxcKCR7eGV9LCR7eGV9LCR7eGV9LCR7bWV9XFwpJGApLCBFZSA9IG5ldyBSZWdFeHAoYF5oc2xcXCgke21lfSwke3hlfSwke3hlfVxcKSRgKSwgTmUgPSBuZXcgUmVnRXhwKGBeaHNsYVxcKCR7bWV9LCR7eGV9LCR7eGV9LCR7bWV9XFwpJGApLCBrZSA9IHsgYWxpY2VibHVlOiAxNTc5MjM4MywgYW50aXF1ZXdoaXRlOiAxNjQ0NDM3NSwgYXF1YTogNjU1MzUsIGFxdWFtYXJpbmU6IDgzODg1NjQsIGF6dXJlOiAxNTc5NDE3NSwgYmVpZ2U6IDE2MTE5MjYwLCBiaXNxdWU6IDE2NzcwMjQ0LCBibGFjazogMCwgYmxhbmNoZWRhbG1vbmQ6IDE2NzcyMDQ1LCBibHVlOiAyNTUsIGJsdWV2aW9sZXQ6IDkwNTUyMDIsIGJyb3duOiAxMDgyNDIzNCwgYnVybHl3b29kOiAxNDU5NjIzMSwgY2FkZXRibHVlOiA2MjY2NTI4LCBjaGFydHJldXNlOiA4Mzg4MzUyLCBjaG9jb2xhdGU6IDEzNzg5NDcwLCBjb3JhbDogMTY3NDQyNzIsIGNvcm5mbG93ZXJibHVlOiA2NTkxOTgxLCBjb3Juc2lsazogMTY3NzUzODgsIGNyaW1zb246IDE0NDIzMTAwLCBjeWFuOiA2NTUzNSwgZGFya2JsdWU6IDEzOSwgZGFya2N5YW46IDM1NzIzLCBkYXJrZ29sZGVucm9kOiAxMjA5MjkzOSwgZGFya2dyYXk6IDExMTE5MDE3LCBkYXJrZ3JlZW46IDI1NjAwLCBkYXJrZ3JleTogMTExMTkwMTcsIGRhcmtraGFraTogMTI0MzMyNTksIGRhcmttYWdlbnRhOiA5MTA5NjQzLCBkYXJrb2xpdmVncmVlbjogNTU5Nzk5OSwgZGFya29yYW5nZTogMTY3NDc1MjAsIGRhcmtvcmNoaWQ6IDEwMDQwMDEyLCBkYXJrcmVkOiA5MTA5NTA0LCBkYXJrc2FsbW9uOiAxNTMwODQxMCwgZGFya3NlYWdyZWVuOiA5NDE5OTE5LCBkYXJrc2xhdGVibHVlOiA0NzM0MzQ3LCBkYXJrc2xhdGVncmF5OiAzMTAwNDk1LCBkYXJrc2xhdGVncmV5OiAzMTAwNDk1LCBkYXJrdHVycXVvaXNlOiA1Mjk0NSwgZGFya3Zpb2xldDogOTY5OTUzOSwgZGVlcHBpbms6IDE2NzE2OTQ3LCBkZWVwc2t5Ymx1ZTogNDkxNTEsIGRpbWdyYXk6IDY5MDgyNjUsIGRpbWdyZXk6IDY5MDgyNjUsIGRvZGdlcmJsdWU6IDIwMDMxOTksIGZpcmVicmljazogMTE2NzQxNDYsIGZsb3JhbHdoaXRlOiAxNjc3NTkyMCwgZm9yZXN0Z3JlZW46IDIyNjM4NDIsIGZ1Y2hzaWE6IDE2NzExOTM1LCBnYWluc2Jvcm86IDE0NDc0NDYwLCBnaG9zdHdoaXRlOiAxNjMxNjY3MSwgZ29sZDogMTY3NjY3MjAsIGdvbGRlbnJvZDogMTQzMjkxMjAsIGdyYXk6IDg0MjE1MDQsIGdyZWVuOiAzMjc2OCwgZ3JlZW55ZWxsb3c6IDExNDAzMDU1LCBncmV5OiA4NDIxNTA0LCBob25leWRldzogMTU3OTQxNjAsIGhvdHBpbms6IDE2NzM4NzQwLCBpbmRpYW5yZWQ6IDEzNDU4NTI0LCBpbmRpZ286IDQ5MTUzMzAsIGl2b3J5OiAxNjc3NzIwMCwga2hha2k6IDE1Nzg3NjYwLCBsYXZlbmRlcjogMTUxMzI0MTAsIGxhdmVuZGVyYmx1c2g6IDE2NzczMzY1LCBsYXduZ3JlZW46IDgxOTA5NzYsIGxlbW9uY2hpZmZvbjogMTY3NzU4ODUsIGxpZ2h0Ymx1ZTogMTEzOTMyNTQsIGxpZ2h0Y29yYWw6IDE1NzYxNTM2LCBsaWdodGN5YW46IDE0NzQ1NTk5LCBsaWdodGdvbGRlbnJvZHllbGxvdzogMTY0NDgyMTAsIGxpZ2h0Z3JheTogMTM4ODIzMjMsIGxpZ2h0Z3JlZW46IDk0OTgyNTYsIGxpZ2h0Z3JleTogMTM4ODIzMjMsIGxpZ2h0cGluazogMTY3NTg0NjUsIGxpZ2h0c2FsbW9uOiAxNjc1Mjc2MiwgbGlnaHRzZWFncmVlbjogMjE0Mjg5MCwgbGlnaHRza3libHVlOiA4OTAwMzQ2LCBsaWdodHNsYXRlZ3JheTogNzgzMzc1MywgbGlnaHRzbGF0ZWdyZXk6IDc4MzM3NTMsIGxpZ2h0c3RlZWxibHVlOiAxMTU4NDczNCwgbGlnaHR5ZWxsb3c6IDE2Nzc3MTg0LCBsaW1lOiA2NTI4MCwgbGltZWdyZWVuOiAzMzI5MzMwLCBsaW5lbjogMTY0NDU2NzAsIG1hZ2VudGE6IDE2NzExOTM1LCBtYXJvb246IDgzODg2MDgsIG1lZGl1bWFxdWFtYXJpbmU6IDY3MzczMjIsIG1lZGl1bWJsdWU6IDIwNSwgbWVkaXVtb3JjaGlkOiAxMjIxMTY2NywgbWVkaXVtcHVycGxlOiA5NjYyNjgzLCBtZWRpdW1zZWFncmVlbjogMzk3ODA5NywgbWVkaXVtc2xhdGVibHVlOiA4MDg3NzkwLCBtZWRpdW1zcHJpbmdncmVlbjogNjQxNTQsIG1lZGl1bXR1cnF1b2lzZTogNDc3MjMwMCwgbWVkaXVtdmlvbGV0cmVkOiAxMzA0NzE3MywgbWlkbmlnaHRibHVlOiAxNjQ0OTEyLCBtaW50Y3JlYW06IDE2MTIxODUwLCBtaXN0eXJvc2U6IDE2NzcwMjczLCBtb2NjYXNpbjogMTY3NzAyMjksIG5hdmFqb3doaXRlOiAxNjc2ODY4NSwgbmF2eTogMTI4LCBvbGRsYWNlOiAxNjY0MzU1OCwgb2xpdmU6IDg0MjEzNzYsIG9saXZlZHJhYjogNzA0ODczOSwgb3JhbmdlOiAxNjc1MzkyMCwgb3JhbmdlcmVkOiAxNjcyOTM0NCwgb3JjaGlkOiAxNDMxNTczNCwgcGFsZWdvbGRlbnJvZDogMTU2NTcxMzAsIHBhbGVncmVlbjogMTAwMjU4ODAsIHBhbGV0dXJxdW9pc2U6IDExNTI5OTY2LCBwYWxldmlvbGV0cmVkOiAxNDM4MTIwMywgcGFwYXlhd2hpcDogMTY3NzMwNzcsIHBlYWNocHVmZjogMTY3Njc2NzMsIHBlcnU6IDEzNDY4OTkxLCBwaW5rOiAxNjc2MTAzNSwgcGx1bTogMTQ1MjQ2MzcsIHBvd2RlcmJsdWU6IDExNTkxOTEwLCBwdXJwbGU6IDgzODg3MzYsIHJlYmVjY2FwdXJwbGU6IDY2OTc4ODEsIHJlZDogMTY3MTE2ODAsIHJvc3licm93bjogMTIzNTc1MTksIHJveWFsYmx1ZTogNDI4Njk0NSwgc2FkZGxlYnJvd246IDkxMjcxODcsIHNhbG1vbjogMTY0MTY4ODIsIHNhbmR5YnJvd246IDE2MDMyODY0LCBzZWFncmVlbjogMzA1MDMyNywgc2Vhc2hlbGw6IDE2Nzc0NjM4LCBzaWVubmE6IDEwNTA2Nzk3LCBzaWx2ZXI6IDEyNjMyMjU2LCBza3libHVlOiA4OTAwMzMxLCBzbGF0ZWJsdWU6IDY5NzAwNjEsIHNsYXRlZ3JheTogNzM3Mjk0NCwgc2xhdGVncmV5OiA3MzcyOTQ0LCBzbm93OiAxNjc3NTkzMCwgc3ByaW5nZ3JlZW46IDY1NDA3LCBzdGVlbGJsdWU6IDQ2MjA5ODAsIHRhbjogMTM4MDg3ODAsIHRlYWw6IDMyODk2LCB0aGlzdGxlOiAxNDIwNDg4OCwgdG9tYXRvOiAxNjczNzA5NSwgdHVycXVvaXNlOiA0MjUxODU2LCB2aW9sZXQ6IDE1NjMxMDg2LCB3aGVhdDogMTYxMTMzMzEsIHdoaXRlOiAxNjc3NzIxNSwgd2hpdGVzbW9rZTogMTYxMTkyODUsIHllbGxvdzogMTY3NzY5NjAsIHllbGxvd2dyZWVuOiAxMDE0NTA3NCB9OwogICAgICBmdW5jdGlvbiBDZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZ2IoKS5mb3JtYXRIZXgoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBQZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZ2IoKS5mb3JtYXRSZ2IoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB6ZSh0MikgewogICAgICAgIHZhciBuMiwgZTI7CiAgICAgICAgcmV0dXJuIHQyID0gKHQyICsgIiIpLnRyaW0oKS50b0xvd2VyQ2FzZSgpLCAobjIgPSB3ZS5leGVjKHQyKSkgPyAoZTIgPSBuMlsxXS5sZW5ndGgsIG4yID0gcGFyc2VJbnQobjJbMV0sIDE2KSwgNiA9PT0gZTIgPyAkZShuMikgOiAzID09PSBlMiA/IG5ldyBxZShuMiA+PiA4ICYgMTUgfCBuMiA+PiA0ICYgMjQwLCBuMiA+PiA0ICYgMTUgfCAyNDAgJiBuMiwgKDE1ICYgbjIpIDw8IDQgfCAxNSAmIG4yLCAxKSA6IDggPT09IGUyID8gRGUobjIgPj4gMjQgJiAyNTUsIG4yID4+IDE2ICYgMjU1LCBuMiA+PiA4ICYgMjU1LCAoMjU1ICYgbjIpIC8gMjU1KSA6IDQgPT09IGUyID8gRGUobjIgPj4gMTIgJiAxNSB8IG4yID4+IDggJiAyNDAsIG4yID4+IDggJiAxNSB8IG4yID4+IDQgJiAyNDAsIG4yID4+IDQgJiAxNSB8IDI0MCAmIG4yLCAoKDE1ICYgbjIpIDw8IDQgfCAxNSAmIG4yKSAvIDI1NSkgOiBudWxsKSA6IChuMiA9IE1lLmV4ZWModDIpKSA/IG5ldyBxZShuMlsxXSwgbjJbMl0sIG4yWzNdLCAxKSA6IChuMiA9IFRlLmV4ZWModDIpKSA/IG5ldyBxZSgyNTUgKiBuMlsxXSAvIDEwMCwgMjU1ICogbjJbMl0gLyAxMDAsIDI1NSAqIG4yWzNdIC8gMTAwLCAxKSA6IChuMiA9IEFlLmV4ZWModDIpKSA/IERlKG4yWzFdLCBuMlsyXSwgbjJbM10sIG4yWzRdKSA6IChuMiA9IFNlLmV4ZWModDIpKSA/IERlKDI1NSAqIG4yWzFdIC8gMTAwLCAyNTUgKiBuMlsyXSAvIDEwMCwgMjU1ICogbjJbM10gLyAxMDAsIG4yWzRdKSA6IChuMiA9IEVlLmV4ZWModDIpKSA/IExlKG4yWzFdLCBuMlsyXSAvIDEwMCwgbjJbM10gLyAxMDAsIDEpIDogKG4yID0gTmUuZXhlYyh0MikpID8gTGUobjJbMV0sIG4yWzJdIC8gMTAwLCBuMlszXSAvIDEwMCwgbjJbNF0pIDoga2UuaGFzT3duUHJvcGVydHkodDIpID8gJGUoa2VbdDJdKSA6ICJ0cmFuc3BhcmVudCIgPT09IHQyID8gbmV3IHFlKE5hTiwgTmFOLCBOYU4sIDApIDogbnVsbDsKICAgICAgfQogICAgICBmdW5jdGlvbiAkZSh0MikgewogICAgICAgIHJldHVybiBuZXcgcWUodDIgPj4gMTYgJiAyNTUsIHQyID4+IDggJiAyNTUsIDI1NSAmIHQyLCAxKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBEZSh0MiwgbjIsIGUyLCByMikgewogICAgICAgIHJldHVybiByMiA8PSAwICYmICh0MiA9IG4yID0gZTIgPSBOYU4pLCBuZXcgcWUodDIsIG4yLCBlMiwgcjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJlKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyIGluc3RhbmNlb2YgeWUgfHwgKHQyID0gemUodDIpKSwgdDIgPyBuZXcgcWUoKHQyID0gdDIucmdiKCkpLnIsIHQyLmcsIHQyLmIsIHQyLm9wYWNpdHkpIDogbmV3IHFlKCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRmUodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICByZXR1cm4gMSA9PT0gYXJndW1lbnRzLmxlbmd0aCA/IFJlKHQyKSA6IG5ldyBxZSh0MiwgbjIsIGUyLCBudWxsID09IHIyID8gMSA6IHIyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBxZSh0MiwgbjIsIGUyLCByMikgewogICAgICAgIHRoaXMuciA9ICt0MiwgdGhpcy5nID0gK24yLCB0aGlzLmIgPSArZTIsIHRoaXMub3BhY2l0eSA9ICtyMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBVZSgpIHsKICAgICAgICByZXR1cm4gYCMke1llKHRoaXMucil9JHtZZSh0aGlzLmcpfSR7WWUodGhpcy5iKX1gOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEllKCkgewogICAgICAgIGNvbnN0IHQyID0gT2UodGhpcy5vcGFjaXR5KTsKICAgICAgICByZXR1cm4gYCR7MSA9PT0gdDIgPyAicmdiKCIgOiAicmdiYSgifSR7QmUodGhpcy5yKX0sICR7QmUodGhpcy5nKX0sICR7QmUodGhpcy5iKX0kezEgPT09IHQyID8gIikiIDogYCwgJHt0Mn0pYH1gOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE9lKHQyKSB7CiAgICAgICAgcmV0dXJuIGlzTmFOKHQyKSA/IDEgOiBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB0MikpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEJlKHQyKSB7CiAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZCh0MikgfHwgMCkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFllKHQyKSB7CiAgICAgICAgcmV0dXJuICgodDIgPSBCZSh0MikpIDwgMTYgPyAiMCIgOiAiIikgKyB0Mi50b1N0cmluZygxNik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTGUodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICByZXR1cm4gcjIgPD0gMCA/IHQyID0gbjIgPSBlMiA9IE5hTiA6IGUyIDw9IDAgfHwgZTIgPj0gMSA/IHQyID0gbjIgPSBOYU4gOiBuMiA8PSAwICYmICh0MiA9IE5hTiksIG5ldyBYZSh0MiwgbjIsIGUyLCByMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gamUodDIpIHsKICAgICAgICBpZiAodDIgaW5zdGFuY2VvZiBYZSkKICAgICAgICAgIHJldHVybiBuZXcgWGUodDIuaCwgdDIucywgdDIubCwgdDIub3BhY2l0eSk7CiAgICAgICAgaWYgKHQyIGluc3RhbmNlb2YgeWUgfHwgKHQyID0gemUodDIpKSwgIXQyKQogICAgICAgICAgcmV0dXJuIG5ldyBYZSgpOwogICAgICAgIGlmICh0MiBpbnN0YW5jZW9mIFhlKQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIHZhciBuMiA9ICh0MiA9IHQyLnJnYigpKS5yIC8gMjU1LCBlMiA9IHQyLmcgLyAyNTUsIHIyID0gdDIuYiAvIDI1NSwgaTIgPSBNYXRoLm1pbihuMiwgZTIsIHIyKSwgbzIgPSBNYXRoLm1heChuMiwgZTIsIHIyKSwgYTIgPSBOYU4sIHUyID0gbzIgLSBpMiwgYzIgPSAobzIgKyBpMikgLyAyOwogICAgICAgIHJldHVybiB1MiA/IChhMiA9IG4yID09PSBvMiA/IChlMiAtIHIyKSAvIHUyICsgNiAqIChlMiA8IHIyKSA6IGUyID09PSBvMiA/IChyMiAtIG4yKSAvIHUyICsgMiA6IChuMiAtIGUyKSAvIHUyICsgNCwgdTIgLz0gYzIgPCAwLjUgPyBvMiArIGkyIDogMiAtIG8yIC0gaTIsIGEyICo9IDYwKSA6IHUyID0gYzIgPiAwICYmIGMyIDwgMSA/IDAgOiBhMiwgbmV3IFhlKGEyLCB1MiwgYzIsIHQyLm9wYWNpdHkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEhlKHQyLCBuMiwgZTIsIHIyKSB7CiAgICAgICAgcmV0dXJuIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggPyBqZSh0MikgOiBuZXcgWGUodDIsIG4yLCBlMiwgbnVsbCA9PSByMiA/IDEgOiByMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWGUodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICB0aGlzLmggPSArdDIsIHRoaXMucyA9ICtuMiwgdGhpcy5sID0gK2UyLCB0aGlzLm9wYWNpdHkgPSArcjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gR2UodDIpIHsKICAgICAgICByZXR1cm4gKHQyID0gKHQyIHx8IDApICUgMzYwKSA8IDAgPyB0MiArIDM2MCA6IHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFZlKHQyKSB7CiAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHQyIHx8IDApKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXZSh0MiwgbjIsIGUyKSB7CiAgICAgICAgcmV0dXJuIDI1NSAqICh0MiA8IDYwID8gbjIgKyAoZTIgLSBuMikgKiB0MiAvIDYwIDogdDIgPCAxODAgPyBlMiA6IHQyIDwgMjQwID8gbjIgKyAoZTIgLSBuMikgKiAoMjQwIC0gdDIpIC8gNjAgOiBuMik7CiAgICAgIH0KICAgICAgcGUoeWUsIHplLCB7IGNvcHkodDIpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLCB0aGlzLCB0Mik7CiAgICAgIH0sIGRpc3BsYXlhYmxlKCkgewogICAgICAgIHJldHVybiB0aGlzLnJnYigpLmRpc3BsYXlhYmxlKCk7CiAgICAgIH0sIGhleDogQ2UsIGZvcm1hdEhleDogQ2UsIGZvcm1hdEhleDg6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLnJnYigpLmZvcm1hdEhleDgoKTsKICAgICAgfSwgZm9ybWF0SHNsOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gamUodGhpcykuZm9ybWF0SHNsKCk7CiAgICAgIH0sIGZvcm1hdFJnYjogUGUsIHRvU3RyaW5nOiBQZSB9KSwgcGUocWUsIEZlLCBnZSh5ZSwgeyBicmlnaHRlcih0MikgewogICAgICAgIHJldHVybiB0MiA9IG51bGwgPT0gdDIgPyBfZSA6IE1hdGgucG93KF9lLCB0MiksIG5ldyBxZSh0aGlzLnIgKiB0MiwgdGhpcy5nICogdDIsIHRoaXMuYiAqIHQyLCB0aGlzLm9wYWNpdHkpOwogICAgICB9LCBkYXJrZXIodDIpIHsKICAgICAgICByZXR1cm4gdDIgPSBudWxsID09IHQyID8gdmUgOiBNYXRoLnBvdyh2ZSwgdDIpLCBuZXcgcWUodGhpcy5yICogdDIsIHRoaXMuZyAqIHQyLCB0aGlzLmIgKiB0MiwgdGhpcy5vcGFjaXR5KTsKICAgICAgfSwgcmdiKCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LCBjbGFtcCgpIHsKICAgICAgICByZXR1cm4gbmV3IHFlKEJlKHRoaXMuciksIEJlKHRoaXMuZyksIEJlKHRoaXMuYiksIE9lKHRoaXMub3BhY2l0eSkpOwogICAgICB9LCBkaXNwbGF5YWJsZSgpIHsKICAgICAgICByZXR1cm4gLTAuNSA8PSB0aGlzLnIgJiYgdGhpcy5yIDwgMjU1LjUgJiYgLTAuNSA8PSB0aGlzLmcgJiYgdGhpcy5nIDwgMjU1LjUgJiYgLTAuNSA8PSB0aGlzLmIgJiYgdGhpcy5iIDwgMjU1LjUgJiYgMCA8PSB0aGlzLm9wYWNpdHkgJiYgdGhpcy5vcGFjaXR5IDw9IDE7CiAgICAgIH0sIGhleDogVWUsIGZvcm1hdEhleDogVWUsIGZvcm1hdEhleDg6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBgIyR7WWUodGhpcy5yKX0ke1llKHRoaXMuZyl9JHtZZSh0aGlzLmIpfSR7WWUoMjU1ICogKGlzTmFOKHRoaXMub3BhY2l0eSkgPyAxIDogdGhpcy5vcGFjaXR5KSl9YDsKICAgICAgfSwgZm9ybWF0UmdiOiBJZSwgdG9TdHJpbmc6IEllIH0pKSwgcGUoWGUsIEhlLCBnZSh5ZSwgeyBicmlnaHRlcih0MikgewogICAgICAgIHJldHVybiB0MiA9IG51bGwgPT0gdDIgPyBfZSA6IE1hdGgucG93KF9lLCB0MiksIG5ldyBYZSh0aGlzLmgsIHRoaXMucywgdGhpcy5sICogdDIsIHRoaXMub3BhY2l0eSk7CiAgICAgIH0sIGRhcmtlcih0MikgewogICAgICAgIHJldHVybiB0MiA9IG51bGwgPT0gdDIgPyB2ZSA6IE1hdGgucG93KHZlLCB0MiksIG5ldyBYZSh0aGlzLmgsIHRoaXMucywgdGhpcy5sICogdDIsIHRoaXMub3BhY2l0eSk7CiAgICAgIH0sIHJnYigpIHsKICAgICAgICB2YXIgdDIgPSB0aGlzLmggJSAzNjAgKyAzNjAgKiAodGhpcy5oIDwgMCksIG4yID0gaXNOYU4odDIpIHx8IGlzTmFOKHRoaXMucykgPyAwIDogdGhpcy5zLCBlMiA9IHRoaXMubCwgcjIgPSBlMiArIChlMiA8IDAuNSA/IGUyIDogMSAtIGUyKSAqIG4yLCBpMiA9IDIgKiBlMiAtIHIyOwogICAgICAgIHJldHVybiBuZXcgcWUoV2UodDIgPj0gMjQwID8gdDIgLSAyNDAgOiB0MiArIDEyMCwgaTIsIHIyKSwgV2UodDIsIGkyLCByMiksIFdlKHQyIDwgMTIwID8gdDIgKyAyNDAgOiB0MiAtIDEyMCwgaTIsIHIyKSwgdGhpcy5vcGFjaXR5KTsKICAgICAgfSwgY2xhbXAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBYZShHZSh0aGlzLmgpLCBWZSh0aGlzLnMpLCBWZSh0aGlzLmwpLCBPZSh0aGlzLm9wYWNpdHkpKTsKICAgICAgfSwgZGlzcGxheWFibGUoKSB7CiAgICAgICAgcmV0dXJuICgwIDw9IHRoaXMucyAmJiB0aGlzLnMgPD0gMSB8fCBpc05hTih0aGlzLnMpKSAmJiAwIDw9IHRoaXMubCAmJiB0aGlzLmwgPD0gMSAmJiAwIDw9IHRoaXMub3BhY2l0eSAmJiB0aGlzLm9wYWNpdHkgPD0gMTsKICAgICAgfSwgZm9ybWF0SHNsKCkgewogICAgICAgIGNvbnN0IHQyID0gT2UodGhpcy5vcGFjaXR5KTsKICAgICAgICByZXR1cm4gYCR7MSA9PT0gdDIgPyAiaHNsKCIgOiAiaHNsYSgifSR7R2UodGhpcy5oKX0sICR7MTAwICogVmUodGhpcy5zKX0lLCAkezEwMCAqIFZlKHRoaXMubCl9JSR7MSA9PT0gdDIgPyAiKSIgOiBgLCAke3QyfSlgfWA7CiAgICAgIH0gfSkpOwogICAgICBjb25zdCBaZSA9IE1hdGguUEkgLyAxODAsIEtlID0gMTgwIC8gTWF0aC5QSSwgUWUgPSAwLjk2NDIyLCBKZSA9IDEsIHRyID0gMC44MjUyMSwgbnIgPSA0IC8gMjksIGVyID0gNiAvIDI5LCByciA9IDMgKiBlciAqIGVyLCBpciA9IGVyICogZXIgKiBlcjsKICAgICAgZnVuY3Rpb24gb3IodDIpIHsKICAgICAgICBpZiAodDIgaW5zdGFuY2VvZiB1cikKICAgICAgICAgIHJldHVybiBuZXcgdXIodDIubCwgdDIuYSwgdDIuYiwgdDIub3BhY2l0eSk7CiAgICAgICAgaWYgKHQyIGluc3RhbmNlb2YgcHIpCiAgICAgICAgICByZXR1cm4gZ3IodDIpOwogICAgICAgIHQyIGluc3RhbmNlb2YgcWUgfHwgKHQyID0gUmUodDIpKTsKICAgICAgICB2YXIgbjIsIGUyLCByMiA9IGxyKHQyLnIpLCBpMiA9IGxyKHQyLmcpLCBvMiA9IGxyKHQyLmIpLCBhMiA9IGNyKCgwLjIyMjUwNDUgKiByMiArIDAuNzE2ODc4NiAqIGkyICsgMC4wNjA2MTY5ICogbzIpIC8gSmUpOwogICAgICAgIHJldHVybiByMiA9PT0gaTIgJiYgaTIgPT09IG8yID8gbjIgPSBlMiA9IGEyIDogKG4yID0gY3IoKDAuNDM2MDc0NyAqIHIyICsgMC4zODUwNjQ5ICogaTIgKyAwLjE0MzA4MDQgKiBvMikgLyBRZSksIGUyID0gY3IoKDAuMDEzOTMyMiAqIHIyICsgMC4wOTcxMDQ1ICogaTIgKyAwLjcxNDE3MzMgKiBvMikgLyB0cikpLCBuZXcgdXIoMTE2ICogYTIgLSAxNiwgNTAwICogKG4yIC0gYTIpLCAyMDAgKiAoYTIgLSBlMiksIHQyLm9wYWNpdHkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGFyKHQyLCBuMiwgZTIsIHIyKSB7CiAgICAgICAgcmV0dXJuIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggPyBvcih0MikgOiBuZXcgdXIodDIsIG4yLCBlMiwgbnVsbCA9PSByMiA/IDEgOiByMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdXIodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICB0aGlzLmwgPSArdDIsIHRoaXMuYSA9ICtuMiwgdGhpcy5iID0gK2UyLCB0aGlzLm9wYWNpdHkgPSArcjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3IodDIpIHsKICAgICAgICByZXR1cm4gdDIgPiBpciA/IE1hdGgucG93KHQyLCAxIC8gMykgOiB0MiAvIHJyICsgbnI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZnIodDIpIHsKICAgICAgICByZXR1cm4gdDIgPiBlciA/IHQyICogdDIgKiB0MiA6IHJyICogKHQyIC0gbnIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHNyKHQyKSB7CiAgICAgICAgcmV0dXJuIDI1NSAqICh0MiA8PSAzMTMwOGUtNyA/IDEyLjkyICogdDIgOiAxLjA1NSAqIE1hdGgucG93KHQyLCAxIC8gMi40KSAtIDAuMDU1KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBscih0MikgewogICAgICAgIHJldHVybiAodDIgLz0gMjU1KSA8PSAwLjA0MDQ1ID8gdDIgLyAxMi45MiA6IE1hdGgucG93KCh0MiArIDAuMDU1KSAvIDEuMDU1LCAyLjQpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGhyKHQyKSB7CiAgICAgICAgaWYgKHQyIGluc3RhbmNlb2YgcHIpCiAgICAgICAgICByZXR1cm4gbmV3IHByKHQyLmgsIHQyLmMsIHQyLmwsIHQyLm9wYWNpdHkpOwogICAgICAgIGlmICh0MiBpbnN0YW5jZW9mIHVyIHx8ICh0MiA9IG9yKHQyKSksIDAgPT09IHQyLmEgJiYgMCA9PT0gdDIuYikKICAgICAgICAgIHJldHVybiBuZXcgcHIoTmFOLCAwIDwgdDIubCAmJiB0Mi5sIDwgMTAwID8gMCA6IE5hTiwgdDIubCwgdDIub3BhY2l0eSk7CiAgICAgICAgdmFyIG4yID0gTWF0aC5hdGFuMih0Mi5iLCB0Mi5hKSAqIEtlOwogICAgICAgIHJldHVybiBuZXcgcHIobjIgPCAwID8gbjIgKyAzNjAgOiBuMiwgTWF0aC5zcXJ0KHQyLmEgKiB0Mi5hICsgdDIuYiAqIHQyLmIpLCB0Mi5sLCB0Mi5vcGFjaXR5KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBkcih0MiwgbjIsIGUyLCByMikgewogICAgICAgIHJldHVybiAxID09PSBhcmd1bWVudHMubGVuZ3RoID8gaHIodDIpIDogbmV3IHByKHQyLCBuMiwgZTIsIG51bGwgPT0gcjIgPyAxIDogcjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHByKHQyLCBuMiwgZTIsIHIyKSB7CiAgICAgICAgdGhpcy5oID0gK3QyLCB0aGlzLmMgPSArbjIsIHRoaXMubCA9ICtlMiwgdGhpcy5vcGFjaXR5ID0gK3IyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGdyKHQyKSB7CiAgICAgICAgaWYgKGlzTmFOKHQyLmgpKQogICAgICAgICAgcmV0dXJuIG5ldyB1cih0Mi5sLCAwLCAwLCB0Mi5vcGFjaXR5KTsKICAgICAgICB2YXIgbjIgPSB0Mi5oICogWmU7CiAgICAgICAgcmV0dXJuIG5ldyB1cih0Mi5sLCBNYXRoLmNvcyhuMikgKiB0Mi5jLCBNYXRoLnNpbihuMikgKiB0Mi5jLCB0Mi5vcGFjaXR5KTsKICAgICAgfQogICAgICBwZSh1ciwgYXIsIGdlKHllLCB7IGJyaWdodGVyKHQyKSB7CiAgICAgICAgcmV0dXJuIG5ldyB1cih0aGlzLmwgKyAxOCAqIChudWxsID09IHQyID8gMSA6IHQyKSwgdGhpcy5hLCB0aGlzLmIsIHRoaXMub3BhY2l0eSk7CiAgICAgIH0sIGRhcmtlcih0MikgewogICAgICAgIHJldHVybiBuZXcgdXIodGhpcy5sIC0gMTggKiAobnVsbCA9PSB0MiA/IDEgOiB0MiksIHRoaXMuYSwgdGhpcy5iLCB0aGlzLm9wYWNpdHkpOwogICAgICB9LCByZ2IoKSB7CiAgICAgICAgdmFyIHQyID0gKHRoaXMubCArIDE2KSAvIDExNiwgbjIgPSBpc05hTih0aGlzLmEpID8gdDIgOiB0MiArIHRoaXMuYSAvIDUwMCwgZTIgPSBpc05hTih0aGlzLmIpID8gdDIgOiB0MiAtIHRoaXMuYiAvIDIwMDsKICAgICAgICByZXR1cm4gbmV3IHFlKHNyKDMuMTMzODU2MSAqIChuMiA9IFFlICogZnIobjIpKSAtIDEuNjE2ODY2NyAqICh0MiA9IEplICogZnIodDIpKSAtIDAuNDkwNjE0NiAqIChlMiA9IHRyICogZnIoZTIpKSksIHNyKC0wLjk3ODc2ODQgKiBuMiArIDEuOTE2MTQxNSAqIHQyICsgMC4wMzM0NTQgKiBlMiksIHNyKDAuMDcxOTQ1MyAqIG4yIC0gMC4yMjg5OTE0ICogdDIgKyAxLjQwNTI0MjcgKiBlMiksIHRoaXMub3BhY2l0eSk7CiAgICAgIH0gfSkpLCBwZShwciwgZHIsIGdlKHllLCB7IGJyaWdodGVyKHQyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBwcih0aGlzLmgsIHRoaXMuYywgdGhpcy5sICsgMTggKiAobnVsbCA9PSB0MiA/IDEgOiB0MiksIHRoaXMub3BhY2l0eSk7CiAgICAgIH0sIGRhcmtlcih0MikgewogICAgICAgIHJldHVybiBuZXcgcHIodGhpcy5oLCB0aGlzLmMsIHRoaXMubCAtIDE4ICogKG51bGwgPT0gdDIgPyAxIDogdDIpLCB0aGlzLm9wYWNpdHkpOwogICAgICB9LCByZ2IoKSB7CiAgICAgICAgcmV0dXJuIGdyKHRoaXMpLnJnYigpOwogICAgICB9IH0pKTsKICAgICAgdmFyIHlyID0gLTAuMTQ4NjEsIHZyID0gMS43ODI3NywgX3IgPSAtMC4yOTIyNywgYnIgPSAtMC45MDY0OSwgbXIgPSAxLjk3Mjk0LCB4ciA9IG1yICogYnIsIHdyID0gbXIgKiB2ciwgTXIgPSB2ciAqIF9yIC0gYnIgKiB5cjsKICAgICAgZnVuY3Rpb24gVHIodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICByZXR1cm4gMSA9PT0gYXJndW1lbnRzLmxlbmd0aCA/IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICBpZiAodDMgaW5zdGFuY2VvZiBBcikKICAgICAgICAgICAgcmV0dXJuIG5ldyBBcih0My5oLCB0My5zLCB0My5sLCB0My5vcGFjaXR5KTsKICAgICAgICAgIHQzIGluc3RhbmNlb2YgcWUgfHwgKHQzID0gUmUodDMpKTsKICAgICAgICAgIHZhciBuMyA9IHQzLnIgLyAyNTUsIGUzID0gdDMuZyAvIDI1NSwgcjMgPSB0My5iIC8gMjU1LCBpMiA9IChNciAqIHIzICsgeHIgKiBuMyAtIHdyICogZTMpIC8gKE1yICsgeHIgLSB3ciksIG8yID0gcjMgLSBpMiwgYTIgPSAobXIgKiAoZTMgLSBpMikgLSBfciAqIG8yKSAvIGJyLCB1MiA9IE1hdGguc3FydChhMiAqIGEyICsgbzIgKiBvMikgLyAobXIgKiBpMiAqICgxIC0gaTIpKSwgYzIgPSB1MiA/IE1hdGguYXRhbjIoYTIsIG8yKSAqIEtlIC0gMTIwIDogTmFOOwogICAgICAgICAgcmV0dXJuIG5ldyBBcihjMiA8IDAgPyBjMiArIDM2MCA6IGMyLCB1MiwgaTIsIHQzLm9wYWNpdHkpOwogICAgICAgIH0odDIpIDogbmV3IEFyKHQyLCBuMiwgZTIsIG51bGwgPT0gcjIgPyAxIDogcjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEFyKHQyLCBuMiwgZTIsIHIyKSB7CiAgICAgICAgdGhpcy5oID0gK3QyLCB0aGlzLnMgPSArbjIsIHRoaXMubCA9ICtlMiwgdGhpcy5vcGFjaXR5ID0gK3IyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFNyKHQyLCBuMiwgZTIsIHIyLCBpMikgewogICAgICAgIHZhciBvMiA9IHQyICogdDIsIGEyID0gbzIgKiB0MjsKICAgICAgICByZXR1cm4gKCgxIC0gMyAqIHQyICsgMyAqIG8yIC0gYTIpICogbjIgKyAoNCAtIDYgKiBvMiArIDMgKiBhMikgKiBlMiArICgxICsgMyAqIHQyICsgMyAqIG8yIC0gMyAqIGEyKSAqIHIyICsgYTIgKiBpMikgLyA2OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEVyKHQyKSB7CiAgICAgICAgdmFyIG4yID0gdDIubGVuZ3RoIC0gMTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHZhciByMiA9IGUyIDw9IDAgPyBlMiA9IDAgOiBlMiA+PSAxID8gKGUyID0gMSwgbjIgLSAxKSA6IE1hdGguZmxvb3IoZTIgKiBuMiksIGkyID0gdDJbcjJdLCBvMiA9IHQyW3IyICsgMV0sIGEyID0gcjIgPiAwID8gdDJbcjIgLSAxXSA6IDIgKiBpMiAtIG8yLCB1MiA9IHIyIDwgbjIgLSAxID8gdDJbcjIgKyAyXSA6IDIgKiBvMiAtIGkyOwogICAgICAgICAgcmV0dXJuIFNyKChlMiAtIHIyIC8gbjIpICogbjIsIGEyLCBpMiwgbzIsIHUyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE5yKHQyKSB7CiAgICAgICAgdmFyIG4yID0gdDIubGVuZ3RoOwogICAgICAgIHJldHVybiBmdW5jdGlvbihlMikgewogICAgICAgICAgdmFyIHIyID0gTWF0aC5mbG9vcigoKGUyICU9IDEpIDwgMCA/ICsrZTIgOiBlMikgKiBuMiksIGkyID0gdDJbKHIyICsgbjIgLSAxKSAlIG4yXSwgbzIgPSB0MltyMiAlIG4yXSwgYTIgPSB0MlsocjIgKyAxKSAlIG4yXSwgdTIgPSB0MlsocjIgKyAyKSAlIG4yXTsKICAgICAgICAgIHJldHVybiBTcigoZTIgLSByMiAvIG4yKSAqIG4yLCBpMiwgbzIsIGEyLCB1Mik7CiAgICAgICAgfTsKICAgICAgfQogICAgICBwZShBciwgVHIsIGdlKHllLCB7IGJyaWdodGVyKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyID0gbnVsbCA9PSB0MiA/IF9lIDogTWF0aC5wb3coX2UsIHQyKSwgbmV3IEFyKHRoaXMuaCwgdGhpcy5zLCB0aGlzLmwgKiB0MiwgdGhpcy5vcGFjaXR5KTsKICAgICAgfSwgZGFya2VyKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyID0gbnVsbCA9PSB0MiA/IHZlIDogTWF0aC5wb3codmUsIHQyKSwgbmV3IEFyKHRoaXMuaCwgdGhpcy5zLCB0aGlzLmwgKiB0MiwgdGhpcy5vcGFjaXR5KTsKICAgICAgfSwgcmdiKCkgewogICAgICAgIHZhciB0MiA9IGlzTmFOKHRoaXMuaCkgPyAwIDogKHRoaXMuaCArIDEyMCkgKiBaZSwgbjIgPSArdGhpcy5sLCBlMiA9IGlzTmFOKHRoaXMucykgPyAwIDogdGhpcy5zICogbjIgKiAoMSAtIG4yKSwgcjIgPSBNYXRoLmNvcyh0MiksIGkyID0gTWF0aC5zaW4odDIpOwogICAgICAgIHJldHVybiBuZXcgcWUoMjU1ICogKG4yICsgZTIgKiAoeXIgKiByMiArIHZyICogaTIpKSwgMjU1ICogKG4yICsgZTIgKiAoX3IgKiByMiArIGJyICogaTIpKSwgMjU1ICogKG4yICsgZTIgKiAobXIgKiByMikpLCB0aGlzLm9wYWNpdHkpOwogICAgICB9IH0pKTsKICAgICAgdmFyIGtyID0gKHQyKSA9PiAoKSA9PiB0MjsKICAgICAgZnVuY3Rpb24gQ3IodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdDIgKyBlMiAqIG4yOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUHIodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gbjIgLSB0MjsKICAgICAgICByZXR1cm4gZTIgPyBDcih0MiwgZTIgPiAxODAgfHwgZTIgPCAtMTgwID8gZTIgLSAzNjAgKiBNYXRoLnJvdW5kKGUyIC8gMzYwKSA6IGUyKSA6IGtyKGlzTmFOKHQyKSA/IG4yIDogdDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHpyKHQyKSB7CiAgICAgICAgcmV0dXJuIDEgPT0gKHQyID0gK3QyKSA/ICRyIDogZnVuY3Rpb24objIsIGUyKSB7CiAgICAgICAgICByZXR1cm4gZTIgLSBuMiA/IGZ1bmN0aW9uKHQzLCBuMywgZTMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzID0gTWF0aC5wb3codDMsIGUzKSwgbjMgPSBNYXRoLnBvdyhuMywgZTMpIC0gdDMsIGUzID0gMSAvIGUzLCBmdW5jdGlvbihyMikgewogICAgICAgICAgICAgIHJldHVybiBNYXRoLnBvdyh0MyArIHIyICogbjMsIGUzKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0objIsIGUyLCB0MikgOiBrcihpc05hTihuMikgPyBlMiA6IG4yKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uICRyKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IG4yIC0gdDI7CiAgICAgICAgcmV0dXJuIGUyID8gQ3IodDIsIGUyKSA6IGtyKGlzTmFOKHQyKSA/IG4yIDogdDIpOwogICAgICB9CiAgICAgIHZhciBEciA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgdmFyIGUyID0genIobjIpOwogICAgICAgIGZ1bmN0aW9uIHIyKHQzLCBuMykgewogICAgICAgICAgdmFyIHIzID0gZTIoKHQzID0gRmUodDMpKS5yLCAobjMgPSBGZShuMykpLnIpLCBpMiA9IGUyKHQzLmcsIG4zLmcpLCBvMiA9IGUyKHQzLmIsIG4zLmIpLCBhMiA9ICRyKHQzLm9wYWNpdHksIG4zLm9wYWNpdHkpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG40KSB7CiAgICAgICAgICAgIHJldHVybiB0My5yID0gcjMobjQpLCB0My5nID0gaTIobjQpLCB0My5iID0gbzIobjQpLCB0My5vcGFjaXR5ID0gYTIobjQpLCB0MyArICIiOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHIyLmdhbW1hID0gdDIsIHIyOwogICAgICB9KDEpOwogICAgICBmdW5jdGlvbiBScih0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihuMikgewogICAgICAgICAgdmFyIGUyLCByMiwgaTIgPSBuMi5sZW5ndGgsIG8yID0gbmV3IEFycmF5KGkyKSwgYTIgPSBuZXcgQXJyYXkoaTIpLCB1MiA9IG5ldyBBcnJheShpMik7CiAgICAgICAgICBmb3IgKGUyID0gMDsgZTIgPCBpMjsgKytlMikKICAgICAgICAgICAgcjIgPSBGZShuMltlMl0pLCBvMltlMl0gPSByMi5yIHx8IDAsIGEyW2UyXSA9IHIyLmcgfHwgMCwgdTJbZTJdID0gcjIuYiB8fCAwOwogICAgICAgICAgcmV0dXJuIG8yID0gdDIobzIpLCBhMiA9IHQyKGEyKSwgdTIgPSB0Mih1MiksIHIyLm9wYWNpdHkgPSAxLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gcjIuciA9IG8yKHQzKSwgcjIuZyA9IGEyKHQzKSwgcjIuYiA9IHUyKHQzKSwgcjIgKyAiIjsKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgRnIgPSBScihFciksIHFyID0gUnIoTnIpOwogICAgICBmdW5jdGlvbiBVcih0MiwgbjIpIHsKICAgICAgICBuMiB8fCAobjIgPSBbXSk7CiAgICAgICAgdmFyIGUyLCByMiA9IHQyID8gTWF0aC5taW4objIubGVuZ3RoLCB0Mi5sZW5ndGgpIDogMCwgaTIgPSBuMi5zbGljZSgpOwogICAgICAgIHJldHVybiBmdW5jdGlvbihvMikgewogICAgICAgICAgZm9yIChlMiA9IDA7IGUyIDwgcjI7ICsrZTIpCiAgICAgICAgICAgIGkyW2UyXSA9IHQyW2UyXSAqICgxIC0gbzIpICsgbjJbZTJdICogbzI7CiAgICAgICAgICByZXR1cm4gaTI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJcih0MikgewogICAgICAgIHJldHVybiBBcnJheUJ1ZmZlci5pc1ZpZXcodDIpICYmICEodDIgaW5zdGFuY2VvZiBEYXRhVmlldyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gT3IodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyLCByMiA9IG4yID8gbjIubGVuZ3RoIDogMCwgaTIgPSB0MiA/IE1hdGgubWluKHIyLCB0Mi5sZW5ndGgpIDogMCwgbzIgPSBuZXcgQXJyYXkoaTIpLCBhMiA9IG5ldyBBcnJheShyMik7CiAgICAgICAgZm9yIChlMiA9IDA7IGUyIDwgaTI7ICsrZTIpCiAgICAgICAgICBvMltlMl0gPSBHcih0MltlMl0sIG4yW2UyXSk7CiAgICAgICAgZm9yICg7IGUyIDwgcjI7ICsrZTIpCiAgICAgICAgICBhMltlMl0gPSBuMltlMl07CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICBmb3IgKGUyID0gMDsgZTIgPCBpMjsgKytlMikKICAgICAgICAgICAgYTJbZTJdID0gbzJbZTJdKHQzKTsKICAgICAgICAgIHJldHVybiBhMjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEJyKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpOwogICAgICAgIHJldHVybiB0MiA9ICt0MiwgbjIgPSArbjIsIGZ1bmN0aW9uKHIyKSB7CiAgICAgICAgICByZXR1cm4gZTIuc2V0VGltZSh0MiAqICgxIC0gcjIpICsgbjIgKiByMiksIGUyOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWXIodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHQyID0gK3QyLCBuMiA9ICtuMiwgZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiB0MiAqICgxIC0gZTIpICsgbjIgKiBlMjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIExyKHQyLCBuMikgewogICAgICAgIHZhciBlMiwgcjIgPSB7fSwgaTIgPSB7fTsKICAgICAgICBmb3IgKGUyIGluIG51bGwgIT09IHQyICYmICJvYmplY3QiID09IHR5cGVvZiB0MiB8fCAodDIgPSB7fSksIG51bGwgIT09IG4yICYmICJvYmplY3QiID09IHR5cGVvZiBuMiB8fCAobjIgPSB7fSksIG4yKQogICAgICAgICAgZTIgaW4gdDIgPyByMltlMl0gPSBHcih0MltlMl0sIG4yW2UyXSkgOiBpMltlMl0gPSBuMltlMl07CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICBmb3IgKGUyIGluIHIyKQogICAgICAgICAgICBpMltlMl0gPSByMltlMl0odDMpOwogICAgICAgICAgcmV0dXJuIGkyOwogICAgICAgIH07CiAgICAgIH0KICAgICAgdmFyIGpyID0gL1stK10/KD86XGQrXC4/XGQqfFwuP1xkKykoPzpbZUVdWy0rXT9cZCspPy9nLCBIciA9IG5ldyBSZWdFeHAoanIuc291cmNlLCAiZyIpOwogICAgICBmdW5jdGlvbiBYcih0MiwgbjIpIHsKICAgICAgICB2YXIgZTIsIHIyLCBpMiwgbzIgPSBqci5sYXN0SW5kZXggPSBIci5sYXN0SW5kZXggPSAwLCBhMiA9IC0xLCB1MiA9IFtdLCBjMiA9IFtdOwogICAgICAgIGZvciAodDIgKz0gIiIsIG4yICs9ICIiOyAoZTIgPSBqci5leGVjKHQyKSkgJiYgKHIyID0gSHIuZXhlYyhuMikpOyApCiAgICAgICAgICAoaTIgPSByMi5pbmRleCkgPiBvMiAmJiAoaTIgPSBuMi5zbGljZShvMiwgaTIpLCB1MlthMl0gPyB1MlthMl0gKz0gaTIgOiB1MlsrK2EyXSA9IGkyKSwgKGUyID0gZTJbMF0pID09PSAocjIgPSByMlswXSkgPyB1MlthMl0gPyB1MlthMl0gKz0gcjIgOiB1MlsrK2EyXSA9IHIyIDogKHUyWysrYTJdID0gbnVsbCwgYzIucHVzaCh7IGk6IGEyLCB4OiBZcihlMiwgcjIpIH0pKSwgbzIgPSBIci5sYXN0SW5kZXg7CiAgICAgICAgcmV0dXJuIG8yIDwgbjIubGVuZ3RoICYmIChpMiA9IG4yLnNsaWNlKG8yKSwgdTJbYTJdID8gdTJbYTJdICs9IGkyIDogdTJbKythMl0gPSBpMiksIHUyLmxlbmd0aCA8IDIgPyBjMlswXSA/IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICAgIHJldHVybiB0MyhuMykgKyAiIjsKICAgICAgICAgIH07CiAgICAgICAgfShjMlswXS54KSA6IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9OwogICAgICAgIH0objIpIDogKG4yID0gYzIubGVuZ3RoLCBmdW5jdGlvbih0MykgewogICAgICAgICAgZm9yICh2YXIgZTMsIHIzID0gMDsgcjMgPCBuMjsgKytyMykKICAgICAgICAgICAgdTJbKGUzID0gYzJbcjNdKS5pXSA9IGUzLngodDMpOwogICAgICAgICAgcmV0dXJuIHUyLmpvaW4oIiIpOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEdyKHQyLCBuMikgewogICAgICAgIHZhciBlMiwgcjIgPSB0eXBlb2YgbjI7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gbjIgfHwgImJvb2xlYW4iID09PSByMiA/IGtyKG4yKSA6ICgibnVtYmVyIiA9PT0gcjIgPyBZciA6ICJzdHJpbmciID09PSByMiA/IChlMiA9IHplKG4yKSkgPyAobjIgPSBlMiwgRHIpIDogWHIgOiBuMiBpbnN0YW5jZW9mIHplID8gRHIgOiBuMiBpbnN0YW5jZW9mIERhdGUgPyBCciA6IElyKG4yKSA/IFVyIDogQXJyYXkuaXNBcnJheShuMikgPyBPciA6ICJmdW5jdGlvbiIgIT0gdHlwZW9mIG4yLnZhbHVlT2YgJiYgImZ1bmN0aW9uIiAhPSB0eXBlb2YgbjIudG9TdHJpbmcgfHwgaXNOYU4objIpID8gTHIgOiBZcikodDIsIG4yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBWcih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gdDIgPSArdDIsIG4yID0gK24yLCBmdW5jdGlvbihlMikgewogICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodDIgKiAoMSAtIGUyKSArIG4yICogZTIpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgdmFyIFdyLCBaciA9IDE4MCAvIE1hdGguUEksIEtyID0geyB0cmFuc2xhdGVYOiAwLCB0cmFuc2xhdGVZOiAwLCByb3RhdGU6IDAsIHNrZXdYOiAwLCBzY2FsZVg6IDEsIHNjYWxlWTogMSB9OwogICAgICBmdW5jdGlvbiBRcih0MiwgbjIsIGUyLCByMiwgaTIsIG8yKSB7CiAgICAgICAgdmFyIGEyLCB1MiwgYzI7CiAgICAgICAgcmV0dXJuIChhMiA9IE1hdGguc3FydCh0MiAqIHQyICsgbjIgKiBuMikpICYmICh0MiAvPSBhMiwgbjIgLz0gYTIpLCAoYzIgPSB0MiAqIGUyICsgbjIgKiByMikgJiYgKGUyIC09IHQyICogYzIsIHIyIC09IG4yICogYzIpLCAodTIgPSBNYXRoLnNxcnQoZTIgKiBlMiArIHIyICogcjIpKSAmJiAoZTIgLz0gdTIsIHIyIC89IHUyLCBjMiAvPSB1MiksIHQyICogcjIgPCBuMiAqIGUyICYmICh0MiA9IC10MiwgbjIgPSAtbjIsIGMyID0gLWMyLCBhMiA9IC1hMiksIHsgdHJhbnNsYXRlWDogaTIsIHRyYW5zbGF0ZVk6IG8yLCByb3RhdGU6IE1hdGguYXRhbjIobjIsIHQyKSAqIFpyLCBza2V3WDogTWF0aC5hdGFuKGMyKSAqIFpyLCBzY2FsZVg6IGEyLCBzY2FsZVk6IHUyIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSnIodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICBmdW5jdGlvbiBpMih0MykgewogICAgICAgICAgcmV0dXJuIHQzLmxlbmd0aCA/IHQzLnBvcCgpICsgIiAiIDogIiI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmdW5jdGlvbihvMiwgYTIpIHsKICAgICAgICAgIHZhciB1MiA9IFtdLCBjMiA9IFtdOwogICAgICAgICAgcmV0dXJuIG8yID0gdDIobzIpLCBhMiA9IHQyKGEyKSwgZnVuY3Rpb24odDMsIHIzLCBpMywgbzMsIGEzLCB1MykgewogICAgICAgICAgICBpZiAodDMgIT09IGkzIHx8IHIzICE9PSBvMykgewogICAgICAgICAgICAgIHZhciBjMyA9IGEzLnB1c2goInRyYW5zbGF0ZSgiLCBudWxsLCBuMiwgbnVsbCwgZTIpOwogICAgICAgICAgICAgIHUzLnB1c2goeyBpOiBjMyAtIDQsIHg6IFlyKHQzLCBpMykgfSwgeyBpOiBjMyAtIDIsIHg6IFlyKHIzLCBvMykgfSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIChpMyB8fCBvMykgJiYgYTMucHVzaCgidHJhbnNsYXRlKCIgKyBpMyArIG4yICsgbzMgKyBlMik7CiAgICAgICAgICB9KG8yLnRyYW5zbGF0ZVgsIG8yLnRyYW5zbGF0ZVksIGEyLnRyYW5zbGF0ZVgsIGEyLnRyYW5zbGF0ZVksIHUyLCBjMiksIGZ1bmN0aW9uKHQzLCBuMywgZTMsIG8zKSB7CiAgICAgICAgICAgIHQzICE9PSBuMyA/ICh0MyAtIG4zID4gMTgwID8gbjMgKz0gMzYwIDogbjMgLSB0MyA+IDE4MCAmJiAodDMgKz0gMzYwKSwgbzMucHVzaCh7IGk6IGUzLnB1c2goaTIoZTMpICsgInJvdGF0ZSgiLCBudWxsLCByMikgLSAyLCB4OiBZcih0MywgbjMpIH0pKSA6IG4zICYmIGUzLnB1c2goaTIoZTMpICsgInJvdGF0ZSgiICsgbjMgKyByMik7CiAgICAgICAgICB9KG8yLnJvdGF0ZSwgYTIucm90YXRlLCB1MiwgYzIpLCBmdW5jdGlvbih0MywgbjMsIGUzLCBvMykgewogICAgICAgICAgICB0MyAhPT0gbjMgPyBvMy5wdXNoKHsgaTogZTMucHVzaChpMihlMykgKyAic2tld1goIiwgbnVsbCwgcjIpIC0gMiwgeDogWXIodDMsIG4zKSB9KSA6IG4zICYmIGUzLnB1c2goaTIoZTMpICsgInNrZXdYKCIgKyBuMyArIHIyKTsKICAgICAgICAgIH0obzIuc2tld1gsIGEyLnNrZXdYLCB1MiwgYzIpLCBmdW5jdGlvbih0MywgbjMsIGUzLCByMywgbzMsIGEzKSB7CiAgICAgICAgICAgIGlmICh0MyAhPT0gZTMgfHwgbjMgIT09IHIzKSB7CiAgICAgICAgICAgICAgdmFyIHUzID0gbzMucHVzaChpMihvMykgKyAic2NhbGUoIiwgbnVsbCwgIiwiLCBudWxsLCAiKSIpOwogICAgICAgICAgICAgIGEzLnB1c2goeyBpOiB1MyAtIDQsIHg6IFlyKHQzLCBlMykgfSwgeyBpOiB1MyAtIDIsIHg6IFlyKG4zLCByMykgfSk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIDEgPT09IGUzICYmIDEgPT09IHIzIHx8IG8zLnB1c2goaTIobzMpICsgInNjYWxlKCIgKyBlMyArICIsIiArIHIzICsgIikiKTsKICAgICAgICAgIH0obzIuc2NhbGVYLCBvMi5zY2FsZVksIGEyLnNjYWxlWCwgYTIuc2NhbGVZLCB1MiwgYzIpLCBvMiA9IGEyID0gbnVsbCwgZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgZm9yICh2YXIgbjMsIGUzID0gLTEsIHIzID0gYzIubGVuZ3RoOyArK2UzIDwgcjM7ICkKICAgICAgICAgICAgICB1MlsobjMgPSBjMltlM10pLmldID0gbjMueCh0Myk7CiAgICAgICAgICAgIHJldHVybiB1Mi5qb2luKCIiKTsKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgdGkgPSBKcihmdW5jdGlvbih0MikgewogICAgICAgIGNvbnN0IG4yID0gbmV3ICgiZnVuY3Rpb24iID09IHR5cGVvZiBET01NYXRyaXggPyBET01NYXRyaXggOiBXZWJLaXRDU1NNYXRyaXgpKHQyICsgIiIpOwogICAgICAgIHJldHVybiBuMi5pc0lkZW50aXR5ID8gS3IgOiBRcihuMi5hLCBuMi5iLCBuMi5jLCBuMi5kLCBuMi5lLCBuMi5mKTsKICAgICAgfSwgInB4LCAiLCAicHgpIiwgImRlZykiKSwgbmkgPSBKcihmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBudWxsID09IHQyID8gS3IgOiAoV3IgfHwgKFdyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIsICJnIikpLCBXci5zZXRBdHRyaWJ1dGUoInRyYW5zZm9ybSIsIHQyKSwgKHQyID0gV3IudHJhbnNmb3JtLmJhc2VWYWwuY29uc29saWRhdGUoKSkgPyBRcigodDIgPSB0Mi5tYXRyaXgpLmEsIHQyLmIsIHQyLmMsIHQyLmQsIHQyLmUsIHQyLmYpIDogS3IpOwogICAgICB9LCAiLCAiLCAiKSIsICIpIik7CiAgICAgIGZ1bmN0aW9uIGVpKHQyKSB7CiAgICAgICAgcmV0dXJuICgodDIgPSBNYXRoLmV4cCh0MikpICsgMSAvIHQyKSAvIDI7CiAgICAgIH0KICAgICAgdmFyIHJpID0gZnVuY3Rpb24gdDIobjIsIGUyLCByMikgewogICAgICAgIGZ1bmN0aW9uIGkyKHQzLCBpMykgewogICAgICAgICAgdmFyIG8yLCBhMiwgdTIgPSB0M1swXSwgYzIgPSB0M1sxXSwgZjIgPSB0M1syXSwgczIgPSBpM1swXSwgbDIgPSBpM1sxXSwgaDIgPSBpM1syXSwgZDIgPSBzMiAtIHUyLCBwMiA9IGwyIC0gYzIsIGcyID0gZDIgKiBkMiArIHAyICogcDI7CiAgICAgICAgICBpZiAoZzIgPCAxZS0xMikKICAgICAgICAgICAgYTIgPSBNYXRoLmxvZyhoMiAvIGYyKSAvIG4yLCBvMiA9IGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIFt1MiArIHQ0ICogZDIsIGMyICsgdDQgKiBwMiwgZjIgKiBNYXRoLmV4cChuMiAqIHQ0ICogYTIpXTsKICAgICAgICAgICAgfTsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgeTIgPSBNYXRoLnNxcnQoZzIpLCB2MiA9IChoMiAqIGgyIC0gZjIgKiBmMiArIHIyICogZzIpIC8gKDIgKiBmMiAqIGUyICogeTIpLCBfMiA9IChoMiAqIGgyIC0gZjIgKiBmMiAtIHIyICogZzIpIC8gKDIgKiBoMiAqIGUyICogeTIpLCBiMiA9IE1hdGgubG9nKE1hdGguc3FydCh2MiAqIHYyICsgMSkgLSB2MiksIG0yID0gTWF0aC5sb2coTWF0aC5zcXJ0KF8yICogXzIgKyAxKSAtIF8yKTsKICAgICAgICAgICAgYTIgPSAobTIgLSBiMikgLyBuMiwgbzIgPSBmdW5jdGlvbih0NCkgewogICAgICAgICAgICAgIHZhciByMyA9IHQ0ICogYTIsIGk0ID0gZWkoYjIpLCBvMyA9IGYyIC8gKGUyICogeTIpICogKGk0ICogZnVuY3Rpb24odDUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoKHQ1ID0gTWF0aC5leHAoMiAqIHQ1KSkgLSAxKSAvICh0NSArIDEpOwogICAgICAgICAgICAgIH0objIgKiByMyArIGIyKSAtIGZ1bmN0aW9uKHQ1KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKCh0NSA9IE1hdGguZXhwKHQ1KSkgLSAxIC8gdDUpIC8gMjsKICAgICAgICAgICAgICB9KGIyKSk7CiAgICAgICAgICAgICAgcmV0dXJuIFt1MiArIG8zICogZDIsIGMyICsgbzMgKiBwMiwgZjIgKiBpNCAvIGVpKG4yICogcjMgKyBiMildOwogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG8yLmR1cmF0aW9uID0gMWUzICogYTIgKiBuMiAvIE1hdGguU1FSVDIsIG8yOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIucmhvID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHZhciBlMyA9IE1hdGgubWF4KDFlLTMsICtuMyksIHIzID0gZTMgKiBlMzsKICAgICAgICAgIHJldHVybiB0MihlMywgcjMsIHIzICogcjMpOwogICAgICAgIH0sIGkyOwogICAgICB9KE1hdGguU1FSVDIsIDIsIDQpOwogICAgICBmdW5jdGlvbiBpaSh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihuMiwgZTIpIHsKICAgICAgICAgIHZhciByMiA9IHQyKChuMiA9IEhlKG4yKSkuaCwgKGUyID0gSGUoZTIpKS5oKSwgaTIgPSAkcihuMi5zLCBlMi5zKSwgbzIgPSAkcihuMi5sLCBlMi5sKSwgYTIgPSAkcihuMi5vcGFjaXR5LCBlMi5vcGFjaXR5KTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gbjIuaCA9IHIyKHQzKSwgbjIucyA9IGkyKHQzKSwgbjIubCA9IG8yKHQzKSwgbjIub3BhY2l0eSA9IGEyKHQzKSwgbjIgKyAiIjsKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgb2kgPSBpaShQciksIGFpID0gaWkoJHIpOwogICAgICBmdW5jdGlvbiB1aSh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihuMiwgZTIpIHsKICAgICAgICAgIHZhciByMiA9IHQyKChuMiA9IGRyKG4yKSkuaCwgKGUyID0gZHIoZTIpKS5oKSwgaTIgPSAkcihuMi5jLCBlMi5jKSwgbzIgPSAkcihuMi5sLCBlMi5sKSwgYTIgPSAkcihuMi5vcGFjaXR5LCBlMi5vcGFjaXR5KTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gbjIuaCA9IHIyKHQzKSwgbjIuYyA9IGkyKHQzKSwgbjIubCA9IG8yKHQzKSwgbjIub3BhY2l0eSA9IGEyKHQzKSwgbjIgKyAiIjsKICAgICAgICAgIH07CiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgY2kgPSB1aShQciksIGZpID0gdWkoJHIpOwogICAgICBmdW5jdGlvbiBzaSh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbiBuMihlMikgewogICAgICAgICAgZnVuY3Rpb24gcjIobjMsIHIzKSB7CiAgICAgICAgICAgIHZhciBpMiA9IHQyKChuMyA9IFRyKG4zKSkuaCwgKHIzID0gVHIocjMpKS5oKSwgbzIgPSAkcihuMy5zLCByMy5zKSwgYTIgPSAkcihuMy5sLCByMy5sKSwgdTIgPSAkcihuMy5vcGFjaXR5LCByMy5vcGFjaXR5KTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG4zLmggPSBpMih0MyksIG4zLnMgPSBvMih0MyksIG4zLmwgPSBhMihNYXRoLnBvdyh0MywgZTIpKSwgbjMub3BhY2l0eSA9IHUyKHQzKSwgbjMgKyAiIjsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBlMiA9ICtlMiwgcjIuZ2FtbWEgPSBuMiwgcjI7CiAgICAgICAgfSgxKTsKICAgICAgfQogICAgICB2YXIgbGkgPSBzaShQciksIGhpID0gc2koJHIpOwogICAgICBmdW5jdGlvbiBkaSh0MiwgbjIpIHsKICAgICAgICB2b2lkIDAgPT09IG4yICYmIChuMiA9IHQyLCB0MiA9IEdyKTsKICAgICAgICBmb3IgKHZhciBlMiA9IDAsIHIyID0gbjIubGVuZ3RoIC0gMSwgaTIgPSBuMlswXSwgbzIgPSBuZXcgQXJyYXkocjIgPCAwID8gMCA6IHIyKTsgZTIgPCByMjsgKQogICAgICAgICAgbzJbZTJdID0gdDIoaTIsIGkyID0gbjJbKytlMl0pOwogICAgICAgIHJldHVybiBmdW5jdGlvbih0MykgewogICAgICAgICAgdmFyIG4zID0gTWF0aC5tYXgoMCwgTWF0aC5taW4ocjIgLSAxLCBNYXRoLmZsb29yKHQzICo9IHIyKSkpOwogICAgICAgICAgcmV0dXJuIG8yW24zXSh0MyAtIG4zKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIHZhciBwaSwgZ2ksIHlpID0gMCwgdmkgPSAwLCBfaSA9IDAsIGJpID0gMWUzLCBtaSA9IDAsIHhpID0gMCwgd2kgPSAwLCBNaSA9ICJvYmplY3QiID09IHR5cGVvZiBwZXJmb3JtYW5jZSAmJiBwZXJmb3JtYW5jZS5ub3cgPyBwZXJmb3JtYW5jZSA6IERhdGUsIFRpID0gIm9iamVjdCIgPT0gdHlwZW9mIHdpbmRvdyAmJiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS5iaW5kKHdpbmRvdykgOiBmdW5jdGlvbih0MikgewogICAgICAgIHNldFRpbWVvdXQodDIsIDE3KTsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gQWkoKSB7CiAgICAgICAgcmV0dXJuIHhpIHx8IChUaShTaSksIHhpID0gTWkubm93KCkgKyB3aSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU2koKSB7CiAgICAgICAgeGkgPSAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEVpKCkgewogICAgICAgIHRoaXMuX2NhbGwgPSB0aGlzLl90aW1lID0gdGhpcy5fbmV4dCA9IG51bGw7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTmkodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IG5ldyBFaSgpOwogICAgICAgIHJldHVybiByMi5yZXN0YXJ0KHQyLCBuMiwgZTIpLCByMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBraSgpIHsKICAgICAgICBBaSgpLCArK3lpOwogICAgICAgIGZvciAodmFyIHQyLCBuMiA9IHBpOyBuMjsgKQogICAgICAgICAgKHQyID0geGkgLSBuMi5fdGltZSkgPj0gMCAmJiBuMi5fY2FsbC5jYWxsKHZvaWQgMCwgdDIpLCBuMiA9IG4yLl9uZXh0OwogICAgICAgIC0teWk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQ2koKSB7CiAgICAgICAgeGkgPSAobWkgPSBNaS5ub3coKSkgKyB3aSwgeWkgPSB2aSA9IDA7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGtpKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIHlpID0gMCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB0MiwgbjIsIGUyID0gcGksIHIyID0gMSAvIDA7CiAgICAgICAgICAgIGZvciAoOyBlMjsgKQogICAgICAgICAgICAgIGUyLl9jYWxsID8gKHIyID4gZTIuX3RpbWUgJiYgKHIyID0gZTIuX3RpbWUpLCB0MiA9IGUyLCBlMiA9IGUyLl9uZXh0KSA6IChuMiA9IGUyLl9uZXh0LCBlMi5fbmV4dCA9IG51bGwsIGUyID0gdDIgPyB0Mi5fbmV4dCA9IG4yIDogcGkgPSBuMik7CiAgICAgICAgICAgIGdpID0gdDIsIHppKHIyKTsKICAgICAgICAgIH0oKSwgeGkgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBQaSgpIHsKICAgICAgICB2YXIgdDIgPSBNaS5ub3coKSwgbjIgPSB0MiAtIG1pOwogICAgICAgIG4yID4gYmkgJiYgKHdpIC09IG4yLCBtaSA9IHQyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB6aSh0MikgewogICAgICAgIHlpIHx8ICh2aSAmJiAodmkgPSBjbGVhclRpbWVvdXQodmkpKSwgdDIgLSB4aSA+IDI0ID8gKHQyIDwgMSAvIDAgJiYgKHZpID0gc2V0VGltZW91dChDaSwgdDIgLSBNaS5ub3coKSAtIHdpKSksIF9pICYmIChfaSA9IGNsZWFySW50ZXJ2YWwoX2kpKSkgOiAoX2kgfHwgKG1pID0gTWkubm93KCksIF9pID0gc2V0SW50ZXJ2YWwoUGksIGJpKSksIHlpID0gMSwgVGkoQ2kpKSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gJGkodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IG5ldyBFaSgpOwogICAgICAgIHJldHVybiBuMiA9IG51bGwgPT0gbjIgPyAwIDogK24yLCByMi5yZXN0YXJ0KChlMykgPT4gewogICAgICAgICAgcjIuc3RvcCgpLCB0MihlMyArIG4yKTsKICAgICAgICB9LCBuMiwgZTIpLCByMjsKICAgICAgfQogICAgICBFaS5wcm90b3R5cGUgPSBOaS5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiBFaSwgcmVzdGFydDogZnVuY3Rpb24odDIsIG4yLCBlMikgewogICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiB0MikKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgZTIgPSAobnVsbCA9PSBlMiA/IEFpKCkgOiArZTIpICsgKG51bGwgPT0gbjIgPyAwIDogK24yKSwgdGhpcy5fbmV4dCB8fCBnaSA9PT0gdGhpcyB8fCAoZ2kgPyBnaS5fbmV4dCA9IHRoaXMgOiBwaSA9IHRoaXMsIGdpID0gdGhpcyksIHRoaXMuX2NhbGwgPSB0MiwgdGhpcy5fdGltZSA9IGUyLCB6aSgpOwogICAgICB9LCBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9jYWxsICYmICh0aGlzLl9jYWxsID0gbnVsbCwgdGhpcy5fdGltZSA9IDEgLyAwLCB6aSgpKTsKICAgICAgfSB9OwogICAgICB2YXIgRGkgPSAkdCgic3RhcnQiLCAiZW5kIiwgImNhbmNlbCIsICJpbnRlcnJ1cHQiKSwgUmkgPSBbXSwgRmkgPSAwLCBxaSA9IDEsIFVpID0gMiwgSWkgPSAzLCBPaSA9IDQsIEJpID0gNSwgWWkgPSA2OwogICAgICBmdW5jdGlvbiBMaSh0MiwgbjIsIGUyLCByMiwgaTIsIG8yKSB7CiAgICAgICAgdmFyIGEyID0gdDIuX190cmFuc2l0aW9uOwogICAgICAgIGlmIChhMikgewogICAgICAgICAgaWYgKGUyIGluIGEyKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlCiAgICAgICAgICB0Mi5fX3RyYW5zaXRpb24gPSB7fTsKICAgICAgICAhZnVuY3Rpb24odDMsIG4zLCBlMykgewogICAgICAgICAgdmFyIHIzLCBpMyA9IHQzLl9fdHJhbnNpdGlvbjsKICAgICAgICAgIGZ1bmN0aW9uIG8zKHQ0KSB7CiAgICAgICAgICAgIGUzLnN0YXRlID0gcWksIGUzLnRpbWVyLnJlc3RhcnQoYTMsIGUzLmRlbGF5LCBlMy50aW1lKSwgZTMuZGVsYXkgPD0gdDQgJiYgYTModDQgLSBlMy5kZWxheSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBhMyhvNCkgewogICAgICAgICAgICB2YXIgZjIsIHMyLCBsMiwgaDI7CiAgICAgICAgICAgIGlmIChlMy5zdGF0ZSAhPT0gcWkpCiAgICAgICAgICAgICAgcmV0dXJuIGMyKCk7CiAgICAgICAgICAgIGZvciAoZjIgaW4gaTMpCiAgICAgICAgICAgICAgaWYgKChoMiA9IGkzW2YyXSkubmFtZSA9PT0gZTMubmFtZSkgewogICAgICAgICAgICAgICAgaWYgKGgyLnN0YXRlID09PSBJaSkKICAgICAgICAgICAgICAgICAgcmV0dXJuICRpKGEzKTsKICAgICAgICAgICAgICAgIGgyLnN0YXRlID09PSBPaSA/IChoMi5zdGF0ZSA9IFlpLCBoMi50aW1lci5zdG9wKCksIGgyLm9uLmNhbGwoImludGVycnVwdCIsIHQzLCB0My5fX2RhdGFfXywgaDIuaW5kZXgsIGgyLmdyb3VwKSwgZGVsZXRlIGkzW2YyXSkgOiArZjIgPCBuMyAmJiAoaDIuc3RhdGUgPSBZaSwgaDIudGltZXIuc3RvcCgpLCBoMi5vbi5jYWxsKCJjYW5jZWwiLCB0MywgdDMuX19kYXRhX18sIGgyLmluZGV4LCBoMi5ncm91cCksIGRlbGV0ZSBpM1tmMl0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRpKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGUzLnN0YXRlID09PSBJaSAmJiAoZTMuc3RhdGUgPSBPaSwgZTMudGltZXIucmVzdGFydCh1MiwgZTMuZGVsYXksIGUzLnRpbWUpLCB1MihvNCkpOwogICAgICAgICAgICB9KSwgZTMuc3RhdGUgPSBVaSwgZTMub24uY2FsbCgic3RhcnQiLCB0MywgdDMuX19kYXRhX18sIGUzLmluZGV4LCBlMy5ncm91cCksIGUzLnN0YXRlID09PSBVaSkgewogICAgICAgICAgICAgIGZvciAoZTMuc3RhdGUgPSBJaSwgcjMgPSBuZXcgQXJyYXkobDIgPSBlMy50d2Vlbi5sZW5ndGgpLCBmMiA9IDAsIHMyID0gLTE7IGYyIDwgbDI7ICsrZjIpCiAgICAgICAgICAgICAgICAoaDIgPSBlMy50d2VlbltmMl0udmFsdWUuY2FsbCh0MywgdDMuX19kYXRhX18sIGUzLmluZGV4LCBlMy5ncm91cCkpICYmIChyM1srK3MyXSA9IGgyKTsKICAgICAgICAgICAgICByMy5sZW5ndGggPSBzMiArIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHUyKG40KSB7CiAgICAgICAgICAgIGZvciAodmFyIGk0ID0gbjQgPCBlMy5kdXJhdGlvbiA/IGUzLmVhc2UuY2FsbChudWxsLCBuNCAvIGUzLmR1cmF0aW9uKSA6IChlMy50aW1lci5yZXN0YXJ0KGMyKSwgZTMuc3RhdGUgPSBCaSwgMSksIG80ID0gLTEsIGE0ID0gcjMubGVuZ3RoOyArK280IDwgYTQ7ICkKICAgICAgICAgICAgICByM1tvNF0uY2FsbCh0MywgaTQpOwogICAgICAgICAgICBlMy5zdGF0ZSA9PT0gQmkgJiYgKGUzLm9uLmNhbGwoImVuZCIsIHQzLCB0My5fX2RhdGFfXywgZTMuaW5kZXgsIGUzLmdyb3VwKSwgYzIoKSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjMigpIHsKICAgICAgICAgICAgZm9yICh2YXIgcjQgaW4gZTMuc3RhdGUgPSBZaSwgZTMudGltZXIuc3RvcCgpLCBkZWxldGUgaTNbbjNdLCBpMykKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGRlbGV0ZSB0My5fX3RyYW5zaXRpb247CiAgICAgICAgICB9CiAgICAgICAgICBpM1tuM10gPSBlMywgZTMudGltZXIgPSBOaShvMywgMCwgZTMudGltZSk7CiAgICAgICAgfSh0MiwgZTIsIHsgbmFtZTogbjIsIGluZGV4OiByMiwgZ3JvdXA6IGkyLCBvbjogRGksIHR3ZWVuOiBSaSwgdGltZTogbzIudGltZSwgZGVsYXk6IG8yLmRlbGF5LCBkdXJhdGlvbjogbzIuZHVyYXRpb24sIGVhc2U6IG8yLmVhc2UsIHRpbWVyOiBudWxsLCBzdGF0ZTogRmkgfSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gamkodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gWGkodDIsIG4yKTsKICAgICAgICBpZiAoZTIuc3RhdGUgPiBGaSkKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidG9vIGxhdGU7IGFscmVhZHkgc2NoZWR1bGVkIik7CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEhpKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IFhpKHQyLCBuMik7CiAgICAgICAgaWYgKGUyLnN0YXRlID4gSWkpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInRvbyBsYXRlOyBhbHJlYWR5IHJ1bm5pbmciKTsKICAgICAgICByZXR1cm4gZTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWGkodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gdDIuX190cmFuc2l0aW9uOwogICAgICAgIGlmICghZTIgfHwgIShlMiA9IGUyW24yXSkpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInRyYW5zaXRpb24gbm90IGZvdW5kIik7CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEdpKHQyLCBuMikgewogICAgICAgIHZhciBlMiwgcjIsIGkyLCBvMiA9IHQyLl9fdHJhbnNpdGlvbiwgYTIgPSB0cnVlOwogICAgICAgIGlmIChvMikgewogICAgICAgICAgZm9yIChpMiBpbiBuMiA9IG51bGwgPT0gbjIgPyBudWxsIDogbjIgKyAiIiwgbzIpCiAgICAgICAgICAgIChlMiA9IG8yW2kyXSkubmFtZSA9PT0gbjIgPyAocjIgPSBlMi5zdGF0ZSA+IFVpICYmIGUyLnN0YXRlIDwgQmksIGUyLnN0YXRlID0gWWksIGUyLnRpbWVyLnN0b3AoKSwgZTIub24uY2FsbChyMiA/ICJpbnRlcnJ1cHQiIDogImNhbmNlbCIsIHQyLCB0Mi5fX2RhdGFfXywgZTIuaW5kZXgsIGUyLmdyb3VwKSwgZGVsZXRlIG8yW2kyXSkgOiBhMiA9IGZhbHNlOwogICAgICAgICAgYTIgJiYgZGVsZXRlIHQyLl9fdHJhbnNpdGlvbjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVmkodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyLCByMjsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgaTIgPSBIaSh0aGlzLCB0MiksIG8yID0gaTIudHdlZW47CiAgICAgICAgICBpZiAobzIgIT09IGUyKSB7CiAgICAgICAgICAgIGZvciAodmFyIGEyID0gMCwgdTIgPSAocjIgPSBlMiA9IG8yKS5sZW5ndGg7IGEyIDwgdTI7ICsrYTIpCiAgICAgICAgICAgICAgaWYgKHIyW2EyXS5uYW1lID09PSBuMikgewogICAgICAgICAgICAgICAgKHIyID0gcjIuc2xpY2UoKSkuc3BsaWNlKGEyLCAxKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGkyLnR3ZWVuID0gcjI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBXaSh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyLCBpMjsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgZTIpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgbzIgPSBIaSh0aGlzLCB0MiksIGEyID0gbzIudHdlZW47CiAgICAgICAgICBpZiAoYTIgIT09IHIyKSB7CiAgICAgICAgICAgIGkyID0gKHIyID0gYTIpLnNsaWNlKCk7CiAgICAgICAgICAgIGZvciAodmFyIHUyID0geyBuYW1lOiBuMiwgdmFsdWU6IGUyIH0sIGMyID0gMCwgZjIgPSBpMi5sZW5ndGg7IGMyIDwgZjI7ICsrYzIpCiAgICAgICAgICAgICAgaWYgKGkyW2MyXS5uYW1lID09PSBuMikgewogICAgICAgICAgICAgICAgaTJbYzJdID0gdTI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGMyID09PSBmMiAmJiBpMi5wdXNoKHUyKTsKICAgICAgICAgIH0KICAgICAgICAgIG8yLnR3ZWVuID0gaTI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBaaSh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gdDIuX2lkOwogICAgICAgIHJldHVybiB0Mi5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHQzID0gSGkodGhpcywgcjIpOwogICAgICAgICAgKHQzLnZhbHVlIHx8ICh0My52YWx1ZSA9IHt9KSlbbjJdID0gZTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9KSwgZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBYaSh0MywgcjIpLnZhbHVlW24yXTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEtpKHQyLCBuMikgewogICAgICAgIHZhciBlMjsKICAgICAgICByZXR1cm4gKCJudW1iZXIiID09IHR5cGVvZiBuMiA/IFlyIDogbjIgaW5zdGFuY2VvZiB6ZSA/IERyIDogKGUyID0gemUobjIpKSA/IChuMiA9IGUyLCBEcikgOiBYcikodDIsIG4yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBRaSh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHRoaXMucmVtb3ZlQXR0cmlidXRlKHQyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEppKHQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyh0Mi5zcGFjZSwgdDIubG9jYWwpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdG8odDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiwgaTIsIG8yID0gZTIgKyAiIjsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgYTIgPSB0aGlzLmdldEF0dHJpYnV0ZSh0Mik7CiAgICAgICAgICByZXR1cm4gYTIgPT09IG8yID8gbnVsbCA6IGEyID09PSByMiA/IGkyIDogaTIgPSBuMihyMiA9IGEyLCBlMik7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBubyh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyLCBpMiwgbzIgPSBlMiArICIiOwogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhMiA9IHRoaXMuZ2V0QXR0cmlidXRlTlModDIuc3BhY2UsIHQyLmxvY2FsKTsKICAgICAgICAgIHJldHVybiBhMiA9PT0gbzIgPyBudWxsIDogYTIgPT09IHIyID8gaTIgOiBpMiA9IG4yKHIyID0gYTIsIGUyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGVvKHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIsIGkyLCBvMjsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgYTIsIHUyLCBjMiA9IGUyKHRoaXMpOwogICAgICAgICAgaWYgKG51bGwgIT0gYzIpCiAgICAgICAgICAgIHJldHVybiAoYTIgPSB0aGlzLmdldEF0dHJpYnV0ZSh0MikpID09PSAodTIgPSBjMiArICIiKSA/IG51bGwgOiBhMiA9PT0gcjIgJiYgdTIgPT09IGkyID8gbzIgOiAoaTIgPSB1MiwgbzIgPSBuMihyMiA9IGEyLCBjMikpOwogICAgICAgICAgdGhpcy5yZW1vdmVBdHRyaWJ1dGUodDIpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcm8odDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiwgaTIsIG8yOwogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBhMiwgdTIsIGMyID0gZTIodGhpcyk7CiAgICAgICAgICBpZiAobnVsbCAhPSBjMikKICAgICAgICAgICAgcmV0dXJuIChhMiA9IHRoaXMuZ2V0QXR0cmlidXRlTlModDIuc3BhY2UsIHQyLmxvY2FsKSkgPT09ICh1MiA9IGMyICsgIiIpID8gbnVsbCA6IGEyID09PSByMiAmJiB1MiA9PT0gaTIgPyBvMiA6IChpMiA9IHUyLCBvMiA9IG4yKHIyID0gYTIsIGMyKSk7CiAgICAgICAgICB0aGlzLnJlbW92ZUF0dHJpYnV0ZU5TKHQyLnNwYWNlLCB0Mi5sb2NhbCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBpbyh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIsIHIyOwogICAgICAgIGZ1bmN0aW9uIGkyKCkgewogICAgICAgICAgdmFyIGkzID0gbjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIHJldHVybiBpMyAhPT0gcjIgJiYgKGUyID0gKHIyID0gaTMpICYmIC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGVOUyh0My5zcGFjZSwgdDMubG9jYWwsIG4zLmNhbGwodGhpcywgZTMpKTsKICAgICAgICAgICAgfTsKICAgICAgICAgIH0odDIsIGkzKSksIGUyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuX3ZhbHVlID0gbjIsIGkyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG9vKHQyLCBuMikgewogICAgICAgIHZhciBlMiwgcjI7CiAgICAgICAgZnVuY3Rpb24gaTIoKSB7CiAgICAgICAgICB2YXIgaTMgPSBuMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgcmV0dXJuIGkzICE9PSByMiAmJiAoZTIgPSAocjIgPSBpMykgJiYgLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSh0MywgbjMuY2FsbCh0aGlzLCBlMykpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSh0MiwgaTMpKSwgZTI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpMi5fdmFsdWUgPSBuMiwgaTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYW8odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgamkodGhpcywgdDIpLmRlbGF5ID0gK24yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiB1byh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gbjIgPSArbjIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgamkodGhpcywgdDIpLmRlbGF5ID0gbjI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjbyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICBIaSh0aGlzLCB0MikuZHVyYXRpb24gPSArbjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZvKHQyLCBuMikgewogICAgICAgIHJldHVybiBuMiA9ICtuMiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICBIaSh0aGlzLCB0MikuZHVyYXRpb24gPSBuMjsKICAgICAgICB9OwogICAgICB9CiAgICAgIHZhciBzbyA9IFduLnByb3RvdHlwZS5jb25zdHJ1Y3RvcjsKICAgICAgZnVuY3Rpb24gbG8odDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aGlzLnN0eWxlLnJlbW92ZVByb3BlcnR5KHQyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIHZhciBobyA9IDA7CiAgICAgIGZ1bmN0aW9uIHBvKHQyLCBuMiwgZTIsIHIyKSB7CiAgICAgICAgdGhpcy5fZ3JvdXBzID0gdDIsIHRoaXMuX3BhcmVudHMgPSBuMiwgdGhpcy5fbmFtZSA9IGUyLCB0aGlzLl9pZCA9IHIyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGdvKHQyKSB7CiAgICAgICAgcmV0dXJuIFduKCkudHJhbnNpdGlvbih0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24geW8oKSB7CiAgICAgICAgcmV0dXJuICsraG87CiAgICAgIH0KICAgICAgdmFyIHZvID0gV24ucHJvdG90eXBlOwogICAgICBwby5wcm90b3R5cGUgPSBnby5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiBwbywgc2VsZWN0OiBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiA9IHRoaXMuX25hbWUsIGUyID0gdGhpcy5faWQ7CiAgICAgICAgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdDIgJiYgKHQyID0ganQodDIpKTsKICAgICAgICBmb3IgKHZhciByMiA9IHRoaXMuX2dyb3VwcywgaTIgPSByMi5sZW5ndGgsIG8yID0gbmV3IEFycmF5KGkyKSwgYTIgPSAwOyBhMiA8IGkyOyArK2EyKQogICAgICAgICAgZm9yICh2YXIgdTIsIGMyLCBmMiA9IHIyW2EyXSwgczIgPSBmMi5sZW5ndGgsIGwyID0gbzJbYTJdID0gbmV3IEFycmF5KHMyKSwgaDIgPSAwOyBoMiA8IHMyOyArK2gyKQogICAgICAgICAgICAodTIgPSBmMltoMl0pICYmIChjMiA9IHQyLmNhbGwodTIsIHUyLl9fZGF0YV9fLCBoMiwgZjIpKSAmJiAoIl9fZGF0YV9fIiBpbiB1MiAmJiAoYzIuX19kYXRhX18gPSB1Mi5fX2RhdGFfXyksIGwyW2gyXSA9IGMyLCBMaShsMltoMl0sIG4yLCBlMiwgaDIsIGwyLCBYaSh1MiwgZTIpKSk7CiAgICAgICAgcmV0dXJuIG5ldyBwbyhvMiwgdGhpcy5fcGFyZW50cywgbjIsIGUyKTsKICAgICAgfSwgc2VsZWN0QWxsOiBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiA9IHRoaXMuX25hbWUsIGUyID0gdGhpcy5faWQ7CiAgICAgICAgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdDIgJiYgKHQyID0gR3QodDIpKTsKICAgICAgICBmb3IgKHZhciByMiA9IHRoaXMuX2dyb3VwcywgaTIgPSByMi5sZW5ndGgsIG8yID0gW10sIGEyID0gW10sIHUyID0gMDsgdTIgPCBpMjsgKyt1MikKICAgICAgICAgIGZvciAodmFyIGMyLCBmMiA9IHIyW3UyXSwgczIgPSBmMi5sZW5ndGgsIGwyID0gMDsgbDIgPCBzMjsgKytsMikKICAgICAgICAgICAgaWYgKGMyID0gZjJbbDJdKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaDIsIGQyID0gdDIuY2FsbChjMiwgYzIuX19kYXRhX18sIGwyLCBmMiksIHAyID0gWGkoYzIsIGUyKSwgZzIgPSAwLCB5MiA9IGQyLmxlbmd0aDsgZzIgPCB5MjsgKytnMikKICAgICAgICAgICAgICAgIChoMiA9IGQyW2cyXSkgJiYgTGkoaDIsIG4yLCBlMiwgZzIsIGQyLCBwMik7CiAgICAgICAgICAgICAgbzIucHVzaChkMiksIGEyLnB1c2goYzIpOwogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBwbyhvMiwgYTIsIG4yLCBlMik7CiAgICAgIH0sIHNlbGVjdENoaWxkOiB2by5zZWxlY3RDaGlsZCwgc2VsZWN0Q2hpbGRyZW46IHZvLnNlbGVjdENoaWxkcmVuLCBmaWx0ZXI6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgImZ1bmN0aW9uIiAhPSB0eXBlb2YgdDIgJiYgKHQyID0gVnQodDIpKTsKICAgICAgICBmb3IgKHZhciBuMiA9IHRoaXMuX2dyb3VwcywgZTIgPSBuMi5sZW5ndGgsIHIyID0gbmV3IEFycmF5KGUyKSwgaTIgPSAwOyBpMiA8IGUyOyArK2kyKQogICAgICAgICAgZm9yICh2YXIgbzIsIGEyID0gbjJbaTJdLCB1MiA9IGEyLmxlbmd0aCwgYzIgPSByMltpMl0gPSBbXSwgZjIgPSAwOyBmMiA8IHUyOyArK2YyKQogICAgICAgICAgICAobzIgPSBhMltmMl0pICYmIHQyLmNhbGwobzIsIG8yLl9fZGF0YV9fLCBmMiwgYTIpICYmIGMyLnB1c2gobzIpOwogICAgICAgIHJldHVybiBuZXcgcG8ocjIsIHRoaXMuX3BhcmVudHMsIHRoaXMuX25hbWUsIHRoaXMuX2lkKTsKICAgICAgfSwgbWVyZ2U6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgaWYgKHQyLl9pZCAhPT0gdGhpcy5faWQpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKICAgICAgICBmb3IgKHZhciBuMiA9IHRoaXMuX2dyb3VwcywgZTIgPSB0Mi5fZ3JvdXBzLCByMiA9IG4yLmxlbmd0aCwgaTIgPSBlMi5sZW5ndGgsIG8yID0gTWF0aC5taW4ocjIsIGkyKSwgYTIgPSBuZXcgQXJyYXkocjIpLCB1MiA9IDA7IHUyIDwgbzI7ICsrdTIpCiAgICAgICAgICBmb3IgKHZhciBjMiwgZjIgPSBuMlt1Ml0sIHMyID0gZTJbdTJdLCBsMiA9IGYyLmxlbmd0aCwgaDIgPSBhMlt1Ml0gPSBuZXcgQXJyYXkobDIpLCBkMiA9IDA7IGQyIDwgbDI7ICsrZDIpCiAgICAgICAgICAgIChjMiA9IGYyW2QyXSB8fCBzMltkMl0pICYmIChoMltkMl0gPSBjMik7CiAgICAgICAgZm9yICg7IHUyIDwgcjI7ICsrdTIpCiAgICAgICAgICBhMlt1Ml0gPSBuMlt1Ml07CiAgICAgICAgcmV0dXJuIG5ldyBwbyhhMiwgdGhpcy5fcGFyZW50cywgdGhpcy5fbmFtZSwgdGhpcy5faWQpOwogICAgICB9LCBzZWxlY3Rpb246IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgc28odGhpcy5fZ3JvdXBzLCB0aGlzLl9wYXJlbnRzKTsKICAgICAgfSwgdHJhbnNpdGlvbjogZnVuY3Rpb24oKSB7CiAgICAgICAgZm9yICh2YXIgdDIgPSB0aGlzLl9uYW1lLCBuMiA9IHRoaXMuX2lkLCBlMiA9IHlvKCksIHIyID0gdGhpcy5fZ3JvdXBzLCBpMiA9IHIyLmxlbmd0aCwgbzIgPSAwOyBvMiA8IGkyOyArK28yKQogICAgICAgICAgZm9yICh2YXIgYTIsIHUyID0gcjJbbzJdLCBjMiA9IHUyLmxlbmd0aCwgZjIgPSAwOyBmMiA8IGMyOyArK2YyKQogICAgICAgICAgICBpZiAoYTIgPSB1MltmMl0pIHsKICAgICAgICAgICAgICB2YXIgczIgPSBYaShhMiwgbjIpOwogICAgICAgICAgICAgIExpKGEyLCB0MiwgZTIsIGYyLCB1MiwgeyB0aW1lOiBzMi50aW1lICsgczIuZGVsYXkgKyBzMi5kdXJhdGlvbiwgZGVsYXk6IDAsIGR1cmF0aW9uOiBzMi5kdXJhdGlvbiwgZWFzZTogczIuZWFzZSB9KTsKICAgICAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgcG8ocjIsIHRoaXMuX3BhcmVudHMsIHQyLCBlMik7CiAgICAgIH0sIGNhbGw6IHZvLmNhbGwsIG5vZGVzOiB2by5ub2Rlcywgbm9kZTogdm8ubm9kZSwgc2l6ZTogdm8uc2l6ZSwgZW1wdHk6IHZvLmVtcHR5LCBlYWNoOiB2by5lYWNoLCBvbjogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gdGhpcy5faWQ7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPCAyID8gWGkodGhpcy5ub2RlKCksIGUyKS5vbi5vbih0MikgOiB0aGlzLmVhY2goZnVuY3Rpb24odDMsIG4zLCBlMykgewogICAgICAgICAgdmFyIHIyLCBpMiwgbzIgPSBmdW5jdGlvbih0NCkgewogICAgICAgICAgICByZXR1cm4gKHQ0ICsgIiIpLnRyaW0oKS5zcGxpdCgvXnxccysvKS5ldmVyeShmdW5jdGlvbih0NSkgewogICAgICAgICAgICAgIHZhciBuNCA9IHQ1LmluZGV4T2YoIi4iKTsKICAgICAgICAgICAgICByZXR1cm4gbjQgPj0gMCAmJiAodDUgPSB0NS5zbGljZSgwLCBuNCkpLCAhdDUgfHwgInN0YXJ0IiA9PT0gdDU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfShuMykgPyBqaSA6IEhpOwogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgYTIgPSBvMih0aGlzLCB0MyksIHUyID0gYTIub247CiAgICAgICAgICAgIHUyICE9PSByMiAmJiAoaTIgPSAocjIgPSB1MikuY29weSgpKS5vbihuMywgZTMpLCBhMi5vbiA9IGkyOwogICAgICAgICAgfTsKICAgICAgICB9KGUyLCB0MiwgbjIpKTsKICAgICAgfSwgYXR0cjogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gSXQodDIpLCByMiA9ICJ0cmFuc2Zvcm0iID09PSBlMiA/IG5pIDogS2k7CiAgICAgICAgcmV0dXJuIHRoaXMuYXR0clR3ZWVuKHQyLCAiZnVuY3Rpb24iID09IHR5cGVvZiBuMiA/IChlMi5sb2NhbCA/IHJvIDogZW8pKGUyLCByMiwgWmkodGhpcywgImF0dHIuIiArIHQyLCBuMikpIDogbnVsbCA9PSBuMiA/IChlMi5sb2NhbCA/IEppIDogUWkpKGUyKSA6IChlMi5sb2NhbCA/IG5vIDogdG8pKGUyLCByMiwgbjIpKTsKICAgICAgfSwgYXR0clR3ZWVuOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSAiYXR0ci4iICsgdDI7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKQogICAgICAgICAgcmV0dXJuIChlMiA9IHRoaXMudHdlZW4oZTIpKSAmJiBlMi5fdmFsdWU7CiAgICAgICAgaWYgKG51bGwgPT0gbjIpCiAgICAgICAgICByZXR1cm4gdGhpcy50d2VlbihlMiwgbnVsbCk7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIG4yKQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7CiAgICAgICAgdmFyIHIyID0gSXQodDIpOwogICAgICAgIHJldHVybiB0aGlzLnR3ZWVuKGUyLCAocjIubG9jYWwgPyBpbyA6IG9vKShyMiwgbjIpKTsKICAgICAgfSwgc3R5bGU6IGZ1bmN0aW9uKHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSAidHJhbnNmb3JtIiA9PSAodDIgKz0gIiIpID8gdGkgOiBLaTsKICAgICAgICByZXR1cm4gbnVsbCA9PSBuMiA/IHRoaXMuc3R5bGVUd2Vlbih0MiwgLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgdmFyIGUzLCByMywgaTI7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBvMiA9IF9uKHRoaXMsIHQzKSwgYTIgPSAodGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eSh0MyksIF9uKHRoaXMsIHQzKSk7CiAgICAgICAgICAgIHJldHVybiBvMiA9PT0gYTIgPyBudWxsIDogbzIgPT09IGUzICYmIGEyID09PSByMyA/IGkyIDogaTIgPSBuMyhlMyA9IG8yLCByMyA9IGEyKTsKICAgICAgICAgIH07CiAgICAgICAgfSh0MiwgcjIpKS5vbigiZW5kLnN0eWxlLiIgKyB0MiwgbG8odDIpKSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4yID8gdGhpcy5zdHlsZVR3ZWVuKHQyLCAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24odDMsIG4zLCBlMykgewogICAgICAgICAgdmFyIHIzLCBpMiwgbzI7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBhMiA9IF9uKHRoaXMsIHQzKSwgdTIgPSBlMyh0aGlzKSwgYzIgPSB1MiArICIiOwogICAgICAgICAgICByZXR1cm4gbnVsbCA9PSB1MiAmJiAodGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eSh0MyksIGMyID0gdTIgPSBfbih0aGlzLCB0MykpLCBhMiA9PT0gYzIgPyBudWxsIDogYTIgPT09IHIzICYmIGMyID09PSBpMiA/IG8yIDogKGkyID0gYzIsIG8yID0gbjMocjMgPSBhMiwgdTIpKTsKICAgICAgICAgIH07CiAgICAgICAgfSh0MiwgcjIsIFppKHRoaXMsICJzdHlsZS4iICsgdDIsIG4yKSkpLmVhY2goZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICB2YXIgZTMsIHIzLCBpMiwgbzIsIGEyID0gInN0eWxlLiIgKyBuMywgdTIgPSAiZW5kLiIgKyBhMjsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGMyID0gSGkodGhpcywgdDMpLCBmMiA9IGMyLm9uLCBzMiA9IG51bGwgPT0gYzIudmFsdWVbYTJdID8gbzIgfHwgKG8yID0gbG8objMpKSA6IHZvaWQgMDsKICAgICAgICAgICAgZjIgPT09IGUzICYmIGkyID09PSBzMiB8fCAocjMgPSAoZTMgPSBmMikuY29weSgpKS5vbih1MiwgaTIgPSBzMiksIGMyLm9uID0gcjM7CiAgICAgICAgICB9OwogICAgICAgIH0odGhpcy5faWQsIHQyKSkgOiB0aGlzLnN0eWxlVHdlZW4odDIsIGZ1bmN0aW9uKHQzLCBuMywgZTMpIHsKICAgICAgICAgIHZhciByMywgaTIsIG8yID0gZTMgKyAiIjsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGEyID0gX24odGhpcywgdDMpOwogICAgICAgICAgICByZXR1cm4gYTIgPT09IG8yID8gbnVsbCA6IGEyID09PSByMyA/IGkyIDogaTIgPSBuMyhyMyA9IGEyLCBlMyk7CiAgICAgICAgICB9OwogICAgICAgIH0odDIsIHIyLCBuMiksIGUyKS5vbigiZW5kLnN0eWxlLiIgKyB0MiwgbnVsbCk7CiAgICAgIH0sIHN0eWxlVHdlZW46IGZ1bmN0aW9uKHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSAic3R5bGUuIiArICh0MiArPSAiIik7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKQogICAgICAgICAgcmV0dXJuIChyMiA9IHRoaXMudHdlZW4ocjIpKSAmJiByMi5fdmFsdWU7CiAgICAgICAgaWYgKG51bGwgPT0gbjIpCiAgICAgICAgICByZXR1cm4gdGhpcy50d2VlbihyMiwgbnVsbCk7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIG4yKQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7CiAgICAgICAgcmV0dXJuIHRoaXMudHdlZW4ocjIsIGZ1bmN0aW9uKHQzLCBuMywgZTMpIHsKICAgICAgICAgIHZhciByMywgaTI7CiAgICAgICAgICBmdW5jdGlvbiBvMigpIHsKICAgICAgICAgICAgdmFyIG8zID0gbjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgcmV0dXJuIG8zICE9PSBpMiAmJiAocjMgPSAoaTIgPSBvMykgJiYgLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQ0LCBuNCwgZTQpIHsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ocjQpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUuc2V0UHJvcGVydHkodDQsIG40LmNhbGwodGhpcywgcjQpLCBlNCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSh0MywgbzMsIGUzKSksIHIzOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG8yLl92YWx1ZSA9IG4zLCBvMjsKICAgICAgICB9KHQyLCBuMiwgbnVsbCA9PSBlMiA/ICIiIDogZTIpKTsKICAgICAgfSwgdGV4dDogZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gdGhpcy50d2VlbigidGV4dCIsICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQyID8gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBuMiA9IHQzKHRoaXMpOwogICAgICAgICAgICB0aGlzLnRleHRDb250ZW50ID0gbnVsbCA9PSBuMiA/ICIiIDogbjI7CiAgICAgICAgICB9OwogICAgICAgIH0oWmkodGhpcywgInRleHQiLCB0MikpIDogLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRoaXMudGV4dENvbnRlbnQgPSB0MzsKICAgICAgICAgIH07CiAgICAgICAgfShudWxsID09IHQyID8gIiIgOiB0MiArICIiKSk7CiAgICAgIH0sIHRleHRUd2VlbjogZnVuY3Rpb24odDIpIHsKICAgICAgICB2YXIgbjIgPSAidGV4dCI7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxKQogICAgICAgICAgcmV0dXJuIChuMiA9IHRoaXMudHdlZW4objIpKSAmJiBuMi5fdmFsdWU7CiAgICAgICAgaWYgKG51bGwgPT0gdDIpCiAgICAgICAgICByZXR1cm4gdGhpcy50d2VlbihuMiwgbnVsbCk7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHQyKQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7CiAgICAgICAgcmV0dXJuIHRoaXMudHdlZW4objIsIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICB2YXIgbjMsIGUyOwogICAgICAgICAgZnVuY3Rpb24gcjIoKSB7CiAgICAgICAgICAgIHZhciByMyA9IHQzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIHJldHVybiByMyAhPT0gZTIgJiYgKG4zID0gKGUyID0gcjMpICYmIC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbih0NCkgewogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihuNCkgewogICAgICAgICAgICAgICAgdGhpcy50ZXh0Q29udGVudCA9IHQ0LmNhbGwodGhpcywgbjQpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0ocjMpKSwgbjM7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcjIuX3ZhbHVlID0gdDMsIHIyOwogICAgICAgIH0odDIpKTsKICAgICAgfSwgcmVtb3ZlOiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5vbigiZW5kLnJlbW92ZSIsIC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgbjIgPSB0aGlzLnBhcmVudE5vZGU7CiAgICAgICAgICAgIGZvciAodmFyIGUyIGluIHRoaXMuX190cmFuc2l0aW9uKQogICAgICAgICAgICAgIGlmICgrZTIgIT09IHQyKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBuMiAmJiBuMi5yZW1vdmVDaGlsZCh0aGlzKTsKICAgICAgICAgIH07CiAgICAgICAgfSh0aGlzLl9pZCkpOwogICAgICB9LCB0d2VlbjogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gdGhpcy5faWQ7CiAgICAgICAgaWYgKHQyICs9ICIiLCBhcmd1bWVudHMubGVuZ3RoIDwgMikgewogICAgICAgICAgZm9yICh2YXIgcjIsIGkyID0gWGkodGhpcy5ub2RlKCksIGUyKS50d2VlbiwgbzIgPSAwLCBhMiA9IGkyLmxlbmd0aDsgbzIgPCBhMjsgKytvMikKICAgICAgICAgICAgaWYgKChyMiA9IGkyW28yXSkubmFtZSA9PT0gdDIpCiAgICAgICAgICAgICAgcmV0dXJuIHIyLnZhbHVlOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmVhY2goKG51bGwgPT0gbjIgPyBWaSA6IFdpKShlMiwgdDIsIG4yKSk7CiAgICAgIH0sIGRlbGF5OiBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiA9IHRoaXMuX2lkOwogICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gdGhpcy5lYWNoKCgiZnVuY3Rpb24iID09IHR5cGVvZiB0MiA/IGFvIDogdW8pKG4yLCB0MikpIDogWGkodGhpcy5ub2RlKCksIG4yKS5kZWxheTsKICAgICAgfSwgZHVyYXRpb246IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgdmFyIG4yID0gdGhpcy5faWQ7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLmVhY2goKCJmdW5jdGlvbiIgPT0gdHlwZW9mIHQyID8gY28gOiBmbykobjIsIHQyKSkgOiBYaSh0aGlzLm5vZGUoKSwgbjIpLmR1cmF0aW9uOwogICAgICB9LCBlYXNlOiBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiA9IHRoaXMuX2lkOwogICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gdGhpcy5lYWNoKGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIG4zKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgSGkodGhpcywgdDMpLmVhc2UgPSBuMzsKICAgICAgICAgIH07CiAgICAgICAgfShuMiwgdDIpKSA6IFhpKHRoaXMubm9kZSgpLCBuMikuZWFzZTsKICAgICAgfSwgZWFzZVZhcnlpbmc6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIHQyKQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCgvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24odDMsIG4yKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBlMiA9IG4yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBlMikKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKICAgICAgICAgICAgSGkodGhpcywgdDMpLmVhc2UgPSBlMjsKICAgICAgICAgIH07CiAgICAgICAgfSh0aGlzLl9pZCwgdDIpKTsKICAgICAgfSwgZW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIsIG4yLCBlMiA9IHRoaXMsIHIyID0gZTIuX2lkLCBpMiA9IGUyLnNpemUoKTsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24obzIsIGEyKSB7CiAgICAgICAgICB2YXIgdTIgPSB7IHZhbHVlOiBhMiB9LCBjMiA9IHsgdmFsdWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAwID09IC0taTIgJiYgbzIoKTsKICAgICAgICAgIH0gfTsKICAgICAgICAgIGUyLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBlMyA9IEhpKHRoaXMsIHIyKSwgaTMgPSBlMy5vbjsKICAgICAgICAgICAgaTMgIT09IHQyICYmICgobjIgPSAodDIgPSBpMykuY29weSgpKS5fLmNhbmNlbC5wdXNoKHUyKSwgbjIuXy5pbnRlcnJ1cHQucHVzaCh1MiksIG4yLl8uZW5kLnB1c2goYzIpKSwgZTMub24gPSBuMjsKICAgICAgICAgIH0pLCAwID09PSBpMiAmJiBvMigpOwogICAgICAgIH0pOwogICAgICB9LCBbU3ltYm9sLml0ZXJhdG9yXTogdm9bU3ltYm9sLml0ZXJhdG9yXSB9OwogICAgICBmdW5jdGlvbiBfbyh0MikgewogICAgICAgIHJldHVybiAoKHQyICo9IDIpIDw9IDEgPyB0MiAqIHQyIDogLS10MiAqICgyIC0gdDIpICsgMSkgLyAyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGJvKHQyKSB7CiAgICAgICAgcmV0dXJuICgodDIgKj0gMikgPD0gMSA/IHQyICogdDIgKiB0MiA6ICh0MiAtPSAyKSAqIHQyICogdDIgKyAyKSAvIDI7CiAgICAgIH0KICAgICAgdmFyIG1vID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MykgewogICAgICAgICAgcmV0dXJuIE1hdGgucG93KHQzLCBuMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuMiA9ICtuMiwgZTIuZXhwb25lbnQgPSB0MiwgZTI7CiAgICAgIH0oMyksIHhvID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MykgewogICAgICAgICAgcmV0dXJuIDEgLSBNYXRoLnBvdygxIC0gdDMsIG4yKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG4yID0gK24yLCBlMi5leHBvbmVudCA9IHQyLCBlMjsKICAgICAgfSgzKSwgd28gPSBmdW5jdGlvbiB0MihuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKHQzKSB7CiAgICAgICAgICByZXR1cm4gKCh0MyAqPSAyKSA8PSAxID8gTWF0aC5wb3codDMsIG4yKSA6IDIgLSBNYXRoLnBvdygyIC0gdDMsIG4yKSkgLyAyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbjIgPSArbjIsIGUyLmV4cG9uZW50ID0gdDIsIGUyOwogICAgICB9KDMpLCBNbyA9IE1hdGguUEksIFRvID0gTW8gLyAyOwogICAgICBmdW5jdGlvbiBBbyh0MikgewogICAgICAgIHJldHVybiAoMSAtIE1hdGguY29zKE1vICogdDIpKSAvIDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU28odDIpIHsKICAgICAgICByZXR1cm4gMS4wMDA5Nzc1MTcxMDY1NDk0ICogKE1hdGgucG93KDIsIC0xMCAqIHQyKSAtIDk3NjU2MjVlLTEwKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBFbyh0MikgewogICAgICAgIHJldHVybiAoKHQyICo9IDIpIDw9IDEgPyBTbygxIC0gdDIpIDogMiAtIFNvKHQyIC0gMSkpIC8gMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBObyh0MikgewogICAgICAgIHJldHVybiAoKHQyICo9IDIpIDw9IDEgPyAxIC0gTWF0aC5zcXJ0KDEgLSB0MiAqIHQyKSA6IE1hdGguc3FydCgxIC0gKHQyIC09IDIpICogdDIpICsgMSkgLyAyOwogICAgICB9CiAgICAgIHZhciBrbyA9IDQgLyAxMSwgQ28gPSA2IC8gMTEsIFBvID0gOCAvIDExLCB6byA9IDMgLyA0LCAkbyA9IDkgLyAxMSwgRG8gPSAxMCAvIDExLCBSbyA9IDE1IC8gMTYsIEZvID0gMjEgLyAyMiwgcW8gPSA2MyAvIDY0LCBVbyA9IDEgLyBrbyAvIGtvOwogICAgICBmdW5jdGlvbiBJbyh0MikgewogICAgICAgIHJldHVybiAodDIgPSArdDIpIDwga28gPyBVbyAqIHQyICogdDIgOiB0MiA8IFBvID8gVW8gKiAodDIgLT0gQ28pICogdDIgKyB6byA6IHQyIDwgRG8gPyBVbyAqICh0MiAtPSAkbykgKiB0MiArIFJvIDogVW8gKiAodDIgLT0gRm8pICogdDIgKyBxbzsKICAgICAgfQogICAgICB2YXIgT28gPSAxLjcwMTU4LCBCbyA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgZnVuY3Rpb24gZTIodDMpIHsKICAgICAgICAgIHJldHVybiAodDMgPSArdDMpICogdDMgKiAobjIgKiAodDMgLSAxKSArIHQzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG4yID0gK24yLCBlMi5vdmVyc2hvb3QgPSB0MiwgZTI7CiAgICAgIH0oT28pLCBZbyA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgZnVuY3Rpb24gZTIodDMpIHsKICAgICAgICAgIHJldHVybiAtLXQzICogdDMgKiAoKHQzICsgMSkgKiBuMiArIHQzKSArIDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuMiA9ICtuMiwgZTIub3ZlcnNob290ID0gdDIsIGUyOwogICAgICB9KE9vKSwgTG8gPSBmdW5jdGlvbiB0MihuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKHQzKSB7CiAgICAgICAgICByZXR1cm4gKCh0MyAqPSAyKSA8IDEgPyB0MyAqIHQzICogKChuMiArIDEpICogdDMgLSBuMikgOiAodDMgLT0gMikgKiB0MyAqICgobjIgKyAxKSAqIHQzICsgbjIpICsgMikgLyAyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbjIgPSArbjIsIGUyLm92ZXJzaG9vdCA9IHQyLCBlMjsKICAgICAgfShPbyksIGpvID0gMiAqIE1hdGguUEksIEhvID0gZnVuY3Rpb24gdDIobjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gTWF0aC5hc2luKDEgLyAobjIgPSBNYXRoLm1heCgxLCBuMikpKSAqIChlMiAvPSBqbyk7CiAgICAgICAgZnVuY3Rpb24gaTIodDMpIHsKICAgICAgICAgIHJldHVybiBuMiAqIFNvKC0gLS10MykgKiBNYXRoLnNpbigocjIgLSB0MykgLyBlMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpMi5hbXBsaXR1ZGUgPSBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIHQyKG4zLCBlMiAqIGpvKTsKICAgICAgICB9LCBpMi5wZXJpb2QgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgcmV0dXJuIHQyKG4yLCBlMyk7CiAgICAgICAgfSwgaTI7CiAgICAgIH0oMSwgMC4zKSwgWG8gPSBmdW5jdGlvbiB0MihuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSBNYXRoLmFzaW4oMSAvIChuMiA9IE1hdGgubWF4KDEsIG4yKSkpICogKGUyIC89IGpvKTsKICAgICAgICBmdW5jdGlvbiBpMih0MykgewogICAgICAgICAgcmV0dXJuIDEgLSBuMiAqIFNvKHQzID0gK3QzKSAqIE1hdGguc2luKCh0MyArIHIyKSAvIGUyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGkyLmFtcGxpdHVkZSA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gdDIobjMsIGUyICogam8pOwogICAgICAgIH0sIGkyLnBlcmlvZCA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICByZXR1cm4gdDIobjIsIGUzKTsKICAgICAgICB9LCBpMjsKICAgICAgfSgxLCAwLjMpLCBHbyA9IGZ1bmN0aW9uIHQyKG4yLCBlMikgewogICAgICAgIHZhciByMiA9IE1hdGguYXNpbigxIC8gKG4yID0gTWF0aC5tYXgoMSwgbjIpKSkgKiAoZTIgLz0gam8pOwogICAgICAgIGZ1bmN0aW9uIGkyKHQzKSB7CiAgICAgICAgICByZXR1cm4gKCh0MyA9IDIgKiB0MyAtIDEpIDwgMCA/IG4yICogU28oLXQzKSAqIE1hdGguc2luKChyMiAtIHQzKSAvIGUyKSA6IDIgLSBuMiAqIFNvKHQzKSAqIE1hdGguc2luKChyMiArIHQzKSAvIGUyKSkgLyAyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuYW1wbGl0dWRlID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiB0MihuMywgZTIgKiBqbyk7CiAgICAgICAgfSwgaTIucGVyaW9kID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgIHJldHVybiB0MihuMiwgZTMpOwogICAgICAgIH0sIGkyOwogICAgICB9KDEsIDAuMyksIFZvID0geyB0aW1lOiBudWxsLCBkZWxheTogMCwgZHVyYXRpb246IDI1MCwgZWFzZTogYm8gfTsKICAgICAgZnVuY3Rpb24gV28odDIsIG4yKSB7CiAgICAgICAgZm9yICh2YXIgZTI7ICEoZTIgPSB0Mi5fX3RyYW5zaXRpb24pIHx8ICEoZTIgPSBlMltuMl0pOyApCiAgICAgICAgICBpZiAoISh0MiA9IHQyLnBhcmVudE5vZGUpKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHRyYW5zaXRpb24gJHtuMn0gbm90IGZvdW5kYCk7CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9CiAgICAgIFduLnByb3RvdHlwZS5pbnRlcnJ1cHQgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICBHaSh0aGlzLCB0Mik7CiAgICAgICAgfSk7CiAgICAgIH0sIFduLnByb3RvdHlwZS50cmFuc2l0aW9uID0gZnVuY3Rpb24odDIpIHsKICAgICAgICB2YXIgbjIsIGUyOwogICAgICAgIHQyIGluc3RhbmNlb2YgcG8gPyAobjIgPSB0Mi5faWQsIHQyID0gdDIuX25hbWUpIDogKG4yID0geW8oKSwgKGUyID0gVm8pLnRpbWUgPSBBaSgpLCB0MiA9IG51bGwgPT0gdDIgPyBudWxsIDogdDIgKyAiIik7CiAgICAgICAgZm9yICh2YXIgcjIgPSB0aGlzLl9ncm91cHMsIGkyID0gcjIubGVuZ3RoLCBvMiA9IDA7IG8yIDwgaTI7ICsrbzIpCiAgICAgICAgICBmb3IgKHZhciBhMiwgdTIgPSByMltvMl0sIGMyID0gdTIubGVuZ3RoLCBmMiA9IDA7IGYyIDwgYzI7ICsrZjIpCiAgICAgICAgICAgIChhMiA9IHUyW2YyXSkgJiYgTGkoYTIsIHQyLCBuMiwgZjIsIHUyLCBlMiB8fCBXbyhhMiwgbjIpKTsKICAgICAgICByZXR1cm4gbmV3IHBvKHIyLCB0aGlzLl9wYXJlbnRzLCB0MiwgbjIpOwogICAgICB9OwogICAgICB2YXIgWm8gPSBbbnVsbF07CiAgICAgIHZhciBLbyA9ICh0MikgPT4gKCkgPT4gdDI7CiAgICAgIGZ1bmN0aW9uIFFvKHQyLCB7IHNvdXJjZUV2ZW50OiBuMiwgdGFyZ2V0OiBlMiwgc2VsZWN0aW9uOiByMiwgbW9kZTogaTIsIGRpc3BhdGNoOiBvMiB9KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgeyB0eXBlOiB7IHZhbHVlOiB0MiwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0sIHNvdXJjZUV2ZW50OiB7IHZhbHVlOiBuMiwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0sIHRhcmdldDogeyB2YWx1ZTogZTIsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LCBzZWxlY3Rpb246IHsgdmFsdWU6IHIyLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSwgbW9kZTogeyB2YWx1ZTogaTIsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LCBfOiB7IHZhbHVlOiBvMiB9IH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEpvKHQyKSB7CiAgICAgICAgdDIucHJldmVudERlZmF1bHQoKSwgdDIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgIH0KICAgICAgdmFyIHRhID0geyBuYW1lOiAiZHJhZyIgfSwgbmEgPSB7IG5hbWU6ICJzcGFjZSIgfSwgZWEgPSB7IG5hbWU6ICJoYW5kbGUiIH0sIHJhID0geyBuYW1lOiAiY2VudGVyIiB9OwogICAgICBjb25zdCB7IGFiczogaWEsIG1heDogb2EsIG1pbjogYWEgfSA9IE1hdGg7CiAgICAgIGZ1bmN0aW9uIHVhKHQyKSB7CiAgICAgICAgcmV0dXJuIFsrdDJbMF0sICt0MlsxXV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2EodDIpIHsKICAgICAgICByZXR1cm4gW3VhKHQyWzBdKSwgdWEodDJbMV0pXTsKICAgICAgfQogICAgICB2YXIgZmEgPSB7IG5hbWU6ICJ4IiwgaGFuZGxlczogWyJ3IiwgImUiXS5tYXAodmEpLCBpbnB1dDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdDIgPyBudWxsIDogW1srdDJbMF0sIG4yWzBdWzFdXSwgWyt0MlsxXSwgbjJbMV1bMV1dXTsKICAgICAgfSwgb3V0cHV0OiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0MiAmJiBbdDJbMF1bMF0sIHQyWzFdWzBdXTsKICAgICAgfSB9LCBzYSA9IHsgbmFtZTogInkiLCBoYW5kbGVzOiBbIm4iLCAicyJdLm1hcCh2YSksIGlucHV0OiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PSB0MiA/IG51bGwgOiBbW24yWzBdWzBdLCArdDJbMF1dLCBbbjJbMV1bMF0sICt0MlsxXV1dOwogICAgICB9LCBvdXRwdXQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyICYmIFt0MlswXVsxXSwgdDJbMV1bMV1dOwogICAgICB9IH0sIGxhID0geyBuYW1lOiAieHkiLCBoYW5kbGVzOiBbIm4iLCAidyIsICJlIiwgInMiLCAibnciLCAibmUiLCAic3ciLCAic2UiXS5tYXAodmEpLCBpbnB1dDogZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PSB0MiA/IG51bGwgOiBjYSh0Mik7CiAgICAgIH0sIG91dHB1dDogZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gdDI7CiAgICAgIH0gfSwgaGEgPSB7IG92ZXJsYXk6ICJjcm9zc2hhaXIiLCBzZWxlY3Rpb246ICJtb3ZlIiwgbjogIm5zLXJlc2l6ZSIsIGU6ICJldy1yZXNpemUiLCBzOiAibnMtcmVzaXplIiwgdzogImV3LXJlc2l6ZSIsIG53OiAibndzZS1yZXNpemUiLCBuZTogIm5lc3ctcmVzaXplIiwgc2U6ICJud3NlLXJlc2l6ZSIsIHN3OiAibmVzdy1yZXNpemUiIH0sIGRhID0geyBlOiAidyIsIHc6ICJlIiwgbnc6ICJuZSIsIG5lOiAibnciLCBzZTogInN3Iiwgc3c6ICJzZSIgfSwgcGEgPSB7IG46ICJzIiwgczogIm4iLCBudzogInN3IiwgbmU6ICJzZSIsIHNlOiAibmUiLCBzdzogIm53IiB9LCBnYSA9IHsgb3ZlcmxheTogMSwgc2VsZWN0aW9uOiAxLCBuOiBudWxsLCBlOiAxLCBzOiBudWxsLCB3OiAtMSwgbnc6IC0xLCBuZTogMSwgc2U6IDEsIHN3OiAtMSB9LCB5YSA9IHsgb3ZlcmxheTogMSwgc2VsZWN0aW9uOiAxLCBuOiAtMSwgZTogbnVsbCwgczogMSwgdzogbnVsbCwgbnc6IC0xLCBuZTogLTEsIHNlOiAxLCBzdzogMSB9OwogICAgICBmdW5jdGlvbiB2YSh0MikgewogICAgICAgIHJldHVybiB7IHR5cGU6IHQyIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX2EodDIpIHsKICAgICAgICByZXR1cm4gIXQyLmN0cmxLZXkgJiYgIXQyLmJ1dHRvbjsKICAgICAgfQogICAgICBmdW5jdGlvbiBiYSgpIHsKICAgICAgICB2YXIgdDIgPSB0aGlzLm93bmVyU1ZHRWxlbWVudCB8fCB0aGlzOwogICAgICAgIHJldHVybiB0Mi5oYXNBdHRyaWJ1dGUoInZpZXdCb3giKSA/IFtbKHQyID0gdDIudmlld0JveC5iYXNlVmFsKS54LCB0Mi55XSwgW3QyLnggKyB0Mi53aWR0aCwgdDIueSArIHQyLmhlaWdodF1dIDogW1swLCAwXSwgW3QyLndpZHRoLmJhc2VWYWwudmFsdWUsIHQyLmhlaWdodC5iYXNlVmFsLnZhbHVlXV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbWEoKSB7CiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyB8fCAib250b3VjaHN0YXJ0IiBpbiB0aGlzOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHhhKHQyKSB7CiAgICAgICAgZm9yICg7ICF0Mi5fX2JydXNoOyApCiAgICAgICAgICBpZiAoISh0MiA9IHQyLnBhcmVudE5vZGUpKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgcmV0dXJuIHQyLl9fYnJ1c2g7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gd2EodDIpIHsKICAgICAgICB2YXIgbjIsIGUyID0gYmEsIHIyID0gX2EsIGkyID0gbWEsIG8yID0gdHJ1ZSwgYTIgPSAkdCgic3RhcnQiLCAiYnJ1c2giLCAiZW5kIiksIHUyID0gNjsKICAgICAgICBmdW5jdGlvbiBjMihuMykgewogICAgICAgICAgdmFyIGUzID0gbjMucHJvcGVydHkoIl9fYnJ1c2giLCBnMikuc2VsZWN0QWxsKCIub3ZlcmxheSIpLmRhdGEoW3ZhKCJvdmVybGF5IildKTsKICAgICAgICAgIGUzLmVudGVyKCkuYXBwZW5kKCJyZWN0IikuYXR0cigiY2xhc3MiLCAib3ZlcmxheSIpLmF0dHIoInBvaW50ZXItZXZlbnRzIiwgImFsbCIpLmF0dHIoImN1cnNvciIsIGhhLm92ZXJsYXkpLm1lcmdlKGUzKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgdDMgPSB4YSh0aGlzKS5leHRlbnQ7CiAgICAgICAgICAgIFpuKHRoaXMpLmF0dHIoIngiLCB0M1swXVswXSkuYXR0cigieSIsIHQzWzBdWzFdKS5hdHRyKCJ3aWR0aCIsIHQzWzFdWzBdIC0gdDNbMF1bMF0pLmF0dHIoImhlaWdodCIsIHQzWzFdWzFdIC0gdDNbMF1bMV0pOwogICAgICAgICAgfSksIG4zLnNlbGVjdEFsbCgiLnNlbGVjdGlvbiIpLmRhdGEoW3ZhKCJzZWxlY3Rpb24iKV0pLmVudGVyKCkuYXBwZW5kKCJyZWN0IikuYXR0cigiY2xhc3MiLCAic2VsZWN0aW9uIikuYXR0cigiY3Vyc29yIiwgaGEuc2VsZWN0aW9uKS5hdHRyKCJmaWxsIiwgIiM3NzciKS5hdHRyKCJmaWxsLW9wYWNpdHkiLCAwLjMpLmF0dHIoInN0cm9rZSIsICIjZmZmIikuYXR0cigic2hhcGUtcmVuZGVyaW5nIiwgImNyaXNwRWRnZXMiKTsKICAgICAgICAgIHZhciByMyA9IG4zLnNlbGVjdEFsbCgiLmhhbmRsZSIpLmRhdGEodDIuaGFuZGxlcywgZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgcmV0dXJuIHQzLnR5cGU7CiAgICAgICAgICB9KTsKICAgICAgICAgIHIzLmV4aXQoKS5yZW1vdmUoKSwgcjMuZW50ZXIoKS5hcHBlbmQoInJlY3QiKS5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHJldHVybiAiaGFuZGxlIGhhbmRsZS0tIiArIHQzLnR5cGU7CiAgICAgICAgICB9KS5hdHRyKCJjdXJzb3IiLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4gaGFbdDMudHlwZV07CiAgICAgICAgICB9KSwgbjMuZWFjaChmMikuYXR0cigiZmlsbCIsICJub25lIikuYXR0cigicG9pbnRlci1ldmVudHMiLCAiYWxsIikub24oIm1vdXNlZG93bi5icnVzaCIsIGgyKS5maWx0ZXIoaTIpLm9uKCJ0b3VjaHN0YXJ0LmJydXNoIiwgaDIpLm9uKCJ0b3VjaG1vdmUuYnJ1c2giLCBkMikub24oInRvdWNoZW5kLmJydXNoIHRvdWNoY2FuY2VsLmJydXNoIiwgcDIpLnN0eWxlKCJ0b3VjaC1hY3Rpb24iLCAibm9uZSIpLnN0eWxlKCItd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3IiLCAicmdiYSgwLDAsMCwwKSIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBmMigpIHsKICAgICAgICAgIHZhciB0MyA9IFpuKHRoaXMpLCBuMyA9IHhhKHRoaXMpLnNlbGVjdGlvbjsKICAgICAgICAgIG4zID8gKHQzLnNlbGVjdEFsbCgiLnNlbGVjdGlvbiIpLnN0eWxlKCJkaXNwbGF5IiwgbnVsbCkuYXR0cigieCIsIG4zWzBdWzBdKS5hdHRyKCJ5IiwgbjNbMF1bMV0pLmF0dHIoIndpZHRoIiwgbjNbMV1bMF0gLSBuM1swXVswXSkuYXR0cigiaGVpZ2h0IiwgbjNbMV1bMV0gLSBuM1swXVsxXSksIHQzLnNlbGVjdEFsbCgiLmhhbmRsZSIpLnN0eWxlKCJkaXNwbGF5IiwgbnVsbCkuYXR0cigieCIsIGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgIHJldHVybiAiZSIgPT09IHQ0LnR5cGVbdDQudHlwZS5sZW5ndGggLSAxXSA/IG4zWzFdWzBdIC0gdTIgLyAyIDogbjNbMF1bMF0gLSB1MiAvIDI7CiAgICAgICAgICB9KS5hdHRyKCJ5IiwgZnVuY3Rpb24odDQpIHsKICAgICAgICAgICAgcmV0dXJuICJzIiA9PT0gdDQudHlwZVswXSA/IG4zWzFdWzFdIC0gdTIgLyAyIDogbjNbMF1bMV0gLSB1MiAvIDI7CiAgICAgICAgICB9KS5hdHRyKCJ3aWR0aCIsIGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgIHJldHVybiAibiIgPT09IHQ0LnR5cGUgfHwgInMiID09PSB0NC50eXBlID8gbjNbMV1bMF0gLSBuM1swXVswXSArIHUyIDogdTI7CiAgICAgICAgICB9KS5hdHRyKCJoZWlnaHQiLCBmdW5jdGlvbih0NCkgewogICAgICAgICAgICByZXR1cm4gImUiID09PSB0NC50eXBlIHx8ICJ3IiA9PT0gdDQudHlwZSA/IG4zWzFdWzFdIC0gbjNbMF1bMV0gKyB1MiA6IHUyOwogICAgICAgICAgfSkpIDogdDMuc2VsZWN0QWxsKCIuc2VsZWN0aW9uLC5oYW5kbGUiKS5zdHlsZSgiZGlzcGxheSIsICJub25lIikuYXR0cigieCIsIG51bGwpLmF0dHIoInkiLCBudWxsKS5hdHRyKCJ3aWR0aCIsIG51bGwpLmF0dHIoImhlaWdodCIsIG51bGwpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzMih0MywgbjMsIGUzKSB7CiAgICAgICAgICB2YXIgcjMgPSB0My5fX2JydXNoLmVtaXR0ZXI7CiAgICAgICAgICByZXR1cm4gIXIzIHx8IGUzICYmIHIzLmNsZWFuID8gbmV3IGwyKHQzLCBuMywgZTMpIDogcjM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGwyKHQzLCBuMywgZTMpIHsKICAgICAgICAgIHRoaXMudGhhdCA9IHQzLCB0aGlzLmFyZ3MgPSBuMywgdGhpcy5zdGF0ZSA9IHQzLl9fYnJ1c2gsIHRoaXMuYWN0aXZlID0gMCwgdGhpcy5jbGVhbiA9IGUzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBoMihlMykgewogICAgICAgICAgaWYgKCghbjIgfHwgZTMudG91Y2hlcykgJiYgcjIuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgewogICAgICAgICAgICB2YXIgaTMsIGEzLCB1MywgYzMsIGwzLCBoMywgZDQsIHAzLCBnMywgeTIsIHYyLCBfMiA9IHRoaXMsIGIyID0gZTMudGFyZ2V0Ll9fZGF0YV9fLnR5cGUsIG0yID0gInNlbGVjdGlvbiIgPT09IChvMiAmJiBlMy5tZXRhS2V5ID8gYjIgPSAib3ZlcmxheSIgOiBiMikgPyB0YSA6IG8yICYmIGUzLmFsdEtleSA/IHJhIDogZWEsIHgyID0gdDIgPT09IHNhID8gbnVsbCA6IGdhW2IyXSwgdzIgPSB0MiA9PT0gZmEgPyBudWxsIDogeWFbYjJdLCBNMiA9IHhhKF8yKSwgVDIgPSBNMi5leHRlbnQsIEEyID0gTTIuc2VsZWN0aW9uLCBTMiA9IFQyWzBdWzBdLCBFMiA9IFQyWzBdWzFdLCBOMiA9IFQyWzFdWzBdLCBrMiA9IFQyWzFdWzFdLCBDMiA9IDAsIFAyID0gMCwgejIgPSB4MiAmJiB3MiAmJiBvMiAmJiBlMy5zaGlmdEtleSwgJDIgPSBBcnJheS5mcm9tKGUzLnRvdWNoZXMgfHwgW2UzXSwgKHQzKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgbjMgPSB0My5pZGVudGlmaWVyOwogICAgICAgICAgICAgIHJldHVybiAodDMgPSBuZSh0MywgXzIpKS5wb2ludDAgPSB0My5zbGljZSgpLCB0My5pZGVudGlmaWVyID0gbjMsIHQzOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgR2koXzIpOwogICAgICAgICAgICB2YXIgRDIgPSBzMihfMiwgYXJndW1lbnRzLCB0cnVlKS5iZWZvcmVzdGFydCgpOwogICAgICAgICAgICBpZiAoIm92ZXJsYXkiID09PSBiMikgewogICAgICAgICAgICAgIEEyICYmIChnMyA9IHRydWUpOwogICAgICAgICAgICAgIGNvbnN0IG4zID0gWyQyWzBdLCAkMlsxXSB8fCAkMlswXV07CiAgICAgICAgICAgICAgTTIuc2VsZWN0aW9uID0gQTIgPSBbW2kzID0gdDIgPT09IHNhID8gUzIgOiBhYShuM1swXVswXSwgbjNbMV1bMF0pLCB1MyA9IHQyID09PSBmYSA/IEUyIDogYWEobjNbMF1bMV0sIG4zWzFdWzFdKV0sIFtsMyA9IHQyID09PSBzYSA/IE4yIDogb2EobjNbMF1bMF0sIG4zWzFdWzBdKSwgZDQgPSB0MiA9PT0gZmEgPyBrMiA6IG9hKG4zWzBdWzFdLCBuM1sxXVsxXSldXSwgJDIubGVuZ3RoID4gMSAmJiBJMihlMyk7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIGkzID0gQTJbMF1bMF0sIHUzID0gQTJbMF1bMV0sIGwzID0gQTJbMV1bMF0sIGQ0ID0gQTJbMV1bMV07CiAgICAgICAgICAgIGEzID0gaTMsIGMzID0gdTMsIGgzID0gbDMsIHAzID0gZDQ7CiAgICAgICAgICAgIHZhciBSMiA9IFpuKF8yKS5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJub25lIiksIEYyID0gUjIuc2VsZWN0QWxsKCIub3ZlcmxheSIpLmF0dHIoImN1cnNvciIsIGhhW2IyXSk7CiAgICAgICAgICAgIGlmIChlMy50b3VjaGVzKQogICAgICAgICAgICAgIEQyLm1vdmVkID0gVTIsIEQyLmVuZGVkID0gTzI7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIHZhciBxMiA9IFpuKGUzLnZpZXcpLm9uKCJtb3VzZW1vdmUuYnJ1c2giLCBVMiwgdHJ1ZSkub24oIm1vdXNldXAuYnJ1c2giLCBPMiwgdHJ1ZSk7CiAgICAgICAgICAgICAgbzIgJiYgcTIub24oImtleWRvd24uYnJ1c2giLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICAgICAgc3dpdGNoICh0My5rZXlDb2RlKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAgICAgejIgPSB4MiAmJiB3MjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgICAgICBtMiA9PT0gZWEgJiYgKHgyICYmIChsMyA9IGgzIC0gQzIgKiB4MiwgaTMgPSBhMyArIEMyICogeDIpLCB3MiAmJiAoZDQgPSBwMyAtIFAyICogdzIsIHUzID0gYzMgKyBQMiAqIHcyKSwgbTIgPSByYSwgSTIodDMpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICAgICAgICBtMiAhPT0gZWEgJiYgbTIgIT09IHJhIHx8ICh4MiA8IDAgPyBsMyA9IGgzIC0gQzIgOiB4MiA+IDAgJiYgKGkzID0gYTMgLSBDMiksIHcyIDwgMCA/IGQ0ID0gcDMgLSBQMiA6IHcyID4gMCAmJiAodTMgPSBjMyAtIFAyKSwgbTIgPSBuYSwgRjIuYXR0cigiY3Vyc29yIiwgaGEuc2VsZWN0aW9uKSwgSTIodDMpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBKbyh0Myk7CiAgICAgICAgICAgICAgfSwgdHJ1ZSkub24oImtleXVwLmJydXNoIiwgZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAodDMua2V5Q29kZSkgewogICAgICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgICAgIHoyICYmICh5MiA9IHYyID0gejIgPSBmYWxzZSwgSTIodDMpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgICAgICBtMiA9PT0gcmEgJiYgKHgyIDwgMCA/IGwzID0gaDMgOiB4MiA+IDAgJiYgKGkzID0gYTMpLCB3MiA8IDAgPyBkNCA9IHAzIDogdzIgPiAwICYmICh1MyA9IGMzKSwgbTIgPSBlYSwgSTIodDMpKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICAgICAgICBtMiA9PT0gbmEgJiYgKHQzLmFsdEtleSA/ICh4MiAmJiAobDMgPSBoMyAtIEMyICogeDIsIGkzID0gYTMgKyBDMiAqIHgyKSwgdzIgJiYgKGQ0ID0gcDMgLSBQMiAqIHcyLCB1MyA9IGMzICsgUDIgKiB3MiksIG0yID0gcmEpIDogKHgyIDwgMCA/IGwzID0gaDMgOiB4MiA+IDAgJiYgKGkzID0gYTMpLCB3MiA8IDAgPyBkNCA9IHAzIDogdzIgPiAwICYmICh1MyA9IGMzKSwgbTIgPSBlYSksIEYyLmF0dHIoImN1cnNvciIsIGhhW2IyXSksIEkyKHQzKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgSm8odDMpOwogICAgICAgICAgICAgIH0sIHRydWUpLCBhZShlMy52aWV3KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmMi5jYWxsKF8yKSwgRDIuc3RhcnQoZTMsIG0yLm5hbWUpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gVTIodDMpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBuMyBvZiB0My5jaGFuZ2VkVG91Y2hlcyB8fCBbdDNdKQogICAgICAgICAgICAgIGZvciAoY29uc3QgdDQgb2YgJDIpCiAgICAgICAgICAgICAgICB0NC5pZGVudGlmaWVyID09PSBuMy5pZGVudGlmaWVyICYmICh0NC5jdXIgPSBuZShuMywgXzIpKTsKICAgICAgICAgICAgaWYgKHoyICYmICF5MiAmJiAhdjIgJiYgMSA9PT0gJDIubGVuZ3RoKSB7CiAgICAgICAgICAgICAgY29uc3QgdDQgPSAkMlswXTsKICAgICAgICAgICAgICBpYSh0NC5jdXJbMF0gLSB0NFswXSkgPiBpYSh0NC5jdXJbMV0gLSB0NFsxXSkgPyB2MiA9IHRydWUgOiB5MiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChjb25zdCB0NCBvZiAkMikKICAgICAgICAgICAgICB0NC5jdXIgJiYgKHQ0WzBdID0gdDQuY3VyWzBdLCB0NFsxXSA9IHQ0LmN1clsxXSk7CiAgICAgICAgICAgIGczID0gdHJ1ZSwgSm8odDMpLCBJMih0Myk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBJMih0MykgewogICAgICAgICAgICBjb25zdCBuMyA9ICQyWzBdLCBlNCA9IG4zLnBvaW50MDsKICAgICAgICAgICAgdmFyIHIzOwogICAgICAgICAgICBzd2l0Y2ggKEMyID0gbjNbMF0gLSBlNFswXSwgUDIgPSBuM1sxXSAtIGU0WzFdLCBtMikgewogICAgICAgICAgICAgIGNhc2UgbmE6CiAgICAgICAgICAgICAgY2FzZSB0YToKICAgICAgICAgICAgICAgIHgyICYmIChDMiA9IG9hKFMyIC0gaTMsIGFhKE4yIC0gbDMsIEMyKSksIGEzID0gaTMgKyBDMiwgaDMgPSBsMyArIEMyKSwgdzIgJiYgKFAyID0gb2EoRTIgLSB1MywgYWEoazIgLSBkNCwgUDIpKSwgYzMgPSB1MyArIFAyLCBwMyA9IGQ0ICsgUDIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBlYToKICAgICAgICAgICAgICAgICQyWzFdID8gKHgyICYmIChhMyA9IG9hKFMyLCBhYShOMiwgJDJbMF1bMF0pKSwgaDMgPSBvYShTMiwgYWEoTjIsICQyWzFdWzBdKSksIHgyID0gMSksIHcyICYmIChjMyA9IG9hKEUyLCBhYShrMiwgJDJbMF1bMV0pKSwgcDMgPSBvYShFMiwgYWEoazIsICQyWzFdWzFdKSksIHcyID0gMSkpIDogKHgyIDwgMCA/IChDMiA9IG9hKFMyIC0gaTMsIGFhKE4yIC0gaTMsIEMyKSksIGEzID0gaTMgKyBDMiwgaDMgPSBsMykgOiB4MiA+IDAgJiYgKEMyID0gb2EoUzIgLSBsMywgYWEoTjIgLSBsMywgQzIpKSwgYTMgPSBpMywgaDMgPSBsMyArIEMyKSwgdzIgPCAwID8gKFAyID0gb2EoRTIgLSB1MywgYWEoazIgLSB1MywgUDIpKSwgYzMgPSB1MyArIFAyLCBwMyA9IGQ0KSA6IHcyID4gMCAmJiAoUDIgPSBvYShFMiAtIGQ0LCBhYShrMiAtIGQ0LCBQMikpLCBjMyA9IHUzLCBwMyA9IGQ0ICsgUDIpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgcmE6CiAgICAgICAgICAgICAgICB4MiAmJiAoYTMgPSBvYShTMiwgYWEoTjIsIGkzIC0gQzIgKiB4MikpLCBoMyA9IG9hKFMyLCBhYShOMiwgbDMgKyBDMiAqIHgyKSkpLCB3MiAmJiAoYzMgPSBvYShFMiwgYWEoazIsIHUzIC0gUDIgKiB3MikpLCBwMyA9IG9hKEUyLCBhYShrMiwgZDQgKyBQMiAqIHcyKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGgzIDwgYTMgJiYgKHgyICo9IC0xLCByMyA9IGkzLCBpMyA9IGwzLCBsMyA9IHIzLCByMyA9IGEzLCBhMyA9IGgzLCBoMyA9IHIzLCBiMiBpbiBkYSAmJiBGMi5hdHRyKCJjdXJzb3IiLCBoYVtiMiA9IGRhW2IyXV0pKSwgcDMgPCBjMyAmJiAodzIgKj0gLTEsIHIzID0gdTMsIHUzID0gZDQsIGQ0ID0gcjMsIHIzID0gYzMsIGMzID0gcDMsIHAzID0gcjMsIGIyIGluIHBhICYmIEYyLmF0dHIoImN1cnNvciIsIGhhW2IyID0gcGFbYjJdXSkpLCBNMi5zZWxlY3Rpb24gJiYgKEEyID0gTTIuc2VsZWN0aW9uKSwgeTIgJiYgKGEzID0gQTJbMF1bMF0sIGgzID0gQTJbMV1bMF0pLCB2MiAmJiAoYzMgPSBBMlswXVsxXSwgcDMgPSBBMlsxXVsxXSksIEEyWzBdWzBdID09PSBhMyAmJiBBMlswXVsxXSA9PT0gYzMgJiYgQTJbMV1bMF0gPT09IGgzICYmIEEyWzFdWzFdID09PSBwMyB8fCAoTTIuc2VsZWN0aW9uID0gW1thMywgYzNdLCBbaDMsIHAzXV0sIGYyLmNhbGwoXzIpLCBEMi5icnVzaCh0MywgbTIubmFtZSkpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gTzIodDMpIHsKICAgICAgICAgICAgaWYgKGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgICAgdDQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH0odDMpLCB0My50b3VjaGVzKSB7CiAgICAgICAgICAgICAgaWYgKHQzLnRvdWNoZXMubGVuZ3RoKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIG4yICYmIGNsZWFyVGltZW91dChuMiksIG4yID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIG4yID0gbnVsbDsKICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICB1ZSh0My52aWV3LCBnMyksIHEyLm9uKCJrZXlkb3duLmJydXNoIGtleXVwLmJydXNoIG1vdXNlbW92ZS5icnVzaCBtb3VzZXVwLmJydXNoIiwgbnVsbCk7CiAgICAgICAgICAgIFIyLmF0dHIoInBvaW50ZXItZXZlbnRzIiwgImFsbCIpLCBGMi5hdHRyKCJjdXJzb3IiLCBoYS5vdmVybGF5KSwgTTIuc2VsZWN0aW9uICYmIChBMiA9IE0yLnNlbGVjdGlvbiksIGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHQ0WzBdWzBdID09PSB0NFsxXVswXSB8fCB0NFswXVsxXSA9PT0gdDRbMV1bMV07CiAgICAgICAgICAgIH0oQTIpICYmIChNMi5zZWxlY3Rpb24gPSBudWxsLCBmMi5jYWxsKF8yKSksIEQyLmVuZCh0MywgbTIubmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGQyKHQzKSB7CiAgICAgICAgICBzMih0aGlzLCBhcmd1bWVudHMpLm1vdmVkKHQzKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcDIodDMpIHsKICAgICAgICAgIHMyKHRoaXMsIGFyZ3VtZW50cykuZW5kZWQodDMpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnMigpIHsKICAgICAgICAgIHZhciBuMyA9IHRoaXMuX19icnVzaCB8fCB7IHNlbGVjdGlvbjogbnVsbCB9OwogICAgICAgICAgcmV0dXJuIG4zLmV4dGVudCA9IGNhKGUyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpLCBuMy5kaW0gPSB0MiwgbjM7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjMi5tb3ZlID0gZnVuY3Rpb24objMsIGUzLCByMykgewogICAgICAgICAgbjMudHdlZW4gPyBuMy5vbigic3RhcnQuYnJ1c2giLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICBzMih0aGlzLCBhcmd1bWVudHMpLmJlZm9yZXN0YXJ0KCkuc3RhcnQodDMpOwogICAgICAgICAgfSkub24oImludGVycnVwdC5icnVzaCBlbmQuYnJ1c2giLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICBzMih0aGlzLCBhcmd1bWVudHMpLmVuZCh0Myk7CiAgICAgICAgICB9KS50d2VlbigiYnJ1c2giLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG40ID0gdGhpcywgcjQgPSBuNC5fX2JydXNoLCBpMyA9IHMyKG40LCBhcmd1bWVudHMpLCBvMyA9IHI0LnNlbGVjdGlvbiwgYTMgPSB0Mi5pbnB1dCgiZnVuY3Rpb24iID09IHR5cGVvZiBlMyA/IGUzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBlMywgcjQuZXh0ZW50KSwgdTMgPSBHcihvMywgYTMpOwogICAgICAgICAgICBmdW5jdGlvbiBjMyh0MykgewogICAgICAgICAgICAgIHI0LnNlbGVjdGlvbiA9IDEgPT09IHQzICYmIG51bGwgPT09IGEzID8gbnVsbCA6IHUzKHQzKSwgZjIuY2FsbChuNCksIGkzLmJydXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwgIT09IG8zICYmIG51bGwgIT09IGEzID8gYzMgOiBjMygxKTsKICAgICAgICAgIH0pIDogbjMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG40ID0gdGhpcywgaTMgPSBhcmd1bWVudHMsIG8zID0gbjQuX19icnVzaCwgYTMgPSB0Mi5pbnB1dCgiZnVuY3Rpb24iID09IHR5cGVvZiBlMyA/IGUzLmFwcGx5KG40LCBpMykgOiBlMywgbzMuZXh0ZW50KSwgdTMgPSBzMihuNCwgaTMpLmJlZm9yZXN0YXJ0KCk7CiAgICAgICAgICAgIEdpKG40KSwgbzMuc2VsZWN0aW9uID0gbnVsbCA9PT0gYTMgPyBudWxsIDogYTMsIGYyLmNhbGwobjQpLCB1My5zdGFydChyMykuYnJ1c2gocjMpLmVuZChyMyk7CiAgICAgICAgICB9KTsKICAgICAgICB9LCBjMi5jbGVhciA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgYzIubW92ZSh0MywgbnVsbCwgbjMpOwogICAgICAgIH0sIGwyLnByb3RvdHlwZSA9IHsgYmVmb3Jlc3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIDEgPT0gKyt0aGlzLmFjdGl2ZSAmJiAodGhpcy5zdGF0ZS5lbWl0dGVyID0gdGhpcywgdGhpcy5zdGFydGluZyA9IHRydWUpLCB0aGlzOwogICAgICAgIH0sIHN0YXJ0OiBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiB0aGlzLnN0YXJ0aW5nID8gKHRoaXMuc3RhcnRpbmcgPSBmYWxzZSwgdGhpcy5lbWl0KCJzdGFydCIsIHQzLCBuMykpIDogdGhpcy5lbWl0KCJicnVzaCIsIHQzKSwgdGhpczsKICAgICAgICB9LCBicnVzaDogZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5lbWl0KCJicnVzaCIsIHQzLCBuMyksIHRoaXM7CiAgICAgICAgfSwgZW5kOiBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiAwID09IC0tdGhpcy5hY3RpdmUgJiYgKGRlbGV0ZSB0aGlzLnN0YXRlLmVtaXR0ZXIsIHRoaXMuZW1pdCgiZW5kIiwgdDMsIG4zKSksIHRoaXM7CiAgICAgICAgfSwgZW1pdDogZnVuY3Rpb24objMsIGUzLCByMykgewogICAgICAgICAgdmFyIGkzID0gWm4odGhpcy50aGF0KS5kYXR1bSgpOwogICAgICAgICAgYTIuY2FsbChuMywgdGhpcy50aGF0LCBuZXcgUW8objMsIHsgc291cmNlRXZlbnQ6IGUzLCB0YXJnZXQ6IGMyLCBzZWxlY3Rpb246IHQyLm91dHB1dCh0aGlzLnN0YXRlLnNlbGVjdGlvbiksIG1vZGU6IHIzLCBkaXNwYXRjaDogYTIgfSksIGkzKTsKICAgICAgICB9IH0sIGMyLmV4dGVudCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBLbyhjYSh0MykpLCBjMikgOiBlMjsKICAgICAgICB9LCBjMi5maWx0ZXIgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogS28oISF0MyksIGMyKSA6IHIyOwogICAgICAgIH0sIGMyLnRvdWNoYWJsZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBLbyghIXQzKSwgYzIpIDogaTI7CiAgICAgICAgfSwgYzIuaGFuZGxlU2l6ZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh1MiA9ICt0MywgYzIpIDogdTI7CiAgICAgICAgfSwgYzIua2V5TW9kaWZpZXJzID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG8yID0gISF0MywgYzIpIDogbzI7CiAgICAgICAgfSwgYzIub24gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciB0MyA9IGEyLm9uLmFwcGx5KGEyLCBhcmd1bWVudHMpOwogICAgICAgICAgcmV0dXJuIHQzID09PSBhMiA/IGMyIDogdDM7CiAgICAgICAgfSwgYzI7CiAgICAgIH0KICAgICAgdmFyIE1hID0gTWF0aC5hYnMsIFRhID0gTWF0aC5jb3MsIEFhID0gTWF0aC5zaW4sIFNhID0gTWF0aC5QSSwgRWEgPSBTYSAvIDIsIE5hID0gMiAqIFNhLCBrYSA9IE1hdGgubWF4LCBDYSA9IDFlLTEyOwogICAgICBmdW5jdGlvbiBQYSh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogbjIgLSB0MiB9LCAobjMsIGUyKSA9PiB0MiArIGUyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB6YSh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSAwLCByMiA9IG51bGwsIGkyID0gbnVsbCwgbzIgPSBudWxsOwogICAgICAgIGZ1bmN0aW9uIGEyKGEzKSB7CiAgICAgICAgICB2YXIgdTIsIGMyID0gYTMubGVuZ3RoLCBmMiA9IG5ldyBBcnJheShjMiksIHMyID0gUGEoMCwgYzIpLCBsMiA9IG5ldyBBcnJheShjMiAqIGMyKSwgaDIgPSBuZXcgQXJyYXkoYzIpLCBkMiA9IDA7CiAgICAgICAgICBhMyA9IEZsb2F0NjRBcnJheS5mcm9tKHsgbGVuZ3RoOiBjMiAqIGMyIH0sIG4yID8gKHQzLCBuMykgPT4gYTNbbjMgJSBjMl1bbjMgLyBjMiB8IDBdIDogKHQzLCBuMykgPT4gYTNbbjMgLyBjMiB8IDBdW24zICUgYzJdKTsKICAgICAgICAgIGZvciAobGV0IG4zID0gMDsgbjMgPCBjMjsgKytuMykgewogICAgICAgICAgICBsZXQgZTMgPSAwOwogICAgICAgICAgICBmb3IgKGxldCByMyA9IDA7IHIzIDwgYzI7ICsrcjMpCiAgICAgICAgICAgICAgZTMgKz0gYTNbbjMgKiBjMiArIHIzXSArIHQyICogYTNbcjMgKiBjMiArIG4zXTsKICAgICAgICAgICAgZDIgKz0gZjJbbjNdID0gZTM7CiAgICAgICAgICB9CiAgICAgICAgICB1MiA9IChkMiA9IGthKDAsIE5hIC0gZTIgKiBjMikgLyBkMikgPyBlMiA6IE5hIC8gYzI7CiAgICAgICAgICB7CiAgICAgICAgICAgIGxldCBuMyA9IDA7CiAgICAgICAgICAgIHIyICYmIHMyLnNvcnQoKHQzLCBuNCkgPT4gcjIoZjJbdDNdLCBmMltuNF0pKTsKICAgICAgICAgICAgZm9yIChjb25zdCBlMyBvZiBzMikgewogICAgICAgICAgICAgIGNvbnN0IHIzID0gbjM7CiAgICAgICAgICAgICAgaWYgKHQyKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IFBhKDEgKyB+YzIsIGMyKS5maWx0ZXIoKHQ0KSA9PiB0NCA8IDAgPyBhM1t+dDQgKiBjMiArIGUzXSA6IGEzW2UzICogYzIgKyB0NF0pOwogICAgICAgICAgICAgICAgaTIgJiYgdDMuc29ydCgodDQsIG40KSA9PiBpMih0NCA8IDAgPyAtYTNbfnQ0ICogYzIgKyBlM10gOiBhM1tlMyAqIGMyICsgdDRdLCBuNCA8IDAgPyAtYTNbfm40ICogYzIgKyBlM10gOiBhM1tlMyAqIGMyICsgbjRdKSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHI0IG9mIHQzKQogICAgICAgICAgICAgICAgICBpZiAocjQgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgKGwyW35yNCAqIGMyICsgZTNdIHx8IChsMlt+cjQgKiBjMiArIGUzXSA9IHsgc291cmNlOiBudWxsLCB0YXJnZXQ6IG51bGwgfSkpLnRhcmdldCA9IHsgaW5kZXg6IGUzLCBzdGFydEFuZ2xlOiBuMywgZW5kQW5nbGU6IG4zICs9IGEzW35yNCAqIGMyICsgZTNdICogZDIsIHZhbHVlOiBhM1t+cjQgKiBjMiArIGUzXSB9OwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIChsMltlMyAqIGMyICsgcjRdIHx8IChsMltlMyAqIGMyICsgcjRdID0geyBzb3VyY2U6IG51bGwsIHRhcmdldDogbnVsbCB9KSkuc291cmNlID0geyBpbmRleDogZTMsIHN0YXJ0QW5nbGU6IG4zLCBlbmRBbmdsZTogbjMgKz0gYTNbZTMgKiBjMiArIHI0XSAqIGQyLCB2YWx1ZTogYTNbZTMgKiBjMiArIHI0XSB9OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoMltlM10gPSB7IGluZGV4OiBlMywgc3RhcnRBbmdsZTogcjMsIGVuZEFuZ2xlOiBuMywgdmFsdWU6IGYyW2UzXSB9OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCB0MyA9IFBhKDAsIGMyKS5maWx0ZXIoKHQ0KSA9PiBhM1tlMyAqIGMyICsgdDRdIHx8IGEzW3Q0ICogYzIgKyBlM10pOwogICAgICAgICAgICAgICAgaTIgJiYgdDMuc29ydCgodDQsIG40KSA9PiBpMihhM1tlMyAqIGMyICsgdDRdLCBhM1tlMyAqIGMyICsgbjRdKSk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHI0IG9mIHQzKSB7CiAgICAgICAgICAgICAgICAgIGxldCB0NDsKICAgICAgICAgICAgICAgICAgaWYgKGUzIDwgcjQgPyAodDQgPSBsMltlMyAqIGMyICsgcjRdIHx8IChsMltlMyAqIGMyICsgcjRdID0geyBzb3VyY2U6IG51bGwsIHRhcmdldDogbnVsbCB9KSwgdDQuc291cmNlID0geyBpbmRleDogZTMsIHN0YXJ0QW5nbGU6IG4zLCBlbmRBbmdsZTogbjMgKz0gYTNbZTMgKiBjMiArIHI0XSAqIGQyLCB2YWx1ZTogYTNbZTMgKiBjMiArIHI0XSB9KSA6ICh0NCA9IGwyW3I0ICogYzIgKyBlM10gfHwgKGwyW3I0ICogYzIgKyBlM10gPSB7IHNvdXJjZTogbnVsbCwgdGFyZ2V0OiBudWxsIH0pLCB0NC50YXJnZXQgPSB7IGluZGV4OiBlMywgc3RhcnRBbmdsZTogbjMsIGVuZEFuZ2xlOiBuMyArPSBhM1tlMyAqIGMyICsgcjRdICogZDIsIHZhbHVlOiBhM1tlMyAqIGMyICsgcjRdIH0sIGUzID09PSByNCAmJiAodDQuc291cmNlID0gdDQudGFyZ2V0KSksIHQ0LnNvdXJjZSAmJiB0NC50YXJnZXQgJiYgdDQuc291cmNlLnZhbHVlIDwgdDQudGFyZ2V0LnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbjQgPSB0NC5zb3VyY2U7CiAgICAgICAgICAgICAgICAgICAgdDQuc291cmNlID0gdDQudGFyZ2V0LCB0NC50YXJnZXQgPSBuNDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaDJbZTNdID0geyBpbmRleDogZTMsIHN0YXJ0QW5nbGU6IHIzLCBlbmRBbmdsZTogbjMsIHZhbHVlOiBmMltlM10gfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbjMgKz0gdTI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAobDIgPSBPYmplY3QudmFsdWVzKGwyKSkuZ3JvdXBzID0gaDIsIG8yID8gbDIuc29ydChvMikgOiBsMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEyLnBhZEFuZ2xlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGUyID0ga2EoMCwgdDMpLCBhMikgOiBlMjsKICAgICAgICB9LCBhMi5zb3J0R3JvdXBzID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gdDMsIGEyKSA6IHIyOwogICAgICAgIH0sIGEyLnNvcnRTdWJncm91cHMgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaTIgPSB0MywgYTIpIDogaTI7CiAgICAgICAgfSwgYTIuc29ydENob3JkcyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChudWxsID09IHQzID8gbzIgPSBudWxsIDogKG4zID0gdDMsIG8yID0gZnVuY3Rpb24odDQsIGUzKSB7CiAgICAgICAgICAgIHJldHVybiBuMyh0NC5zb3VyY2UudmFsdWUgKyB0NC50YXJnZXQudmFsdWUsIGUzLnNvdXJjZS52YWx1ZSArIGUzLnRhcmdldC52YWx1ZSk7CiAgICAgICAgICB9KS5fID0gdDMsIGEyKSA6IG8yICYmIG8yLl87CiAgICAgICAgICB2YXIgbjM7CiAgICAgICAgfSwgYTI7CiAgICAgIH0KICAgICAgY29uc3QgJGEgPSBNYXRoLlBJLCBEYSA9IDIgKiAkYSwgUmEgPSAxZS02LCBGYSA9IERhIC0gUmE7CiAgICAgIGZ1bmN0aW9uIHFhKHQyKSB7CiAgICAgICAgdGhpcy5fICs9IHQyWzBdOwogICAgICAgIGZvciAobGV0IG4yID0gMSwgZTIgPSB0Mi5sZW5ndGg7IG4yIDwgZTI7ICsrbjIpCiAgICAgICAgICB0aGlzLl8gKz0gYXJndW1lbnRzW24yXSArIHQyW24yXTsKICAgICAgfQogICAgICBsZXQgVWEgPSBjbGFzcyB7CiAgICAgICAgY29uc3RydWN0b3IodDIpIHsKICAgICAgICAgIHRoaXMuX3gwID0gdGhpcy5feTAgPSB0aGlzLl94MSA9IHRoaXMuX3kxID0gbnVsbCwgdGhpcy5fID0gIiIsIHRoaXMuX2FwcGVuZCA9IG51bGwgPT0gdDIgPyBxYSA6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGxldCBuMiA9IE1hdGguZmxvb3IodDMpOwogICAgICAgICAgICBpZiAoIShuMiA+PSAwKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgZGlnaXRzOiAke3QzfWApOwogICAgICAgICAgICBpZiAobjIgPiAxNSkKICAgICAgICAgICAgICByZXR1cm4gcWE7CiAgICAgICAgICAgIGNvbnN0IGUyID0gMTAgKiogbjI7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih0NCkgewogICAgICAgICAgICAgIHRoaXMuXyArPSB0NFswXTsKICAgICAgICAgICAgICBmb3IgKGxldCBuMyA9IDEsIHIyID0gdDQubGVuZ3RoOyBuMyA8IHIyOyArK24zKQogICAgICAgICAgICAgICAgdGhpcy5fICs9IE1hdGgucm91bmQoYXJndW1lbnRzW24zXSAqIGUyKSAvIGUyICsgdDRbbjNdOwogICAgICAgICAgICB9OwogICAgICAgICAgfSh0Mik7CiAgICAgICAgfQogICAgICAgIG1vdmVUbyh0MiwgbjIpIHsKICAgICAgICAgIHRoaXMuX2FwcGVuZGBNJHt0aGlzLl94MCA9IHRoaXMuX3gxID0gK3QyfSwke3RoaXMuX3kwID0gdGhpcy5feTEgPSArbjJ9YDsKICAgICAgICB9CiAgICAgICAgY2xvc2VQYXRoKCkgewogICAgICAgICAgbnVsbCAhPT0gdGhpcy5feDEgJiYgKHRoaXMuX3gxID0gdGhpcy5feDAsIHRoaXMuX3kxID0gdGhpcy5feTAsIHRoaXMuX2FwcGVuZGBaYCk7CiAgICAgICAgfQogICAgICAgIGxpbmVUbyh0MiwgbjIpIHsKICAgICAgICAgIHRoaXMuX2FwcGVuZGBMJHt0aGlzLl94MSA9ICt0Mn0sJHt0aGlzLl95MSA9ICtuMn1gOwogICAgICAgIH0KICAgICAgICBxdWFkcmF0aWNDdXJ2ZVRvKHQyLCBuMiwgZTIsIHIyKSB7CiAgICAgICAgICB0aGlzLl9hcHBlbmRgUSR7K3QyfSwkeytuMn0sJHt0aGlzLl94MSA9ICtlMn0sJHt0aGlzLl95MSA9ICtyMn1gOwogICAgICAgIH0KICAgICAgICBiZXppZXJDdXJ2ZVRvKHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIpIHsKICAgICAgICAgIHRoaXMuX2FwcGVuZGBDJHsrdDJ9LCR7K24yfSwkeytlMn0sJHsrcjJ9LCR7dGhpcy5feDEgPSAraTJ9LCR7dGhpcy5feTEgPSArbzJ9YDsKICAgICAgICB9CiAgICAgICAgYXJjVG8odDIsIG4yLCBlMiwgcjIsIGkyKSB7CiAgICAgICAgICBpZiAodDIgPSArdDIsIG4yID0gK24yLCBlMiA9ICtlMiwgcjIgPSArcjIsIChpMiA9ICtpMikgPCAwKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYG5lZ2F0aXZlIHJhZGl1czogJHtpMn1gKTsKICAgICAgICAgIGxldCBvMiA9IHRoaXMuX3gxLCBhMiA9IHRoaXMuX3kxLCB1MiA9IGUyIC0gdDIsIGMyID0gcjIgLSBuMiwgZjIgPSBvMiAtIHQyLCBzMiA9IGEyIC0gbjIsIGwyID0gZjIgKiBmMiArIHMyICogczI7CiAgICAgICAgICBpZiAobnVsbCA9PT0gdGhpcy5feDEpCiAgICAgICAgICAgIHRoaXMuX2FwcGVuZGBNJHt0aGlzLl94MSA9IHQyfSwke3RoaXMuX3kxID0gbjJ9YDsKICAgICAgICAgIGVsc2UgaWYgKGwyID4gUmEpCiAgICAgICAgICAgIGlmIChNYXRoLmFicyhzMiAqIHUyIC0gYzIgKiBmMikgPiBSYSAmJiBpMikgewogICAgICAgICAgICAgIGxldCBoMiA9IGUyIC0gbzIsIGQyID0gcjIgLSBhMiwgcDIgPSB1MiAqIHUyICsgYzIgKiBjMiwgZzIgPSBoMiAqIGgyICsgZDIgKiBkMiwgeTIgPSBNYXRoLnNxcnQocDIpLCB2MiA9IE1hdGguc3FydChsMiksIF8yID0gaTIgKiBNYXRoLnRhbigoJGEgLSBNYXRoLmFjb3MoKHAyICsgbDIgLSBnMikgLyAoMiAqIHkyICogdjIpKSkgLyAyKSwgYjIgPSBfMiAvIHYyLCBtMiA9IF8yIC8geTI7CiAgICAgICAgICAgICAgTWF0aC5hYnMoYjIgLSAxKSA+IFJhICYmIHRoaXMuX2FwcGVuZGBMJHt0MiArIGIyICogZjJ9LCR7bjIgKyBiMiAqIHMyfWAsIHRoaXMuX2FwcGVuZGBBJHtpMn0sJHtpMn0sMCwwLCR7KyhzMiAqIGgyID4gZjIgKiBkMil9LCR7dGhpcy5feDEgPSB0MiArIG0yICogdTJ9LCR7dGhpcy5feTEgPSBuMiArIG0yICogYzJ9YDsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgdGhpcy5fYXBwZW5kYEwke3RoaXMuX3gxID0gdDJ9LCR7dGhpcy5feTEgPSBuMn1gOwogICAgICAgICAgZWxzZQogICAgICAgICAgICA7CiAgICAgICAgfQogICAgICAgIGFyYyh0MiwgbjIsIGUyLCByMiwgaTIsIG8yKSB7CiAgICAgICAgICBpZiAodDIgPSArdDIsIG4yID0gK24yLCBvMiA9ICEhbzIsIChlMiA9ICtlMikgPCAwKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYG5lZ2F0aXZlIHJhZGl1czogJHtlMn1gKTsKICAgICAgICAgIGxldCBhMiA9IGUyICogTWF0aC5jb3MocjIpLCB1MiA9IGUyICogTWF0aC5zaW4ocjIpLCBjMiA9IHQyICsgYTIsIGYyID0gbjIgKyB1MiwgczIgPSAxIF4gbzIsIGwyID0gbzIgPyByMiAtIGkyIDogaTIgLSByMjsKICAgICAgICAgIG51bGwgPT09IHRoaXMuX3gxID8gdGhpcy5fYXBwZW5kYE0ke2MyfSwke2YyfWAgOiAoTWF0aC5hYnModGhpcy5feDEgLSBjMikgPiBSYSB8fCBNYXRoLmFicyh0aGlzLl95MSAtIGYyKSA+IFJhKSAmJiB0aGlzLl9hcHBlbmRgTCR7YzJ9LCR7ZjJ9YCwgZTIgJiYgKGwyIDwgMCAmJiAobDIgPSBsMiAlIERhICsgRGEpLCBsMiA+IEZhID8gdGhpcy5fYXBwZW5kYEEke2UyfSwke2UyfSwwLDEsJHtzMn0sJHt0MiAtIGEyfSwke24yIC0gdTJ9QSR7ZTJ9LCR7ZTJ9LDAsMSwke3MyfSwke3RoaXMuX3gxID0gYzJ9LCR7dGhpcy5feTEgPSBmMn1gIDogbDIgPiBSYSAmJiB0aGlzLl9hcHBlbmRgQSR7ZTJ9LCR7ZTJ9LDAsJHsrKGwyID49ICRhKX0sJHtzMn0sJHt0aGlzLl94MSA9IHQyICsgZTIgKiBNYXRoLmNvcyhpMil9LCR7dGhpcy5feTEgPSBuMiArIGUyICogTWF0aC5zaW4oaTIpfWApOwogICAgICAgIH0KICAgICAgICByZWN0KHQyLCBuMiwgZTIsIHIyKSB7CiAgICAgICAgICB0aGlzLl9hcHBlbmRgTSR7dGhpcy5feDAgPSB0aGlzLl94MSA9ICt0Mn0sJHt0aGlzLl95MCA9IHRoaXMuX3kxID0gK24yfWgke2UyID0gK2UyfXYkeytyMn1oJHstZTJ9WmA7CiAgICAgICAgfQogICAgICAgIHRvU3RyaW5nKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuXzsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIElhKCkgewogICAgICAgIHJldHVybiBuZXcgVWEoKTsKICAgICAgfQogICAgICBJYS5wcm90b3R5cGUgPSBVYS5wcm90b3R5cGU7CiAgICAgIHZhciBPYSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKICAgICAgZnVuY3Rpb24gQmEodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBZYSh0MikgewogICAgICAgIHJldHVybiB0Mi5zb3VyY2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTGEodDIpIHsKICAgICAgICByZXR1cm4gdDIudGFyZ2V0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGphKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLnJhZGl1czsKICAgICAgfQogICAgICBmdW5jdGlvbiBIYSh0MikgewogICAgICAgIHJldHVybiB0Mi5zdGFydEFuZ2xlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFhhKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLmVuZEFuZ2xlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEdhKCkgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFZhKCkgewogICAgICAgIHJldHVybiAxMDsKICAgICAgfQogICAgICBmdW5jdGlvbiBXYSh0MikgewogICAgICAgIHZhciBuMiA9IFlhLCBlMiA9IExhLCByMiA9IGphLCBpMiA9IGphLCBvMiA9IEhhLCBhMiA9IFhhLCB1MiA9IEdhLCBjMiA9IG51bGw7CiAgICAgICAgZnVuY3Rpb24gZjIoKSB7CiAgICAgICAgICB2YXIgZjMsIHMyID0gbjIuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgbDIgPSBlMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBoMiA9IHUyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgLyAyLCBkMiA9IE9hLmNhbGwoYXJndW1lbnRzKSwgcDIgPSArcjIuYXBwbHkodGhpcywgKGQyWzBdID0gczIsIGQyKSksIGcyID0gbzIuYXBwbHkodGhpcywgZDIpIC0gRWEsIHkyID0gYTIuYXBwbHkodGhpcywgZDIpIC0gRWEsIHYyID0gK2kyLmFwcGx5KHRoaXMsIChkMlswXSA9IGwyLCBkMikpLCBfMiA9IG8yLmFwcGx5KHRoaXMsIGQyKSAtIEVhLCBiMiA9IGEyLmFwcGx5KHRoaXMsIGQyKSAtIEVhOwogICAgICAgICAgaWYgKGMyIHx8IChjMiA9IGYzID0gSWEoKSksIGgyID4gQ2EgJiYgKE1hKHkyIC0gZzIpID4gMiAqIGgyICsgQ2EgPyB5MiA+IGcyID8gKGcyICs9IGgyLCB5MiAtPSBoMikgOiAoZzIgLT0gaDIsIHkyICs9IGgyKSA6IGcyID0geTIgPSAoZzIgKyB5MikgLyAyLCBNYShiMiAtIF8yKSA+IDIgKiBoMiArIENhID8gYjIgPiBfMiA/IChfMiArPSBoMiwgYjIgLT0gaDIpIDogKF8yIC09IGgyLCBiMiArPSBoMikgOiBfMiA9IGIyID0gKF8yICsgYjIpIC8gMiksIGMyLm1vdmVUbyhwMiAqIFRhKGcyKSwgcDIgKiBBYShnMikpLCBjMi5hcmMoMCwgMCwgcDIsIGcyLCB5MiksIGcyICE9PSBfMiB8fCB5MiAhPT0gYjIpCiAgICAgICAgICAgIGlmICh0MikgewogICAgICAgICAgICAgIHZhciBtMiA9IHYyIC0gK3QyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHgyID0gKF8yICsgYjIpIC8gMjsKICAgICAgICAgICAgICBjMi5xdWFkcmF0aWNDdXJ2ZVRvKDAsIDAsIG0yICogVGEoXzIpLCBtMiAqIEFhKF8yKSksIGMyLmxpbmVUbyh2MiAqIFRhKHgyKSwgdjIgKiBBYSh4MikpLCBjMi5saW5lVG8obTIgKiBUYShiMiksIG0yICogQWEoYjIpKTsKICAgICAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgYzIucXVhZHJhdGljQ3VydmVUbygwLCAwLCB2MiAqIFRhKF8yKSwgdjIgKiBBYShfMikpLCBjMi5hcmMoMCwgMCwgdjIsIF8yLCBiMik7CiAgICAgICAgICBpZiAoYzIucXVhZHJhdGljQ3VydmVUbygwLCAwLCBwMiAqIFRhKGcyKSwgcDIgKiBBYShnMikpLCBjMi5jbG9zZVBhdGgoKSwgZjMpCiAgICAgICAgICAgIHJldHVybiBjMiA9IG51bGwsIGYzICsgIiIgfHwgbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHQyICYmIChmMi5oZWFkUmFkaXVzID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHQyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjMgPyBuMyA6IEJhKCtuMyksIGYyKSA6IHQyOwogICAgICAgIH0pLCBmMi5yYWRpdXMgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSBpMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBCYSgrdDMpLCBmMikgOiByMjsKICAgICAgICB9LCBmMi5zb3VyY2VSYWRpdXMgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogQmEoK3QzKSwgZjIpIDogcjI7CiAgICAgICAgfSwgZjIudGFyZ2V0UmFkaXVzID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGkyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IEJhKCt0MyksIGYyKSA6IGkyOwogICAgICAgIH0sIGYyLnN0YXJ0QW5nbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobzIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogQmEoK3QzKSwgZjIpIDogbzI7CiAgICAgICAgfSwgZjIuZW5kQW5nbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogQmEoK3QzKSwgZjIpIDogYTI7CiAgICAgICAgfSwgZjIucGFkQW5nbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogQmEoK3QzKSwgZjIpIDogdTI7CiAgICAgICAgfSwgZjIuc291cmNlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gdDMsIGYyKSA6IG4yOwogICAgICAgIH0sIGYyLnRhcmdldCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9IHQzLCBmMikgOiBlMjsKICAgICAgICB9LCBmMi5jb250ZXh0ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGMyID0gbnVsbCA9PSB0MyA/IG51bGwgOiB0MywgZjIpIDogYzI7CiAgICAgICAgfSwgZjI7CiAgICAgIH0KICAgICAgdmFyIFphID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwogICAgICBmdW5jdGlvbiBLYSh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gdDIgLSBuMjsKICAgICAgfQogICAgICB2YXIgUWEgPSAodDIpID0+ICgpID0+IHQyOwogICAgICBmdW5jdGlvbiBKYSh0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiwgcjIgPSAtMSwgaTIgPSBuMi5sZW5ndGg7ICsrcjIgPCBpMjsgKQogICAgICAgICAgaWYgKGUyID0gdHUodDIsIG4yW3IyXSkpCiAgICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICBmdW5jdGlvbiB0dSh0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiA9IG4yWzBdLCByMiA9IG4yWzFdLCBpMiA9IC0xLCBvMiA9IDAsIGEyID0gdDIubGVuZ3RoLCB1MiA9IGEyIC0gMTsgbzIgPCBhMjsgdTIgPSBvMisrKSB7CiAgICAgICAgICB2YXIgYzIgPSB0MltvMl0sIGYyID0gYzJbMF0sIHMyID0gYzJbMV0sIGwyID0gdDJbdTJdLCBoMiA9IGwyWzBdLCBkMiA9IGwyWzFdOwogICAgICAgICAgaWYgKG51KGMyLCBsMiwgbjIpKQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgIHMyID4gcjIgIT0gZDIgPiByMiAmJiBlMiA8IChoMiAtIGYyKSAqIChyMiAtIHMyKSAvIChkMiAtIHMyKSArIGYyICYmIChpMiA9IC1pMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBudSh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyLCBpMiwgbzIsIGEyOwogICAgICAgIHJldHVybiBmdW5jdGlvbih0MywgbjMsIGUzKSB7CiAgICAgICAgICByZXR1cm4gKG4zWzBdIC0gdDNbMF0pICogKGUzWzFdIC0gdDNbMV0pID09IChlM1swXSAtIHQzWzBdKSAqIChuM1sxXSAtIHQzWzFdKTsKICAgICAgICB9KHQyLCBuMiwgZTIpICYmIChpMiA9IHQyW3IyID0gKyh0MlswXSA9PT0gbjJbMF0pXSwgbzIgPSBlMltyMl0sIGEyID0gbjJbcjJdLCBpMiA8PSBvMiAmJiBvMiA8PSBhMiB8fCBhMiA8PSBvMiAmJiBvMiA8PSBpMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZXUoKSB7CiAgICAgIH0KICAgICAgdmFyIHJ1ID0gW1tdLCBbW1sxLCAxLjVdLCBbMC41LCAxXV1dLCBbW1sxLjUsIDFdLCBbMSwgMS41XV1dLCBbW1sxLjUsIDFdLCBbMC41LCAxXV1dLCBbW1sxLCAwLjVdLCBbMS41LCAxXV1dLCBbW1sxLCAxLjVdLCBbMC41LCAxXV0sIFtbMSwgMC41XSwgWzEuNSwgMV1dXSwgW1tbMSwgMC41XSwgWzEsIDEuNV1dXSwgW1tbMSwgMC41XSwgWzAuNSwgMV1dXSwgW1tbMC41LCAxXSwgWzEsIDAuNV1dXSwgW1tbMSwgMS41XSwgWzEsIDAuNV1dXSwgW1tbMC41LCAxXSwgWzEsIDAuNV1dLCBbWzEuNSwgMV0sIFsxLCAxLjVdXV0sIFtbWzEuNSwgMV0sIFsxLCAwLjVdXV0sIFtbWzAuNSwgMV0sIFsxLjUsIDFdXV0sIFtbWzEsIDEuNV0sIFsxLjUsIDFdXV0sIFtbWzAuNSwgMV0sIFsxLCAxLjVdXV0sIFtdXTsKICAgICAgZnVuY3Rpb24gaXUoKSB7CiAgICAgICAgdmFyIHQyID0gMSwgbjIgPSAxLCBlMiA9IEssIHIyID0gdTI7CiAgICAgICAgZnVuY3Rpb24gaTIodDMpIHsKICAgICAgICAgIHZhciBuMyA9IGUyKHQzKTsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG4zKSkKICAgICAgICAgICAgbjMgPSBuMy5zbGljZSgpLnNvcnQoS2EpOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gTSh0Mywgb3UpOwogICAgICAgICAgICBmb3IgKG4zID0gRyguLi5aKGUzWzBdLCBlM1sxXSwgbjMpLCBuMyk7IG4zW24zLmxlbmd0aCAtIDFdID49IGUzWzFdOyApCiAgICAgICAgICAgICAgbjMucG9wKCk7CiAgICAgICAgICAgIGZvciAoOyBuM1sxXSA8IGUzWzBdOyApCiAgICAgICAgICAgICAgbjMuc2hpZnQoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuMy5tYXAoKG40KSA9PiBvMih0MywgbjQpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbzIoZTMsIGkzKSB7CiAgICAgICAgICBjb25zdCBvMyA9IG51bGwgPT0gaTMgPyBOYU4gOiAraTM7CiAgICAgICAgICBpZiAoaXNOYU4obzMpKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgdmFsdWU6ICR7aTN9YCk7CiAgICAgICAgICB2YXIgdTMgPSBbXSwgYzIgPSBbXTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihlNCwgcjMsIGk0KSB7CiAgICAgICAgICAgIHZhciBvNCwgdTQsIGMzLCBmMiwgczIsIGwyLCBoMiA9IG5ldyBBcnJheSgpLCBkMiA9IG5ldyBBcnJheSgpOwogICAgICAgICAgICBvNCA9IHU0ID0gLTEsIGYyID0gYXUoZTRbMF0sIHIzKSwgcnVbZjIgPDwgMV0uZm9yRWFjaChwMik7CiAgICAgICAgICAgIGZvciAoOyArK280IDwgdDIgLSAxOyApCiAgICAgICAgICAgICAgYzMgPSBmMiwgZjIgPSBhdShlNFtvNCArIDFdLCByMyksIHJ1W2MzIHwgZjIgPDwgMV0uZm9yRWFjaChwMik7CiAgICAgICAgICAgIHJ1W2YyIDw8IDBdLmZvckVhY2gocDIpOwogICAgICAgICAgICBmb3IgKDsgKyt1NCA8IG4yIC0gMTsgKSB7CiAgICAgICAgICAgICAgZm9yIChvNCA9IC0xLCBmMiA9IGF1KGU0W3U0ICogdDIgKyB0Ml0sIHIzKSwgczIgPSBhdShlNFt1NCAqIHQyXSwgcjMpLCBydVtmMiA8PCAxIHwgczIgPDwgMl0uZm9yRWFjaChwMik7ICsrbzQgPCB0MiAtIDE7ICkKICAgICAgICAgICAgICAgIGMzID0gZjIsIGYyID0gYXUoZTRbdTQgKiB0MiArIHQyICsgbzQgKyAxXSwgcjMpLCBsMiA9IHMyLCBzMiA9IGF1KGU0W3U0ICogdDIgKyBvNCArIDFdLCByMyksIHJ1W2MzIHwgZjIgPDwgMSB8IHMyIDw8IDIgfCBsMiA8PCAzXS5mb3JFYWNoKHAyKTsKICAgICAgICAgICAgICBydVtmMiB8IHMyIDw8IDNdLmZvckVhY2gocDIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG80ID0gLTEsIHMyID0gZTRbdTQgKiB0Ml0gPj0gcjMsIHJ1W3MyIDw8IDJdLmZvckVhY2gocDIpOwogICAgICAgICAgICBmb3IgKDsgKytvNCA8IHQyIC0gMTsgKQogICAgICAgICAgICAgIGwyID0gczIsIHMyID0gYXUoZTRbdTQgKiB0MiArIG80ICsgMV0sIHIzKSwgcnVbczIgPDwgMiB8IGwyIDw8IDNdLmZvckVhY2gocDIpOwogICAgICAgICAgICBmdW5jdGlvbiBwMih0MykgewogICAgICAgICAgICAgIHZhciBuMywgZTUsIHI0ID0gW3QzWzBdWzBdICsgbzQsIHQzWzBdWzFdICsgdTRdLCBjNCA9IFt0M1sxXVswXSArIG80LCB0M1sxXVsxXSArIHU0XSwgZjMgPSBhMihyNCksIHMzID0gYTIoYzQpOwogICAgICAgICAgICAgIChuMyA9IGQyW2YzXSkgPyAoZTUgPSBoMltzM10pID8gKGRlbGV0ZSBkMltuMy5lbmRdLCBkZWxldGUgaDJbZTUuc3RhcnRdLCBuMyA9PT0gZTUgPyAobjMucmluZy5wdXNoKGM0KSwgaTQobjMucmluZykpIDogaDJbbjMuc3RhcnRdID0gZDJbZTUuZW5kXSA9IHsgc3RhcnQ6IG4zLnN0YXJ0LCBlbmQ6IGU1LmVuZCwgcmluZzogbjMucmluZy5jb25jYXQoZTUucmluZykgfSkgOiAoZGVsZXRlIGQyW24zLmVuZF0sIG4zLnJpbmcucHVzaChjNCksIGQyW24zLmVuZCA9IHMzXSA9IG4zKSA6IChuMyA9IGgyW3MzXSkgPyAoZTUgPSBkMltmM10pID8gKGRlbGV0ZSBoMltuMy5zdGFydF0sIGRlbGV0ZSBkMltlNS5lbmRdLCBuMyA9PT0gZTUgPyAobjMucmluZy5wdXNoKGM0KSwgaTQobjMucmluZykpIDogaDJbZTUuc3RhcnRdID0gZDJbbjMuZW5kXSA9IHsgc3RhcnQ6IGU1LnN0YXJ0LCBlbmQ6IG4zLmVuZCwgcmluZzogZTUucmluZy5jb25jYXQobjMucmluZykgfSkgOiAoZGVsZXRlIGgyW24zLnN0YXJ0XSwgbjMucmluZy51bnNoaWZ0KHI0KSwgaDJbbjMuc3RhcnQgPSBmM10gPSBuMykgOiBoMltmM10gPSBkMltzM10gPSB7IHN0YXJ0OiBmMywgZW5kOiBzMywgcmluZzogW3I0LCBjNF0gfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBydVtzMiA8PCAzXS5mb3JFYWNoKHAyKTsKICAgICAgICAgIH0oZTMsIG8zLCBmdW5jdGlvbih0MykgewogICAgICAgICAgICByMih0MywgZTMsIG8zKSwgZnVuY3Rpb24odDQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBuMyA9IDAsIGU0ID0gdDQubGVuZ3RoLCByMyA9IHQ0W2U0IC0gMV1bMV0gKiB0NFswXVswXSAtIHQ0W2U0IC0gMV1bMF0gKiB0NFswXVsxXTsgKytuMyA8IGU0OyApCiAgICAgICAgICAgICAgICByMyArPSB0NFtuMyAtIDFdWzFdICogdDRbbjNdWzBdIC0gdDRbbjMgLSAxXVswXSAqIHQ0W24zXVsxXTsKICAgICAgICAgICAgICByZXR1cm4gcjM7CiAgICAgICAgICAgIH0odDMpID4gMCA/IHUzLnB1c2goW3QzXSkgOiBjMi5wdXNoKHQzKTsKICAgICAgICAgIH0pLCBjMi5mb3JFYWNoKGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGZvciAodmFyIG4zLCBlNCA9IDAsIHIzID0gdTMubGVuZ3RoOyBlNCA8IHIzOyArK2U0KQogICAgICAgICAgICAgIGlmICgtMSAhPT0gSmEoKG4zID0gdTNbZTRdKVswXSwgdDMpKQogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgbjMucHVzaCh0Myk7CiAgICAgICAgICB9KSwgeyB0eXBlOiAiTXVsdGlQb2x5Z29uIiwgdmFsdWU6IGkzLCBjb29yZGluYXRlczogdTMgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYTIobjMpIHsKICAgICAgICAgIHJldHVybiAyICogbjNbMF0gKyBuM1sxXSAqICh0MiArIDEpICogNDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdTIoZTMsIHIzLCBpMykgewogICAgICAgICAgZTMuZm9yRWFjaChmdW5jdGlvbihlNCkgewogICAgICAgICAgICB2YXIgbzMgPSBlNFswXSwgYTMgPSBlNFsxXSwgdTMgPSAwIHwgbzMsIGMyID0gMCB8IGEzLCBmMiA9IHV1KHIzW2MyICogdDIgKyB1M10pOwogICAgICAgICAgICBvMyA+IDAgJiYgbzMgPCB0MiAmJiB1MyA9PT0gbzMgJiYgKGU0WzBdID0gY3UobzMsIHV1KHIzW2MyICogdDIgKyB1MyAtIDFdKSwgZjIsIGkzKSksIGEzID4gMCAmJiBhMyA8IG4yICYmIGMyID09PSBhMyAmJiAoZTRbMV0gPSBjdShhMywgdXUocjNbKGMyIC0gMSkgKiB0MiArIHUzXSksIGYyLCBpMykpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpMi5jb250b3VyID0gbzIsIGkyLnNpemUgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gW3QyLCBuMl07CiAgICAgICAgICB2YXIgcjMgPSBNYXRoLmZsb29yKGUzWzBdKSwgbzMgPSBNYXRoLmZsb29yKGUzWzFdKTsKICAgICAgICAgIGlmICghKHIzID49IDAgJiYgbzMgPj0gMCkpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiaW52YWxpZCBzaXplIik7CiAgICAgICAgICByZXR1cm4gdDIgPSByMywgbjIgPSBvMywgaTI7CiAgICAgICAgfSwgaTIudGhyZXNob2xkcyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBBcnJheS5pc0FycmF5KHQzKSA/IFFhKFphLmNhbGwodDMpKSA6IFFhKHQzKSwgaTIpIDogZTI7CiAgICAgICAgfSwgaTIuc21vb3RoID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gdDMgPyB1MiA6IGV1LCBpMikgOiByMiA9PT0gdTI7CiAgICAgICAgfSwgaTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gb3UodDIpIHsKICAgICAgICByZXR1cm4gaXNGaW5pdGUodDIpID8gdDIgOiBOYU47CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYXUodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT0gdDIgJiYgK3QyID49IG4yOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHV1KHQyKSB7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdDIgfHwgaXNOYU4odDIgPSArdDIpID8gLTEgLyAwIDogdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3UodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICBjb25zdCBpMiA9IHIyIC0gbjIsIG8yID0gZTIgLSBuMiwgYTIgPSBpc0Zpbml0ZShpMikgfHwgaXNGaW5pdGUobzIpID8gaTIgLyBvMiA6IE1hdGguc2lnbihpMikgLyBNYXRoLnNpZ24obzIpOwogICAgICAgIHJldHVybiBpc05hTihhMikgPyB0MiA6IHQyICsgYTIgLSAwLjU7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZnUodDIpIHsKICAgICAgICByZXR1cm4gdDJbMF07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc3UodDIpIHsKICAgICAgICByZXR1cm4gdDJbMV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbHUoKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICAgIH0KICAgICAgY29uc3QgaHUgPSAxMzQyMTc3MjksIGR1ID0gMzMzMDY2OTA3Mzg3NTQ3MDZlLTMyOwogICAgICBmdW5jdGlvbiBwdSh0MiwgbjIsIGUyLCByMiwgaTIpIHsKICAgICAgICBsZXQgbzIsIGEyLCB1MiwgYzIsIGYyID0gbjJbMF0sIHMyID0gcjJbMF0sIGwyID0gMCwgaDIgPSAwOwogICAgICAgIHMyID4gZjIgPT0gczIgPiAtZjIgPyAobzIgPSBmMiwgZjIgPSBuMlsrK2wyXSkgOiAobzIgPSBzMiwgczIgPSByMlsrK2gyXSk7CiAgICAgICAgbGV0IGQyID0gMDsKICAgICAgICBpZiAobDIgPCB0MiAmJiBoMiA8IGUyKQogICAgICAgICAgZm9yIChzMiA+IGYyID09IHMyID4gLWYyID8gKGEyID0gZjIgKyBvMiwgdTIgPSBvMiAtIChhMiAtIGYyKSwgZjIgPSBuMlsrK2wyXSkgOiAoYTIgPSBzMiArIG8yLCB1MiA9IG8yIC0gKGEyIC0gczIpLCBzMiA9IHIyWysraDJdKSwgbzIgPSBhMiwgMCAhPT0gdTIgJiYgKGkyW2QyKytdID0gdTIpOyBsMiA8IHQyICYmIGgyIDwgZTI7ICkKICAgICAgICAgICAgczIgPiBmMiA9PSBzMiA+IC1mMiA/IChhMiA9IG8yICsgZjIsIGMyID0gYTIgLSBvMiwgdTIgPSBvMiAtIChhMiAtIGMyKSArIChmMiAtIGMyKSwgZjIgPSBuMlsrK2wyXSkgOiAoYTIgPSBvMiArIHMyLCBjMiA9IGEyIC0gbzIsIHUyID0gbzIgLSAoYTIgLSBjMikgKyAoczIgLSBjMiksIHMyID0gcjJbKytoMl0pLCBvMiA9IGEyLCAwICE9PSB1MiAmJiAoaTJbZDIrK10gPSB1Mik7CiAgICAgICAgZm9yICg7IGwyIDwgdDI7ICkKICAgICAgICAgIGEyID0gbzIgKyBmMiwgYzIgPSBhMiAtIG8yLCB1MiA9IG8yIC0gKGEyIC0gYzIpICsgKGYyIC0gYzIpLCBmMiA9IG4yWysrbDJdLCBvMiA9IGEyLCAwICE9PSB1MiAmJiAoaTJbZDIrK10gPSB1Mik7CiAgICAgICAgZm9yICg7IGgyIDwgZTI7ICkKICAgICAgICAgIGEyID0gbzIgKyBzMiwgYzIgPSBhMiAtIG8yLCB1MiA9IG8yIC0gKGEyIC0gYzIpICsgKHMyIC0gYzIpLCBzMiA9IHIyWysraDJdLCBvMiA9IGEyLCAwICE9PSB1MiAmJiAoaTJbZDIrK10gPSB1Mik7CiAgICAgICAgcmV0dXJuIDAgPT09IG8yICYmIDAgIT09IGQyIHx8IChpMltkMisrXSA9IG8yKSwgZDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZ3UodDIpIHsKICAgICAgICByZXR1cm4gbmV3IEZsb2F0NjRBcnJheSh0Mik7CiAgICAgIH0KICAgICAgY29uc3QgeXUgPSAyMjIwNDQ2MDQ5MjUwMzE0NmUtMzIsIHZ1ID0gMTEwOTMzNTY0Nzk2NzA0ODdlLTQ3LCBfdSA9IGd1KDQpLCBidSA9IGd1KDgpLCBtdSA9IGd1KDEyKSwgeHUgPSBndSgxNiksIHd1ID0gZ3UoNCk7CiAgICAgIGZ1bmN0aW9uIE11KHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIpIHsKICAgICAgICBjb25zdCBhMiA9IChuMiAtIG8yKSAqIChlMiAtIGkyKSwgdTIgPSAodDIgLSBpMikgKiAocjIgLSBvMiksIGMyID0gYTIgLSB1MiwgZjIgPSBNYXRoLmFicyhhMiArIHUyKTsKICAgICAgICByZXR1cm4gTWF0aC5hYnMoYzIpID49IDMzMzA2NjkwNzM4NzU0NzE2ZS0zMiAqIGYyID8gYzIgOiAtZnVuY3Rpb24odDMsIG4zLCBlMywgcjMsIGkzLCBvMywgYTMpIHsKICAgICAgICAgIGxldCB1MywgYzMsIGYzLCBzMiwgbDIsIGgyLCBkMiwgcDIsIGcyLCB5MiwgdjIsIF8yLCBiMiwgbTIsIHgyLCB3MiwgTTIsIFQyOwogICAgICAgICAgY29uc3QgQTIgPSB0MyAtIGkzLCBTMiA9IGUzIC0gaTMsIEUyID0gbjMgLSBvMywgTjIgPSByMyAtIG8zOwogICAgICAgICAgbTIgPSBBMiAqIE4yLCBoMiA9IGh1ICogQTIsIGQyID0gaDIgLSAoaDIgLSBBMiksIHAyID0gQTIgLSBkMiwgaDIgPSBodSAqIE4yLCBnMiA9IGgyIC0gKGgyIC0gTjIpLCB5MiA9IE4yIC0gZzIsIHgyID0gcDIgKiB5MiAtIChtMiAtIGQyICogZzIgLSBwMiAqIGcyIC0gZDIgKiB5MiksIHcyID0gRTIgKiBTMiwgaDIgPSBodSAqIEUyLCBkMiA9IGgyIC0gKGgyIC0gRTIpLCBwMiA9IEUyIC0gZDIsIGgyID0gaHUgKiBTMiwgZzIgPSBoMiAtIChoMiAtIFMyKSwgeTIgPSBTMiAtIGcyLCBNMiA9IHAyICogeTIgLSAodzIgLSBkMiAqIGcyIC0gcDIgKiBnMiAtIGQyICogeTIpLCB2MiA9IHgyIC0gTTIsIGwyID0geDIgLSB2MiwgX3VbMF0gPSB4MiAtICh2MiArIGwyKSArIChsMiAtIE0yKSwgXzIgPSBtMiArIHYyLCBsMiA9IF8yIC0gbTIsIGIyID0gbTIgLSAoXzIgLSBsMikgKyAodjIgLSBsMiksIHYyID0gYjIgLSB3MiwgbDIgPSBiMiAtIHYyLCBfdVsxXSA9IGIyIC0gKHYyICsgbDIpICsgKGwyIC0gdzIpLCBUMiA9IF8yICsgdjIsIGwyID0gVDIgLSBfMiwgX3VbMl0gPSBfMiAtIChUMiAtIGwyKSArICh2MiAtIGwyKSwgX3VbM10gPSBUMjsKICAgICAgICAgIGxldCBrMiA9IGZ1bmN0aW9uKHQ0LCBuNCkgewogICAgICAgICAgICBsZXQgZTQgPSBuNFswXTsKICAgICAgICAgICAgZm9yIChsZXQgcjQgPSAxOyByNCA8IHQ0OyByNCsrKQogICAgICAgICAgICAgIGU0ICs9IG40W3I0XTsKICAgICAgICAgICAgcmV0dXJuIGU0OwogICAgICAgICAgfSg0LCBfdSksIEMyID0geXUgKiBhMzsKICAgICAgICAgIGlmIChrMiA+PSBDMiB8fCAtazIgPj0gQzIpCiAgICAgICAgICAgIHJldHVybiBrMjsKICAgICAgICAgIGlmIChsMiA9IHQzIC0gQTIsIHUzID0gdDMgLSAoQTIgKyBsMikgKyAobDIgLSBpMyksIGwyID0gZTMgLSBTMiwgZjMgPSBlMyAtIChTMiArIGwyKSArIChsMiAtIGkzKSwgbDIgPSBuMyAtIEUyLCBjMyA9IG4zIC0gKEUyICsgbDIpICsgKGwyIC0gbzMpLCBsMiA9IHIzIC0gTjIsIHMyID0gcjMgLSAoTjIgKyBsMikgKyAobDIgLSBvMyksIDAgPT09IHUzICYmIDAgPT09IGMzICYmIDAgPT09IGYzICYmIDAgPT09IHMyKQogICAgICAgICAgICByZXR1cm4gazI7CiAgICAgICAgICBpZiAoQzIgPSB2dSAqIGEzICsgZHUgKiBNYXRoLmFicyhrMiksIGsyICs9IEEyICogczIgKyBOMiAqIHUzIC0gKEUyICogZjMgKyBTMiAqIGMzKSwgazIgPj0gQzIgfHwgLWsyID49IEMyKQogICAgICAgICAgICByZXR1cm4gazI7CiAgICAgICAgICBtMiA9IHUzICogTjIsIGgyID0gaHUgKiB1MywgZDIgPSBoMiAtIChoMiAtIHUzKSwgcDIgPSB1MyAtIGQyLCBoMiA9IGh1ICogTjIsIGcyID0gaDIgLSAoaDIgLSBOMiksIHkyID0gTjIgLSBnMiwgeDIgPSBwMiAqIHkyIC0gKG0yIC0gZDIgKiBnMiAtIHAyICogZzIgLSBkMiAqIHkyKSwgdzIgPSBjMyAqIFMyLCBoMiA9IGh1ICogYzMsIGQyID0gaDIgLSAoaDIgLSBjMyksIHAyID0gYzMgLSBkMiwgaDIgPSBodSAqIFMyLCBnMiA9IGgyIC0gKGgyIC0gUzIpLCB5MiA9IFMyIC0gZzIsIE0yID0gcDIgKiB5MiAtICh3MiAtIGQyICogZzIgLSBwMiAqIGcyIC0gZDIgKiB5MiksIHYyID0geDIgLSBNMiwgbDIgPSB4MiAtIHYyLCB3dVswXSA9IHgyIC0gKHYyICsgbDIpICsgKGwyIC0gTTIpLCBfMiA9IG0yICsgdjIsIGwyID0gXzIgLSBtMiwgYjIgPSBtMiAtIChfMiAtIGwyKSArICh2MiAtIGwyKSwgdjIgPSBiMiAtIHcyLCBsMiA9IGIyIC0gdjIsIHd1WzFdID0gYjIgLSAodjIgKyBsMikgKyAobDIgLSB3MiksIFQyID0gXzIgKyB2MiwgbDIgPSBUMiAtIF8yLCB3dVsyXSA9IF8yIC0gKFQyIC0gbDIpICsgKHYyIC0gbDIpLCB3dVszXSA9IFQyOwogICAgICAgICAgY29uc3QgUDIgPSBwdSg0LCBfdSwgNCwgd3UsIGJ1KTsKICAgICAgICAgIG0yID0gQTIgKiBzMiwgaDIgPSBodSAqIEEyLCBkMiA9IGgyIC0gKGgyIC0gQTIpLCBwMiA9IEEyIC0gZDIsIGgyID0gaHUgKiBzMiwgZzIgPSBoMiAtIChoMiAtIHMyKSwgeTIgPSBzMiAtIGcyLCB4MiA9IHAyICogeTIgLSAobTIgLSBkMiAqIGcyIC0gcDIgKiBnMiAtIGQyICogeTIpLCB3MiA9IEUyICogZjMsIGgyID0gaHUgKiBFMiwgZDIgPSBoMiAtIChoMiAtIEUyKSwgcDIgPSBFMiAtIGQyLCBoMiA9IGh1ICogZjMsIGcyID0gaDIgLSAoaDIgLSBmMyksIHkyID0gZjMgLSBnMiwgTTIgPSBwMiAqIHkyIC0gKHcyIC0gZDIgKiBnMiAtIHAyICogZzIgLSBkMiAqIHkyKSwgdjIgPSB4MiAtIE0yLCBsMiA9IHgyIC0gdjIsIHd1WzBdID0geDIgLSAodjIgKyBsMikgKyAobDIgLSBNMiksIF8yID0gbTIgKyB2MiwgbDIgPSBfMiAtIG0yLCBiMiA9IG0yIC0gKF8yIC0gbDIpICsgKHYyIC0gbDIpLCB2MiA9IGIyIC0gdzIsIGwyID0gYjIgLSB2Miwgd3VbMV0gPSBiMiAtICh2MiArIGwyKSArIChsMiAtIHcyKSwgVDIgPSBfMiArIHYyLCBsMiA9IFQyIC0gXzIsIHd1WzJdID0gXzIgLSAoVDIgLSBsMikgKyAodjIgLSBsMiksIHd1WzNdID0gVDI7CiAgICAgICAgICBjb25zdCB6MiA9IHB1KFAyLCBidSwgNCwgd3UsIG11KTsKICAgICAgICAgIG0yID0gdTMgKiBzMiwgaDIgPSBodSAqIHUzLCBkMiA9IGgyIC0gKGgyIC0gdTMpLCBwMiA9IHUzIC0gZDIsIGgyID0gaHUgKiBzMiwgZzIgPSBoMiAtIChoMiAtIHMyKSwgeTIgPSBzMiAtIGcyLCB4MiA9IHAyICogeTIgLSAobTIgLSBkMiAqIGcyIC0gcDIgKiBnMiAtIGQyICogeTIpLCB3MiA9IGMzICogZjMsIGgyID0gaHUgKiBjMywgZDIgPSBoMiAtIChoMiAtIGMzKSwgcDIgPSBjMyAtIGQyLCBoMiA9IGh1ICogZjMsIGcyID0gaDIgLSAoaDIgLSBmMyksIHkyID0gZjMgLSBnMiwgTTIgPSBwMiAqIHkyIC0gKHcyIC0gZDIgKiBnMiAtIHAyICogZzIgLSBkMiAqIHkyKSwgdjIgPSB4MiAtIE0yLCBsMiA9IHgyIC0gdjIsIHd1WzBdID0geDIgLSAodjIgKyBsMikgKyAobDIgLSBNMiksIF8yID0gbTIgKyB2MiwgbDIgPSBfMiAtIG0yLCBiMiA9IG0yIC0gKF8yIC0gbDIpICsgKHYyIC0gbDIpLCB2MiA9IGIyIC0gdzIsIGwyID0gYjIgLSB2Miwgd3VbMV0gPSBiMiAtICh2MiArIGwyKSArIChsMiAtIHcyKSwgVDIgPSBfMiArIHYyLCBsMiA9IFQyIC0gXzIsIHd1WzJdID0gXzIgLSAoVDIgLSBsMikgKyAodjIgLSBsMiksIHd1WzNdID0gVDI7CiAgICAgICAgICBjb25zdCAkMiA9IHB1KHoyLCBtdSwgNCwgd3UsIHh1KTsKICAgICAgICAgIHJldHVybiB4dVskMiAtIDFdOwogICAgICAgIH0odDIsIG4yLCBlMiwgcjIsIGkyLCBvMiwgZjIpOwogICAgICB9CiAgICAgIGNvbnN0IFR1ID0gTWF0aC5wb3coMiwgLTUyKSwgQXUgPSBuZXcgVWludDMyQXJyYXkoNTEyKTsKICAgICAgY2xhc3MgU3UgewogICAgICAgIHN0YXRpYyBmcm9tKHQyLCBuMiA9IHp1LCBlMiA9ICR1KSB7CiAgICAgICAgICBjb25zdCByMiA9IHQyLmxlbmd0aCwgaTIgPSBuZXcgRmxvYXQ2NEFycmF5KDIgKiByMik7CiAgICAgICAgICBmb3IgKGxldCBvMiA9IDA7IG8yIDwgcjI7IG8yKyspIHsKICAgICAgICAgICAgY29uc3QgcjMgPSB0MltvMl07CiAgICAgICAgICAgIGkyWzIgKiBvMl0gPSBuMihyMyksIGkyWzIgKiBvMiArIDFdID0gZTIocjMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBTdShpMik7CiAgICAgICAgfQogICAgICAgIGNvbnN0cnVjdG9yKHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHQyLmxlbmd0aCA+PiAxOwogICAgICAgICAgaWYgKG4yID4gMCAmJiAibnVtYmVyIiAhPSB0eXBlb2YgdDJbMF0pCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiRXhwZWN0ZWQgY29vcmRzIHRvIGNvbnRhaW4gbnVtYmVycy4iKTsKICAgICAgICAgIHRoaXMuY29vcmRzID0gdDI7CiAgICAgICAgICBjb25zdCBlMiA9IE1hdGgubWF4KDIgKiBuMiAtIDUsIDApOwogICAgICAgICAgdGhpcy5fdHJpYW5nbGVzID0gbmV3IFVpbnQzMkFycmF5KDMgKiBlMiksIHRoaXMuX2hhbGZlZGdlcyA9IG5ldyBJbnQzMkFycmF5KDMgKiBlMiksIHRoaXMuX2hhc2hTaXplID0gTWF0aC5jZWlsKE1hdGguc3FydChuMikpLCB0aGlzLl9odWxsUHJldiA9IG5ldyBVaW50MzJBcnJheShuMiksIHRoaXMuX2h1bGxOZXh0ID0gbmV3IFVpbnQzMkFycmF5KG4yKSwgdGhpcy5faHVsbFRyaSA9IG5ldyBVaW50MzJBcnJheShuMiksIHRoaXMuX2h1bGxIYXNoID0gbmV3IEludDMyQXJyYXkodGhpcy5faGFzaFNpemUpLmZpbGwoLTEpLCB0aGlzLl9pZHMgPSBuZXcgVWludDMyQXJyYXkobjIpLCB0aGlzLl9kaXN0cyA9IG5ldyBGbG9hdDY0QXJyYXkobjIpLCB0aGlzLnVwZGF0ZSgpOwogICAgICAgIH0KICAgICAgICB1cGRhdGUoKSB7CiAgICAgICAgICBjb25zdCB7IGNvb3JkczogdDIsIF9odWxsUHJldjogbjIsIF9odWxsTmV4dDogZTIsIF9odWxsVHJpOiByMiwgX2h1bGxIYXNoOiBpMiB9ID0gdGhpcywgbzIgPSB0Mi5sZW5ndGggPj4gMTsKICAgICAgICAgIGxldCBhMiA9IDEgLyAwLCB1MiA9IDEgLyAwLCBjMiA9IC0xIC8gMCwgZjIgPSAtMSAvIDA7CiAgICAgICAgICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgbzI7IG4zKyspIHsKICAgICAgICAgICAgY29uc3QgZTMgPSB0MlsyICogbjNdLCByMyA9IHQyWzIgKiBuMyArIDFdOwogICAgICAgICAgICBlMyA8IGEyICYmIChhMiA9IGUzKSwgcjMgPCB1MiAmJiAodTIgPSByMyksIGUzID4gYzIgJiYgKGMyID0gZTMpLCByMyA+IGYyICYmIChmMiA9IHIzKSwgdGhpcy5faWRzW24zXSA9IG4zOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgczIgPSAoYTIgKyBjMikgLyAyLCBsMiA9ICh1MiArIGYyKSAvIDI7CiAgICAgICAgICBsZXQgaDIsIGQyLCBwMiwgZzIgPSAxIC8gMDsKICAgICAgICAgIGZvciAobGV0IG4zID0gMDsgbjMgPCBvMjsgbjMrKykgewogICAgICAgICAgICBjb25zdCBlMyA9IEV1KHMyLCBsMiwgdDJbMiAqIG4zXSwgdDJbMiAqIG4zICsgMV0pOwogICAgICAgICAgICBlMyA8IGcyICYmIChoMiA9IG4zLCBnMiA9IGUzKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHkyID0gdDJbMiAqIGgyXSwgdjIgPSB0MlsyICogaDIgKyAxXTsKICAgICAgICAgIGcyID0gMSAvIDA7CiAgICAgICAgICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgbzI7IG4zKyspIHsKICAgICAgICAgICAgaWYgKG4zID09PSBoMikKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY29uc3QgZTMgPSBFdSh5MiwgdjIsIHQyWzIgKiBuM10sIHQyWzIgKiBuMyArIDFdKTsKICAgICAgICAgICAgZTMgPCBnMiAmJiBlMyA+IDAgJiYgKGQyID0gbjMsIGcyID0gZTMpOwogICAgICAgICAgfQogICAgICAgICAgbGV0IF8yID0gdDJbMiAqIGQyXSwgYjIgPSB0MlsyICogZDIgKyAxXSwgbTIgPSAxIC8gMDsKICAgICAgICAgIGZvciAobGV0IG4zID0gMDsgbjMgPCBvMjsgbjMrKykgewogICAgICAgICAgICBpZiAobjMgPT09IGgyIHx8IG4zID09PSBkMikKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgY29uc3QgZTMgPSBrdSh5MiwgdjIsIF8yLCBiMiwgdDJbMiAqIG4zXSwgdDJbMiAqIG4zICsgMV0pOwogICAgICAgICAgICBlMyA8IG0yICYmIChwMiA9IG4zLCBtMiA9IGUzKTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCB4MiA9IHQyWzIgKiBwMl0sIHcyID0gdDJbMiAqIHAyICsgMV07CiAgICAgICAgICBpZiAobTIgPT09IDEgLyAwKSB7CiAgICAgICAgICAgIGZvciAobGV0IG40ID0gMDsgbjQgPCBvMjsgbjQrKykKICAgICAgICAgICAgICB0aGlzLl9kaXN0c1tuNF0gPSB0MlsyICogbjRdIC0gdDJbMF0gfHwgdDJbMiAqIG40ICsgMV0gLSB0MlsxXTsKICAgICAgICAgICAgQ3UodGhpcy5faWRzLCB0aGlzLl9kaXN0cywgMCwgbzIgLSAxKTsKICAgICAgICAgICAgY29uc3QgbjMgPSBuZXcgVWludDMyQXJyYXkobzIpOwogICAgICAgICAgICBsZXQgZTMgPSAwOwogICAgICAgICAgICBmb3IgKGxldCB0MyA9IDAsIHIzID0gLTEgLyAwOyB0MyA8IG8yOyB0MysrKSB7CiAgICAgICAgICAgICAgY29uc3QgaTMgPSB0aGlzLl9pZHNbdDNdOwogICAgICAgICAgICAgIHRoaXMuX2Rpc3RzW2kzXSA+IHIzICYmIChuM1tlMysrXSA9IGkzLCByMyA9IHRoaXMuX2Rpc3RzW2kzXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuaHVsbCA9IG4zLnN1YmFycmF5KDAsIGUzKSwgdGhpcy50cmlhbmdsZXMgPSBuZXcgVWludDMyQXJyYXkoMCksIHZvaWQgKHRoaXMuaGFsZmVkZ2VzID0gbmV3IFVpbnQzMkFycmF5KDApKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChNdSh5MiwgdjIsIF8yLCBiMiwgeDIsIHcyKSA8IDApIHsKICAgICAgICAgICAgY29uc3QgdDMgPSBkMiwgbjMgPSBfMiwgZTMgPSBiMjsKICAgICAgICAgICAgZDIgPSBwMiwgXzIgPSB4MiwgYjIgPSB3MiwgcDIgPSB0MywgeDIgPSBuMywgdzIgPSBlMzsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IE0yID0gZnVuY3Rpb24odDMsIG4zLCBlMywgcjMsIGkzLCBvMykgewogICAgICAgICAgICBjb25zdCBhMyA9IGUzIC0gdDMsIHUzID0gcjMgLSBuMywgYzMgPSBpMyAtIHQzLCBmMyA9IG8zIC0gbjMsIHMzID0gYTMgKiBhMyArIHUzICogdTMsIGwzID0gYzMgKiBjMyArIGYzICogZjMsIGgzID0gMC41IC8gKGEzICogZjMgLSB1MyAqIGMzKSwgZDQgPSB0MyArIChmMyAqIHMzIC0gdTMgKiBsMykgKiBoMywgcDMgPSBuMyArIChhMyAqIGwzIC0gYzMgKiBzMykgKiBoMzsKICAgICAgICAgICAgcmV0dXJuIHsgeDogZDQsIHk6IHAzIH07CiAgICAgICAgICB9KHkyLCB2MiwgXzIsIGIyLCB4MiwgdzIpOwogICAgICAgICAgdGhpcy5fY3ggPSBNMi54LCB0aGlzLl9jeSA9IE0yLnk7CiAgICAgICAgICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgbzI7IG4zKyspCiAgICAgICAgICAgIHRoaXMuX2Rpc3RzW24zXSA9IEV1KHQyWzIgKiBuM10sIHQyWzIgKiBuMyArIDFdLCBNMi54LCBNMi55KTsKICAgICAgICAgIEN1KHRoaXMuX2lkcywgdGhpcy5fZGlzdHMsIDAsIG8yIC0gMSksIHRoaXMuX2h1bGxTdGFydCA9IGgyOwogICAgICAgICAgbGV0IFQyID0gMzsKICAgICAgICAgIGUyW2gyXSA9IG4yW3AyXSA9IGQyLCBlMltkMl0gPSBuMltoMl0gPSBwMiwgZTJbcDJdID0gbjJbZDJdID0gaDIsIHIyW2gyXSA9IDAsIHIyW2QyXSA9IDEsIHIyW3AyXSA9IDIsIGkyLmZpbGwoLTEpLCBpMlt0aGlzLl9oYXNoS2V5KHkyLCB2MildID0gaDIsIGkyW3RoaXMuX2hhc2hLZXkoXzIsIGIyKV0gPSBkMiwgaTJbdGhpcy5faGFzaEtleSh4MiwgdzIpXSA9IHAyLCB0aGlzLnRyaWFuZ2xlc0xlbiA9IDAsIHRoaXMuX2FkZFRyaWFuZ2xlKGgyLCBkMiwgcDIsIC0xLCAtMSwgLTEpOwogICAgICAgICAgZm9yIChsZXQgbzMsIGEzLCB1MyA9IDA7IHUzIDwgdGhpcy5faWRzLmxlbmd0aDsgdTMrKykgewogICAgICAgICAgICBjb25zdCBjMyA9IHRoaXMuX2lkc1t1M10sIGYzID0gdDJbMiAqIGMzXSwgczMgPSB0MlsyICogYzMgKyAxXTsKICAgICAgICAgICAgaWYgKHUzID4gMCAmJiBNYXRoLmFicyhmMyAtIG8zKSA8PSBUdSAmJiBNYXRoLmFicyhzMyAtIGEzKSA8PSBUdSkKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgaWYgKG8zID0gZjMsIGEzID0gczMsIGMzID09PSBoMiB8fCBjMyA9PT0gZDIgfHwgYzMgPT09IHAyKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBsZXQgbDMgPSAwOwogICAgICAgICAgICBmb3IgKGxldCB0MyA9IDAsIG4zID0gdGhpcy5faGFzaEtleShmMywgczMpOyB0MyA8IHRoaXMuX2hhc2hTaXplICYmIChsMyA9IGkyWyhuMyArIHQzKSAlIHRoaXMuX2hhc2hTaXplXSwgLTEgPT09IGwzIHx8IGwzID09PSBlMltsM10pOyB0MysrKQogICAgICAgICAgICAgIDsKICAgICAgICAgICAgbDMgPSBuMltsM107CiAgICAgICAgICAgIGxldCBnMywgeTMgPSBsMzsKICAgICAgICAgICAgZm9yICg7IGczID0gZTJbeTNdLCBNdShmMywgczMsIHQyWzIgKiB5M10sIHQyWzIgKiB5MyArIDFdLCB0MlsyICogZzNdLCB0MlsyICogZzMgKyAxXSkgPj0gMDsgKQogICAgICAgICAgICAgIGlmICh5MyA9IGczLCB5MyA9PT0gbDMpIHsKICAgICAgICAgICAgICAgIHkzID0gLTE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgtMSA9PT0geTMpCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGxldCB2MyA9IHRoaXMuX2FkZFRyaWFuZ2xlKHkzLCBjMywgZTJbeTNdLCAtMSwgLTEsIHIyW3kzXSk7CiAgICAgICAgICAgIHIyW2MzXSA9IHRoaXMuX2xlZ2FsaXplKHYzICsgMiksIHIyW3kzXSA9IHYzLCBUMisrOwogICAgICAgICAgICBsZXQgXzMgPSBlMlt5M107CiAgICAgICAgICAgIGZvciAoOyBnMyA9IGUyW18zXSwgTXUoZjMsIHMzLCB0MlsyICogXzNdLCB0MlsyICogXzMgKyAxXSwgdDJbMiAqIGczXSwgdDJbMiAqIGczICsgMV0pIDwgMDsgKQogICAgICAgICAgICAgIHYzID0gdGhpcy5fYWRkVHJpYW5nbGUoXzMsIGMzLCBnMywgcjJbYzNdLCAtMSwgcjJbXzNdKSwgcjJbYzNdID0gdGhpcy5fbGVnYWxpemUodjMgKyAyKSwgZTJbXzNdID0gXzMsIFQyLS0sIF8zID0gZzM7CiAgICAgICAgICAgIGlmICh5MyA9PT0gbDMpCiAgICAgICAgICAgICAgZm9yICg7IGczID0gbjJbeTNdLCBNdShmMywgczMsIHQyWzIgKiBnM10sIHQyWzIgKiBnMyArIDFdLCB0MlsyICogeTNdLCB0MlsyICogeTMgKyAxXSkgPCAwOyApCiAgICAgICAgICAgICAgICB2MyA9IHRoaXMuX2FkZFRyaWFuZ2xlKGczLCBjMywgeTMsIC0xLCByMlt5M10sIHIyW2czXSksIHRoaXMuX2xlZ2FsaXplKHYzICsgMiksIHIyW2czXSA9IHYzLCBlMlt5M10gPSB5MywgVDItLSwgeTMgPSBnMzsKICAgICAgICAgICAgdGhpcy5faHVsbFN0YXJ0ID0gbjJbYzNdID0geTMsIGUyW3kzXSA9IG4yW18zXSA9IGMzLCBlMltjM10gPSBfMywgaTJbdGhpcy5faGFzaEtleShmMywgczMpXSA9IGMzLCBpMlt0aGlzLl9oYXNoS2V5KHQyWzIgKiB5M10sIHQyWzIgKiB5MyArIDFdKV0gPSB5MzsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuaHVsbCA9IG5ldyBVaW50MzJBcnJheShUMik7CiAgICAgICAgICBmb3IgKGxldCB0MyA9IDAsIG4zID0gdGhpcy5faHVsbFN0YXJ0OyB0MyA8IFQyOyB0MysrKQogICAgICAgICAgICB0aGlzLmh1bGxbdDNdID0gbjMsIG4zID0gZTJbbjNdOwogICAgICAgICAgdGhpcy50cmlhbmdsZXMgPSB0aGlzLl90cmlhbmdsZXMuc3ViYXJyYXkoMCwgdGhpcy50cmlhbmdsZXNMZW4pLCB0aGlzLmhhbGZlZGdlcyA9IHRoaXMuX2hhbGZlZGdlcy5zdWJhcnJheSgwLCB0aGlzLnRyaWFuZ2xlc0xlbik7CiAgICAgICAgfQogICAgICAgIF9oYXNoS2V5KHQyLCBuMikgewogICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICAgIGNvbnN0IGUyID0gdDMgLyAoTWF0aC5hYnModDMpICsgTWF0aC5hYnMobjMpKTsKICAgICAgICAgICAgcmV0dXJuIChuMyA+IDAgPyAzIC0gZTIgOiAxICsgZTIpIC8gNDsKICAgICAgICAgIH0odDIgLSB0aGlzLl9jeCwgbjIgLSB0aGlzLl9jeSkgKiB0aGlzLl9oYXNoU2l6ZSkgJSB0aGlzLl9oYXNoU2l6ZTsKICAgICAgICB9CiAgICAgICAgX2xlZ2FsaXplKHQyKSB7CiAgICAgICAgICBjb25zdCB7IF90cmlhbmdsZXM6IG4yLCBfaGFsZmVkZ2VzOiBlMiwgY29vcmRzOiByMiB9ID0gdGhpczsKICAgICAgICAgIGxldCBpMiA9IDAsIG8yID0gMDsKICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICBjb25zdCBhMiA9IGUyW3QyXSwgdTIgPSB0MiAtIHQyICUgMzsKICAgICAgICAgICAgaWYgKG8yID0gdTIgKyAodDIgKyAyKSAlIDMsIC0xID09PSBhMikgewogICAgICAgICAgICAgIGlmICgwID09PSBpMikKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIHQyID0gQXVbLS1pMl07CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgYzIgPSBhMiAtIGEyICUgMywgZjIgPSB1MiArICh0MiArIDEpICUgMywgczIgPSBjMiArIChhMiArIDIpICUgMywgbDIgPSBuMltvMl0sIGgyID0gbjJbdDJdLCBkMiA9IG4yW2YyXSwgcDIgPSBuMltzMl07CiAgICAgICAgICAgIGlmIChOdShyMlsyICogbDJdLCByMlsyICogbDIgKyAxXSwgcjJbMiAqIGgyXSwgcjJbMiAqIGgyICsgMV0sIHIyWzIgKiBkMl0sIHIyWzIgKiBkMiArIDFdLCByMlsyICogcDJdLCByMlsyICogcDIgKyAxXSkpIHsKICAgICAgICAgICAgICBuMlt0Ml0gPSBwMiwgbjJbYTJdID0gbDI7CiAgICAgICAgICAgICAgY29uc3QgcjMgPSBlMltzMl07CiAgICAgICAgICAgICAgaWYgKC0xID09PSByMykgewogICAgICAgICAgICAgICAgbGV0IG4zID0gdGhpcy5faHVsbFN0YXJ0OwogICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICBpZiAodGhpcy5faHVsbFRyaVtuM10gPT09IHMyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faHVsbFRyaVtuM10gPSB0MjsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBuMyA9IHRoaXMuX2h1bGxQcmV2W24zXTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKG4zICE9PSB0aGlzLl9odWxsU3RhcnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLl9saW5rKHQyLCByMyksIHRoaXMuX2xpbmsoYTIsIGUyW28yXSksIHRoaXMuX2xpbmsobzIsIHMyKTsKICAgICAgICAgICAgICBjb25zdCB1MyA9IGMyICsgKGEyICsgMSkgJSAzOwogICAgICAgICAgICAgIGkyIDwgQXUubGVuZ3RoICYmIChBdVtpMisrXSA9IHUzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoMCA9PT0gaTIpCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB0MiA9IEF1Wy0taTJdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbzI7CiAgICAgICAgfQogICAgICAgIF9saW5rKHQyLCBuMikgewogICAgICAgICAgdGhpcy5faGFsZmVkZ2VzW3QyXSA9IG4yLCAtMSAhPT0gbjIgJiYgKHRoaXMuX2hhbGZlZGdlc1tuMl0gPSB0Mik7CiAgICAgICAgfQogICAgICAgIF9hZGRUcmlhbmdsZSh0MiwgbjIsIGUyLCByMiwgaTIsIG8yKSB7CiAgICAgICAgICBjb25zdCBhMiA9IHRoaXMudHJpYW5nbGVzTGVuOwogICAgICAgICAgcmV0dXJuIHRoaXMuX3RyaWFuZ2xlc1thMl0gPSB0MiwgdGhpcy5fdHJpYW5nbGVzW2EyICsgMV0gPSBuMiwgdGhpcy5fdHJpYW5nbGVzW2EyICsgMl0gPSBlMiwgdGhpcy5fbGluayhhMiwgcjIpLCB0aGlzLl9saW5rKGEyICsgMSwgaTIpLCB0aGlzLl9saW5rKGEyICsgMiwgbzIpLCB0aGlzLnRyaWFuZ2xlc0xlbiArPSAzLCBhMjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRXUodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICBjb25zdCBpMiA9IHQyIC0gZTIsIG8yID0gbjIgLSByMjsKICAgICAgICByZXR1cm4gaTIgKiBpMiArIG8yICogbzI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTnUodDIsIG4yLCBlMiwgcjIsIGkyLCBvMiwgYTIsIHUyKSB7CiAgICAgICAgY29uc3QgYzIgPSB0MiAtIGEyLCBmMiA9IG4yIC0gdTIsIHMyID0gZTIgLSBhMiwgbDIgPSByMiAtIHUyLCBoMiA9IGkyIC0gYTIsIGQyID0gbzIgLSB1MiwgcDIgPSBzMiAqIHMyICsgbDIgKiBsMiwgZzIgPSBoMiAqIGgyICsgZDIgKiBkMjsKICAgICAgICByZXR1cm4gYzIgKiAobDIgKiBnMiAtIHAyICogZDIpIC0gZjIgKiAoczIgKiBnMiAtIHAyICogaDIpICsgKGMyICogYzIgKyBmMiAqIGYyKSAqIChzMiAqIGQyIC0gbDIgKiBoMikgPCAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGt1KHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIpIHsKICAgICAgICBjb25zdCBhMiA9IGUyIC0gdDIsIHUyID0gcjIgLSBuMiwgYzIgPSBpMiAtIHQyLCBmMiA9IG8yIC0gbjIsIHMyID0gYTIgKiBhMiArIHUyICogdTIsIGwyID0gYzIgKiBjMiArIGYyICogZjIsIGgyID0gMC41IC8gKGEyICogZjIgLSB1MiAqIGMyKSwgZDIgPSAoZjIgKiBzMiAtIHUyICogbDIpICogaDIsIHAyID0gKGEyICogbDIgLSBjMiAqIHMyKSAqIGgyOwogICAgICAgIHJldHVybiBkMiAqIGQyICsgcDIgKiBwMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBDdSh0MiwgbjIsIGUyLCByMikgewogICAgICAgIGlmIChyMiAtIGUyIDw9IDIwKQogICAgICAgICAgZm9yIChsZXQgaTIgPSBlMiArIDE7IGkyIDw9IHIyOyBpMisrKSB7CiAgICAgICAgICAgIGNvbnN0IHIzID0gdDJbaTJdLCBvMiA9IG4yW3IzXTsKICAgICAgICAgICAgbGV0IGEyID0gaTIgLSAxOwogICAgICAgICAgICBmb3IgKDsgYTIgPj0gZTIgJiYgbjJbdDJbYTJdXSA+IG8yOyApCiAgICAgICAgICAgICAgdDJbYTIgKyAxXSA9IHQyW2EyLS1dOwogICAgICAgICAgICB0MlthMiArIDFdID0gcjM7CiAgICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBsZXQgaTIgPSBlMiArIDEsIG8yID0gcjI7CiAgICAgICAgICBQdSh0MiwgZTIgKyByMiA+PiAxLCBpMiksIG4yW3QyW2UyXV0gPiBuMlt0MltyMl1dICYmIFB1KHQyLCBlMiwgcjIpLCBuMlt0MltpMl1dID4gbjJbdDJbcjJdXSAmJiBQdSh0MiwgaTIsIHIyKSwgbjJbdDJbZTJdXSA+IG4yW3QyW2kyXV0gJiYgUHUodDIsIGUyLCBpMik7CiAgICAgICAgICBjb25zdCBhMiA9IHQyW2kyXSwgdTIgPSBuMlthMl07CiAgICAgICAgICBmb3IgKDsgOyApIHsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGkyKys7CiAgICAgICAgICAgIH0gd2hpbGUgKG4yW3QyW2kyXV0gPCB1Mik7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBvMi0tOwogICAgICAgICAgICB9IHdoaWxlIChuMlt0MltvMl1dID4gdTIpOwogICAgICAgICAgICBpZiAobzIgPCBpMikKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgUHUodDIsIGkyLCBvMik7CiAgICAgICAgICB9CiAgICAgICAgICB0MltlMiArIDFdID0gdDJbbzJdLCB0MltvMl0gPSBhMiwgcjIgLSBpMiArIDEgPj0gbzIgLSBlMiA/IChDdSh0MiwgbjIsIGkyLCByMiksIEN1KHQyLCBuMiwgZTIsIG8yIC0gMSkpIDogKEN1KHQyLCBuMiwgZTIsIG8yIC0gMSksIEN1KHQyLCBuMiwgaTIsIHIyKSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIFB1KHQyLCBuMiwgZTIpIHsKICAgICAgICBjb25zdCByMiA9IHQyW24yXTsKICAgICAgICB0MltuMl0gPSB0MltlMl0sIHQyW2UyXSA9IHIyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHp1KHQyKSB7CiAgICAgICAgcmV0dXJuIHQyWzBdOwogICAgICB9CiAgICAgIGZ1bmN0aW9uICR1KHQyKSB7CiAgICAgICAgcmV0dXJuIHQyWzFdOwogICAgICB9CiAgICAgIGNvbnN0IER1ID0gMWUtNjsKICAgICAgY2xhc3MgUnUgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgdGhpcy5feDAgPSB0aGlzLl95MCA9IHRoaXMuX3gxID0gdGhpcy5feTEgPSBudWxsLCB0aGlzLl8gPSAiIjsKICAgICAgICB9CiAgICAgICAgbW92ZVRvKHQyLCBuMikgewogICAgICAgICAgdGhpcy5fICs9IGBNJHt0aGlzLl94MCA9IHRoaXMuX3gxID0gK3QyfSwke3RoaXMuX3kwID0gdGhpcy5feTEgPSArbjJ9YDsKICAgICAgICB9CiAgICAgICAgY2xvc2VQYXRoKCkgewogICAgICAgICAgbnVsbCAhPT0gdGhpcy5feDEgJiYgKHRoaXMuX3gxID0gdGhpcy5feDAsIHRoaXMuX3kxID0gdGhpcy5feTAsIHRoaXMuXyArPSAiWiIpOwogICAgICAgIH0KICAgICAgICBsaW5lVG8odDIsIG4yKSB7CiAgICAgICAgICB0aGlzLl8gKz0gYEwke3RoaXMuX3gxID0gK3QyfSwke3RoaXMuX3kxID0gK24yfWA7CiAgICAgICAgfQogICAgICAgIGFyYyh0MiwgbjIsIGUyKSB7CiAgICAgICAgICBjb25zdCByMiA9ICh0MiA9ICt0MikgKyAoZTIgPSArZTIpLCBpMiA9IG4yID0gK24yOwogICAgICAgICAgaWYgKGUyIDwgMCkKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJuZWdhdGl2ZSByYWRpdXMiKTsKICAgICAgICAgIG51bGwgPT09IHRoaXMuX3gxID8gdGhpcy5fICs9IGBNJHtyMn0sJHtpMn1gIDogKE1hdGguYWJzKHRoaXMuX3gxIC0gcjIpID4gRHUgfHwgTWF0aC5hYnModGhpcy5feTEgLSBpMikgPiBEdSkgJiYgKHRoaXMuXyArPSAiTCIgKyByMiArICIsIiArIGkyKSwgZTIgJiYgKHRoaXMuXyArPSBgQSR7ZTJ9LCR7ZTJ9LDAsMSwxLCR7dDIgLSBlMn0sJHtuMn1BJHtlMn0sJHtlMn0sMCwxLDEsJHt0aGlzLl94MSA9IHIyfSwke3RoaXMuX3kxID0gaTJ9YCk7CiAgICAgICAgfQogICAgICAgIHJlY3QodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICAgIHRoaXMuXyArPSBgTSR7dGhpcy5feDAgPSB0aGlzLl94MSA9ICt0Mn0sJHt0aGlzLl95MCA9IHRoaXMuX3kxID0gK24yfWgkeytlMn12JHsrcjJ9aCR7LWUyfVpgOwogICAgICAgIH0KICAgICAgICB2YWx1ZSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl8gfHwgbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgICAgY2xhc3MgRnUgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgdGhpcy5fID0gW107CiAgICAgICAgfQogICAgICAgIG1vdmVUbyh0MiwgbjIpIHsKICAgICAgICAgIHRoaXMuXy5wdXNoKFt0MiwgbjJdKTsKICAgICAgICB9CiAgICAgICAgY2xvc2VQYXRoKCkgewogICAgICAgICAgdGhpcy5fLnB1c2godGhpcy5fWzBdLnNsaWNlKCkpOwogICAgICAgIH0KICAgICAgICBsaW5lVG8odDIsIG4yKSB7CiAgICAgICAgICB0aGlzLl8ucHVzaChbdDIsIG4yXSk7CiAgICAgICAgfQogICAgICAgIHZhbHVlKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuXy5sZW5ndGggPyB0aGlzLl8gOiBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgICBjbGFzcyBxdSB7CiAgICAgICAgY29uc3RydWN0b3IodDIsIFtuMiwgZTIsIHIyLCBpMl0gPSBbMCwgMCwgOTYwLCA1MDBdKSB7CiAgICAgICAgICBpZiAoISgocjIgPSArcjIpID49IChuMiA9ICtuMikgJiYgKGkyID0gK2kyKSA+PSAoZTIgPSArZTIpKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGJvdW5kcyIpOwogICAgICAgICAgdGhpcy5kZWxhdW5heSA9IHQyLCB0aGlzLl9jaXJjdW1jZW50ZXJzID0gbmV3IEZsb2F0NjRBcnJheSgyICogdDIucG9pbnRzLmxlbmd0aCksIHRoaXMudmVjdG9ycyA9IG5ldyBGbG9hdDY0QXJyYXkoMiAqIHQyLnBvaW50cy5sZW5ndGgpLCB0aGlzLnhtYXggPSByMiwgdGhpcy54bWluID0gbjIsIHRoaXMueW1heCA9IGkyLCB0aGlzLnltaW4gPSBlMiwgdGhpcy5faW5pdCgpOwogICAgICAgIH0KICAgICAgICB1cGRhdGUoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5kZWxhdW5heS51cGRhdGUoKSwgdGhpcy5faW5pdCgpLCB0aGlzOwogICAgICAgIH0KICAgICAgICBfaW5pdCgpIHsKICAgICAgICAgIGNvbnN0IHsgZGVsYXVuYXk6IHsgcG9pbnRzOiB0MiwgaHVsbDogbjIsIHRyaWFuZ2xlczogZTIgfSwgdmVjdG9yczogcjIgfSA9IHRoaXM7CiAgICAgICAgICBsZXQgaTIsIG8yOwogICAgICAgICAgY29uc3QgYTIgPSB0aGlzLmNpcmN1bWNlbnRlcnMgPSB0aGlzLl9jaXJjdW1jZW50ZXJzLnN1YmFycmF5KDAsIGUyLmxlbmd0aCAvIDMgKiAyKTsKICAgICAgICAgIGZvciAobGV0IHIzLCB1MywgYzMgPSAwLCBmMyA9IDAsIHMzID0gZTIubGVuZ3RoOyBjMyA8IHMzOyBjMyArPSAzLCBmMyArPSAyKSB7CiAgICAgICAgICAgIGNvbnN0IHM0ID0gMiAqIGUyW2MzXSwgbDMgPSAyICogZTJbYzMgKyAxXSwgaDMgPSAyICogZTJbYzMgKyAyXSwgZDQgPSB0MltzNF0sIHAyID0gdDJbczQgKyAxXSwgZzIgPSB0MltsM10sIHkyID0gdDJbbDMgKyAxXSwgdjIgPSB0MltoM10sIF8yID0gdDJbaDMgKyAxXSwgYjIgPSBnMiAtIGQ0LCBtMiA9IHkyIC0gcDIsIHgyID0gdjIgLSBkNCwgdzIgPSBfMiAtIHAyLCBNMiA9IDIgKiAoYjIgKiB3MiAtIG0yICogeDIpOwogICAgICAgICAgICBpZiAoTWF0aC5hYnMoTTIpIDwgMWUtOSkgewogICAgICAgICAgICAgIGlmICh2b2lkIDAgPT09IGkyKSB7CiAgICAgICAgICAgICAgICBpMiA9IG8yID0gMDsKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZTQgb2YgbjIpCiAgICAgICAgICAgICAgICAgIGkyICs9IHQyWzIgKiBlNF0sIG8yICs9IHQyWzIgKiBlNCArIDFdOwogICAgICAgICAgICAgICAgaTIgLz0gbjIubGVuZ3RoLCBvMiAvPSBuMi5sZW5ndGg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGUzID0gMWU5ICogTWF0aC5zaWduKChpMiAtIGQ0KSAqIHcyIC0gKG8yIC0gcDIpICogeDIpOwogICAgICAgICAgICAgIHIzID0gKGQ0ICsgdjIpIC8gMiAtIGUzICogdzIsIHUzID0gKHAyICsgXzIpIC8gMiArIGUzICogeDI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc3QgdDMgPSAxIC8gTTIsIG4zID0gYjIgKiBiMiArIG0yICogbTIsIGUzID0geDIgKiB4MiArIHcyICogdzI7CiAgICAgICAgICAgICAgcjMgPSBkNCArICh3MiAqIG4zIC0gbTIgKiBlMykgKiB0MywgdTMgPSBwMiArIChiMiAqIGUzIC0geDIgKiBuMykgKiB0MzsKICAgICAgICAgICAgfQogICAgICAgICAgICBhMltmM10gPSByMywgYTJbZjMgKyAxXSA9IHUzOwogICAgICAgICAgfQogICAgICAgICAgbGV0IHUyLCBjMiwgZjIsIHMyID0gbjJbbjIubGVuZ3RoIC0gMV0sIGwyID0gNCAqIHMyLCBoMiA9IHQyWzIgKiBzMl0sIGQyID0gdDJbMiAqIHMyICsgMV07CiAgICAgICAgICByMi5maWxsKDApOwogICAgICAgICAgZm9yIChsZXQgZTMgPSAwOyBlMyA8IG4yLmxlbmd0aDsgKytlMykKICAgICAgICAgICAgczIgPSBuMltlM10sIHUyID0gbDIsIGMyID0gaDIsIGYyID0gZDIsIGwyID0gNCAqIHMyLCBoMiA9IHQyWzIgKiBzMl0sIGQyID0gdDJbMiAqIHMyICsgMV0sIHIyW3UyICsgMl0gPSByMltsMl0gPSBmMiAtIGQyLCByMlt1MiArIDNdID0gcjJbbDIgKyAxXSA9IGgyIC0gYzI7CiAgICAgICAgfQogICAgICAgIHJlbmRlcih0MikgewogICAgICAgICAgY29uc3QgbjIgPSBudWxsID09IHQyID8gdDIgPSBuZXcgUnUoKSA6IHZvaWQgMCwgeyBkZWxhdW5heTogeyBoYWxmZWRnZXM6IGUyLCBpbmVkZ2VzOiByMiwgaHVsbDogaTIgfSwgY2lyY3VtY2VudGVyczogbzIsIHZlY3RvcnM6IGEyIH0gPSB0aGlzOwogICAgICAgICAgaWYgKGkyLmxlbmd0aCA8PSAxKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIGZvciAobGV0IG4zID0gMCwgcjMgPSBlMi5sZW5ndGg7IG4zIDwgcjM7ICsrbjMpIHsKICAgICAgICAgICAgY29uc3QgcjQgPSBlMltuM107CiAgICAgICAgICAgIGlmIChyNCA8IG4zKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCBpMyA9IDIgKiBNYXRoLmZsb29yKG4zIC8gMyksIGEzID0gMiAqIE1hdGguZmxvb3IocjQgLyAzKSwgdTMgPSBvMltpM10sIGMzID0gbzJbaTMgKyAxXSwgZjIgPSBvMlthM10sIHMyID0gbzJbYTMgKyAxXTsKICAgICAgICAgICAgdGhpcy5fcmVuZGVyU2VnbWVudCh1MywgYzMsIGYyLCBzMiwgdDIpOwogICAgICAgICAgfQogICAgICAgICAgbGV0IHUyLCBjMiA9IGkyW2kyLmxlbmd0aCAtIDFdOwogICAgICAgICAgZm9yIChsZXQgbjMgPSAwOyBuMyA8IGkyLmxlbmd0aDsgKytuMykgewogICAgICAgICAgICB1MiA9IGMyLCBjMiA9IGkyW24zXTsKICAgICAgICAgICAgY29uc3QgZTMgPSAyICogTWF0aC5mbG9vcihyMltjMl0gLyAzKSwgZjIgPSBvMltlM10sIHMyID0gbzJbZTMgKyAxXSwgbDIgPSA0ICogdTIsIGgyID0gdGhpcy5fcHJvamVjdChmMiwgczIsIGEyW2wyICsgMl0sIGEyW2wyICsgM10pOwogICAgICAgICAgICBoMiAmJiB0aGlzLl9yZW5kZXJTZWdtZW50KGYyLCBzMiwgaDJbMF0sIGgyWzFdLCB0Mik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbjIgJiYgbjIudmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgcmVuZGVyQm91bmRzKHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IG51bGwgPT0gdDIgPyB0MiA9IG5ldyBSdSgpIDogdm9pZCAwOwogICAgICAgICAgcmV0dXJuIHQyLnJlY3QodGhpcy54bWluLCB0aGlzLnltaW4sIHRoaXMueG1heCAtIHRoaXMueG1pbiwgdGhpcy55bWF4IC0gdGhpcy55bWluKSwgbjIgJiYgbjIudmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgcmVuZGVyQ2VsbCh0MiwgbjIpIHsKICAgICAgICAgIGNvbnN0IGUyID0gbnVsbCA9PSBuMiA/IG4yID0gbmV3IFJ1KCkgOiB2b2lkIDAsIHIyID0gdGhpcy5fY2xpcCh0Mik7CiAgICAgICAgICBpZiAobnVsbCA9PT0gcjIgfHwgIXIyLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgbjIubW92ZVRvKHIyWzBdLCByMlsxXSk7CiAgICAgICAgICBsZXQgaTIgPSByMi5sZW5ndGg7CiAgICAgICAgICBmb3IgKDsgcjJbMF0gPT09IHIyW2kyIC0gMl0gJiYgcjJbMV0gPT09IHIyW2kyIC0gMV0gJiYgaTIgPiAxOyApCiAgICAgICAgICAgIGkyIC09IDI7CiAgICAgICAgICBmb3IgKGxldCB0MyA9IDI7IHQzIDwgaTI7IHQzICs9IDIpCiAgICAgICAgICAgIHIyW3QzXSA9PT0gcjJbdDMgLSAyXSAmJiByMlt0MyArIDFdID09PSByMlt0MyAtIDFdIHx8IG4yLmxpbmVUbyhyMlt0M10sIHIyW3QzICsgMV0pOwogICAgICAgICAgcmV0dXJuIG4yLmNsb3NlUGF0aCgpLCBlMiAmJiBlMi52YWx1ZSgpOwogICAgICAgIH0KICAgICAgICAqY2VsbFBvbHlnb25zKCkgewogICAgICAgICAgY29uc3QgeyBkZWxhdW5heTogeyBwb2ludHM6IHQyIH0gfSA9IHRoaXM7CiAgICAgICAgICBmb3IgKGxldCBuMiA9IDAsIGUyID0gdDIubGVuZ3RoIC8gMjsgbjIgPCBlMjsgKytuMikgewogICAgICAgICAgICBjb25zdCB0MyA9IHRoaXMuY2VsbFBvbHlnb24objIpOwogICAgICAgICAgICB0MyAmJiAodDMuaW5kZXggPSBuMiwgeWllbGQgdDMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjZWxsUG9seWdvbih0MikgewogICAgICAgICAgY29uc3QgbjIgPSBuZXcgRnUoKTsKICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckNlbGwodDIsIG4yKSwgbjIudmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgX3JlbmRlclNlZ21lbnQodDIsIG4yLCBlMiwgcjIsIGkyKSB7CiAgICAgICAgICBsZXQgbzI7CiAgICAgICAgICBjb25zdCBhMiA9IHRoaXMuX3JlZ2lvbmNvZGUodDIsIG4yKSwgdTIgPSB0aGlzLl9yZWdpb25jb2RlKGUyLCByMik7CiAgICAgICAgICAwID09PSBhMiAmJiAwID09PSB1MiA/IChpMi5tb3ZlVG8odDIsIG4yKSwgaTIubGluZVRvKGUyLCByMikpIDogKG8yID0gdGhpcy5fY2xpcFNlZ21lbnQodDIsIG4yLCBlMiwgcjIsIGEyLCB1MikpICYmIChpMi5tb3ZlVG8obzJbMF0sIG8yWzFdKSwgaTIubGluZVRvKG8yWzJdLCBvMlszXSkpOwogICAgICAgIH0KICAgICAgICBjb250YWlucyh0MiwgbjIsIGUyKSB7CiAgICAgICAgICByZXR1cm4gKG4yID0gK24yKSA9PSBuMiAmJiAoZTIgPSArZTIpID09IGUyICYmIHRoaXMuZGVsYXVuYXkuX3N0ZXAodDIsIG4yLCBlMikgPT09IHQyOwogICAgICAgIH0KICAgICAgICAqbmVpZ2hib3JzKHQyKSB7CiAgICAgICAgICBjb25zdCBuMiA9IHRoaXMuX2NsaXAodDIpOwogICAgICAgICAgaWYgKG4yKQogICAgICAgICAgICBmb3IgKGNvbnN0IGUyIG9mIHRoaXMuZGVsYXVuYXkubmVpZ2hib3JzKHQyKSkgewogICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5fY2xpcChlMik7CiAgICAgICAgICAgICAgaWYgKHQzKSB7CiAgICAgICAgICAgICAgICB0OgogICAgICAgICAgICAgICAgICBmb3IgKGxldCByMiA9IDAsIGkyID0gbjIubGVuZ3RoOyByMiA8IGkyOyByMiArPSAyKQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG8yID0gMCwgYTIgPSB0My5sZW5ndGg7IG8yIDwgYTI7IG8yICs9IDIpCiAgICAgICAgICAgICAgICAgICAgICBpZiAobjJbcjJdID09PSB0M1tvMl0gJiYgbjJbcjIgKyAxXSA9PT0gdDNbbzIgKyAxXSAmJiBuMlsocjIgKyAyKSAlIGkyXSA9PT0gdDNbKG8yICsgYTIgLSAyKSAlIGEyXSAmJiBuMlsocjIgKyAzKSAlIGkyXSA9PT0gdDNbKG8yICsgYTIgLSAxKSAlIGEyXSkgewogICAgICAgICAgICAgICAgICAgICAgICB5aWVsZCBlMjsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdDsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgX2NlbGwodDIpIHsKICAgICAgICAgIGNvbnN0IHsgY2lyY3VtY2VudGVyczogbjIsIGRlbGF1bmF5OiB7IGluZWRnZXM6IGUyLCBoYWxmZWRnZXM6IHIyLCB0cmlhbmdsZXM6IGkyIH0gfSA9IHRoaXMsIG8yID0gZTJbdDJdOwogICAgICAgICAgaWYgKC0xID09PSBvMikKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICBjb25zdCBhMiA9IFtdOwogICAgICAgICAgbGV0IHUyID0gbzI7CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIGNvbnN0IGUzID0gTWF0aC5mbG9vcih1MiAvIDMpOwogICAgICAgICAgICBpZiAoYTIucHVzaChuMlsyICogZTNdLCBuMlsyICogZTMgKyAxXSksIHUyID0gdTIgJSAzID09IDIgPyB1MiAtIDIgOiB1MiArIDEsIGkyW3UyXSAhPT0gdDIpCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIHUyID0gcjJbdTJdOwogICAgICAgICAgfSB3aGlsZSAodTIgIT09IG8yICYmIC0xICE9PSB1Mik7CiAgICAgICAgICByZXR1cm4gYTI7CiAgICAgICAgfQogICAgICAgIF9jbGlwKHQyKSB7CiAgICAgICAgICBpZiAoMCA9PT0gdDIgJiYgMSA9PT0gdGhpcy5kZWxhdW5heS5odWxsLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIFt0aGlzLnhtYXgsIHRoaXMueW1pbiwgdGhpcy54bWF4LCB0aGlzLnltYXgsIHRoaXMueG1pbiwgdGhpcy55bWF4LCB0aGlzLnhtaW4sIHRoaXMueW1pbl07CiAgICAgICAgICBjb25zdCBuMiA9IHRoaXMuX2NlbGwodDIpOwogICAgICAgICAgaWYgKG51bGwgPT09IG4yKQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIGNvbnN0IHsgdmVjdG9yczogZTIgfSA9IHRoaXMsIHIyID0gNCAqIHQyOwogICAgICAgICAgcmV0dXJuIHRoaXMuX3NpbXBsaWZ5KGUyW3IyXSB8fCBlMltyMiArIDFdID8gdGhpcy5fY2xpcEluZmluaXRlKHQyLCBuMiwgZTJbcjJdLCBlMltyMiArIDFdLCBlMltyMiArIDJdLCBlMltyMiArIDNdKSA6IHRoaXMuX2NsaXBGaW5pdGUodDIsIG4yKSk7CiAgICAgICAgfQogICAgICAgIF9jbGlwRmluaXRlKHQyLCBuMikgewogICAgICAgICAgY29uc3QgZTIgPSBuMi5sZW5ndGg7CiAgICAgICAgICBsZXQgcjIsIGkyLCBvMiwgYTIsIHUyID0gbnVsbCwgYzIgPSBuMltlMiAtIDJdLCBmMiA9IG4yW2UyIC0gMV0sIHMyID0gdGhpcy5fcmVnaW9uY29kZShjMiwgZjIpLCBsMiA9IDA7CiAgICAgICAgICBmb3IgKGxldCBoMiA9IDA7IGgyIDwgZTI7IGgyICs9IDIpCiAgICAgICAgICAgIGlmIChyMiA9IGMyLCBpMiA9IGYyLCBjMiA9IG4yW2gyXSwgZjIgPSBuMltoMiArIDFdLCBvMiA9IHMyLCBzMiA9IHRoaXMuX3JlZ2lvbmNvZGUoYzIsIGYyKSwgMCA9PT0gbzIgJiYgMCA9PT0gczIpCiAgICAgICAgICAgICAgYTIgPSBsMiwgbDIgPSAwLCB1MiA/IHUyLnB1c2goYzIsIGYyKSA6IHUyID0gW2MyLCBmMl07CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGxldCBuMywgZTMsIGgzLCBkMiwgcDI7CiAgICAgICAgICAgICAgaWYgKDAgPT09IG8yKSB7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PT0gKG4zID0gdGhpcy5fY2xpcFNlZ21lbnQocjIsIGkyLCBjMiwgZjIsIG8yLCBzMikpKQogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIFtlMywgaDMsIGQyLCBwMl0gPSBuMzsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IChuMyA9IHRoaXMuX2NsaXBTZWdtZW50KGMyLCBmMiwgcjIsIGkyLCBzMiwgbzIpKSkKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICBbZDIsIHAyLCBlMywgaDNdID0gbjMsIGEyID0gbDIsIGwyID0gdGhpcy5fZWRnZWNvZGUoZTMsIGgzKSwgYTIgJiYgbDIgJiYgdGhpcy5fZWRnZSh0MiwgYTIsIGwyLCB1MiwgdTIubGVuZ3RoKSwgdTIgPyB1Mi5wdXNoKGUzLCBoMykgOiB1MiA9IFtlMywgaDNdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhMiA9IGwyLCBsMiA9IHRoaXMuX2VkZ2Vjb2RlKGQyLCBwMiksIGEyICYmIGwyICYmIHRoaXMuX2VkZ2UodDIsIGEyLCBsMiwgdTIsIHUyLmxlbmd0aCksIHUyID8gdTIucHVzaChkMiwgcDIpIDogdTIgPSBbZDIsIHAyXTsKICAgICAgICAgICAgfQogICAgICAgICAgaWYgKHUyKQogICAgICAgICAgICBhMiA9IGwyLCBsMiA9IHRoaXMuX2VkZ2Vjb2RlKHUyWzBdLCB1MlsxXSksIGEyICYmIGwyICYmIHRoaXMuX2VkZ2UodDIsIGEyLCBsMiwgdTIsIHUyLmxlbmd0aCk7CiAgICAgICAgICBlbHNlIGlmICh0aGlzLmNvbnRhaW5zKHQyLCAodGhpcy54bWluICsgdGhpcy54bWF4KSAvIDIsICh0aGlzLnltaW4gKyB0aGlzLnltYXgpIC8gMikpCiAgICAgICAgICAgIHJldHVybiBbdGhpcy54bWF4LCB0aGlzLnltaW4sIHRoaXMueG1heCwgdGhpcy55bWF4LCB0aGlzLnhtaW4sIHRoaXMueW1heCwgdGhpcy54bWluLCB0aGlzLnltaW5dOwogICAgICAgICAgcmV0dXJuIHUyOwogICAgICAgIH0KICAgICAgICBfY2xpcFNlZ21lbnQodDIsIG4yLCBlMiwgcjIsIGkyLCBvMikgewogICAgICAgICAgY29uc3QgYTIgPSBpMiA8IG8yOwogICAgICAgICAgZm9yIChhMiAmJiAoW3QyLCBuMiwgZTIsIHIyLCBpMiwgbzJdID0gW2UyLCByMiwgdDIsIG4yLCBvMiwgaTJdKTsgOyApIHsKICAgICAgICAgICAgaWYgKDAgPT09IGkyICYmIDAgPT09IG8yKQogICAgICAgICAgICAgIHJldHVybiBhMiA/IFtlMiwgcjIsIHQyLCBuMl0gOiBbdDIsIG4yLCBlMiwgcjJdOwogICAgICAgICAgICBpZiAoaTIgJiBvMikKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgbGV0IHUyLCBjMiwgZjIgPSBpMiB8fCBvMjsKICAgICAgICAgICAgOCAmIGYyID8gKHUyID0gdDIgKyAoZTIgLSB0MikgKiAodGhpcy55bWF4IC0gbjIpIC8gKHIyIC0gbjIpLCBjMiA9IHRoaXMueW1heCkgOiA0ICYgZjIgPyAodTIgPSB0MiArIChlMiAtIHQyKSAqICh0aGlzLnltaW4gLSBuMikgLyAocjIgLSBuMiksIGMyID0gdGhpcy55bWluKSA6IDIgJiBmMiA/IChjMiA9IG4yICsgKHIyIC0gbjIpICogKHRoaXMueG1heCAtIHQyKSAvIChlMiAtIHQyKSwgdTIgPSB0aGlzLnhtYXgpIDogKGMyID0gbjIgKyAocjIgLSBuMikgKiAodGhpcy54bWluIC0gdDIpIC8gKGUyIC0gdDIpLCB1MiA9IHRoaXMueG1pbiksIGkyID8gKHQyID0gdTIsIG4yID0gYzIsIGkyID0gdGhpcy5fcmVnaW9uY29kZSh0MiwgbjIpKSA6IChlMiA9IHUyLCByMiA9IGMyLCBvMiA9IHRoaXMuX3JlZ2lvbmNvZGUoZTIsIHIyKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIF9jbGlwSW5maW5pdGUodDIsIG4yLCBlMiwgcjIsIGkyLCBvMikgewogICAgICAgICAgbGV0IGEyLCB1MiA9IEFycmF5LmZyb20objIpOwogICAgICAgICAgaWYgKChhMiA9IHRoaXMuX3Byb2plY3QodTJbMF0sIHUyWzFdLCBlMiwgcjIpKSAmJiB1Mi51bnNoaWZ0KGEyWzBdLCBhMlsxXSksIChhMiA9IHRoaXMuX3Byb2plY3QodTJbdTIubGVuZ3RoIC0gMl0sIHUyW3UyLmxlbmd0aCAtIDFdLCBpMiwgbzIpKSAmJiB1Mi5wdXNoKGEyWzBdLCBhMlsxXSksIHUyID0gdGhpcy5fY2xpcEZpbml0ZSh0MiwgdTIpKQogICAgICAgICAgICBmb3IgKGxldCBuMywgZTMgPSAwLCByMyA9IHUyLmxlbmd0aCwgaTMgPSB0aGlzLl9lZGdlY29kZSh1MltyMyAtIDJdLCB1MltyMyAtIDFdKTsgZTMgPCByMzsgZTMgKz0gMikKICAgICAgICAgICAgICBuMyA9IGkzLCBpMyA9IHRoaXMuX2VkZ2Vjb2RlKHUyW2UzXSwgdTJbZTMgKyAxXSksIG4zICYmIGkzICYmIChlMyA9IHRoaXMuX2VkZ2UodDIsIG4zLCBpMywgdTIsIGUzKSwgcjMgPSB1Mi5sZW5ndGgpOwogICAgICAgICAgZWxzZQogICAgICAgICAgICB0aGlzLmNvbnRhaW5zKHQyLCAodGhpcy54bWluICsgdGhpcy54bWF4KSAvIDIsICh0aGlzLnltaW4gKyB0aGlzLnltYXgpIC8gMikgJiYgKHUyID0gW3RoaXMueG1pbiwgdGhpcy55bWluLCB0aGlzLnhtYXgsIHRoaXMueW1pbiwgdGhpcy54bWF4LCB0aGlzLnltYXgsIHRoaXMueG1pbiwgdGhpcy55bWF4XSk7CiAgICAgICAgICByZXR1cm4gdTI7CiAgICAgICAgfQogICAgICAgIF9lZGdlKHQyLCBuMiwgZTIsIHIyLCBpMikgewogICAgICAgICAgZm9yICg7IG4yICE9PSBlMjsgKSB7CiAgICAgICAgICAgIGxldCBlMywgbzI7CiAgICAgICAgICAgIHN3aXRjaCAobjIpIHsKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBuMiA9IDQ7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBuMiA9IDYsIGUzID0gdGhpcy54bWF4LCBvMiA9IHRoaXMueW1pbjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIG4yID0gMjsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIG4yID0gMTAsIGUzID0gdGhpcy54bWF4LCBvMiA9IHRoaXMueW1heDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICBuMiA9IDg7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBuMiA9IDksIGUzID0gdGhpcy54bWluLCBvMiA9IHRoaXMueW1heDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIG4yID0gMTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIG4yID0gNSwgZTMgPSB0aGlzLnhtaW4sIG8yID0gdGhpcy55bWluOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHIyW2kyXSA9PT0gZTMgJiYgcjJbaTIgKyAxXSA9PT0gbzIgfHwgIXRoaXMuY29udGFpbnModDIsIGUzLCBvMikgfHwgKHIyLnNwbGljZShpMiwgMCwgZTMsIG8yKSwgaTIgKz0gMik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaTI7CiAgICAgICAgfQogICAgICAgIF9wcm9qZWN0KHQyLCBuMiwgZTIsIHIyKSB7CiAgICAgICAgICBsZXQgaTIsIG8yLCBhMiwgdTIgPSAxIC8gMDsKICAgICAgICAgIGlmIChyMiA8IDApIHsKICAgICAgICAgICAgaWYgKG4yIDw9IHRoaXMueW1pbikKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgKGkyID0gKHRoaXMueW1pbiAtIG4yKSAvIHIyKSA8IHUyICYmIChhMiA9IHRoaXMueW1pbiwgbzIgPSB0MiArICh1MiA9IGkyKSAqIGUyKTsKICAgICAgICAgIH0gZWxzZSBpZiAocjIgPiAwKSB7CiAgICAgICAgICAgIGlmIChuMiA+PSB0aGlzLnltYXgpCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIChpMiA9ICh0aGlzLnltYXggLSBuMikgLyByMikgPCB1MiAmJiAoYTIgPSB0aGlzLnltYXgsIG8yID0gdDIgKyAodTIgPSBpMikgKiBlMik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZTIgPiAwKSB7CiAgICAgICAgICAgIGlmICh0MiA+PSB0aGlzLnhtYXgpCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIChpMiA9ICh0aGlzLnhtYXggLSB0MikgLyBlMikgPCB1MiAmJiAobzIgPSB0aGlzLnhtYXgsIGEyID0gbjIgKyAodTIgPSBpMikgKiByMik7CiAgICAgICAgICB9IGVsc2UgaWYgKGUyIDwgMCkgewogICAgICAgICAgICBpZiAodDIgPD0gdGhpcy54bWluKQogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAoaTIgPSAodGhpcy54bWluIC0gdDIpIC8gZTIpIDwgdTIgJiYgKG8yID0gdGhpcy54bWluLCBhMiA9IG4yICsgKHUyID0gaTIpICogcjIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFtvMiwgYTJdOwogICAgICAgIH0KICAgICAgICBfZWRnZWNvZGUodDIsIG4yKSB7CiAgICAgICAgICByZXR1cm4gKHQyID09PSB0aGlzLnhtaW4gPyAxIDogdDIgPT09IHRoaXMueG1heCA/IDIgOiAwKSB8IChuMiA9PT0gdGhpcy55bWluID8gNCA6IG4yID09PSB0aGlzLnltYXggPyA4IDogMCk7CiAgICAgICAgfQogICAgICAgIF9yZWdpb25jb2RlKHQyLCBuMikgewogICAgICAgICAgcmV0dXJuICh0MiA8IHRoaXMueG1pbiA/IDEgOiB0MiA+IHRoaXMueG1heCA/IDIgOiAwKSB8IChuMiA8IHRoaXMueW1pbiA/IDQgOiBuMiA+IHRoaXMueW1heCA/IDggOiAwKTsKICAgICAgICB9CiAgICAgICAgX3NpbXBsaWZ5KHQyKSB7CiAgICAgICAgICBpZiAodDIgJiYgdDIubGVuZ3RoID4gNCkgewogICAgICAgICAgICBmb3IgKGxldCBuMiA9IDA7IG4yIDwgdDIubGVuZ3RoOyBuMiArPSAyKSB7CiAgICAgICAgICAgICAgY29uc3QgZTIgPSAobjIgKyAyKSAlIHQyLmxlbmd0aCwgcjIgPSAobjIgKyA0KSAlIHQyLmxlbmd0aDsKICAgICAgICAgICAgICAodDJbbjJdID09PSB0MltlMl0gJiYgdDJbZTJdID09PSB0MltyMl0gfHwgdDJbbjIgKyAxXSA9PT0gdDJbZTIgKyAxXSAmJiB0MltlMiArIDFdID09PSB0MltyMiArIDFdKSAmJiAodDIuc3BsaWNlKGUyLCAyKSwgbjIgLT0gMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdDIubGVuZ3RoIHx8ICh0MiA9IG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBVdSA9IDIgKiBNYXRoLlBJLCBJdSA9IE1hdGgucG93OwogICAgICBmdW5jdGlvbiBPdSh0MikgewogICAgICAgIHJldHVybiB0MlswXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBCdSh0MikgewogICAgICAgIHJldHVybiB0MlsxXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBZdSh0MiwgbjIsIGUyKSB7CiAgICAgICAgcmV0dXJuIFt0MiArIE1hdGguc2luKHQyICsgbjIpICogZTIsIG4yICsgTWF0aC5jb3ModDIgLSBuMikgKiBlMl07CiAgICAgIH0KICAgICAgY2xhc3MgTHUgewogICAgICAgIHN0YXRpYyBmcm9tKHQyLCBuMiA9IE91LCBlMiA9IEJ1LCByMikgewogICAgICAgICAgcmV0dXJuIG5ldyBMdSgibGVuZ3RoIiBpbiB0MiA/IGZ1bmN0aW9uKHQzLCBuMywgZTMsIHIzKSB7CiAgICAgICAgICAgIGNvbnN0IGkyID0gdDMubGVuZ3RoLCBvMiA9IG5ldyBGbG9hdDY0QXJyYXkoMiAqIGkyKTsKICAgICAgICAgICAgZm9yIChsZXQgYTIgPSAwOyBhMiA8IGkyOyArK2EyKSB7CiAgICAgICAgICAgICAgY29uc3QgaTMgPSB0M1thMl07CiAgICAgICAgICAgICAgbzJbMiAqIGEyXSA9IG4zLmNhbGwocjMsIGkzLCBhMiwgdDMpLCBvMlsyICogYTIgKyAxXSA9IGUzLmNhbGwocjMsIGkzLCBhMiwgdDMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvMjsKICAgICAgICAgIH0odDIsIG4yLCBlMiwgcjIpIDogRmxvYXQ2NEFycmF5LmZyb20oZnVuY3Rpb24qICh0MywgbjMsIGUzLCByMykgewogICAgICAgICAgICBsZXQgaTIgPSAwOwogICAgICAgICAgICBmb3IgKGNvbnN0IG8yIG9mIHQzKQogICAgICAgICAgICAgIHlpZWxkIG4zLmNhbGwocjMsIG8yLCBpMiwgdDMpLCB5aWVsZCBlMy5jYWxsKHIzLCBvMiwgaTIsIHQzKSwgKytpMjsKICAgICAgICAgIH0odDIsIG4yLCBlMiwgcjIpKSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0cnVjdG9yKHQyKSB7CiAgICAgICAgICB0aGlzLl9kZWxhdW5hdG9yID0gbmV3IFN1KHQyKSwgdGhpcy5pbmVkZ2VzID0gbmV3IEludDMyQXJyYXkodDIubGVuZ3RoIC8gMiksIHRoaXMuX2h1bGxJbmRleCA9IG5ldyBJbnQzMkFycmF5KHQyLmxlbmd0aCAvIDIpLCB0aGlzLnBvaW50cyA9IHRoaXMuX2RlbGF1bmF0b3IuY29vcmRzLCB0aGlzLl9pbml0KCk7CiAgICAgICAgfQogICAgICAgIHVwZGF0ZSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9kZWxhdW5hdG9yLnVwZGF0ZSgpLCB0aGlzLl9pbml0KCksIHRoaXM7CiAgICAgICAgfQogICAgICAgIF9pbml0KCkgewogICAgICAgICAgY29uc3QgdDIgPSB0aGlzLl9kZWxhdW5hdG9yLCBuMiA9IHRoaXMucG9pbnRzOwogICAgICAgICAgaWYgKHQyLmh1bGwgJiYgdDIuaHVsbC5sZW5ndGggPiAyICYmIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IHsgdHJpYW5nbGVzOiBuMywgY29vcmRzOiBlMyB9ID0gdDM7CiAgICAgICAgICAgIGZvciAobGV0IHQ0ID0gMDsgdDQgPCBuMy5sZW5ndGg7IHQ0ICs9IDMpIHsKICAgICAgICAgICAgICBjb25zdCByMyA9IDIgKiBuM1t0NF0sIGkzID0gMiAqIG4zW3Q0ICsgMV0sIG8zID0gMiAqIG4zW3Q0ICsgMl07CiAgICAgICAgICAgICAgaWYgKChlM1tvM10gLSBlM1tyM10pICogKGUzW2kzICsgMV0gLSBlM1tyMyArIDFdKSAtIChlM1tpM10gLSBlM1tyM10pICogKGUzW28zICsgMV0gLSBlM1tyMyArIDFdKSA+IDFlLTEwKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSh0MikpIHsKICAgICAgICAgICAgdGhpcy5jb2xsaW5lYXIgPSBJbnQzMkFycmF5LmZyb20oeyBsZW5ndGg6IG4yLmxlbmd0aCAvIDIgfSwgKHQ0LCBuMykgPT4gbjMpLnNvcnQoKHQ0LCBlNCkgPT4gbjJbMiAqIHQ0XSAtIG4yWzIgKiBlNF0gfHwgbjJbMiAqIHQ0ICsgMV0gLSBuMlsyICogZTQgKyAxXSk7CiAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5jb2xsaW5lYXJbMF0sIGUzID0gdGhpcy5jb2xsaW5lYXJbdGhpcy5jb2xsaW5lYXIubGVuZ3RoIC0gMV0sIHIzID0gW24yWzIgKiB0M10sIG4yWzIgKiB0MyArIDFdLCBuMlsyICogZTNdLCBuMlsyICogZTMgKyAxXV0sIGkzID0gMWUtOCAqIE1hdGguaHlwb3QocjNbM10gLSByM1sxXSwgcjNbMl0gLSByM1swXSk7CiAgICAgICAgICAgIGZvciAobGV0IHQ0ID0gMCwgZTQgPSBuMi5sZW5ndGggLyAyOyB0NCA8IGU0OyArK3Q0KSB7CiAgICAgICAgICAgICAgY29uc3QgZTUgPSBZdShuMlsyICogdDRdLCBuMlsyICogdDQgKyAxXSwgaTMpOwogICAgICAgICAgICAgIG4yWzIgKiB0NF0gPSBlNVswXSwgbjJbMiAqIHQ0ICsgMV0gPSBlNVsxXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9kZWxhdW5hdG9yID0gbmV3IFN1KG4yKTsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBkZWxldGUgdGhpcy5jb2xsaW5lYXI7CiAgICAgICAgICBjb25zdCBlMiA9IHRoaXMuaGFsZmVkZ2VzID0gdGhpcy5fZGVsYXVuYXRvci5oYWxmZWRnZXMsIHIyID0gdGhpcy5odWxsID0gdGhpcy5fZGVsYXVuYXRvci5odWxsLCBpMiA9IHRoaXMudHJpYW5nbGVzID0gdGhpcy5fZGVsYXVuYXRvci50cmlhbmdsZXMsIG8yID0gdGhpcy5pbmVkZ2VzLmZpbGwoLTEpLCBhMiA9IHRoaXMuX2h1bGxJbmRleC5maWxsKC0xKTsKICAgICAgICAgIGZvciAobGV0IHQzID0gMCwgbjMgPSBlMi5sZW5ndGg7IHQzIDwgbjM7ICsrdDMpIHsKICAgICAgICAgICAgY29uc3QgbjQgPSBpMlt0MyAlIDMgPT0gMiA/IHQzIC0gMiA6IHQzICsgMV07CiAgICAgICAgICAgIC0xICE9PSBlMlt0M10gJiYgLTEgIT09IG8yW240XSB8fCAobzJbbjRdID0gdDMpOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChsZXQgdDMgPSAwLCBuMyA9IHIyLmxlbmd0aDsgdDMgPCBuMzsgKyt0MykKICAgICAgICAgICAgYTJbcjJbdDNdXSA9IHQzOwogICAgICAgICAgcjIubGVuZ3RoIDw9IDIgJiYgcjIubGVuZ3RoID4gMCAmJiAodGhpcy50cmlhbmdsZXMgPSBuZXcgSW50MzJBcnJheSgzKS5maWxsKC0xKSwgdGhpcy5oYWxmZWRnZXMgPSBuZXcgSW50MzJBcnJheSgzKS5maWxsKC0xKSwgdGhpcy50cmlhbmdsZXNbMF0gPSByMlswXSwgbzJbcjJbMF1dID0gMSwgMiA9PT0gcjIubGVuZ3RoICYmIChvMltyMlsxXV0gPSAwLCB0aGlzLnRyaWFuZ2xlc1sxXSA9IHIyWzFdLCB0aGlzLnRyaWFuZ2xlc1syXSA9IHIyWzFdKSk7CiAgICAgICAgfQogICAgICAgIHZvcm9ub2kodDIpIHsKICAgICAgICAgIHJldHVybiBuZXcgcXUodGhpcywgdDIpOwogICAgICAgIH0KICAgICAgICAqbmVpZ2hib3JzKHQyKSB7CiAgICAgICAgICBjb25zdCB7IGluZWRnZXM6IG4yLCBodWxsOiBlMiwgX2h1bGxJbmRleDogcjIsIGhhbGZlZGdlczogaTIsIHRyaWFuZ2xlczogbzIsIGNvbGxpbmVhcjogYTIgfSA9IHRoaXM7CiAgICAgICAgICBpZiAoYTIpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBhMi5pbmRleE9mKHQyKTsKICAgICAgICAgICAgcmV0dXJuIG4zID4gMCAmJiAoeWllbGQgYTJbbjMgLSAxXSksIHZvaWQgKG4zIDwgYTIubGVuZ3RoIC0gMSAmJiAoeWllbGQgYTJbbjMgKyAxXSkpOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgdTIgPSBuMlt0Ml07CiAgICAgICAgICBpZiAoLTEgPT09IHUyKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBsZXQgYzIgPSB1MiwgZjIgPSAtMTsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgaWYgKHlpZWxkIGYyID0gbzJbYzJdLCBjMiA9IGMyICUgMyA9PSAyID8gYzIgLSAyIDogYzIgKyAxLCBvMltjMl0gIT09IHQyKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgaWYgKGMyID0gaTJbYzJdLCAtMSA9PT0gYzIpIHsKICAgICAgICAgICAgICBjb25zdCBuMyA9IGUyWyhyMlt0Ml0gKyAxKSAlIGUyLmxlbmd0aF07CiAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgKG4zICE9PSBmMiAmJiAoeWllbGQgbjMpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSB3aGlsZSAoYzIgIT09IHUyKTsKICAgICAgICB9CiAgICAgICAgZmluZCh0MiwgbjIsIGUyID0gMCkgewogICAgICAgICAgaWYgKCh0MiA9ICt0MikgIT0gdDIgfHwgKG4yID0gK24yKSAhPSBuMikKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgY29uc3QgcjIgPSBlMjsKICAgICAgICAgIGxldCBpMjsKICAgICAgICAgIGZvciAoOyAoaTIgPSB0aGlzLl9zdGVwKGUyLCB0MiwgbjIpKSA+PSAwICYmIGkyICE9PSBlMiAmJiBpMiAhPT0gcjI7ICkKICAgICAgICAgICAgZTIgPSBpMjsKICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICB9CiAgICAgICAgX3N0ZXAodDIsIG4yLCBlMikgewogICAgICAgICAgY29uc3QgeyBpbmVkZ2VzOiByMiwgaHVsbDogaTIsIF9odWxsSW5kZXg6IG8yLCBoYWxmZWRnZXM6IGEyLCB0cmlhbmdsZXM6IHUyLCBwb2ludHM6IGMyIH0gPSB0aGlzOwogICAgICAgICAgaWYgKC0xID09PSByMlt0Ml0gfHwgIWMyLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuICh0MiArIDEpICUgKGMyLmxlbmd0aCA+PiAxKTsKICAgICAgICAgIGxldCBmMiA9IHQyLCBzMiA9IEl1KG4yIC0gYzJbMiAqIHQyXSwgMikgKyBJdShlMiAtIGMyWzIgKiB0MiArIDFdLCAyKTsKICAgICAgICAgIGNvbnN0IGwyID0gcjJbdDJdOwogICAgICAgICAgbGV0IGgyID0gbDI7CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIGxldCByMyA9IHUyW2gyXTsKICAgICAgICAgICAgY29uc3QgbDMgPSBJdShuMiAtIGMyWzIgKiByM10sIDIpICsgSXUoZTIgLSBjMlsyICogcjMgKyAxXSwgMik7CiAgICAgICAgICAgIGlmIChsMyA8IHMyICYmIChzMiA9IGwzLCBmMiA9IHIzKSwgaDIgPSBoMiAlIDMgPT0gMiA/IGgyIC0gMiA6IGgyICsgMSwgdTJbaDJdICE9PSB0MikKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgaWYgKGgyID0gYTJbaDJdLCAtMSA9PT0gaDIpIHsKICAgICAgICAgICAgICBpZiAoaDIgPSBpMlsobzJbdDJdICsgMSkgJSBpMi5sZW5ndGhdLCBoMiAhPT0gcjMgJiYgSXUobjIgLSBjMlsyICogaDJdLCAyKSArIEl1KGUyIC0gYzJbMiAqIGgyICsgMV0sIDIpIDwgczIpCiAgICAgICAgICAgICAgICByZXR1cm4gaDI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gd2hpbGUgKGgyICE9PSBsMik7CiAgICAgICAgICByZXR1cm4gZjI7CiAgICAgICAgfQogICAgICAgIHJlbmRlcih0MikgewogICAgICAgICAgY29uc3QgbjIgPSBudWxsID09IHQyID8gdDIgPSBuZXcgUnUoKSA6IHZvaWQgMCwgeyBwb2ludHM6IGUyLCBoYWxmZWRnZXM6IHIyLCB0cmlhbmdsZXM6IGkyIH0gPSB0aGlzOwogICAgICAgICAgZm9yIChsZXQgbjMgPSAwLCBvMiA9IHIyLmxlbmd0aDsgbjMgPCBvMjsgKytuMykgewogICAgICAgICAgICBjb25zdCBvMyA9IHIyW24zXTsKICAgICAgICAgICAgaWYgKG8zIDwgbjMpCiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGNvbnN0IGEyID0gMiAqIGkyW24zXSwgdTIgPSAyICogaTJbbzNdOwogICAgICAgICAgICB0Mi5tb3ZlVG8oZTJbYTJdLCBlMlthMiArIDFdKSwgdDIubGluZVRvKGUyW3UyXSwgZTJbdTIgKyAxXSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJIdWxsKHQyKSwgbjIgJiYgbjIudmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgcmVuZGVyUG9pbnRzKHQyLCBuMikgewogICAgICAgICAgdm9pZCAwICE9PSBuMiB8fCB0MiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0Mi5tb3ZlVG8gfHwgKG4yID0gdDIsIHQyID0gbnVsbCksIG4yID0gbnVsbCA9PSBuMiA/IDIgOiArbjI7CiAgICAgICAgICBjb25zdCBlMiA9IG51bGwgPT0gdDIgPyB0MiA9IG5ldyBSdSgpIDogdm9pZCAwLCB7IHBvaW50czogcjIgfSA9IHRoaXM7CiAgICAgICAgICBmb3IgKGxldCBlMyA9IDAsIGkyID0gcjIubGVuZ3RoOyBlMyA8IGkyOyBlMyArPSAyKSB7CiAgICAgICAgICAgIGNvbnN0IGkzID0gcjJbZTNdLCBvMiA9IHIyW2UzICsgMV07CiAgICAgICAgICAgIHQyLm1vdmVUbyhpMyArIG4yLCBvMiksIHQyLmFyYyhpMywgbzIsIG4yLCAwLCBVdSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZTIgJiYgZTIudmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgcmVuZGVySHVsbCh0MikgewogICAgICAgICAgY29uc3QgbjIgPSBudWxsID09IHQyID8gdDIgPSBuZXcgUnUoKSA6IHZvaWQgMCwgeyBodWxsOiBlMiwgcG9pbnRzOiByMiB9ID0gdGhpcywgaTIgPSAyICogZTJbMF0sIG8yID0gZTIubGVuZ3RoOwogICAgICAgICAgdDIubW92ZVRvKHIyW2kyXSwgcjJbaTIgKyAxXSk7CiAgICAgICAgICBmb3IgKGxldCBuMyA9IDE7IG4zIDwgbzI7ICsrbjMpIHsKICAgICAgICAgICAgY29uc3QgaTMgPSAyICogZTJbbjNdOwogICAgICAgICAgICB0Mi5saW5lVG8ocjJbaTNdLCByMltpMyArIDFdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0Mi5jbG9zZVBhdGgoKSwgbjIgJiYgbjIudmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgaHVsbFBvbHlnb24oKSB7CiAgICAgICAgICBjb25zdCB0MiA9IG5ldyBGdSgpOwogICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVySHVsbCh0MiksIHQyLnZhbHVlKCk7CiAgICAgICAgfQogICAgICAgIHJlbmRlclRyaWFuZ2xlKHQyLCBuMikgewogICAgICAgICAgY29uc3QgZTIgPSBudWxsID09IG4yID8gbjIgPSBuZXcgUnUoKSA6IHZvaWQgMCwgeyBwb2ludHM6IHIyLCB0cmlhbmdsZXM6IGkyIH0gPSB0aGlzLCBvMiA9IDIgKiBpMlt0MiAqPSAzXSwgYTIgPSAyICogaTJbdDIgKyAxXSwgdTIgPSAyICogaTJbdDIgKyAyXTsKICAgICAgICAgIHJldHVybiBuMi5tb3ZlVG8ocjJbbzJdLCByMltvMiArIDFdKSwgbjIubGluZVRvKHIyW2EyXSwgcjJbYTIgKyAxXSksIG4yLmxpbmVUbyhyMlt1Ml0sIHIyW3UyICsgMV0pLCBuMi5jbG9zZVBhdGgoKSwgZTIgJiYgZTIudmFsdWUoKTsKICAgICAgICB9CiAgICAgICAgKnRyaWFuZ2xlUG9seWdvbnMoKSB7CiAgICAgICAgICBjb25zdCB7IHRyaWFuZ2xlczogdDIgfSA9IHRoaXM7CiAgICAgICAgICBmb3IgKGxldCBuMiA9IDAsIGUyID0gdDIubGVuZ3RoIC8gMzsgbjIgPCBlMjsgKytuMikKICAgICAgICAgICAgeWllbGQgdGhpcy50cmlhbmdsZVBvbHlnb24objIpOwogICAgICAgIH0KICAgICAgICB0cmlhbmdsZVBvbHlnb24odDIpIHsKICAgICAgICAgIGNvbnN0IG4yID0gbmV3IEZ1KCk7CiAgICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJUcmlhbmdsZSh0MiwgbjIpLCBuMi52YWx1ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIganUgPSB7fSwgSHUgPSB7fSwgWHUgPSAzNCwgR3UgPSAxMCwgVnUgPSAxMzsKICAgICAgZnVuY3Rpb24gV3UodDIpIHsKICAgICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKCJkIiwgInJldHVybiB7IiArIHQyLm1hcChmdW5jdGlvbih0MywgbjIpIHsKICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0MykgKyAiOiBkWyIgKyBuMiArICddIHx8ICIiJzsKICAgICAgICB9KS5qb2luKCIsIikgKyAifSIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFp1KHQyKSB7CiAgICAgICAgdmFyIG4yID0gLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCksIGUyID0gW107CiAgICAgICAgcmV0dXJuIHQyLmZvckVhY2goZnVuY3Rpb24odDMpIHsKICAgICAgICAgIGZvciAodmFyIHIyIGluIHQzKQogICAgICAgICAgICByMiBpbiBuMiB8fCBlMi5wdXNoKG4yW3IyXSA9IHIyKTsKICAgICAgICB9KSwgZTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gS3UodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gdDIgKyAiIiwgcjIgPSBlMi5sZW5ndGg7CiAgICAgICAgcmV0dXJuIHIyIDwgbjIgPyBuZXcgQXJyYXkobjIgLSByMiArIDEpLmpvaW4oMCkgKyBlMiA6IGUyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFF1KHQyKSB7CiAgICAgICAgdmFyIG4yLCBlMiA9IHQyLmdldFVUQ0hvdXJzKCksIHIyID0gdDIuZ2V0VVRDTWludXRlcygpLCBpMiA9IHQyLmdldFVUQ1NlY29uZHMoKSwgbzIgPSB0Mi5nZXRVVENNaWxsaXNlY29uZHMoKTsKICAgICAgICByZXR1cm4gaXNOYU4odDIpID8gIkludmFsaWQgRGF0ZSIgOiAoKG4yID0gdDIuZ2V0VVRDRnVsbFllYXIoKSkgPCAwID8gIi0iICsgS3UoLW4yLCA2KSA6IG4yID4gOTk5OSA/ICIrIiArIEt1KG4yLCA2KSA6IEt1KG4yLCA0KSkgKyAiLSIgKyBLdSh0Mi5nZXRVVENNb250aCgpICsgMSwgMikgKyAiLSIgKyBLdSh0Mi5nZXRVVENEYXRlKCksIDIpICsgKG8yID8gIlQiICsgS3UoZTIsIDIpICsgIjoiICsgS3UocjIsIDIpICsgIjoiICsgS3UoaTIsIDIpICsgIi4iICsgS3UobzIsIDMpICsgIloiIDogaTIgPyAiVCIgKyBLdShlMiwgMikgKyAiOiIgKyBLdShyMiwgMikgKyAiOiIgKyBLdShpMiwgMikgKyAiWiIgOiByMiB8fCBlMiA/ICJUIiArIEt1KGUyLCAyKSArICI6IiArIEt1KHIyLCAyKSArICJaIiA6ICIiKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBKdSh0MikgewogICAgICAgIHZhciBuMiA9IG5ldyBSZWdFeHAoJ1siJyArIHQyICsgIlxuXHJdIiksIGUyID0gdDIuY2hhckNvZGVBdCgwKTsKICAgICAgICBmdW5jdGlvbiByMih0MywgbjMpIHsKICAgICAgICAgIHZhciByMywgaTMgPSBbXSwgbzMgPSB0My5sZW5ndGgsIGEzID0gMCwgdTIgPSAwLCBjMiA9IG8zIDw9IDAsIGYyID0gZmFsc2U7CiAgICAgICAgICBmdW5jdGlvbiBzMigpIHsKICAgICAgICAgICAgaWYgKGMyKQogICAgICAgICAgICAgIHJldHVybiBIdTsKICAgICAgICAgICAgaWYgKGYyKQogICAgICAgICAgICAgIHJldHVybiBmMiA9IGZhbHNlLCBqdTsKICAgICAgICAgICAgdmFyIG40LCByNCwgaTQgPSBhMzsKICAgICAgICAgICAgaWYgKHQzLmNoYXJDb2RlQXQoaTQpID09PSBYdSkgewogICAgICAgICAgICAgIGZvciAoOyBhMysrIDwgbzMgJiYgdDMuY2hhckNvZGVBdChhMykgIT09IFh1IHx8IHQzLmNoYXJDb2RlQXQoKythMykgPT09IFh1OyApCiAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgcmV0dXJuIChuNCA9IGEzKSA+PSBvMyA/IGMyID0gdHJ1ZSA6IChyNCA9IHQzLmNoYXJDb2RlQXQoYTMrKykpID09PSBHdSA/IGYyID0gdHJ1ZSA6IHI0ID09PSBWdSAmJiAoZjIgPSB0cnVlLCB0My5jaGFyQ29kZUF0KGEzKSA9PT0gR3UgJiYgKythMyksIHQzLnNsaWNlKGk0ICsgMSwgbjQgLSAxKS5yZXBsYWNlKC8iIi9nLCAnIicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoOyBhMyA8IG8zOyApIHsKICAgICAgICAgICAgICBpZiAoKHI0ID0gdDMuY2hhckNvZGVBdChuNCA9IGEzKyspKSA9PT0gR3UpCiAgICAgICAgICAgICAgICBmMiA9IHRydWU7CiAgICAgICAgICAgICAgZWxzZSBpZiAocjQgPT09IFZ1KQogICAgICAgICAgICAgICAgZjIgPSB0cnVlLCB0My5jaGFyQ29kZUF0KGEzKSA9PT0gR3UgJiYgKythMzsKICAgICAgICAgICAgICBlbHNlIGlmIChyNCAhPT0gZTIpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICByZXR1cm4gdDMuc2xpY2UoaTQsIG40KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gYzIgPSB0cnVlLCB0My5zbGljZShpNCwgbzMpOwogICAgICAgICAgfQogICAgICAgICAgZm9yICh0My5jaGFyQ29kZUF0KG8zIC0gMSkgPT09IEd1ICYmIC0tbzMsIHQzLmNoYXJDb2RlQXQobzMgLSAxKSA9PT0gVnUgJiYgLS1vMzsgKHIzID0gczIoKSkgIT09IEh1OyApIHsKICAgICAgICAgICAgZm9yICh2YXIgbDIgPSBbXTsgcjMgIT09IGp1ICYmIHIzICE9PSBIdTsgKQogICAgICAgICAgICAgIGwyLnB1c2gocjMpLCByMyA9IHMyKCk7CiAgICAgICAgICAgIG4zICYmIG51bGwgPT0gKGwyID0gbjMobDIsIHUyKyspKSB8fCBpMy5wdXNoKGwyKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpMzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaTIobjMsIGUzKSB7CiAgICAgICAgICByZXR1cm4gbjMubWFwKGZ1bmN0aW9uKG40KSB7CiAgICAgICAgICAgIHJldHVybiBlMy5tYXAoZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICByZXR1cm4gYTIobjRbdDNdKTsKICAgICAgICAgICAgfSkuam9pbih0Mik7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbzIobjMpIHsKICAgICAgICAgIHJldHVybiBuMy5tYXAoYTIpLmpvaW4odDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhMih0MykgewogICAgICAgICAgcmV0dXJuIG51bGwgPT0gdDMgPyAiIiA6IHQzIGluc3RhbmNlb2YgRGF0ZSA/IFF1KHQzKSA6IG4yLnRlc3QodDMgKz0gIiIpID8gJyInICsgdDMucmVwbGFjZSgvIi9nLCAnIiInKSArICciJyA6IHQzOwogICAgICAgIH0KICAgICAgICByZXR1cm4geyBwYXJzZTogZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICB2YXIgZTMsIGkzLCBvMyA9IHIyKHQzLCBmdW5jdGlvbih0NCwgcjMpIHsKICAgICAgICAgICAgaWYgKGUzKQogICAgICAgICAgICAgIHJldHVybiBlMyh0NCwgcjMgLSAxKTsKICAgICAgICAgICAgaTMgPSB0NCwgZTMgPSBuMyA/IGZ1bmN0aW9uKHQ1LCBuNCkgewogICAgICAgICAgICAgIHZhciBlNCA9IFd1KHQ1KTsKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ocjQsIGk0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbjQoZTQocjQpLCBpNCwgdDUpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0odDQsIG4zKSA6IFd1KHQ0KTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIG8zLmNvbHVtbnMgPSBpMyB8fCBbXSwgbzM7CiAgICAgICAgfSwgcGFyc2VSb3dzOiByMiwgZm9ybWF0OiBmdW5jdGlvbihuMywgZTMpIHsKICAgICAgICAgIHJldHVybiBudWxsID09IGUzICYmIChlMyA9IFp1KG4zKSksIFtlMy5tYXAoYTIpLmpvaW4odDIpXS5jb25jYXQoaTIobjMsIGUzKSkuam9pbigiXG4iKTsKICAgICAgICB9LCBmb3JtYXRCb2R5OiBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiBudWxsID09IG4zICYmIChuMyA9IFp1KHQzKSksIGkyKHQzLCBuMykuam9pbigiXG4iKTsKICAgICAgICB9LCBmb3JtYXRSb3dzOiBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIHQzLm1hcChvMikuam9pbigiXG4iKTsKICAgICAgICB9LCBmb3JtYXRSb3c6IG8yLCBmb3JtYXRWYWx1ZTogYTIgfTsKICAgICAgfQogICAgICB2YXIgdGMgPSBKdSgiLCIpLCBuYyA9IHRjLnBhcnNlLCBlYyA9IHRjLnBhcnNlUm93cywgcmMgPSB0Yy5mb3JtYXQsIGljID0gdGMuZm9ybWF0Qm9keSwgb2MgPSB0Yy5mb3JtYXRSb3dzLCBhYyA9IHRjLmZvcm1hdFJvdywgdWMgPSB0Yy5mb3JtYXRWYWx1ZSwgY2MgPSBKdSgiCSIpLCBmYyA9IGNjLnBhcnNlLCBzYyA9IGNjLnBhcnNlUm93cywgbGMgPSBjYy5mb3JtYXQsIGhjID0gY2MuZm9ybWF0Qm9keSwgZGMgPSBjYy5mb3JtYXRSb3dzLCBwYyA9IGNjLmZvcm1hdFJvdywgZ2MgPSBjYy5mb3JtYXRWYWx1ZTsKICAgICAgY29uc3QgeWMgPSAoLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCIyMDE5LTAxLTAxVDAwOjAwIikpLmdldEhvdXJzKCkgfHwgKC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgiMjAxOS0wNy0wMVQwMDowMCIpKS5nZXRIb3VycygpOwogICAgICBmdW5jdGlvbiB2Yyh0MikgewogICAgICAgIGlmICghdDIub2spCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IodDIuc3RhdHVzICsgIiAiICsgdDIuc3RhdHVzVGV4dCk7CiAgICAgICAgcmV0dXJuIHQyLmJsb2IoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfYyh0MikgewogICAgICAgIGlmICghdDIub2spCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IodDIuc3RhdHVzICsgIiAiICsgdDIuc3RhdHVzVGV4dCk7CiAgICAgICAgcmV0dXJuIHQyLmFycmF5QnVmZmVyKCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYmModDIpIHsKICAgICAgICBpZiAoIXQyLm9rKQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHQyLnN0YXR1cyArICIgIiArIHQyLnN0YXR1c1RleHQpOwogICAgICAgIHJldHVybiB0Mi50ZXh0KCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbWModDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIGZldGNoKHQyLCBuMikudGhlbihiYyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24geGModDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24objIsIGUyLCByMikgewogICAgICAgICAgcmV0dXJuIDIgPT09IGFyZ3VtZW50cy5sZW5ndGggJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZTIgJiYgKHIyID0gZTIsIGUyID0gdm9pZCAwKSwgbWMobjIsIGUyKS50aGVuKGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICAgIHJldHVybiB0MihuMywgcjIpOwogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgd2MgPSB4YyhuYyksIE1jID0geGMoZmMpOwogICAgICBmdW5jdGlvbiBUYyh0MikgewogICAgICAgIGlmICghdDIub2spCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IodDIuc3RhdHVzICsgIiAiICsgdDIuc3RhdHVzVGV4dCk7CiAgICAgICAgaWYgKDIwNCAhPT0gdDIuc3RhdHVzICYmIDIwNSAhPT0gdDIuc3RhdHVzKQogICAgICAgICAgcmV0dXJuIHQyLmpzb24oKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBBYyh0MikgewogICAgICAgIHJldHVybiAobjIsIGUyKSA9PiBtYyhuMiwgZTIpLnRoZW4oKG4zKSA9PiBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKG4zLCB0MikpOwogICAgICB9CiAgICAgIHZhciBTYyA9IEFjKCJhcHBsaWNhdGlvbi94bWwiKSwgRWMgPSBBYygidGV4dC9odG1sIiksIE5jID0gQWMoImltYWdlL3N2Zyt4bWwiKTsKICAgICAgZnVuY3Rpb24ga2ModDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICBpZiAoaXNOYU4objIpIHx8IGlzTmFOKGUyKSkKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB2YXIgaTIsIG8yLCBhMiwgdTIsIGMyLCBmMiwgczIsIGwyLCBoMiwgZDIgPSB0Mi5fcm9vdCwgcDIgPSB7IGRhdGE6IHIyIH0sIGcyID0gdDIuX3gwLCB5MiA9IHQyLl95MCwgdjIgPSB0Mi5feDEsIF8yID0gdDIuX3kxOwogICAgICAgIGlmICghZDIpCiAgICAgICAgICByZXR1cm4gdDIuX3Jvb3QgPSBwMiwgdDI7CiAgICAgICAgZm9yICg7IGQyLmxlbmd0aDsgKQogICAgICAgICAgaWYgKChmMiA9IG4yID49IChvMiA9IChnMiArIHYyKSAvIDIpKSA/IGcyID0gbzIgOiB2MiA9IG8yLCAoczIgPSBlMiA+PSAoYTIgPSAoeTIgKyBfMikgLyAyKSkgPyB5MiA9IGEyIDogXzIgPSBhMiwgaTIgPSBkMiwgIShkMiA9IGQyW2wyID0gczIgPDwgMSB8IGYyXSkpCiAgICAgICAgICAgIHJldHVybiBpMltsMl0gPSBwMiwgdDI7CiAgICAgICAgaWYgKHUyID0gK3QyLl94LmNhbGwobnVsbCwgZDIuZGF0YSksIGMyID0gK3QyLl95LmNhbGwobnVsbCwgZDIuZGF0YSksIG4yID09PSB1MiAmJiBlMiA9PT0gYzIpCiAgICAgICAgICByZXR1cm4gcDIubmV4dCA9IGQyLCBpMiA/IGkyW2wyXSA9IHAyIDogdDIuX3Jvb3QgPSBwMiwgdDI7CiAgICAgICAgZG8gewogICAgICAgICAgaTIgPSBpMiA/IGkyW2wyXSA9IG5ldyBBcnJheSg0KSA6IHQyLl9yb290ID0gbmV3IEFycmF5KDQpLCAoZjIgPSBuMiA+PSAobzIgPSAoZzIgKyB2MikgLyAyKSkgPyBnMiA9IG8yIDogdjIgPSBvMiwgKHMyID0gZTIgPj0gKGEyID0gKHkyICsgXzIpIC8gMikpID8geTIgPSBhMiA6IF8yID0gYTI7CiAgICAgICAgfSB3aGlsZSAoKGwyID0gczIgPDwgMSB8IGYyKSA9PSAoaDIgPSAoYzIgPj0gYTIpIDw8IDEgfCB1MiA+PSBvMikpOwogICAgICAgIHJldHVybiBpMltoMl0gPSBkMiwgaTJbbDJdID0gcDIsIHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIENjKHQyLCBuMiwgZTIsIHIyLCBpMikgewogICAgICAgIHRoaXMubm9kZSA9IHQyLCB0aGlzLngwID0gbjIsIHRoaXMueTAgPSBlMiwgdGhpcy54MSA9IHIyLCB0aGlzLnkxID0gaTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUGModDIpIHsKICAgICAgICByZXR1cm4gdDJbMF07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gemModDIpIHsKICAgICAgICByZXR1cm4gdDJbMV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gJGModDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IG5ldyBEYyhudWxsID09IG4yID8gUGMgOiBuMiwgbnVsbCA9PSBlMiA/IHpjIDogZTIsIE5hTiwgTmFOLCBOYU4sIE5hTik7CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdDIgPyByMiA6IHIyLmFkZEFsbCh0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRGModDIsIG4yLCBlMiwgcjIsIGkyLCBvMikgewogICAgICAgIHRoaXMuX3ggPSB0MiwgdGhpcy5feSA9IG4yLCB0aGlzLl94MCA9IGUyLCB0aGlzLl95MCA9IHIyLCB0aGlzLl94MSA9IGkyLCB0aGlzLl95MSA9IG8yLCB0aGlzLl9yb290ID0gdm9pZCAwOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJjKHQyKSB7CiAgICAgICAgZm9yICh2YXIgbjIgPSB7IGRhdGE6IHQyLmRhdGEgfSwgZTIgPSBuMjsgdDIgPSB0Mi5uZXh0OyApCiAgICAgICAgICBlMiA9IGUyLm5leHQgPSB7IGRhdGE6IHQyLmRhdGEgfTsKICAgICAgICByZXR1cm4gbjI7CiAgICAgIH0KICAgICAgdmFyIEZjID0gJGMucHJvdG90eXBlID0gRGMucHJvdG90eXBlOwogICAgICBmdW5jdGlvbiBxYyh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFVjKHQyKSB7CiAgICAgICAgcmV0dXJuIDFlLTYgKiAodDIoKSAtIDAuNSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSWModDIpIHsKICAgICAgICByZXR1cm4gdDIueCArIHQyLnZ4OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE9jKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLnkgKyB0Mi52eTsKICAgICAgfQogICAgICBmdW5jdGlvbiBCYyh0MikgewogICAgICAgIHJldHVybiB0Mi5pbmRleDsKICAgICAgfQogICAgICBmdW5jdGlvbiBZYyh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSB0Mi5nZXQobjIpOwogICAgICAgIGlmICghZTIpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5vZGUgbm90IGZvdW5kOiAiICsgbjIpOwogICAgICAgIHJldHVybiBlMjsKICAgICAgfQogICAgICBGYy5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyLCBuMiwgZTIgPSBuZXcgRGModGhpcy5feCwgdGhpcy5feSwgdGhpcy5feDAsIHRoaXMuX3kwLCB0aGlzLl94MSwgdGhpcy5feTEpLCByMiA9IHRoaXMuX3Jvb3Q7CiAgICAgICAgaWYgKCFyMikKICAgICAgICAgIHJldHVybiBlMjsKICAgICAgICBpZiAoIXIyLmxlbmd0aCkKICAgICAgICAgIHJldHVybiBlMi5fcm9vdCA9IFJjKHIyKSwgZTI7CiAgICAgICAgZm9yICh0MiA9IFt7IHNvdXJjZTogcjIsIHRhcmdldDogZTIuX3Jvb3QgPSBuZXcgQXJyYXkoNCkgfV07IHIyID0gdDIucG9wKCk7ICkKICAgICAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCA0OyArK2kyKQogICAgICAgICAgICAobjIgPSByMi5zb3VyY2VbaTJdKSAmJiAobjIubGVuZ3RoID8gdDIucHVzaCh7IHNvdXJjZTogbjIsIHRhcmdldDogcjIudGFyZ2V0W2kyXSA9IG5ldyBBcnJheSg0KSB9KSA6IHIyLnRhcmdldFtpMl0gPSBSYyhuMikpOwogICAgICAgIHJldHVybiBlMjsKICAgICAgfSwgRmMuYWRkID0gZnVuY3Rpb24odDIpIHsKICAgICAgICBjb25zdCBuMiA9ICt0aGlzLl94LmNhbGwobnVsbCwgdDIpLCBlMiA9ICt0aGlzLl95LmNhbGwobnVsbCwgdDIpOwogICAgICAgIHJldHVybiBrYyh0aGlzLmNvdmVyKG4yLCBlMiksIG4yLCBlMiwgdDIpOwogICAgICB9LCBGYy5hZGRBbGwgPSBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiwgZTIsIHIyLCBpMiwgbzIgPSB0Mi5sZW5ndGgsIGEyID0gbmV3IEFycmF5KG8yKSwgdTIgPSBuZXcgQXJyYXkobzIpLCBjMiA9IDEgLyAwLCBmMiA9IDEgLyAwLCBzMiA9IC0xIC8gMCwgbDIgPSAtMSAvIDA7CiAgICAgICAgZm9yIChlMiA9IDA7IGUyIDwgbzI7ICsrZTIpCiAgICAgICAgICBpc05hTihyMiA9ICt0aGlzLl94LmNhbGwobnVsbCwgbjIgPSB0MltlMl0pKSB8fCBpc05hTihpMiA9ICt0aGlzLl95LmNhbGwobnVsbCwgbjIpKSB8fCAoYTJbZTJdID0gcjIsIHUyW2UyXSA9IGkyLCByMiA8IGMyICYmIChjMiA9IHIyKSwgcjIgPiBzMiAmJiAoczIgPSByMiksIGkyIDwgZjIgJiYgKGYyID0gaTIpLCBpMiA+IGwyICYmIChsMiA9IGkyKSk7CiAgICAgICAgaWYgKGMyID4gczIgfHwgZjIgPiBsMikKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIGZvciAodGhpcy5jb3ZlcihjMiwgZjIpLmNvdmVyKHMyLCBsMiksIGUyID0gMDsgZTIgPCBvMjsgKytlMikKICAgICAgICAgIGtjKHRoaXMsIGEyW2UyXSwgdTJbZTJdLCB0MltlMl0pOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LCBGYy5jb3ZlciA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGlmIChpc05hTih0MiA9ICt0MikgfHwgaXNOYU4objIgPSArbjIpKQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgdmFyIGUyID0gdGhpcy5feDAsIHIyID0gdGhpcy5feTAsIGkyID0gdGhpcy5feDEsIG8yID0gdGhpcy5feTE7CiAgICAgICAgaWYgKGlzTmFOKGUyKSkKICAgICAgICAgIGkyID0gKGUyID0gTWF0aC5mbG9vcih0MikpICsgMSwgbzIgPSAocjIgPSBNYXRoLmZsb29yKG4yKSkgKyAxOwogICAgICAgIGVsc2UgewogICAgICAgICAgZm9yICh2YXIgYTIsIHUyLCBjMiA9IGkyIC0gZTIgfHwgMSwgZjIgPSB0aGlzLl9yb290OyBlMiA+IHQyIHx8IHQyID49IGkyIHx8IHIyID4gbjIgfHwgbjIgPj0gbzI7ICkKICAgICAgICAgICAgc3dpdGNoICh1MiA9IChuMiA8IHIyKSA8PCAxIHwgdDIgPCBlMiwgKGEyID0gbmV3IEFycmF5KDQpKVt1Ml0gPSBmMiwgZjIgPSBhMiwgYzIgKj0gMiwgdTIpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpMiA9IGUyICsgYzIsIG8yID0gcjIgKyBjMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIGUyID0gaTIgLSBjMiwgbzIgPSByMiArIGMyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaTIgPSBlMiArIGMyLCByMiA9IG8yIC0gYzI7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBlMiA9IGkyIC0gYzIsIHIyID0gbzIgLSBjMjsKICAgICAgICAgICAgfQogICAgICAgICAgdGhpcy5fcm9vdCAmJiB0aGlzLl9yb290Lmxlbmd0aCAmJiAodGhpcy5fcm9vdCA9IGYyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX3gwID0gZTIsIHRoaXMuX3kwID0gcjIsIHRoaXMuX3gxID0gaTIsIHRoaXMuX3kxID0gbzIsIHRoaXM7CiAgICAgIH0sIEZjLmRhdGEgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBbXTsKICAgICAgICByZXR1cm4gdGhpcy52aXNpdChmdW5jdGlvbihuMikgewogICAgICAgICAgaWYgKCFuMi5sZW5ndGgpCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICB0Mi5wdXNoKG4yLmRhdGEpOwogICAgICAgICAgICB9IHdoaWxlIChuMiA9IG4yLm5leHQpOwogICAgICAgIH0pLCB0MjsKICAgICAgfSwgRmMuZXh0ZW50ID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IHRoaXMuY292ZXIoK3QyWzBdWzBdLCArdDJbMF1bMV0pLmNvdmVyKCt0MlsxXVswXSwgK3QyWzFdWzFdKSA6IGlzTmFOKHRoaXMuX3gwKSA/IHZvaWQgMCA6IFtbdGhpcy5feDAsIHRoaXMuX3kwXSwgW3RoaXMuX3gxLCB0aGlzLl95MV1dOwogICAgICB9LCBGYy5maW5kID0gZnVuY3Rpb24odDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiwgaTIsIG8yLCBhMiwgdTIsIGMyLCBmMiwgczIgPSB0aGlzLl94MCwgbDIgPSB0aGlzLl95MCwgaDIgPSB0aGlzLl94MSwgZDIgPSB0aGlzLl95MSwgcDIgPSBbXSwgZzIgPSB0aGlzLl9yb290OwogICAgICAgIGZvciAoZzIgJiYgcDIucHVzaChuZXcgQ2MoZzIsIHMyLCBsMiwgaDIsIGQyKSksIG51bGwgPT0gZTIgPyBlMiA9IDEgLyAwIDogKHMyID0gdDIgLSBlMiwgbDIgPSBuMiAtIGUyLCBoMiA9IHQyICsgZTIsIGQyID0gbjIgKyBlMiwgZTIgKj0gZTIpOyBjMiA9IHAyLnBvcCgpOyApCiAgICAgICAgICBpZiAoISghKGcyID0gYzIubm9kZSkgfHwgKGkyID0gYzIueDApID4gaDIgfHwgKG8yID0gYzIueTApID4gZDIgfHwgKGEyID0gYzIueDEpIDwgczIgfHwgKHUyID0gYzIueTEpIDwgbDIpKQogICAgICAgICAgICBpZiAoZzIubGVuZ3RoKSB7CiAgICAgICAgICAgICAgdmFyIHkyID0gKGkyICsgYTIpIC8gMiwgdjIgPSAobzIgKyB1MikgLyAyOwogICAgICAgICAgICAgIHAyLnB1c2gobmV3IENjKGcyWzNdLCB5MiwgdjIsIGEyLCB1MiksIG5ldyBDYyhnMlsyXSwgaTIsIHYyLCB5MiwgdTIpLCBuZXcgQ2MoZzJbMV0sIHkyLCBvMiwgYTIsIHYyKSwgbmV3IENjKGcyWzBdLCBpMiwgbzIsIHkyLCB2MikpLCAoZjIgPSAobjIgPj0gdjIpIDw8IDEgfCB0MiA+PSB5MikgJiYgKGMyID0gcDJbcDIubGVuZ3RoIC0gMV0sIHAyW3AyLmxlbmd0aCAtIDFdID0gcDJbcDIubGVuZ3RoIC0gMSAtIGYyXSwgcDJbcDIubGVuZ3RoIC0gMSAtIGYyXSA9IGMyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgXzIgPSB0MiAtICt0aGlzLl94LmNhbGwobnVsbCwgZzIuZGF0YSksIGIyID0gbjIgLSArdGhpcy5feS5jYWxsKG51bGwsIGcyLmRhdGEpLCBtMiA9IF8yICogXzIgKyBiMiAqIGIyOwogICAgICAgICAgICAgIGlmIChtMiA8IGUyKSB7CiAgICAgICAgICAgICAgICB2YXIgeDIgPSBNYXRoLnNxcnQoZTIgPSBtMik7CiAgICAgICAgICAgICAgICBzMiA9IHQyIC0geDIsIGwyID0gbjIgLSB4MiwgaDIgPSB0MiArIHgyLCBkMiA9IG4yICsgeDIsIHIyID0gZzIuZGF0YTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICByZXR1cm4gcjI7CiAgICAgIH0sIEZjLnJlbW92ZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgaWYgKGlzTmFOKG8yID0gK3RoaXMuX3guY2FsbChudWxsLCB0MikpIHx8IGlzTmFOKGEyID0gK3RoaXMuX3kuY2FsbChudWxsLCB0MikpKQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgdmFyIG4yLCBlMiwgcjIsIGkyLCBvMiwgYTIsIHUyLCBjMiwgZjIsIHMyLCBsMiwgaDIsIGQyID0gdGhpcy5fcm9vdCwgcDIgPSB0aGlzLl94MCwgZzIgPSB0aGlzLl95MCwgeTIgPSB0aGlzLl94MSwgdjIgPSB0aGlzLl95MTsKICAgICAgICBpZiAoIWQyKQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgaWYgKGQyLmxlbmd0aCkKICAgICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgICBpZiAoKGYyID0gbzIgPj0gKHUyID0gKHAyICsgeTIpIC8gMikpID8gcDIgPSB1MiA6IHkyID0gdTIsIChzMiA9IGEyID49IChjMiA9IChnMiArIHYyKSAvIDIpKSA/IGcyID0gYzIgOiB2MiA9IGMyLCBuMiA9IGQyLCAhKGQyID0gZDJbbDIgPSBzMiA8PCAxIHwgZjJdKSkKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgaWYgKCFkMi5sZW5ndGgpCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIChuMltsMiArIDEgJiAzXSB8fCBuMltsMiArIDIgJiAzXSB8fCBuMltsMiArIDMgJiAzXSkgJiYgKGUyID0gbjIsIGgyID0gbDIpOwogICAgICAgICAgfQogICAgICAgIGZvciAoOyBkMi5kYXRhICE9PSB0MjsgKQogICAgICAgICAgaWYgKHIyID0gZDIsICEoZDIgPSBkMi5uZXh0KSkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgcmV0dXJuIChpMiA9IGQyLm5leHQpICYmIGRlbGV0ZSBkMi5uZXh0LCByMiA/IChpMiA/IHIyLm5leHQgPSBpMiA6IGRlbGV0ZSByMi5uZXh0LCB0aGlzKSA6IG4yID8gKGkyID8gbjJbbDJdID0gaTIgOiBkZWxldGUgbjJbbDJdLCAoZDIgPSBuMlswXSB8fCBuMlsxXSB8fCBuMlsyXSB8fCBuMlszXSkgJiYgZDIgPT09IChuMlszXSB8fCBuMlsyXSB8fCBuMlsxXSB8fCBuMlswXSkgJiYgIWQyLmxlbmd0aCAmJiAoZTIgPyBlMltoMl0gPSBkMiA6IHRoaXMuX3Jvb3QgPSBkMiksIHRoaXMpIDogKHRoaXMuX3Jvb3QgPSBpMiwgdGhpcyk7CiAgICAgIH0sIEZjLnJlbW92ZUFsbCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgZm9yICh2YXIgbjIgPSAwLCBlMiA9IHQyLmxlbmd0aDsgbjIgPCBlMjsgKytuMikKICAgICAgICAgIHRoaXMucmVtb3ZlKHQyW24yXSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sIEZjLnJvb3QgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcm9vdDsKICAgICAgfSwgRmMuc2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0MiA9IDA7CiAgICAgICAgcmV0dXJuIHRoaXMudmlzaXQoZnVuY3Rpb24objIpIHsKICAgICAgICAgIGlmICghbjIubGVuZ3RoKQogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgKyt0MjsKICAgICAgICAgICAgfSB3aGlsZSAobjIgPSBuMi5uZXh0KTsKICAgICAgICB9KSwgdDI7CiAgICAgIH0sIEZjLnZpc2l0ID0gZnVuY3Rpb24odDIpIHsKICAgICAgICB2YXIgbjIsIGUyLCByMiwgaTIsIG8yLCBhMiwgdTIgPSBbXSwgYzIgPSB0aGlzLl9yb290OwogICAgICAgIGZvciAoYzIgJiYgdTIucHVzaChuZXcgQ2MoYzIsIHRoaXMuX3gwLCB0aGlzLl95MCwgdGhpcy5feDEsIHRoaXMuX3kxKSk7IG4yID0gdTIucG9wKCk7ICkKICAgICAgICAgIGlmICghdDIoYzIgPSBuMi5ub2RlLCByMiA9IG4yLngwLCBpMiA9IG4yLnkwLCBvMiA9IG4yLngxLCBhMiA9IG4yLnkxKSAmJiBjMi5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGYyID0gKHIyICsgbzIpIC8gMiwgczIgPSAoaTIgKyBhMikgLyAyOwogICAgICAgICAgICAoZTIgPSBjMlszXSkgJiYgdTIucHVzaChuZXcgQ2MoZTIsIGYyLCBzMiwgbzIsIGEyKSksIChlMiA9IGMyWzJdKSAmJiB1Mi5wdXNoKG5ldyBDYyhlMiwgcjIsIHMyLCBmMiwgYTIpKSwgKGUyID0gYzJbMV0pICYmIHUyLnB1c2gobmV3IENjKGUyLCBmMiwgaTIsIG8yLCBzMikpLCAoZTIgPSBjMlswXSkgJiYgdTIucHVzaChuZXcgQ2MoZTIsIHIyLCBpMiwgZjIsIHMyKSk7CiAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sIEZjLnZpc2l0QWZ0ZXIgPSBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiwgZTIgPSBbXSwgcjIgPSBbXTsKICAgICAgICBmb3IgKHRoaXMuX3Jvb3QgJiYgZTIucHVzaChuZXcgQ2ModGhpcy5fcm9vdCwgdGhpcy5feDAsIHRoaXMuX3kwLCB0aGlzLl94MSwgdGhpcy5feTEpKTsgbjIgPSBlMi5wb3AoKTsgKSB7CiAgICAgICAgICB2YXIgaTIgPSBuMi5ub2RlOwogICAgICAgICAgaWYgKGkyLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgbzIsIGEyID0gbjIueDAsIHUyID0gbjIueTAsIGMyID0gbjIueDEsIGYyID0gbjIueTEsIHMyID0gKGEyICsgYzIpIC8gMiwgbDIgPSAodTIgKyBmMikgLyAyOwogICAgICAgICAgICAobzIgPSBpMlswXSkgJiYgZTIucHVzaChuZXcgQ2MobzIsIGEyLCB1MiwgczIsIGwyKSksIChvMiA9IGkyWzFdKSAmJiBlMi5wdXNoKG5ldyBDYyhvMiwgczIsIHUyLCBjMiwgbDIpKSwgKG8yID0gaTJbMl0pICYmIGUyLnB1c2gobmV3IENjKG8yLCBhMiwgbDIsIHMyLCBmMikpLCAobzIgPSBpMlszXSkgJiYgZTIucHVzaChuZXcgQ2MobzIsIHMyLCBsMiwgYzIsIGYyKSk7CiAgICAgICAgICB9CiAgICAgICAgICByMi5wdXNoKG4yKTsKICAgICAgICB9CiAgICAgICAgZm9yICg7IG4yID0gcjIucG9wKCk7ICkKICAgICAgICAgIHQyKG4yLm5vZGUsIG4yLngwLCBuMi55MCwgbjIueDEsIG4yLnkxKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwgRmMueCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodGhpcy5feCA9IHQyLCB0aGlzKSA6IHRoaXMuX3g7CiAgICAgIH0sIEZjLnkgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHRoaXMuX3kgPSB0MiwgdGhpcykgOiB0aGlzLl95OwogICAgICB9OwogICAgICBjb25zdCBMYyA9IDE2NjQ1MjUsIGpjID0gMTAxMzkwNDIyMywgSGMgPSA0Mjk0OTY3Mjk2OwogICAgICBmdW5jdGlvbiBYYyh0MikgewogICAgICAgIHJldHVybiB0Mi54OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEdjKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLnk7CiAgICAgIH0KICAgICAgdmFyIFZjID0gTWF0aC5QSSAqICgzIC0gTWF0aC5zcXJ0KDUpKTsKICAgICAgZnVuY3Rpb24gV2ModDIsIG4yKSB7CiAgICAgICAgaWYgKChlMiA9ICh0MiA9IG4yID8gdDIudG9FeHBvbmVudGlhbChuMiAtIDEpIDogdDIudG9FeHBvbmVudGlhbCgpKS5pbmRleE9mKCJlIikpIDwgMCkKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHZhciBlMiwgcjIgPSB0Mi5zbGljZSgwLCBlMik7CiAgICAgICAgcmV0dXJuIFtyMi5sZW5ndGggPiAxID8gcjJbMF0gKyByMi5zbGljZSgyKSA6IHIyLCArdDIuc2xpY2UoZTIgKyAxKV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWmModDIpIHsKICAgICAgICByZXR1cm4gKHQyID0gV2MoTWF0aC5hYnModDIpKSkgPyB0MlsxXSA6IE5hTjsKICAgICAgfQogICAgICB2YXIgS2MsIFFjID0gL14oPzooLik/KFs8Pj1eXSkpPyhbK1wtKCBdKT8oWyQjXSk/KDApPyhcZCspPygsKT8oXC5cZCspPyh+KT8oW2EteiVdKT8kL2k7CiAgICAgIGZ1bmN0aW9uIEpjKHQyKSB7CiAgICAgICAgaWYgKCEobjIgPSBRYy5leGVjKHQyKSkpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgZm9ybWF0OiAiICsgdDIpOwogICAgICAgIHZhciBuMjsKICAgICAgICByZXR1cm4gbmV3IHRmKHsgZmlsbDogbjJbMV0sIGFsaWduOiBuMlsyXSwgc2lnbjogbjJbM10sIHN5bWJvbDogbjJbNF0sIHplcm86IG4yWzVdLCB3aWR0aDogbjJbNl0sIGNvbW1hOiBuMls3XSwgcHJlY2lzaW9uOiBuMls4XSAmJiBuMls4XS5zbGljZSgxKSwgdHJpbTogbjJbOV0sIHR5cGU6IG4yWzEwXSB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiB0Zih0MikgewogICAgICAgIHRoaXMuZmlsbCA9IHZvaWQgMCA9PT0gdDIuZmlsbCA/ICIgIiA6IHQyLmZpbGwgKyAiIiwgdGhpcy5hbGlnbiA9IHZvaWQgMCA9PT0gdDIuYWxpZ24gPyAiPiIgOiB0Mi5hbGlnbiArICIiLCB0aGlzLnNpZ24gPSB2b2lkIDAgPT09IHQyLnNpZ24gPyAiLSIgOiB0Mi5zaWduICsgIiIsIHRoaXMuc3ltYm9sID0gdm9pZCAwID09PSB0Mi5zeW1ib2wgPyAiIiA6IHQyLnN5bWJvbCArICIiLCB0aGlzLnplcm8gPSAhIXQyLnplcm8sIHRoaXMud2lkdGggPSB2b2lkIDAgPT09IHQyLndpZHRoID8gdm9pZCAwIDogK3QyLndpZHRoLCB0aGlzLmNvbW1hID0gISF0Mi5jb21tYSwgdGhpcy5wcmVjaXNpb24gPSB2b2lkIDAgPT09IHQyLnByZWNpc2lvbiA/IHZvaWQgMCA6ICt0Mi5wcmVjaXNpb24sIHRoaXMudHJpbSA9ICEhdDIudHJpbSwgdGhpcy50eXBlID0gdm9pZCAwID09PSB0Mi50eXBlID8gIiIgOiB0Mi50eXBlICsgIiI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbmYodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gV2ModDIsIG4yKTsKICAgICAgICBpZiAoIWUyKQogICAgICAgICAgcmV0dXJuIHQyICsgIiI7CiAgICAgICAgdmFyIHIyID0gZTJbMF0sIGkyID0gZTJbMV07CiAgICAgICAgcmV0dXJuIGkyIDwgMCA/ICIwLiIgKyBuZXcgQXJyYXkoLWkyKS5qb2luKCIwIikgKyByMiA6IHIyLmxlbmd0aCA+IGkyICsgMSA/IHIyLnNsaWNlKDAsIGkyICsgMSkgKyAiLiIgKyByMi5zbGljZShpMiArIDEpIDogcjIgKyBuZXcgQXJyYXkoaTIgLSByMi5sZW5ndGggKyAyKS5qb2luKCIwIik7CiAgICAgIH0KICAgICAgSmMucHJvdG90eXBlID0gdGYucHJvdG90eXBlLCB0Zi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5maWxsICsgdGhpcy5hbGlnbiArIHRoaXMuc2lnbiArIHRoaXMuc3ltYm9sICsgKHRoaXMuemVybyA/ICIwIiA6ICIiKSArICh2b2lkIDAgPT09IHRoaXMud2lkdGggPyAiIiA6IE1hdGgubWF4KDEsIDAgfCB0aGlzLndpZHRoKSkgKyAodGhpcy5jb21tYSA/ICIsIiA6ICIiKSArICh2b2lkIDAgPT09IHRoaXMucHJlY2lzaW9uID8gIiIgOiAiLiIgKyBNYXRoLm1heCgwLCAwIHwgdGhpcy5wcmVjaXNpb24pKSArICh0aGlzLnRyaW0gPyAifiIgOiAiIikgKyB0aGlzLnR5cGU7CiAgICAgIH07CiAgICAgIHZhciBlZiA9IHsgIiUiOiAodDIsIG4yKSA9PiAoMTAwICogdDIpLnRvRml4ZWQobjIpLCBiOiAodDIpID0+IE1hdGgucm91bmQodDIpLnRvU3RyaW5nKDIpLCBjOiAodDIpID0+IHQyICsgIiIsIGQ6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIE1hdGguYWJzKHQyID0gTWF0aC5yb3VuZCh0MikpID49IDFlMjEgPyB0Mi50b0xvY2FsZVN0cmluZygiZW4iKS5yZXBsYWNlKC8sL2csICIiKSA6IHQyLnRvU3RyaW5nKDEwKTsKICAgICAgfSwgZTogKHQyLCBuMikgPT4gdDIudG9FeHBvbmVudGlhbChuMiksIGY6ICh0MiwgbjIpID0+IHQyLnRvRml4ZWQobjIpLCBnOiAodDIsIG4yKSA9PiB0Mi50b1ByZWNpc2lvbihuMiksIG86ICh0MikgPT4gTWF0aC5yb3VuZCh0MikudG9TdHJpbmcoOCksIHA6ICh0MiwgbjIpID0+IG5mKDEwMCAqIHQyLCBuMiksIHI6IG5mLCBzOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSBXYyh0MiwgbjIpOwogICAgICAgIGlmICghZTIpCiAgICAgICAgICByZXR1cm4gdDIgKyAiIjsKICAgICAgICB2YXIgcjIgPSBlMlswXSwgaTIgPSBlMlsxXSwgbzIgPSBpMiAtIChLYyA9IDMgKiBNYXRoLm1heCgtOCwgTWF0aC5taW4oOCwgTWF0aC5mbG9vcihpMiAvIDMpKSkpICsgMSwgYTIgPSByMi5sZW5ndGg7CiAgICAgICAgcmV0dXJuIG8yID09PSBhMiA/IHIyIDogbzIgPiBhMiA/IHIyICsgbmV3IEFycmF5KG8yIC0gYTIgKyAxKS5qb2luKCIwIikgOiBvMiA+IDAgPyByMi5zbGljZSgwLCBvMikgKyAiLiIgKyByMi5zbGljZShvMikgOiAiMC4iICsgbmV3IEFycmF5KDEgLSBvMikuam9pbigiMCIpICsgV2ModDIsIE1hdGgubWF4KDAsIG4yICsgbzIgLSAxKSlbMF07CiAgICAgIH0sIFg6ICh0MikgPT4gTWF0aC5yb3VuZCh0MikudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCksIHg6ICh0MikgPT4gTWF0aC5yb3VuZCh0MikudG9TdHJpbmcoMTYpIH07CiAgICAgIGZ1bmN0aW9uIHJmKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyOwogICAgICB9CiAgICAgIHZhciBvZiwgYWYgPSBBcnJheS5wcm90b3R5cGUubWFwLCB1ZiA9IFsieSIsICJ6IiwgImEiLCAiZiIsICJwIiwgIm4iLCAiXHhCNSIsICJtIiwgIiIsICJrIiwgIk0iLCAiRyIsICJUIiwgIlAiLCAiRSIsICJaIiwgIlkiXTsKICAgICAgZnVuY3Rpb24gY2YodDIpIHsKICAgICAgICB2YXIgbjIsIGUyLCByMiA9IHZvaWQgMCA9PT0gdDIuZ3JvdXBpbmcgfHwgdm9pZCAwID09PSB0Mi50aG91c2FuZHMgPyByZiA6IChuMiA9IGFmLmNhbGwodDIuZ3JvdXBpbmcsIE51bWJlciksIGUyID0gdDIudGhvdXNhbmRzICsgIiIsIGZ1bmN0aW9uKHQzLCByMykgewogICAgICAgICAgZm9yICh2YXIgaTMgPSB0My5sZW5ndGgsIG8zID0gW10sIGEzID0gMCwgdTMgPSBuMlswXSwgYzMgPSAwOyBpMyA+IDAgJiYgdTMgPiAwICYmIChjMyArIHUzICsgMSA+IHIzICYmICh1MyA9IE1hdGgubWF4KDEsIHIzIC0gYzMpKSwgbzMucHVzaCh0My5zdWJzdHJpbmcoaTMgLT0gdTMsIGkzICsgdTMpKSwgISgoYzMgKz0gdTMgKyAxKSA+IHIzKSk7ICkKICAgICAgICAgICAgdTMgPSBuMlthMyA9IChhMyArIDEpICUgbjIubGVuZ3RoXTsKICAgICAgICAgIHJldHVybiBvMy5yZXZlcnNlKCkuam9pbihlMik7CiAgICAgICAgfSksIGkyID0gdm9pZCAwID09PSB0Mi5jdXJyZW5jeSA/ICIiIDogdDIuY3VycmVuY3lbMF0gKyAiIiwgbzIgPSB2b2lkIDAgPT09IHQyLmN1cnJlbmN5ID8gIiIgOiB0Mi5jdXJyZW5jeVsxXSArICIiLCBhMiA9IHZvaWQgMCA9PT0gdDIuZGVjaW1hbCA/ICIuIiA6IHQyLmRlY2ltYWwgKyAiIiwgdTIgPSB2b2lkIDAgPT09IHQyLm51bWVyYWxzID8gcmYgOiAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihuMykgewogICAgICAgICAgICByZXR1cm4gbjMucmVwbGFjZSgvWzAtOV0vZywgZnVuY3Rpb24objQpIHsKICAgICAgICAgICAgICByZXR1cm4gdDNbK240XTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgIH0oYWYuY2FsbCh0Mi5udW1lcmFscywgU3RyaW5nKSksIGMyID0gdm9pZCAwID09PSB0Mi5wZXJjZW50ID8gIiUiIDogdDIucGVyY2VudCArICIiLCBmMiA9IHZvaWQgMCA9PT0gdDIubWludXMgPyAiXHUyMjEyIiA6IHQyLm1pbnVzICsgIiIsIHMyID0gdm9pZCAwID09PSB0Mi5uYW4gPyAiTmFOIiA6IHQyLm5hbiArICIiOwogICAgICAgIGZ1bmN0aW9uIGwyKHQzKSB7CiAgICAgICAgICB2YXIgbjMgPSAodDMgPSBKYyh0MykpLmZpbGwsIGUzID0gdDMuYWxpZ24sIGwzID0gdDMuc2lnbiwgaDIgPSB0My5zeW1ib2wsIGQyID0gdDMuemVybywgcDIgPSB0My53aWR0aCwgZzIgPSB0My5jb21tYSwgeTIgPSB0My5wcmVjaXNpb24sIHYyID0gdDMudHJpbSwgXzIgPSB0My50eXBlOwogICAgICAgICAgIm4iID09PSBfMiA/IChnMiA9IHRydWUsIF8yID0gImciKSA6IGVmW18yXSB8fCAodm9pZCAwID09PSB5MiAmJiAoeTIgPSAxMiksIHYyID0gdHJ1ZSwgXzIgPSAiZyIpLCAoZDIgfHwgIjAiID09PSBuMyAmJiAiPSIgPT09IGUzKSAmJiAoZDIgPSB0cnVlLCBuMyA9ICIwIiwgZTMgPSAiPSIpOwogICAgICAgICAgdmFyIGIyID0gIiQiID09PSBoMiA/IGkyIDogIiMiID09PSBoMiAmJiAvW2JveFhdLy50ZXN0KF8yKSA/ICIwIiArIF8yLnRvTG93ZXJDYXNlKCkgOiAiIiwgbTIgPSAiJCIgPT09IGgyID8gbzIgOiAvWyVwXS8udGVzdChfMikgPyBjMiA6ICIiLCB4MiA9IGVmW18yXSwgdzIgPSAvW2RlZmdwcnMlXS8udGVzdChfMik7CiAgICAgICAgICBmdW5jdGlvbiBNMih0NCkgewogICAgICAgICAgICB2YXIgaTMsIG8zLCBjMywgaDMgPSBiMiwgTTMgPSBtMjsKICAgICAgICAgICAgaWYgKCJjIiA9PT0gXzIpCiAgICAgICAgICAgICAgTTMgPSB4Mih0NCkgKyBNMywgdDQgPSAiIjsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdmFyIFQyID0gKHQ0ID0gK3Q0KSA8IDAgfHwgMSAvIHQ0IDwgMDsKICAgICAgICAgICAgICBpZiAodDQgPSBpc05hTih0NCkgPyBzMiA6IHgyKE1hdGguYWJzKHQ0KSwgeTIpLCB2MiAmJiAodDQgPSBmdW5jdGlvbih0NSkgewogICAgICAgICAgICAgICAgdDoKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbjQsIGU0ID0gdDUubGVuZ3RoLCByMyA9IDEsIGk0ID0gLTE7IHIzIDwgZTQ7ICsrcjMpCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0NVtyM10pIHsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIi4iOgogICAgICAgICAgICAgICAgICAgICAgICBpNCA9IG40ID0gcjM7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiMCI6CiAgICAgICAgICAgICAgICAgICAgICAgIDAgPT09IGk0ICYmIChpNCA9IHIzKSwgbjQgPSByMzsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISt0NVtyM10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsgdDsKICAgICAgICAgICAgICAgICAgICAgICAgaTQgPiAwICYmIChpNCA9IDApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBpNCA+IDAgPyB0NS5zbGljZSgwLCBpNCkgKyB0NS5zbGljZShuNCArIDEpIDogdDU7CiAgICAgICAgICAgICAgfSh0NCkpLCBUMiAmJiAwID09ICt0NCAmJiAiKyIgIT09IGwzICYmIChUMiA9IGZhbHNlKSwgaDMgPSAoVDIgPyAiKCIgPT09IGwzID8gbDMgOiBmMiA6ICItIiA9PT0gbDMgfHwgIigiID09PSBsMyA/ICIiIDogbDMpICsgaDMsIE0zID0gKCJzIiA9PT0gXzIgPyB1Zls4ICsgS2MgLyAzXSA6ICIiKSArIE0zICsgKFQyICYmICIoIiA9PT0gbDMgPyAiKSIgOiAiIiksIHcyKSB7CiAgICAgICAgICAgICAgICBmb3IgKGkzID0gLTEsIG8zID0gdDQubGVuZ3RoOyArK2kzIDwgbzM7ICkKICAgICAgICAgICAgICAgICAgaWYgKDQ4ID4gKGMzID0gdDQuY2hhckNvZGVBdChpMykpIHx8IGMzID4gNTcpIHsKICAgICAgICAgICAgICAgICAgICBNMyA9ICg0NiA9PT0gYzMgPyBhMiArIHQ0LnNsaWNlKGkzICsgMSkgOiB0NC5zbGljZShpMykpICsgTTMsIHQ0ID0gdDQuc2xpY2UoMCwgaTMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGcyICYmICFkMiAmJiAodDQgPSByMih0NCwgMSAvIDApKTsKICAgICAgICAgICAgdmFyIEEyID0gaDMubGVuZ3RoICsgdDQubGVuZ3RoICsgTTMubGVuZ3RoLCBTMiA9IEEyIDwgcDIgPyBuZXcgQXJyYXkocDIgLSBBMiArIDEpLmpvaW4objMpIDogIiI7CiAgICAgICAgICAgIHN3aXRjaCAoZzIgJiYgZDIgJiYgKHQ0ID0gcjIoUzIgKyB0NCwgUzIubGVuZ3RoID8gcDIgLSBNMy5sZW5ndGggOiAxIC8gMCksIFMyID0gIiIpLCBlMykgewogICAgICAgICAgICAgIGNhc2UgIjwiOgogICAgICAgICAgICAgICAgdDQgPSBoMyArIHQ0ICsgTTMgKyBTMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIj0iOgogICAgICAgICAgICAgICAgdDQgPSBoMyArIFMyICsgdDQgKyBNMzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgIl4iOgogICAgICAgICAgICAgICAgdDQgPSBTMi5zbGljZSgwLCBBMiA9IFMyLmxlbmd0aCA+PiAxKSArIGgzICsgdDQgKyBNMyArIFMyLnNsaWNlKEEyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB0NCA9IFMyICsgaDMgKyB0NCArIE0zOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB1Mih0NCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4geTIgPSB2b2lkIDAgPT09IHkyID8gNiA6IC9bZ3Byc10vLnRlc3QoXzIpID8gTWF0aC5tYXgoMSwgTWF0aC5taW4oMjEsIHkyKSkgOiBNYXRoLm1heCgwLCBNYXRoLm1pbigyMCwgeTIpKSwgTTIudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHQzICsgIiI7CiAgICAgICAgICB9LCBNMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgZm9ybWF0OiBsMiwgZm9ybWF0UHJlZml4OiBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHZhciBlMyA9IGwyKCgodDMgPSBKYyh0MykpLnR5cGUgPSAiZiIsIHQzKSksIHIzID0gMyAqIE1hdGgubWF4KC04LCBNYXRoLm1pbig4LCBNYXRoLmZsb29yKFpjKG4zKSAvIDMpKSksIGkzID0gTWF0aC5wb3coMTAsIC1yMyksIG8zID0gdWZbOCArIHIzIC8gM107CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odDQpIHsKICAgICAgICAgICAgcmV0dXJuIGUzKGkzICogdDQpICsgbzM7CiAgICAgICAgICB9OwogICAgICAgIH0gfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBmZihuMikgewogICAgICAgIHJldHVybiBvZiA9IGNmKG4yKSwgdC5mb3JtYXQgPSBvZi5mb3JtYXQsIHQuZm9ybWF0UHJlZml4ID0gb2YuZm9ybWF0UHJlZml4LCBvZjsKICAgICAgfQogICAgICBmdW5jdGlvbiBzZih0MikgewogICAgICAgIHJldHVybiBNYXRoLm1heCgwLCAtWmMoTWF0aC5hYnModDIpKSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbGYodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIDMgKiBNYXRoLm1heCgtOCwgTWF0aC5taW4oOCwgTWF0aC5mbG9vcihaYyhuMikgLyAzKSkpIC0gWmMoTWF0aC5hYnModDIpKSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaGYodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHQyID0gTWF0aC5hYnModDIpLCBuMiA9IE1hdGguYWJzKG4yKSAtIHQyLCBNYXRoLm1heCgwLCBaYyhuMikgLSBaYyh0MikpICsgMTsKICAgICAgfQogICAgICB0LmZvcm1hdCA9IHZvaWQgMCwgdC5mb3JtYXRQcmVmaXggPSB2b2lkIDAsIGZmKHsgdGhvdXNhbmRzOiAiLCIsIGdyb3VwaW5nOiBbM10sIGN1cnJlbmN5OiBbIiQiLCAiIl0gfSk7CiAgICAgIHZhciBkZiA9IDFlLTYsIHBmID0gMWUtMTIsIGdmID0gTWF0aC5QSSwgeWYgPSBnZiAvIDIsIHZmID0gZ2YgLyA0LCBfZiA9IDIgKiBnZiwgYmYgPSAxODAgLyBnZiwgbWYgPSBnZiAvIDE4MCwgeGYgPSBNYXRoLmFicywgd2YgPSBNYXRoLmF0YW4sIE1mID0gTWF0aC5hdGFuMiwgVGYgPSBNYXRoLmNvcywgQWYgPSBNYXRoLmNlaWwsIFNmID0gTWF0aC5leHAsIEVmID0gTWF0aC5oeXBvdCwgTmYgPSBNYXRoLmxvZywga2YgPSBNYXRoLnBvdywgQ2YgPSBNYXRoLnNpbiwgUGYgPSBNYXRoLnNpZ24gfHwgZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gdDIgPiAwID8gMSA6IHQyIDwgMCA/IC0xIDogMDsKICAgICAgfSwgemYgPSBNYXRoLnNxcnQsICRmID0gTWF0aC50YW47CiAgICAgIGZ1bmN0aW9uIERmKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyID4gMSA/IDAgOiB0MiA8IC0xID8gZ2YgOiBNYXRoLmFjb3ModDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFJmKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyID4gMSA/IHlmIDogdDIgPCAtMSA/IC15ZiA6IE1hdGguYXNpbih0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRmYodDIpIHsKICAgICAgICByZXR1cm4gKHQyID0gQ2YodDIgLyAyKSkgKiB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBxZigpIHsKICAgICAgfQogICAgICBmdW5jdGlvbiBVZih0MiwgbjIpIHsKICAgICAgICB0MiAmJiBPZi5oYXNPd25Qcm9wZXJ0eSh0Mi50eXBlKSAmJiBPZlt0Mi50eXBlXSh0MiwgbjIpOwogICAgICB9CiAgICAgIHZhciBJZiA9IHsgRmVhdHVyZTogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgVWYodDIuZ2VvbWV0cnksIG4yKTsKICAgICAgfSwgRmVhdHVyZUNvbGxlY3Rpb246IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGZvciAodmFyIGUyID0gdDIuZmVhdHVyZXMsIHIyID0gLTEsIGkyID0gZTIubGVuZ3RoOyArK3IyIDwgaTI7ICkKICAgICAgICAgIFVmKGUyW3IyXS5nZW9tZXRyeSwgbjIpOwogICAgICB9IH0sIE9mID0geyBTcGhlcmU6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIG4yLnNwaGVyZSgpOwogICAgICB9LCBQb2ludDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdDIgPSB0Mi5jb29yZGluYXRlcywgbjIucG9pbnQodDJbMF0sIHQyWzFdLCB0MlsyXSk7CiAgICAgIH0sIE11bHRpUG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGZvciAodmFyIGUyID0gdDIuY29vcmRpbmF0ZXMsIHIyID0gLTEsIGkyID0gZTIubGVuZ3RoOyArK3IyIDwgaTI7ICkKICAgICAgICAgIHQyID0gZTJbcjJdLCBuMi5wb2ludCh0MlswXSwgdDJbMV0sIHQyWzJdKTsKICAgICAgfSwgTGluZVN0cmluZzogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgQmYodDIuY29vcmRpbmF0ZXMsIG4yLCAwKTsKICAgICAgfSwgTXVsdGlMaW5lU3RyaW5nOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiA9IHQyLmNvb3JkaW5hdGVzLCByMiA9IC0xLCBpMiA9IGUyLmxlbmd0aDsgKytyMiA8IGkyOyApCiAgICAgICAgICBCZihlMltyMl0sIG4yLCAwKTsKICAgICAgfSwgUG9seWdvbjogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgWWYodDIuY29vcmRpbmF0ZXMsIG4yKTsKICAgICAgfSwgTXVsdGlQb2x5Z29uOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiA9IHQyLmNvb3JkaW5hdGVzLCByMiA9IC0xLCBpMiA9IGUyLmxlbmd0aDsgKytyMiA8IGkyOyApCiAgICAgICAgICBZZihlMltyMl0sIG4yKTsKICAgICAgfSwgR2VvbWV0cnlDb2xsZWN0aW9uOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiA9IHQyLmdlb21ldHJpZXMsIHIyID0gLTEsIGkyID0gZTIubGVuZ3RoOyArK3IyIDwgaTI7ICkKICAgICAgICAgIFVmKGUyW3IyXSwgbjIpOwogICAgICB9IH07CiAgICAgIGZ1bmN0aW9uIEJmKHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIsIGkyID0gLTEsIG8yID0gdDIubGVuZ3RoIC0gZTI7CiAgICAgICAgZm9yIChuMi5saW5lU3RhcnQoKTsgKytpMiA8IG8yOyApCiAgICAgICAgICByMiA9IHQyW2kyXSwgbjIucG9pbnQocjJbMF0sIHIyWzFdLCByMlsyXSk7CiAgICAgICAgbjIubGluZUVuZCgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFlmKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IC0xLCByMiA9IHQyLmxlbmd0aDsKICAgICAgICBmb3IgKG4yLnBvbHlnb25TdGFydCgpOyArK2UyIDwgcjI7ICkKICAgICAgICAgIEJmKHQyW2UyXSwgbjIsIDEpOwogICAgICAgIG4yLnBvbHlnb25FbmQoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBMZih0MiwgbjIpIHsKICAgICAgICB0MiAmJiBJZi5oYXNPd25Qcm9wZXJ0eSh0Mi50eXBlKSA/IElmW3QyLnR5cGVdKHQyLCBuMikgOiBVZih0MiwgbjIpOwogICAgICB9CiAgICAgIHZhciBqZiwgSGYsIFhmLCBHZiwgVmYsIFdmLCBaZiwgS2YsIFFmLCBKZiwgdHMsIG5zLCBlcywgcnMsIGlzLCBvcywgYXMgPSBuZXcgVCgpLCB1cyA9IG5ldyBUKCksIGNzID0geyBwb2ludDogcWYsIGxpbmVTdGFydDogcWYsIGxpbmVFbmQ6IHFmLCBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGFzID0gbmV3IFQoKSwgY3MubGluZVN0YXJ0ID0gZnMsIGNzLmxpbmVFbmQgPSBzczsKICAgICAgfSwgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyID0gK2FzOwogICAgICAgIHVzLmFkZCh0MiA8IDAgPyBfZiArIHQyIDogdDIpLCB0aGlzLmxpbmVTdGFydCA9IHRoaXMubGluZUVuZCA9IHRoaXMucG9pbnQgPSBxZjsKICAgICAgfSwgc3BoZXJlOiBmdW5jdGlvbigpIHsKICAgICAgICB1cy5hZGQoX2YpOwogICAgICB9IH07CiAgICAgIGZ1bmN0aW9uIGZzKCkgewogICAgICAgIGNzLnBvaW50ID0gbHM7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc3MoKSB7CiAgICAgICAgaHMoamYsIEhmKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBscyh0MiwgbjIpIHsKICAgICAgICBjcy5wb2ludCA9IGhzLCBqZiA9IHQyLCBIZiA9IG4yLCBYZiA9IHQyICo9IG1mLCBHZiA9IFRmKG4yID0gKG4yICo9IG1mKSAvIDIgKyB2ZiksIFZmID0gQ2YobjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGhzKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9ICh0MiAqPSBtZikgLSBYZiwgcjIgPSBlMiA+PSAwID8gMSA6IC0xLCBpMiA9IHIyICogZTIsIG8yID0gVGYobjIgPSAobjIgKj0gbWYpIC8gMiArIHZmKSwgYTIgPSBDZihuMiksIHUyID0gVmYgKiBhMiwgYzIgPSBHZiAqIG8yICsgdTIgKiBUZihpMiksIGYyID0gdTIgKiByMiAqIENmKGkyKTsKICAgICAgICBhcy5hZGQoTWYoZjIsIGMyKSksIFhmID0gdDIsIEdmID0gbzIsIFZmID0gYTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZHModDIpIHsKICAgICAgICByZXR1cm4gW01mKHQyWzFdLCB0MlswXSksIFJmKHQyWzJdKV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcHModDIpIHsKICAgICAgICB2YXIgbjIgPSB0MlswXSwgZTIgPSB0MlsxXSwgcjIgPSBUZihlMik7CiAgICAgICAgcmV0dXJuIFtyMiAqIFRmKG4yKSwgcjIgKiBDZihuMiksIENmKGUyKV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZ3ModDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHQyWzBdICogbjJbMF0gKyB0MlsxXSAqIG4yWzFdICsgdDJbMl0gKiBuMlsyXTsKICAgICAgfQogICAgICBmdW5jdGlvbiB5cyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gW3QyWzFdICogbjJbMl0gLSB0MlsyXSAqIG4yWzFdLCB0MlsyXSAqIG4yWzBdIC0gdDJbMF0gKiBuMlsyXSwgdDJbMF0gKiBuMlsxXSAtIHQyWzFdICogbjJbMF1dOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHZzKHQyLCBuMikgewogICAgICAgIHQyWzBdICs9IG4yWzBdLCB0MlsxXSArPSBuMlsxXSwgdDJbMl0gKz0gbjJbMl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gX3ModDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIFt0MlswXSAqIG4yLCB0MlsxXSAqIG4yLCB0MlsyXSAqIG4yXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBicyh0MikgewogICAgICAgIHZhciBuMiA9IHpmKHQyWzBdICogdDJbMF0gKyB0MlsxXSAqIHQyWzFdICsgdDJbMl0gKiB0MlsyXSk7CiAgICAgICAgdDJbMF0gLz0gbjIsIHQyWzFdIC89IG4yLCB0MlsyXSAvPSBuMjsKICAgICAgfQogICAgICB2YXIgbXMsIHhzLCB3cywgTXMsIFRzLCBBcywgU3MsIEVzLCBOcywga3MsIENzLCBQcywgenMsICRzLCBEcywgUnMsIEZzID0geyBwb2ludDogcXMsIGxpbmVTdGFydDogSXMsIGxpbmVFbmQ6IE9zLCBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIEZzLnBvaW50ID0gQnMsIEZzLmxpbmVTdGFydCA9IFlzLCBGcy5saW5lRW5kID0gTHMsIHJzID0gbmV3IFQoKSwgY3MucG9seWdvblN0YXJ0KCk7CiAgICAgIH0sIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGNzLnBvbHlnb25FbmQoKSwgRnMucG9pbnQgPSBxcywgRnMubGluZVN0YXJ0ID0gSXMsIEZzLmxpbmVFbmQgPSBPcywgYXMgPCAwID8gKFdmID0gLShLZiA9IDE4MCksIFpmID0gLShRZiA9IDkwKSkgOiBycyA+IGRmID8gUWYgPSA5MCA6IHJzIDwgLWRmICYmIChaZiA9IC05MCksIG9zWzBdID0gV2YsIG9zWzFdID0gS2Y7CiAgICAgIH0sIHNwaGVyZTogZnVuY3Rpb24oKSB7CiAgICAgICAgV2YgPSAtKEtmID0gMTgwKSwgWmYgPSAtKFFmID0gOTApOwogICAgICB9IH07CiAgICAgIGZ1bmN0aW9uIHFzKHQyLCBuMikgewogICAgICAgIGlzLnB1c2gob3MgPSBbV2YgPSB0MiwgS2YgPSB0Ml0pLCBuMiA8IFpmICYmIChaZiA9IG4yKSwgbjIgPiBRZiAmJiAoUWYgPSBuMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVXModDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gcHMoW3QyICogbWYsIG4yICogbWZdKTsKICAgICAgICBpZiAoZXMpIHsKICAgICAgICAgIHZhciByMiA9IHlzKGVzLCBlMiksIGkyID0geXMoW3IyWzFdLCAtcjJbMF0sIDBdLCByMik7CiAgICAgICAgICBicyhpMiksIGkyID0gZHMoaTIpOwogICAgICAgICAgdmFyIG8yLCBhMiA9IHQyIC0gSmYsIHUyID0gYTIgPiAwID8gMSA6IC0xLCBjMiA9IGkyWzBdICogYmYgKiB1MiwgZjIgPSB4ZihhMikgPiAxODA7CiAgICAgICAgICBmMiBeICh1MiAqIEpmIDwgYzIgJiYgYzIgPCB1MiAqIHQyKSA/IChvMiA9IGkyWzFdICogYmYpID4gUWYgJiYgKFFmID0gbzIpIDogZjIgXiAodTIgKiBKZiA8IChjMiA9IChjMiArIDM2MCkgJSAzNjAgLSAxODApICYmIGMyIDwgdTIgKiB0MikgPyAobzIgPSAtaTJbMV0gKiBiZikgPCBaZiAmJiAoWmYgPSBvMikgOiAobjIgPCBaZiAmJiAoWmYgPSBuMiksIG4yID4gUWYgJiYgKFFmID0gbjIpKSwgZjIgPyB0MiA8IEpmID8ganMoV2YsIHQyKSA+IGpzKFdmLCBLZikgJiYgKEtmID0gdDIpIDoganModDIsIEtmKSA+IGpzKFdmLCBLZikgJiYgKFdmID0gdDIpIDogS2YgPj0gV2YgPyAodDIgPCBXZiAmJiAoV2YgPSB0MiksIHQyID4gS2YgJiYgKEtmID0gdDIpKSA6IHQyID4gSmYgPyBqcyhXZiwgdDIpID4ganMoV2YsIEtmKSAmJiAoS2YgPSB0MikgOiBqcyh0MiwgS2YpID4ganMoV2YsIEtmKSAmJiAoV2YgPSB0Mik7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICBpcy5wdXNoKG9zID0gW1dmID0gdDIsIEtmID0gdDJdKTsKICAgICAgICBuMiA8IFpmICYmIChaZiA9IG4yKSwgbjIgPiBRZiAmJiAoUWYgPSBuMiksIGVzID0gZTIsIEpmID0gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXMoKSB7CiAgICAgICAgRnMucG9pbnQgPSBVczsKICAgICAgfQogICAgICBmdW5jdGlvbiBPcygpIHsKICAgICAgICBvc1swXSA9IFdmLCBvc1sxXSA9IEtmLCBGcy5wb2ludCA9IHFzLCBlcyA9IG51bGw7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQnModDIsIG4yKSB7CiAgICAgICAgaWYgKGVzKSB7CiAgICAgICAgICB2YXIgZTIgPSB0MiAtIEpmOwogICAgICAgICAgcnMuYWRkKHhmKGUyKSA+IDE4MCA/IGUyICsgKGUyID4gMCA/IDM2MCA6IC0zNjApIDogZTIpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgdHMgPSB0MiwgbnMgPSBuMjsKICAgICAgICBjcy5wb2ludCh0MiwgbjIpLCBVcyh0MiwgbjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFlzKCkgewogICAgICAgIGNzLmxpbmVTdGFydCgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIExzKCkgewogICAgICAgIEJzKHRzLCBucyksIGNzLmxpbmVFbmQoKSwgeGYocnMpID4gZGYgJiYgKFdmID0gLShLZiA9IDE4MCkpLCBvc1swXSA9IFdmLCBvc1sxXSA9IEtmLCBlcyA9IG51bGw7CiAgICAgIH0KICAgICAgZnVuY3Rpb24ganModDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIChuMiAtPSB0MikgPCAwID8gbjIgKyAzNjAgOiBuMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBIcyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gdDJbMF0gLSBuMlswXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBYcyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gdDJbMF0gPD0gdDJbMV0gPyB0MlswXSA8PSBuMiAmJiBuMiA8PSB0MlsxXSA6IG4yIDwgdDJbMF0gfHwgdDJbMV0gPCBuMjsKICAgICAgfQogICAgICB2YXIgR3MgPSB7IHNwaGVyZTogcWYsIHBvaW50OiBWcywgbGluZVN0YXJ0OiBacywgbGluZUVuZDogSnMsIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgR3MubGluZVN0YXJ0ID0gdGwsIEdzLmxpbmVFbmQgPSBubDsKICAgICAgfSwgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgR3MubGluZVN0YXJ0ID0gWnMsIEdzLmxpbmVFbmQgPSBKczsKICAgICAgfSB9OwogICAgICBmdW5jdGlvbiBWcyh0MiwgbjIpIHsKICAgICAgICB0MiAqPSBtZjsKICAgICAgICB2YXIgZTIgPSBUZihuMiAqPSBtZik7CiAgICAgICAgV3MoZTIgKiBUZih0MiksIGUyICogQ2YodDIpLCBDZihuMikpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdzKHQyLCBuMiwgZTIpIHsKICAgICAgICArK21zLCB3cyArPSAodDIgLSB3cykgLyBtcywgTXMgKz0gKG4yIC0gTXMpIC8gbXMsIFRzICs9IChlMiAtIFRzKSAvIG1zOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFpzKCkgewogICAgICAgIEdzLnBvaW50ID0gS3M7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gS3ModDIsIG4yKSB7CiAgICAgICAgdDIgKj0gbWY7CiAgICAgICAgdmFyIGUyID0gVGYobjIgKj0gbWYpOwogICAgICAgICRzID0gZTIgKiBUZih0MiksIERzID0gZTIgKiBDZih0MiksIFJzID0gQ2YobjIpLCBHcy5wb2ludCA9IFFzLCBXcygkcywgRHMsIFJzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBRcyh0MiwgbjIpIHsKICAgICAgICB0MiAqPSBtZjsKICAgICAgICB2YXIgZTIgPSBUZihuMiAqPSBtZiksIHIyID0gZTIgKiBUZih0MiksIGkyID0gZTIgKiBDZih0MiksIG8yID0gQ2YobjIpLCBhMiA9IE1mKHpmKChhMiA9IERzICogbzIgLSBScyAqIGkyKSAqIGEyICsgKGEyID0gUnMgKiByMiAtICRzICogbzIpICogYTIgKyAoYTIgPSAkcyAqIGkyIC0gRHMgKiByMikgKiBhMiksICRzICogcjIgKyBEcyAqIGkyICsgUnMgKiBvMik7CiAgICAgICAgeHMgKz0gYTIsIEFzICs9IGEyICogKCRzICsgKCRzID0gcjIpKSwgU3MgKz0gYTIgKiAoRHMgKyAoRHMgPSBpMikpLCBFcyArPSBhMiAqIChScyArIChScyA9IG8yKSksIFdzKCRzLCBEcywgUnMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEpzKCkgewogICAgICAgIEdzLnBvaW50ID0gVnM7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdGwoKSB7CiAgICAgICAgR3MucG9pbnQgPSBlbDsKICAgICAgfQogICAgICBmdW5jdGlvbiBubCgpIHsKICAgICAgICBybChQcywgenMpLCBHcy5wb2ludCA9IFZzOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGVsKHQyLCBuMikgewogICAgICAgIFBzID0gdDIsIHpzID0gbjIsIHQyICo9IG1mLCBuMiAqPSBtZiwgR3MucG9pbnQgPSBybDsKICAgICAgICB2YXIgZTIgPSBUZihuMik7CiAgICAgICAgJHMgPSBlMiAqIFRmKHQyKSwgRHMgPSBlMiAqIENmKHQyKSwgUnMgPSBDZihuMiksIFdzKCRzLCBEcywgUnMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHJsKHQyLCBuMikgewogICAgICAgIHQyICo9IG1mOwogICAgICAgIHZhciBlMiA9IFRmKG4yICo9IG1mKSwgcjIgPSBlMiAqIFRmKHQyKSwgaTIgPSBlMiAqIENmKHQyKSwgbzIgPSBDZihuMiksIGEyID0gRHMgKiBvMiAtIFJzICogaTIsIHUyID0gUnMgKiByMiAtICRzICogbzIsIGMyID0gJHMgKiBpMiAtIERzICogcjIsIGYyID0gRWYoYTIsIHUyLCBjMiksIHMyID0gUmYoZjIpLCBsMiA9IGYyICYmIC1zMiAvIGYyOwogICAgICAgIE5zLmFkZChsMiAqIGEyKSwga3MuYWRkKGwyICogdTIpLCBDcy5hZGQobDIgKiBjMiksIHhzICs9IHMyLCBBcyArPSBzMiAqICgkcyArICgkcyA9IHIyKSksIFNzICs9IHMyICogKERzICsgKERzID0gaTIpKSwgRXMgKz0gczIgKiAoUnMgKyAoUnMgPSBvMikpLCBXcygkcywgRHMsIFJzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBpbCh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG9sKHQyLCBuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKGUzLCByMikgewogICAgICAgICAgcmV0dXJuIGUzID0gdDIoZTMsIHIyKSwgbjIoZTNbMF0sIGUzWzFdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHQyLmludmVydCAmJiBuMi5pbnZlcnQgJiYgKGUyLmludmVydCA9IGZ1bmN0aW9uKGUzLCByMikgewogICAgICAgICAgcmV0dXJuIChlMyA9IG4yLmludmVydChlMywgcjIpKSAmJiB0Mi5pbnZlcnQoZTNbMF0sIGUzWzFdKTsKICAgICAgICB9KSwgZTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYWwodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHhmKHQyKSA+IGdmICYmICh0MiAtPSBNYXRoLnJvdW5kKHQyIC8gX2YpICogX2YpLCBbdDIsIG4yXTsKICAgICAgfQogICAgICBmdW5jdGlvbiB1bCh0MiwgbjIsIGUyKSB7CiAgICAgICAgcmV0dXJuICh0MiAlPSBfZikgPyBuMiB8fCBlMiA/IG9sKGZsKHQyKSwgc2wobjIsIGUyKSkgOiBmbCh0MikgOiBuMiB8fCBlMiA/IHNsKG4yLCBlMikgOiBhbDsKICAgICAgfQogICAgICBmdW5jdGlvbiBjbCh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihuMiwgZTIpIHsKICAgICAgICAgIHJldHVybiB4ZihuMiArPSB0MikgPiBnZiAmJiAobjIgLT0gTWF0aC5yb3VuZChuMiAvIF9mKSAqIF9mKSwgW24yLCBlMl07CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBmbCh0MikgewogICAgICAgIHZhciBuMiA9IGNsKHQyKTsKICAgICAgICByZXR1cm4gbjIuaW52ZXJ0ID0gY2woLXQyKSwgbjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc2wodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gVGYodDIpLCByMiA9IENmKHQyKSwgaTIgPSBUZihuMiksIG8yID0gQ2YobjIpOwogICAgICAgIGZ1bmN0aW9uIGEyKHQzLCBuMykgewogICAgICAgICAgdmFyIGEzID0gVGYobjMpLCB1MiA9IFRmKHQzKSAqIGEzLCBjMiA9IENmKHQzKSAqIGEzLCBmMiA9IENmKG4zKSwgczIgPSBmMiAqIGUyICsgdTIgKiByMjsKICAgICAgICAgIHJldHVybiBbTWYoYzIgKiBpMiAtIHMyICogbzIsIHUyICogZTIgLSBmMiAqIHIyKSwgUmYoczIgKiBpMiArIGMyICogbzIpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEyLmludmVydCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgdmFyIGEzID0gVGYobjMpLCB1MiA9IFRmKHQzKSAqIGEzLCBjMiA9IENmKHQzKSAqIGEzLCBmMiA9IENmKG4zKSwgczIgPSBmMiAqIGkyIC0gYzIgKiBvMjsKICAgICAgICAgIHJldHVybiBbTWYoYzIgKiBpMiArIGYyICogbzIsIHUyICogZTIgKyBzMiAqIHIyKSwgUmYoczIgKiBlMiAtIHUyICogcjIpXTsKICAgICAgICB9LCBhMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBsbCh0MikgewogICAgICAgIGZ1bmN0aW9uIG4yKG4zKSB7CiAgICAgICAgICByZXR1cm4gKG4zID0gdDIobjNbMF0gKiBtZiwgbjNbMV0gKiBtZikpWzBdICo9IGJmLCBuM1sxXSAqPSBiZiwgbjM7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0MiA9IHVsKHQyWzBdICogbWYsIHQyWzFdICogbWYsIHQyLmxlbmd0aCA+IDIgPyB0MlsyXSAqIG1mIDogMCksIG4yLmludmVydCA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gKG4zID0gdDIuaW52ZXJ0KG4zWzBdICogbWYsIG4zWzFdICogbWYpKVswXSAqPSBiZiwgbjNbMV0gKj0gYmYsIG4zOwogICAgICAgIH0sIG4yOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGhsKHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIpIHsKICAgICAgICBpZiAoZTIpIHsKICAgICAgICAgIHZhciBhMiA9IFRmKG4yKSwgdTIgPSBDZihuMiksIGMyID0gcjIgKiBlMjsKICAgICAgICAgIG51bGwgPT0gaTIgPyAoaTIgPSBuMiArIHIyICogX2YsIG8yID0gbjIgLSBjMiAvIDIpIDogKGkyID0gZGwoYTIsIGkyKSwgbzIgPSBkbChhMiwgbzIpLCAocjIgPiAwID8gaTIgPCBvMiA6IGkyID4gbzIpICYmIChpMiArPSByMiAqIF9mKSk7CiAgICAgICAgICBmb3IgKHZhciBmMiwgczIgPSBpMjsgcjIgPiAwID8gczIgPiBvMiA6IHMyIDwgbzI7IHMyIC09IGMyKQogICAgICAgICAgICBmMiA9IGRzKFthMiwgLXUyICogVGYoczIpLCAtdTIgKiBDZihzMildKSwgdDIucG9pbnQoZjJbMF0sIGYyWzFdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZGwodDIsIG4yKSB7CiAgICAgICAgKG4yID0gcHMobjIpKVswXSAtPSB0MiwgYnMobjIpOwogICAgICAgIHZhciBlMiA9IERmKC1uMlsxXSk7CiAgICAgICAgcmV0dXJuICgoLW4yWzJdIDwgMCA/IC1lMiA6IGUyKSArIF9mIC0gZGYpICUgX2Y7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcGwoKSB7CiAgICAgICAgdmFyIHQyLCBuMiA9IFtdOwogICAgICAgIHJldHVybiB7IHBvaW50OiBmdW5jdGlvbihuMywgZTIsIHIyKSB7CiAgICAgICAgICB0Mi5wdXNoKFtuMywgZTIsIHIyXSk7CiAgICAgICAgfSwgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIG4yLnB1c2godDIgPSBbXSk7CiAgICAgICAgfSwgbGluZUVuZDogcWYsIHJlam9pbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICBuMi5sZW5ndGggPiAxICYmIG4yLnB1c2gobjIucG9wKCkuY29uY2F0KG4yLnNoaWZ0KCkpKTsKICAgICAgICB9LCByZXN1bHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGUyID0gbjI7CiAgICAgICAgICByZXR1cm4gbjIgPSBbXSwgdDIgPSBudWxsLCBlMjsKICAgICAgICB9IH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZ2wodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHhmKHQyWzBdIC0gbjJbMF0pIDwgZGYgJiYgeGYodDJbMV0gLSBuMlsxXSkgPCBkZjsKICAgICAgfQogICAgICBmdW5jdGlvbiB5bCh0MiwgbjIsIGUyLCByMikgewogICAgICAgIHRoaXMueCA9IHQyLCB0aGlzLnogPSBuMiwgdGhpcy5vID0gZTIsIHRoaXMuZSA9IHIyLCB0aGlzLnYgPSBmYWxzZSwgdGhpcy5uID0gdGhpcy5wID0gbnVsbDsKICAgICAgfQogICAgICBmdW5jdGlvbiB2bCh0MiwgbjIsIGUyLCByMiwgaTIpIHsKICAgICAgICB2YXIgbzIsIGEyLCB1MiA9IFtdLCBjMiA9IFtdOwogICAgICAgIGlmICh0Mi5mb3JFYWNoKGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICBpZiAoISgobjMgPSB0My5sZW5ndGggLSAxKSA8PSAwKSkgewogICAgICAgICAgICB2YXIgbjMsIGUzLCByMyA9IHQzWzBdLCBhMyA9IHQzW24zXTsKICAgICAgICAgICAgaWYgKGdsKHIzLCBhMykpIHsKICAgICAgICAgICAgICBpZiAoIXIzWzJdICYmICFhM1syXSkgewogICAgICAgICAgICAgICAgZm9yIChpMi5saW5lU3RhcnQoKSwgbzIgPSAwOyBvMiA8IG4zOyArK28yKQogICAgICAgICAgICAgICAgICBpMi5wb2ludCgocjMgPSB0M1tvMl0pWzBdLCByM1sxXSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCBpMi5saW5lRW5kKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGEzWzBdICs9IDIgKiBkZjsKICAgICAgICAgICAgfQogICAgICAgICAgICB1Mi5wdXNoKGUzID0gbmV3IHlsKHIzLCB0MywgbnVsbCwgdHJ1ZSkpLCBjMi5wdXNoKGUzLm8gPSBuZXcgeWwocjMsIG51bGwsIGUzLCBmYWxzZSkpLCB1Mi5wdXNoKGUzID0gbmV3IHlsKGEzLCB0MywgbnVsbCwgZmFsc2UpKSwgYzIucHVzaChlMy5vID0gbmV3IHlsKGEzLCBudWxsLCBlMywgdHJ1ZSkpOwogICAgICAgICAgfQogICAgICAgIH0pLCB1Mi5sZW5ndGgpIHsKICAgICAgICAgIGZvciAoYzIuc29ydChuMiksIF9sKHUyKSwgX2woYzIpLCBvMiA9IDAsIGEyID0gYzIubGVuZ3RoOyBvMiA8IGEyOyArK28yKQogICAgICAgICAgICBjMltvMl0uZSA9IGUyID0gIWUyOwogICAgICAgICAgZm9yICh2YXIgZjIsIHMyLCBsMiA9IHUyWzBdOyA7ICkgewogICAgICAgICAgICBmb3IgKHZhciBoMiA9IGwyLCBkMiA9IHRydWU7IGgyLnY7ICkKICAgICAgICAgICAgICBpZiAoKGgyID0gaDIubikgPT09IGwyKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBmMiA9IGgyLnosIGkyLmxpbmVTdGFydCgpOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKGgyLnYgPSBoMi5vLnYgPSB0cnVlLCBoMi5lKSB7CiAgICAgICAgICAgICAgICBpZiAoZDIpCiAgICAgICAgICAgICAgICAgIGZvciAobzIgPSAwLCBhMiA9IGYyLmxlbmd0aDsgbzIgPCBhMjsgKytvMikKICAgICAgICAgICAgICAgICAgICBpMi5wb2ludCgoczIgPSBmMltvMl0pWzBdLCBzMlsxXSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgIHIyKGgyLngsIGgyLm4ueCwgMSwgaTIpOwogICAgICAgICAgICAgICAgaDIgPSBoMi5uOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoZDIpCiAgICAgICAgICAgICAgICAgIGZvciAoZjIgPSBoMi5wLnosIG8yID0gZjIubGVuZ3RoIC0gMTsgbzIgPj0gMDsgLS1vMikKICAgICAgICAgICAgICAgICAgICBpMi5wb2ludCgoczIgPSBmMltvMl0pWzBdLCBzMlsxXSk7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgIHIyKGgyLngsIGgyLnAueCwgLTEsIGkyKTsKICAgICAgICAgICAgICAgIGgyID0gaDIucDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZjIgPSAoaDIgPSBoMi5vKS56LCBkMiA9ICFkMjsKICAgICAgICAgICAgfSB3aGlsZSAoIWgyLnYpOwogICAgICAgICAgICBpMi5saW5lRW5kKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9sKHQyKSB7CiAgICAgICAgaWYgKG4yID0gdDIubGVuZ3RoKSB7CiAgICAgICAgICBmb3IgKHZhciBuMiwgZTIsIHIyID0gMCwgaTIgPSB0MlswXTsgKytyMiA8IG4yOyApCiAgICAgICAgICAgIGkyLm4gPSBlMiA9IHQyW3IyXSwgZTIucCA9IGkyLCBpMiA9IGUyOwogICAgICAgICAgaTIubiA9IGUyID0gdDJbMF0sIGUyLnAgPSBpMjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYmwodDIpIHsKICAgICAgICByZXR1cm4geGYodDJbMF0pIDw9IGdmID8gdDJbMF0gOiBQZih0MlswXSkgKiAoKHhmKHQyWzBdKSArIGdmKSAlIF9mIC0gZ2YpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1sKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IGJsKG4yKSwgcjIgPSBuMlsxXSwgaTIgPSBDZihyMiksIG8yID0gW0NmKGUyKSwgLVRmKGUyKSwgMF0sIGEyID0gMCwgdTIgPSAwLCBjMiA9IG5ldyBUKCk7CiAgICAgICAgMSA9PT0gaTIgPyByMiA9IHlmICsgZGYgOiAtMSA9PT0gaTIgJiYgKHIyID0gLXlmIC0gZGYpOwogICAgICAgIGZvciAodmFyIGYyID0gMCwgczIgPSB0Mi5sZW5ndGg7IGYyIDwgczI7ICsrZjIpCiAgICAgICAgICBpZiAoaDIgPSAobDIgPSB0MltmMl0pLmxlbmd0aCkKICAgICAgICAgICAgZm9yICh2YXIgbDIsIGgyLCBkMiA9IGwyW2gyIC0gMV0sIHAyID0gYmwoZDIpLCBnMiA9IGQyWzFdIC8gMiArIHZmLCB5MiA9IENmKGcyKSwgdjIgPSBUZihnMiksIF8yID0gMDsgXzIgPCBoMjsgKytfMiwgcDIgPSBtMiwgeTIgPSB3MiwgdjIgPSBNMiwgZDIgPSBiMikgewogICAgICAgICAgICAgIHZhciBiMiA9IGwyW18yXSwgbTIgPSBibChiMiksIHgyID0gYjJbMV0gLyAyICsgdmYsIHcyID0gQ2YoeDIpLCBNMiA9IFRmKHgyKSwgQTIgPSBtMiAtIHAyLCBTMiA9IEEyID49IDAgPyAxIDogLTEsIEUyID0gUzIgKiBBMiwgTjIgPSBFMiA+IGdmLCBrMiA9IHkyICogdzI7CiAgICAgICAgICAgICAgaWYgKGMyLmFkZChNZihrMiAqIFMyICogQ2YoRTIpLCB2MiAqIE0yICsgazIgKiBUZihFMikpKSwgYTIgKz0gTjIgPyBBMiArIFMyICogX2YgOiBBMiwgTjIgXiBwMiA+PSBlMiBeIG0yID49IGUyKSB7CiAgICAgICAgICAgICAgICB2YXIgQzIgPSB5cyhwcyhkMiksIHBzKGIyKSk7CiAgICAgICAgICAgICAgICBicyhDMik7CiAgICAgICAgICAgICAgICB2YXIgUDIgPSB5cyhvMiwgQzIpOwogICAgICAgICAgICAgICAgYnMoUDIpOwogICAgICAgICAgICAgICAgdmFyIHoyID0gKE4yIF4gQTIgPj0gMCA/IC0xIDogMSkgKiBSZihQMlsyXSk7CiAgICAgICAgICAgICAgICAocjIgPiB6MiB8fCByMiA9PT0gejIgJiYgKEMyWzBdIHx8IEMyWzFdKSkgJiYgKHUyICs9IE4yIF4gQTIgPj0gMCA/IDEgOiAtMSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIChhMiA8IC1kZiB8fCBhMiA8IGRmICYmIGMyIDwgLXBmKSBeIDEgJiB1MjsKICAgICAgfQogICAgICBmdW5jdGlvbiB4bCh0MiwgbjIsIGUyLCByMikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihpMikgewogICAgICAgICAgdmFyIG8yLCBhMiwgdTIsIGMyID0gbjIoaTIpLCBmMiA9IHBsKCksIHMyID0gbjIoZjIpLCBsMiA9IGZhbHNlLCBoMiA9IHsgcG9pbnQ6IGQyLCBsaW5lU3RhcnQ6IGcyLCBsaW5lRW5kOiB5MiwgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaDIucG9pbnQgPSB2MiwgaDIubGluZVN0YXJ0ID0gXzIsIGgyLmxpbmVFbmQgPSBiMiwgYTIgPSBbXSwgbzIgPSBbXTsKICAgICAgICAgIH0sIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBoMi5wb2ludCA9IGQyLCBoMi5saW5lU3RhcnQgPSBnMiwgaDIubGluZUVuZCA9IHkyLCBhMiA9IGZ0KGEyKTsKICAgICAgICAgICAgdmFyIHQzID0gbWwobzIsIHIyKTsKICAgICAgICAgICAgYTIubGVuZ3RoID8gKGwyIHx8IChpMi5wb2x5Z29uU3RhcnQoKSwgbDIgPSB0cnVlKSwgdmwoYTIsIE1sLCB0MywgZTIsIGkyKSkgOiB0MyAmJiAobDIgfHwgKGkyLnBvbHlnb25TdGFydCgpLCBsMiA9IHRydWUpLCBpMi5saW5lU3RhcnQoKSwgZTIobnVsbCwgbnVsbCwgMSwgaTIpLCBpMi5saW5lRW5kKCkpLCBsMiAmJiAoaTIucG9seWdvbkVuZCgpLCBsMiA9IGZhbHNlKSwgYTIgPSBvMiA9IG51bGw7CiAgICAgICAgICB9LCBzcGhlcmU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpMi5wb2x5Z29uU3RhcnQoKSwgaTIubGluZVN0YXJ0KCksIGUyKG51bGwsIG51bGwsIDEsIGkyKSwgaTIubGluZUVuZCgpLCBpMi5wb2x5Z29uRW5kKCk7CiAgICAgICAgICB9IH07CiAgICAgICAgICBmdW5jdGlvbiBkMihuMywgZTMpIHsKICAgICAgICAgICAgdDIobjMsIGUzKSAmJiBpMi5wb2ludChuMywgZTMpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcDIodDMsIG4zKSB7CiAgICAgICAgICAgIGMyLnBvaW50KHQzLCBuMyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnMigpIHsKICAgICAgICAgICAgaDIucG9pbnQgPSBwMiwgYzIubGluZVN0YXJ0KCk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiB5MigpIHsKICAgICAgICAgICAgaDIucG9pbnQgPSBkMiwgYzIubGluZUVuZCgpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gdjIodDMsIG4zKSB7CiAgICAgICAgICAgIHUyLnB1c2goW3QzLCBuM10pLCBzMi5wb2ludCh0MywgbjMpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gXzIoKSB7CiAgICAgICAgICAgIHMyLmxpbmVTdGFydCgpLCB1MiA9IFtdOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gYjIoKSB7CiAgICAgICAgICAgIHYyKHUyWzBdWzBdLCB1MlswXVsxXSksIHMyLmxpbmVFbmQoKTsKICAgICAgICAgICAgdmFyIHQzLCBuMywgZTMsIHIzLCBjMyA9IHMyLmNsZWFuKCksIGgzID0gZjIucmVzdWx0KCksIGQ0ID0gaDMubGVuZ3RoOwogICAgICAgICAgICBpZiAodTIucG9wKCksIG8yLnB1c2godTIpLCB1MiA9IG51bGwsIGQ0KQogICAgICAgICAgICAgIGlmICgxICYgYzMpIHsKICAgICAgICAgICAgICAgIGlmICgobjMgPSAoZTMgPSBoM1swXSkubGVuZ3RoIC0gMSkgPiAwKSB7CiAgICAgICAgICAgICAgICAgIGZvciAobDIgfHwgKGkyLnBvbHlnb25TdGFydCgpLCBsMiA9IHRydWUpLCBpMi5saW5lU3RhcnQoKSwgdDMgPSAwOyB0MyA8IG4zOyArK3QzKQogICAgICAgICAgICAgICAgICAgIGkyLnBvaW50KChyMyA9IGUzW3QzXSlbMF0sIHIzWzFdKTsKICAgICAgICAgICAgICAgICAgaTIubGluZUVuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgZDQgPiAxICYmIDIgJiBjMyAmJiBoMy5wdXNoKGgzLnBvcCgpLmNvbmNhdChoMy5zaGlmdCgpKSksIGEyLnB1c2goaDMuZmlsdGVyKHdsKSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gaDI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiB3bCh0MikgewogICAgICAgIHJldHVybiB0Mi5sZW5ndGggPiAxOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE1sKHQyLCBuMikgewogICAgICAgIHJldHVybiAoKHQyID0gdDIueClbMF0gPCAwID8gdDJbMV0gLSB5ZiAtIGRmIDogeWYgLSB0MlsxXSkgLSAoKG4yID0gbjIueClbMF0gPCAwID8gbjJbMV0gLSB5ZiAtIGRmIDogeWYgLSBuMlsxXSk7CiAgICAgIH0KICAgICAgYWwuaW52ZXJ0ID0gYWw7CiAgICAgIHZhciBUbCA9IHhsKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9LCBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiwgZTIgPSBOYU4sIHIyID0gTmFOLCBpMiA9IE5hTjsKICAgICAgICByZXR1cm4geyBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgdDIubGluZVN0YXJ0KCksIG4yID0gMTsKICAgICAgICB9LCBwb2ludDogZnVuY3Rpb24obzIsIGEyKSB7CiAgICAgICAgICB2YXIgdTIgPSBvMiA+IDAgPyBnZiA6IC1nZiwgYzIgPSB4ZihvMiAtIGUyKTsKICAgICAgICAgIHhmKGMyIC0gZ2YpIDwgZGYgPyAodDIucG9pbnQoZTIsIHIyID0gKHIyICsgYTIpIC8gMiA+IDAgPyB5ZiA6IC15ZiksIHQyLnBvaW50KGkyLCByMiksIHQyLmxpbmVFbmQoKSwgdDIubGluZVN0YXJ0KCksIHQyLnBvaW50KHUyLCByMiksIHQyLnBvaW50KG8yLCByMiksIG4yID0gMCkgOiBpMiAhPT0gdTIgJiYgYzIgPj0gZ2YgJiYgKHhmKGUyIC0gaTIpIDwgZGYgJiYgKGUyIC09IGkyICogZGYpLCB4ZihvMiAtIHUyKSA8IGRmICYmIChvMiAtPSB1MiAqIGRmKSwgcjIgPSBmdW5jdGlvbih0MywgbjMsIGUzLCByMykgewogICAgICAgICAgICB2YXIgaTMsIG8zLCBhMyA9IENmKHQzIC0gZTMpOwogICAgICAgICAgICByZXR1cm4geGYoYTMpID4gZGYgPyB3ZigoQ2YobjMpICogKG8zID0gVGYocjMpKSAqIENmKGUzKSAtIENmKHIzKSAqIChpMyA9IFRmKG4zKSkgKiBDZih0MykpIC8gKGkzICogbzMgKiBhMykpIDogKG4zICsgcjMpIC8gMjsKICAgICAgICAgIH0oZTIsIHIyLCBvMiwgYTIpLCB0Mi5wb2ludChpMiwgcjIpLCB0Mi5saW5lRW5kKCksIHQyLmxpbmVTdGFydCgpLCB0Mi5wb2ludCh1MiwgcjIpLCBuMiA9IDApLCB0Mi5wb2ludChlMiA9IG8yLCByMiA9IGEyKSwgaTIgPSB1MjsKICAgICAgICB9LCBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHQyLmxpbmVFbmQoKSwgZTIgPSByMiA9IE5hTjsKICAgICAgICB9LCBjbGVhbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMiAtIG4yOwogICAgICAgIH0gfTsKICAgICAgfSwgZnVuY3Rpb24odDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICB2YXIgaTI7CiAgICAgICAgaWYgKG51bGwgPT0gdDIpCiAgICAgICAgICBpMiA9IGUyICogeWYsIHIyLnBvaW50KC1nZiwgaTIpLCByMi5wb2ludCgwLCBpMiksIHIyLnBvaW50KGdmLCBpMiksIHIyLnBvaW50KGdmLCAwKSwgcjIucG9pbnQoZ2YsIC1pMiksIHIyLnBvaW50KDAsIC1pMiksIHIyLnBvaW50KC1nZiwgLWkyKSwgcjIucG9pbnQoLWdmLCAwKSwgcjIucG9pbnQoLWdmLCBpMik7CiAgICAgICAgZWxzZSBpZiAoeGYodDJbMF0gLSBuMlswXSkgPiBkZikgewogICAgICAgICAgdmFyIG8yID0gdDJbMF0gPCBuMlswXSA/IGdmIDogLWdmOwogICAgICAgICAgaTIgPSBlMiAqIG8yIC8gMiwgcjIucG9pbnQoLW8yLCBpMiksIHIyLnBvaW50KDAsIGkyKSwgcjIucG9pbnQobzIsIGkyKTsKICAgICAgICB9IGVsc2UKICAgICAgICAgIHIyLnBvaW50KG4yWzBdLCBuMlsxXSk7CiAgICAgIH0sIFstZ2YsIC15Zl0pOwogICAgICBmdW5jdGlvbiBBbCh0MikgewogICAgICAgIHZhciBuMiA9IFRmKHQyKSwgZTIgPSA2ICogbWYsIHIyID0gbjIgPiAwLCBpMiA9IHhmKG4yKSA+IGRmOwogICAgICAgIGZ1bmN0aW9uIG8yKHQzLCBlMykgewogICAgICAgICAgcmV0dXJuIFRmKHQzKSAqIFRmKGUzKSA+IG4yOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhMih0MywgZTMsIHIzKSB7CiAgICAgICAgICB2YXIgaTMgPSBbMSwgMCwgMF0sIG8zID0geXMocHModDMpLCBwcyhlMykpLCBhMyA9IGdzKG8zLCBvMyksIHUzID0gbzNbMF0sIGMyID0gYTMgLSB1MyAqIHUzOwogICAgICAgICAgaWYgKCFjMikKICAgICAgICAgICAgcmV0dXJuICFyMyAmJiB0MzsKICAgICAgICAgIHZhciBmMiA9IG4yICogYTMgLyBjMiwgczIgPSAtbjIgKiB1MyAvIGMyLCBsMiA9IHlzKGkzLCBvMyksIGgyID0gX3MoaTMsIGYyKTsKICAgICAgICAgIHZzKGgyLCBfcyhvMywgczIpKTsKICAgICAgICAgIHZhciBkMiA9IGwyLCBwMiA9IGdzKGgyLCBkMiksIGcyID0gZ3MoZDIsIGQyKSwgeTIgPSBwMiAqIHAyIC0gZzIgKiAoZ3MoaDIsIGgyKSAtIDEpOwogICAgICAgICAgaWYgKCEoeTIgPCAwKSkgewogICAgICAgICAgICB2YXIgdjIgPSB6Zih5MiksIF8yID0gX3MoZDIsICgtcDIgLSB2MikgLyBnMik7CiAgICAgICAgICAgIGlmICh2cyhfMiwgaDIpLCBfMiA9IGRzKF8yKSwgIXIzKQogICAgICAgICAgICAgIHJldHVybiBfMjsKICAgICAgICAgICAgdmFyIGIyLCBtMiA9IHQzWzBdLCB4MiA9IGUzWzBdLCB3MiA9IHQzWzFdLCBNMiA9IGUzWzFdOwogICAgICAgICAgICB4MiA8IG0yICYmIChiMiA9IG0yLCBtMiA9IHgyLCB4MiA9IGIyKTsKICAgICAgICAgICAgdmFyIFQyID0geDIgLSBtMiwgQTIgPSB4ZihUMiAtIGdmKSA8IGRmOwogICAgICAgICAgICBpZiAoIUEyICYmIE0yIDwgdzIgJiYgKGIyID0gdzIsIHcyID0gTTIsIE0yID0gYjIpLCBBMiB8fCBUMiA8IGRmID8gQTIgPyB3MiArIE0yID4gMCBeIF8yWzFdIDwgKHhmKF8yWzBdIC0gbTIpIDwgZGYgPyB3MiA6IE0yKSA6IHcyIDw9IF8yWzFdICYmIF8yWzFdIDw9IE0yIDogVDIgPiBnZiBeIChtMiA8PSBfMlswXSAmJiBfMlswXSA8PSB4MikpIHsKICAgICAgICAgICAgICB2YXIgUzIgPSBfcyhkMiwgKC1wMiArIHYyKSAvIGcyKTsKICAgICAgICAgICAgICByZXR1cm4gdnMoUzIsIGgyKSwgW18yLCBkcyhTMildOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHUyKG4zLCBlMykgewogICAgICAgICAgdmFyIGkzID0gcjIgPyB0MiA6IGdmIC0gdDIsIG8zID0gMDsKICAgICAgICAgIHJldHVybiBuMyA8IC1pMyA/IG8zIHw9IDEgOiBuMyA+IGkzICYmIChvMyB8PSAyKSwgZTMgPCAtaTMgPyBvMyB8PSA0IDogZTMgPiBpMyAmJiAobzMgfD0gOCksIG8zOwogICAgICAgIH0KICAgICAgICByZXR1cm4geGwobzIsIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICB2YXIgbjMsIGUzLCBjMiwgZjIsIHMyOwogICAgICAgICAgcmV0dXJuIHsgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZjIgPSBjMiA9IGZhbHNlLCBzMiA9IDE7CiAgICAgICAgICB9LCBwb2ludDogZnVuY3Rpb24obDIsIGgyKSB7CiAgICAgICAgICAgIHZhciBkMiwgcDIgPSBbbDIsIGgyXSwgZzIgPSBvMihsMiwgaDIpLCB5MiA9IHIyID8gZzIgPyAwIDogdTIobDIsIGgyKSA6IGcyID8gdTIobDIgKyAobDIgPCAwID8gZ2YgOiAtZ2YpLCBoMikgOiAwOwogICAgICAgICAgICBpZiAoIW4zICYmIChmMiA9IGMyID0gZzIpICYmIHQzLmxpbmVTdGFydCgpLCBnMiAhPT0gYzIgJiYgKCEoZDIgPSBhMihuMywgcDIpKSB8fCBnbChuMywgZDIpIHx8IGdsKHAyLCBkMikpICYmIChwMlsyXSA9IDEpLCBnMiAhPT0gYzIpCiAgICAgICAgICAgICAgczIgPSAwLCBnMiA/ICh0My5saW5lU3RhcnQoKSwgZDIgPSBhMihwMiwgbjMpLCB0My5wb2ludChkMlswXSwgZDJbMV0pKSA6IChkMiA9IGEyKG4zLCBwMiksIHQzLnBvaW50KGQyWzBdLCBkMlsxXSwgMiksIHQzLmxpbmVFbmQoKSksIG4zID0gZDI7CiAgICAgICAgICAgIGVsc2UgaWYgKGkyICYmIG4zICYmIHIyIF4gZzIpIHsKICAgICAgICAgICAgICB2YXIgdjI7CiAgICAgICAgICAgICAgeTIgJiBlMyB8fCAhKHYyID0gYTIocDIsIG4zLCB0cnVlKSkgfHwgKHMyID0gMCwgcjIgPyAodDMubGluZVN0YXJ0KCksIHQzLnBvaW50KHYyWzBdWzBdLCB2MlswXVsxXSksIHQzLnBvaW50KHYyWzFdWzBdLCB2MlsxXVsxXSksIHQzLmxpbmVFbmQoKSkgOiAodDMucG9pbnQodjJbMV1bMF0sIHYyWzFdWzFdKSwgdDMubGluZUVuZCgpLCB0My5saW5lU3RhcnQoKSwgdDMucG9pbnQodjJbMF1bMF0sIHYyWzBdWzFdLCAzKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICFnMiB8fCBuMyAmJiBnbChuMywgcDIpIHx8IHQzLnBvaW50KHAyWzBdLCBwMlsxXSksIG4zID0gcDIsIGMyID0gZzIsIGUzID0geTI7CiAgICAgICAgICB9LCBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgYzIgJiYgdDMubGluZUVuZCgpLCBuMyA9IG51bGw7CiAgICAgICAgICB9LCBjbGVhbjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBzMiB8IChmMiAmJiBjMikgPDwgMTsKICAgICAgICAgIH0gfTsKICAgICAgICB9LCBmdW5jdGlvbihuMywgcjMsIGkzLCBvMykgewogICAgICAgICAgaGwobzMsIHQyLCBlMiwgaTMsIG4zLCByMyk7CiAgICAgICAgfSwgcjIgPyBbMCwgLXQyXSA6IFstZ2YsIHQyIC0gZ2ZdKTsKICAgICAgfQogICAgICB2YXIgU2wsIEVsLCBObCwga2wsIENsID0gMWU5LCBQbCA9IC1DbDsKICAgICAgZnVuY3Rpb24gemwodDIsIG4yLCBlMiwgcjIpIHsKICAgICAgICBmdW5jdGlvbiBpMihpMywgbzMpIHsKICAgICAgICAgIHJldHVybiB0MiA8PSBpMyAmJiBpMyA8PSBlMiAmJiBuMiA8PSBvMyAmJiBvMyA8PSByMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbzIoaTMsIG8zLCB1MywgZjIpIHsKICAgICAgICAgIHZhciBzMiA9IDAsIGwyID0gMDsKICAgICAgICAgIGlmIChudWxsID09IGkzIHx8IChzMiA9IGEyKGkzLCB1MykpICE9PSAobDIgPSBhMihvMywgdTMpKSB8fCBjMihpMywgbzMpIDwgMCBeIHUzID4gMCkKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGYyLnBvaW50KDAgPT09IHMyIHx8IDMgPT09IHMyID8gdDIgOiBlMiwgczIgPiAxID8gcjIgOiBuMik7CiAgICAgICAgICAgIH0gd2hpbGUgKChzMiA9IChzMiArIHUzICsgNCkgJSA0KSAhPT0gbDIpOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBmMi5wb2ludChvM1swXSwgbzNbMV0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhMihyMywgaTMpIHsKICAgICAgICAgIHJldHVybiB4ZihyM1swXSAtIHQyKSA8IGRmID8gaTMgPiAwID8gMCA6IDMgOiB4ZihyM1swXSAtIGUyKSA8IGRmID8gaTMgPiAwID8gMiA6IDEgOiB4ZihyM1sxXSAtIG4yKSA8IGRmID8gaTMgPiAwID8gMSA6IDAgOiBpMyA+IDAgPyAzIDogMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdTIodDMsIG4zKSB7CiAgICAgICAgICByZXR1cm4gYzIodDMueCwgbjMueCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGMyKHQzLCBuMykgewogICAgICAgICAgdmFyIGUzID0gYTIodDMsIDEpLCByMyA9IGEyKG4zLCAxKTsKICAgICAgICAgIHJldHVybiBlMyAhPT0gcjMgPyBlMyAtIHIzIDogMCA9PT0gZTMgPyBuM1sxXSAtIHQzWzFdIDogMSA9PT0gZTMgPyB0M1swXSAtIG4zWzBdIDogMiA9PT0gZTMgPyB0M1sxXSAtIG4zWzFdIDogbjNbMF0gLSB0M1swXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGEzKSB7CiAgICAgICAgICB2YXIgYzMsIGYyLCBzMiwgbDIsIGgyLCBkMiwgcDIsIGcyLCB5MiwgdjIsIF8yLCBiMiA9IGEzLCBtMiA9IHBsKCksIHgyID0geyBwb2ludDogdzIsIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHgyLnBvaW50ID0gTTIsIGYyICYmIGYyLnB1c2goczIgPSBbXSk7CiAgICAgICAgICAgIHYyID0gdHJ1ZSwgeTIgPSBmYWxzZSwgcDIgPSBnMiA9IE5hTjsKICAgICAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjMyAmJiAoTTIobDIsIGgyKSwgZDIgJiYgeTIgJiYgbTIucmVqb2luKCksIGMzLnB1c2gobTIucmVzdWx0KCkpKTsKICAgICAgICAgICAgeDIucG9pbnQgPSB3MiwgeTIgJiYgYjIubGluZUVuZCgpOwogICAgICAgICAgfSwgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgYjIgPSBtMiwgYzMgPSBbXSwgZjIgPSBbXSwgXzIgPSB0cnVlOwogICAgICAgICAgfSwgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBuMyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGZvciAodmFyIG40ID0gMCwgZTQgPSAwLCBpNCA9IGYyLmxlbmd0aDsgZTQgPCBpNDsgKytlNCkKICAgICAgICAgICAgICAgIGZvciAodmFyIG8zLCBhNCwgdTMgPSBmMltlNF0sIGM0ID0gMSwgczMgPSB1My5sZW5ndGgsIGwzID0gdTNbMF0sIGgzID0gbDNbMF0sIGQ0ID0gbDNbMV07IGM0IDwgczM7ICsrYzQpCiAgICAgICAgICAgICAgICAgIG8zID0gaDMsIGE0ID0gZDQsIGgzID0gKGwzID0gdTNbYzRdKVswXSwgZDQgPSBsM1sxXSwgYTQgPD0gcjIgPyBkNCA+IHIyICYmIChoMyAtIG8zKSAqIChyMiAtIGE0KSA+IChkNCAtIGE0KSAqICh0MiAtIG8zKSAmJiArK240IDogZDQgPD0gcjIgJiYgKGgzIC0gbzMpICogKHIyIC0gYTQpIDwgKGQ0IC0gYTQpICogKHQyIC0gbzMpICYmIC0tbjQ7CiAgICAgICAgICAgICAgcmV0dXJuIG40OwogICAgICAgICAgICB9KCksIGUzID0gXzIgJiYgbjMsIGkzID0gKGMzID0gZnQoYzMpKS5sZW5ndGg7CiAgICAgICAgICAgIChlMyB8fCBpMykgJiYgKGEzLnBvbHlnb25TdGFydCgpLCBlMyAmJiAoYTMubGluZVN0YXJ0KCksIG8yKG51bGwsIG51bGwsIDEsIGEzKSwgYTMubGluZUVuZCgpKSwgaTMgJiYgdmwoYzMsIHUyLCBuMywgbzIsIGEzKSwgYTMucG9seWdvbkVuZCgpKTsKICAgICAgICAgICAgYjIgPSBhMywgYzMgPSBmMiA9IHMyID0gbnVsbDsKICAgICAgICAgIH0gfTsKICAgICAgICAgIGZ1bmN0aW9uIHcyKHQzLCBuMykgewogICAgICAgICAgICBpMih0MywgbjMpICYmIGIyLnBvaW50KHQzLCBuMyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBNMihvMywgYTQpIHsKICAgICAgICAgICAgdmFyIHUzID0gaTIobzMsIGE0KTsKICAgICAgICAgICAgaWYgKGYyICYmIHMyLnB1c2goW28zLCBhNF0pLCB2MikKICAgICAgICAgICAgICBsMiA9IG8zLCBoMiA9IGE0LCBkMiA9IHUzLCB2MiA9IGZhbHNlLCB1MyAmJiAoYjIubGluZVN0YXJ0KCksIGIyLnBvaW50KG8zLCBhNCkpOwogICAgICAgICAgICBlbHNlIGlmICh1MyAmJiB5MikKICAgICAgICAgICAgICBiMi5wb2ludChvMywgYTQpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICB2YXIgYzQgPSBbcDIgPSBNYXRoLm1heChQbCwgTWF0aC5taW4oQ2wsIHAyKSksIGcyID0gTWF0aC5tYXgoUGwsIE1hdGgubWluKENsLCBnMikpXSwgbTMgPSBbbzMgPSBNYXRoLm1heChQbCwgTWF0aC5taW4oQ2wsIG8zKSksIGE0ID0gTWF0aC5tYXgoUGwsIE1hdGgubWluKENsLCBhNCkpXTsKICAgICAgICAgICAgICAhZnVuY3Rpb24odDMsIG4zLCBlMywgcjMsIGkzLCBvNCkgewogICAgICAgICAgICAgICAgdmFyIGE1LCB1NCA9IHQzWzBdLCBjNSA9IHQzWzFdLCBmMyA9IDAsIHMzID0gMSwgbDMgPSBuM1swXSAtIHU0LCBoMyA9IG4zWzFdIC0gYzU7CiAgICAgICAgICAgICAgICBpZiAoYTUgPSBlMyAtIHU0LCBsMyB8fCAhKGE1ID4gMCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKGE1IC89IGwzLCBsMyA8IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYTUgPCBmMykKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBhNSA8IHMzICYmIChzMyA9IGE1KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChsMyA+IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYTUgPiBzMykKICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBhNSA+IGYzICYmIChmMyA9IGE1KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoYTUgPSBpMyAtIHU0LCBsMyB8fCAhKGE1IDwgMCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYTUgLz0gbDMsIGwzIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGE1ID4gczMpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgIGE1ID4gZjMgJiYgKGYzID0gYTUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobDMgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYTUgPCBmMykKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgYTUgPCBzMyAmJiAoczMgPSBhNSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChhNSA9IHIzIC0gYzUsIGgzIHx8ICEoYTUgPiAwKSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKGE1IC89IGgzLCBoMyA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGE1IDwgZjMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBhNSA8IHMzICYmIChzMyA9IGE1KTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaDMgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhNSA+IHMzKQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgYTUgPiBmMyAmJiAoZjMgPSBhNSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYTUgPSBvNCAtIGM1LCBoMyB8fCAhKGE1IDwgMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGE1IC89IGgzLCBoMyA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYTUgPiBzMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICBhNSA+IGYzICYmIChmMyA9IGE1KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoMyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYTUgPCBmMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICBhNSA8IHMzICYmIChzMyA9IGE1KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZjMgPiAwICYmICh0M1swXSA9IHU0ICsgZjMgKiBsMywgdDNbMV0gPSBjNSArIGYzICogaDMpLCBzMyA8IDEgJiYgKG4zWzBdID0gdTQgKyBzMyAqIGwzLCBuM1sxXSA9IGM1ICsgczMgKiBoMyksIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfShjNCwgbTMsIHQyLCBuMiwgZTIsIHIyKSA/IHUzICYmIChiMi5saW5lU3RhcnQoKSwgYjIucG9pbnQobzMsIGE0KSwgXzIgPSBmYWxzZSkgOiAoeTIgfHwgKGIyLmxpbmVTdGFydCgpLCBiMi5wb2ludChjNFswXSwgYzRbMV0pKSwgYjIucG9pbnQobTNbMF0sIG0zWzFdKSwgdTMgfHwgYjIubGluZUVuZCgpLCBfMiA9IGZhbHNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwMiA9IG8zLCBnMiA9IGE0LCB5MiA9IHUzOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHgyOwogICAgICAgIH07CiAgICAgIH0KICAgICAgdmFyICRsID0geyBzcGhlcmU6IHFmLCBwb2ludDogcWYsIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgJGwucG9pbnQgPSBSbCwgJGwubGluZUVuZCA9IERsOwogICAgICB9LCBsaW5lRW5kOiBxZiwgcG9seWdvblN0YXJ0OiBxZiwgcG9seWdvbkVuZDogcWYgfTsKICAgICAgZnVuY3Rpb24gRGwoKSB7CiAgICAgICAgJGwucG9pbnQgPSAkbC5saW5lRW5kID0gcWY7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmwodDIsIG4yKSB7CiAgICAgICAgRWwgPSB0MiAqPSBtZiwgTmwgPSBDZihuMiAqPSBtZiksIGtsID0gVGYobjIpLCAkbC5wb2ludCA9IEZsOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEZsKHQyLCBuMikgewogICAgICAgIHQyICo9IG1mOwogICAgICAgIHZhciBlMiA9IENmKG4yICo9IG1mKSwgcjIgPSBUZihuMiksIGkyID0geGYodDIgLSBFbCksIG8yID0gVGYoaTIpLCBhMiA9IHIyICogQ2YoaTIpLCB1MiA9IGtsICogZTIgLSBObCAqIHIyICogbzIsIGMyID0gTmwgKiBlMiArIGtsICogcjIgKiBvMjsKICAgICAgICBTbC5hZGQoTWYoemYoYTIgKiBhMiArIHUyICogdTIpLCBjMikpLCBFbCA9IHQyLCBObCA9IGUyLCBrbCA9IHIyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHFsKHQyKSB7CiAgICAgICAgcmV0dXJuIFNsID0gbmV3IFQoKSwgTGYodDIsICRsKSwgK1NsOwogICAgICB9CiAgICAgIHZhciBVbCA9IFtudWxsLCBudWxsXSwgSWwgPSB7IHR5cGU6ICJMaW5lU3RyaW5nIiwgY29vcmRpbmF0ZXM6IFVsIH07CiAgICAgIGZ1bmN0aW9uIE9sKHQyLCBuMikgewogICAgICAgIHJldHVybiBVbFswXSA9IHQyLCBVbFsxXSA9IG4yLCBxbChJbCk7CiAgICAgIH0KICAgICAgdmFyIEJsID0geyBGZWF0dXJlOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gTGwodDIuZ2VvbWV0cnksIG4yKTsKICAgICAgfSwgRmVhdHVyZUNvbGxlY3Rpb246IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGZvciAodmFyIGUyID0gdDIuZmVhdHVyZXMsIHIyID0gLTEsIGkyID0gZTIubGVuZ3RoOyArK3IyIDwgaTI7ICkKICAgICAgICAgIGlmIChMbChlMltyMl0uZ2VvbWV0cnksIG4yKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IH0sIFlsID0geyBTcGhlcmU6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9LCBQb2ludDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIGpsKHQyLmNvb3JkaW5hdGVzLCBuMik7CiAgICAgIH0sIE11bHRpUG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGZvciAodmFyIGUyID0gdDIuY29vcmRpbmF0ZXMsIHIyID0gLTEsIGkyID0gZTIubGVuZ3RoOyArK3IyIDwgaTI7ICkKICAgICAgICAgIGlmIChqbChlMltyMl0sIG4yKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9LCBMaW5lU3RyaW5nOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gSGwodDIuY29vcmRpbmF0ZXMsIG4yKTsKICAgICAgfSwgTXVsdGlMaW5lU3RyaW5nOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiA9IHQyLmNvb3JkaW5hdGVzLCByMiA9IC0xLCBpMiA9IGUyLmxlbmd0aDsgKytyMiA8IGkyOyApCiAgICAgICAgICBpZiAoSGwoZTJbcjJdLCBuMikpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwgUG9seWdvbjogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIFhsKHQyLmNvb3JkaW5hdGVzLCBuMik7CiAgICAgIH0sIE11bHRpUG9seWdvbjogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgZm9yICh2YXIgZTIgPSB0Mi5jb29yZGluYXRlcywgcjIgPSAtMSwgaTIgPSBlMi5sZW5ndGg7ICsrcjIgPCBpMjsgKQogICAgICAgICAgaWYgKFhsKGUyW3IyXSwgbjIpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sIEdlb21ldHJ5Q29sbGVjdGlvbjogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgZm9yICh2YXIgZTIgPSB0Mi5nZW9tZXRyaWVzLCByMiA9IC0xLCBpMiA9IGUyLmxlbmd0aDsgKytyMiA8IGkyOyApCiAgICAgICAgICBpZiAoTGwoZTJbcjJdLCBuMikpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSB9OwogICAgICBmdW5jdGlvbiBMbCh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gISghdDIgfHwgIVlsLmhhc093blByb3BlcnR5KHQyLnR5cGUpKSAmJiBZbFt0Mi50eXBlXSh0MiwgbjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGpsKHQyLCBuMikgewogICAgICAgIHJldHVybiAwID09PSBPbCh0MiwgbjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEhsKHQyLCBuMikgewogICAgICAgIGZvciAodmFyIGUyLCByMiwgaTIsIG8yID0gMCwgYTIgPSB0Mi5sZW5ndGg7IG8yIDwgYTI7IG8yKyspIHsKICAgICAgICAgIGlmICgwID09PSAocjIgPSBPbCh0MltvMl0sIG4yKSkpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgaWYgKG8yID4gMCAmJiAoaTIgPSBPbCh0MltvMl0sIHQyW28yIC0gMV0pKSA+IDAgJiYgZTIgPD0gaTIgJiYgcjIgPD0gaTIgJiYgKGUyICsgcjIgLSBpMikgKiAoMSAtIE1hdGgucG93KChlMiAtIHIyKSAvIGkyLCAyKSkgPCBwZiAqIGkyKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGUyID0gcjI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBmdW5jdGlvbiBYbCh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gISFtbCh0Mi5tYXAoR2wpLCBWbChuMikpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEdsKHQyKSB7CiAgICAgICAgcmV0dXJuICh0MiA9IHQyLm1hcChWbCkpLnBvcCgpLCB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBWbCh0MikgewogICAgICAgIHJldHVybiBbdDJbMF0gKiBtZiwgdDJbMV0gKiBtZl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gV2wodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGx0KHQyLCBuMiAtIGRmLCBlMikuY29uY2F0KG4yKTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiByMi5tYXAoZnVuY3Rpb24objMpIHsKICAgICAgICAgICAgcmV0dXJuIFt0MywgbjNdOwogICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBabCh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gbHQodDIsIG4yIC0gZGYsIGUyKS5jb25jYXQobjIpOwogICAgICAgIHJldHVybiBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIHIyLm1hcChmdW5jdGlvbihuMykgewogICAgICAgICAgICByZXR1cm4gW24zLCB0M107CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEtsKCkgewogICAgICAgIHZhciB0MiwgbjIsIGUyLCByMiwgaTIsIG8yLCBhMiwgdTIsIGMyLCBmMiwgczIsIGwyLCBoMiA9IDEwLCBkMiA9IGgyLCBwMiA9IDkwLCBnMiA9IDM2MCwgeTIgPSAyLjU7CiAgICAgICAgZnVuY3Rpb24gdjIoKSB7CiAgICAgICAgICByZXR1cm4geyB0eXBlOiAiTXVsdGlMaW5lU3RyaW5nIiwgY29vcmRpbmF0ZXM6IF8yKCkgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gXzIoKSB7CiAgICAgICAgICByZXR1cm4gbHQoQWYocjIgLyBwMikgKiBwMiwgZTIsIHAyKS5tYXAoczIpLmNvbmNhdChsdChBZih1MiAvIGcyKSAqIGcyLCBhMiwgZzIpLm1hcChsMikpLmNvbmNhdChsdChBZihuMiAvIGgyKSAqIGgyLCB0MiwgaDIpLmZpbHRlcihmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4geGYodDMgJSBwMikgPiBkZjsKICAgICAgICAgIH0pLm1hcChjMikpLmNvbmNhdChsdChBZihvMiAvIGQyKSAqIGQyLCBpMiwgZDIpLmZpbHRlcihmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4geGYodDMgJSBnMikgPiBkZjsKICAgICAgICAgIH0pLm1hcChmMikpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdjIubGluZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBfMigpLm1hcChmdW5jdGlvbih0MykgewogICAgICAgICAgICByZXR1cm4geyB0eXBlOiAiTGluZVN0cmluZyIsIGNvb3JkaW5hdGVzOiB0MyB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSwgdjIub3V0bGluZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHsgdHlwZTogIlBvbHlnb24iLCBjb29yZGluYXRlczogW3MyKHIyKS5jb25jYXQobDIoYTIpLnNsaWNlKDEpLCBzMihlMikucmV2ZXJzZSgpLnNsaWNlKDEpLCBsMih1MikucmV2ZXJzZSgpLnNsaWNlKDEpKV0gfTsKICAgICAgICB9LCB2Mi5leHRlbnQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyB2Mi5leHRlbnRNYWpvcih0MykuZXh0ZW50TWlub3IodDMpIDogdjIuZXh0ZW50TWlub3IoKTsKICAgICAgICB9LCB2Mi5leHRlbnRNYWpvciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyMiA9ICt0M1swXVswXSwgZTIgPSArdDNbMV1bMF0sIHUyID0gK3QzWzBdWzFdLCBhMiA9ICt0M1sxXVsxXSwgcjIgPiBlMiAmJiAodDMgPSByMiwgcjIgPSBlMiwgZTIgPSB0MyksIHUyID4gYTIgJiYgKHQzID0gdTIsIHUyID0gYTIsIGEyID0gdDMpLCB2Mi5wcmVjaXNpb24oeTIpKSA6IFtbcjIsIHUyXSwgW2UyLCBhMl1dOwogICAgICAgIH0sIHYyLmV4dGVudE1pbm9yID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gK2UzWzBdWzBdLCB0MiA9ICtlM1sxXVswXSwgbzIgPSArZTNbMF1bMV0sIGkyID0gK2UzWzFdWzFdLCBuMiA+IHQyICYmIChlMyA9IG4yLCBuMiA9IHQyLCB0MiA9IGUzKSwgbzIgPiBpMiAmJiAoZTMgPSBvMiwgbzIgPSBpMiwgaTIgPSBlMyksIHYyLnByZWNpc2lvbih5MikpIDogW1tuMiwgbzJdLCBbdDIsIGkyXV07CiAgICAgICAgfSwgdjIuc3RlcCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IHYyLnN0ZXBNYWpvcih0Mykuc3RlcE1pbm9yKHQzKSA6IHYyLnN0ZXBNaW5vcigpOwogICAgICAgIH0sIHYyLnN0ZXBNYWpvciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChwMiA9ICt0M1swXSwgZzIgPSArdDNbMV0sIHYyKSA6IFtwMiwgZzJdOwogICAgICAgIH0sIHYyLnN0ZXBNaW5vciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChoMiA9ICt0M1swXSwgZDIgPSArdDNbMV0sIHYyKSA6IFtoMiwgZDJdOwogICAgICAgIH0sIHYyLnByZWNpc2lvbiA9IGZ1bmN0aW9uKGgzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh5MiA9ICtoMywgYzIgPSBXbChvMiwgaTIsIDkwKSwgZjIgPSBabChuMiwgdDIsIHkyKSwgczIgPSBXbCh1MiwgYTIsIDkwKSwgbDIgPSBabChyMiwgZTIsIHkyKSwgdjIpIDogeTI7CiAgICAgICAgfSwgdjIuZXh0ZW50TWFqb3IoW1stMTgwLCAtOTAgKyBkZl0sIFsxODAsIDkwIC0gZGZdXSkuZXh0ZW50TWlub3IoW1stMTgwLCAtODAgLSBkZl0sIFsxODAsIDgwICsgZGZdXSk7CiAgICAgIH0KICAgICAgdmFyIFFsLCBKbCwgdGgsIG5oLCBlaCA9ICh0MikgPT4gdDIsIHJoID0gbmV3IFQoKSwgaWggPSBuZXcgVCgpLCBvaCA9IHsgcG9pbnQ6IHFmLCBsaW5lU3RhcnQ6IHFmLCBsaW5lRW5kOiBxZiwgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICBvaC5saW5lU3RhcnQgPSBhaCwgb2gubGluZUVuZCA9IGZoOwogICAgICB9LCBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICBvaC5saW5lU3RhcnQgPSBvaC5saW5lRW5kID0gb2gucG9pbnQgPSBxZiwgcmguYWRkKHhmKGloKSksIGloID0gbmV3IFQoKTsKICAgICAgfSwgcmVzdWx0OiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSByaCAvIDI7CiAgICAgICAgcmV0dXJuIHJoID0gbmV3IFQoKSwgdDI7CiAgICAgIH0gfTsKICAgICAgZnVuY3Rpb24gYWgoKSB7CiAgICAgICAgb2gucG9pbnQgPSB1aDsKICAgICAgfQogICAgICBmdW5jdGlvbiB1aCh0MiwgbjIpIHsKICAgICAgICBvaC5wb2ludCA9IGNoLCBRbCA9IHRoID0gdDIsIEpsID0gbmggPSBuMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBjaCh0MiwgbjIpIHsKICAgICAgICBpaC5hZGQobmggKiB0MiAtIHRoICogbjIpLCB0aCA9IHQyLCBuaCA9IG4yOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGZoKCkgewogICAgICAgIGNoKFFsLCBKbCk7CiAgICAgIH0KICAgICAgdmFyIHNoID0gb2gsIGxoID0gMSAvIDAsIGhoID0gbGgsIGRoID0gLWxoLCBwaCA9IGRoLCBnaCA9IHsgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHQyIDwgbGggJiYgKGxoID0gdDIpOwogICAgICAgIHQyID4gZGggJiYgKGRoID0gdDIpOwogICAgICAgIG4yIDwgaGggJiYgKGhoID0gbjIpOwogICAgICAgIG4yID4gcGggJiYgKHBoID0gbjIpOwogICAgICB9LCBsaW5lU3RhcnQ6IHFmLCBsaW5lRW5kOiBxZiwgcG9seWdvblN0YXJ0OiBxZiwgcG9seWdvbkVuZDogcWYsIHJlc3VsdDogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyID0gW1tsaCwgaGhdLCBbZGgsIHBoXV07CiAgICAgICAgcmV0dXJuIGRoID0gcGggPSAtKGhoID0gbGggPSAxIC8gMCksIHQyOwogICAgICB9IH07CiAgICAgIHZhciB5aCwgdmgsIF9oLCBiaCwgbWggPSBnaCwgeGggPSAwLCB3aCA9IDAsIE1oID0gMCwgVGggPSAwLCBBaCA9IDAsIFNoID0gMCwgRWggPSAwLCBOaCA9IDAsIGtoID0gMCwgQ2ggPSB7IHBvaW50OiBQaCwgbGluZVN0YXJ0OiB6aCwgbGluZUVuZDogUmgsIHBvbHlnb25TdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgQ2gubGluZVN0YXJ0ID0gRmgsIENoLmxpbmVFbmQgPSBxaDsKICAgICAgfSwgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgQ2gucG9pbnQgPSBQaCwgQ2gubGluZVN0YXJ0ID0gemgsIENoLmxpbmVFbmQgPSBSaDsKICAgICAgfSwgcmVzdWx0OiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBraCA/IFtFaCAvIGtoLCBOaCAvIGtoXSA6IFNoID8gW1RoIC8gU2gsIEFoIC8gU2hdIDogTWggPyBbeGggLyBNaCwgd2ggLyBNaF0gOiBbTmFOLCBOYU5dOwogICAgICAgIHJldHVybiB4aCA9IHdoID0gTWggPSBUaCA9IEFoID0gU2ggPSBFaCA9IE5oID0ga2ggPSAwLCB0MjsKICAgICAgfSB9OwogICAgICBmdW5jdGlvbiBQaCh0MiwgbjIpIHsKICAgICAgICB4aCArPSB0Miwgd2ggKz0gbjIsICsrTWg7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gemgoKSB7CiAgICAgICAgQ2gucG9pbnQgPSAkaDsKICAgICAgfQogICAgICBmdW5jdGlvbiAkaCh0MiwgbjIpIHsKICAgICAgICBDaC5wb2ludCA9IERoLCBQaChfaCA9IHQyLCBiaCA9IG4yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBEaCh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSB0MiAtIF9oLCByMiA9IG4yIC0gYmgsIGkyID0gemYoZTIgKiBlMiArIHIyICogcjIpOwogICAgICAgIFRoICs9IGkyICogKF9oICsgdDIpIC8gMiwgQWggKz0gaTIgKiAoYmggKyBuMikgLyAyLCBTaCArPSBpMiwgUGgoX2ggPSB0MiwgYmggPSBuMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUmgoKSB7CiAgICAgICAgQ2gucG9pbnQgPSBQaDsKICAgICAgfQogICAgICBmdW5jdGlvbiBGaCgpIHsKICAgICAgICBDaC5wb2ludCA9IFVoOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHFoKCkgewogICAgICAgIEloKHloLCB2aCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVWgodDIsIG4yKSB7CiAgICAgICAgQ2gucG9pbnQgPSBJaCwgUGgoeWggPSBfaCA9IHQyLCB2aCA9IGJoID0gbjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEloKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IHQyIC0gX2gsIHIyID0gbjIgLSBiaCwgaTIgPSB6ZihlMiAqIGUyICsgcjIgKiByMik7CiAgICAgICAgVGggKz0gaTIgKiAoX2ggKyB0MikgLyAyLCBBaCArPSBpMiAqIChiaCArIG4yKSAvIDIsIFNoICs9IGkyLCBFaCArPSAoaTIgPSBiaCAqIHQyIC0gX2ggKiBuMikgKiAoX2ggKyB0MiksIE5oICs9IGkyICogKGJoICsgbjIpLCBraCArPSAzICogaTIsIFBoKF9oID0gdDIsIGJoID0gbjIpOwogICAgICB9CiAgICAgIHZhciBPaCA9IENoOwogICAgICBmdW5jdGlvbiBCaCh0MikgewogICAgICAgIHRoaXMuX2NvbnRleHQgPSB0MjsKICAgICAgfQogICAgICBCaC5wcm90b3R5cGUgPSB7IF9yYWRpdXM6IDQuNSwgcG9pbnRSYWRpdXM6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3JhZGl1cyA9IHQyLCB0aGlzOwogICAgICB9LCBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSAwOwogICAgICB9LCBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9saW5lID0gTmFOOwogICAgICB9LCBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX3BvaW50ID0gMDsKICAgICAgfSwgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgMCA9PT0gdGhpcy5fbGluZSAmJiB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpLCB0aGlzLl9wb2ludCA9IE5hTjsKICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgdGhpcy5fY29udGV4dC5tb3ZlVG8odDIsIG4yKSwgdGhpcy5fcG9pbnQgPSAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdGhpcy5fY29udGV4dC5saW5lVG8odDIsIG4yKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aGlzLl9jb250ZXh0Lm1vdmVUbyh0MiArIHRoaXMuX3JhZGl1cywgbjIpLCB0aGlzLl9jb250ZXh0LmFyYyh0MiwgbjIsIHRoaXMuX3JhZGl1cywgMCwgX2YpOwogICAgICAgIH0KICAgICAgfSwgcmVzdWx0OiBxZiB9OwogICAgICB2YXIgWWgsIExoLCBqaCwgSGgsIFhoLCBHaCA9IG5ldyBUKCksIFZoID0geyBwb2ludDogcWYsIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgVmgucG9pbnQgPSBXaDsKICAgICAgfSwgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgWWggJiYgWmgoTGgsIGpoKSwgVmgucG9pbnQgPSBxZjsKICAgICAgfSwgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICBZaCA9IHRydWU7CiAgICAgIH0sIHBvbHlnb25FbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIFloID0gbnVsbDsKICAgICAgfSwgcmVzdWx0OiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSArR2g7CiAgICAgICAgcmV0dXJuIEdoID0gbmV3IFQoKSwgdDI7CiAgICAgIH0gfTsKICAgICAgZnVuY3Rpb24gV2godDIsIG4yKSB7CiAgICAgICAgVmgucG9pbnQgPSBaaCwgTGggPSBIaCA9IHQyLCBqaCA9IFhoID0gbjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWmgodDIsIG4yKSB7CiAgICAgICAgSGggLT0gdDIsIFhoIC09IG4yLCBHaC5hZGQoemYoSGggKiBIaCArIFhoICogWGgpKSwgSGggPSB0MiwgWGggPSBuMjsKICAgICAgfQogICAgICB2YXIgS2ggPSBWaDsKICAgICAgbGV0IFFoLCBKaCwgdGQsIG5kOwogICAgICBjbGFzcyBlZCB7CiAgICAgICAgY29uc3RydWN0b3IodDIpIHsKICAgICAgICAgIHRoaXMuX2FwcGVuZCA9IG51bGwgPT0gdDIgPyByZCA6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGNvbnN0IG4yID0gTWF0aC5mbG9vcih0Myk7CiAgICAgICAgICAgIGlmICghKG4yID49IDApKQogICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKGBpbnZhbGlkIGRpZ2l0czogJHt0M31gKTsKICAgICAgICAgICAgaWYgKG4yID4gMTUpCiAgICAgICAgICAgICAgcmV0dXJuIHJkOwogICAgICAgICAgICBpZiAobjIgIT09IFFoKSB7CiAgICAgICAgICAgICAgY29uc3QgdDQgPSAxMCAqKiBuMjsKICAgICAgICAgICAgICBRaCA9IG4yLCBKaCA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICAgICAgICBsZXQgZTIgPSAxOwogICAgICAgICAgICAgICAgdGhpcy5fICs9IG4zWzBdOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCByMiA9IG4zLmxlbmd0aDsgZTIgPCByMjsgKytlMikKICAgICAgICAgICAgICAgICAgdGhpcy5fICs9IE1hdGgucm91bmQoYXJndW1lbnRzW2UyXSAqIHQ0KSAvIHQ0ICsgbjNbZTJdOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIEpoOwogICAgICAgICAgfSh0MiksIHRoaXMuX3JhZGl1cyA9IDQuNSwgdGhpcy5fID0gIiI7CiAgICAgICAgfQogICAgICAgIHBvaW50UmFkaXVzKHQyKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fcmFkaXVzID0gK3QyLCB0aGlzOwogICAgICAgIH0KICAgICAgICBwb2x5Z29uU3RhcnQoKSB7CiAgICAgICAgICB0aGlzLl9saW5lID0gMDsKICAgICAgICB9CiAgICAgICAgcG9seWdvbkVuZCgpIHsKICAgICAgICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgICAgICAgfQogICAgICAgIGxpbmVTdGFydCgpIHsKICAgICAgICAgIHRoaXMuX3BvaW50ID0gMDsKICAgICAgICB9CiAgICAgICAgbGluZUVuZCgpIHsKICAgICAgICAgIDAgPT09IHRoaXMuX2xpbmUgJiYgKHRoaXMuXyArPSAiWiIpLCB0aGlzLl9wb2ludCA9IE5hTjsKICAgICAgICB9CiAgICAgICAgcG9pbnQodDIsIG4yKSB7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLl9hcHBlbmRgTSR7dDJ9LCR7bjJ9YCwgdGhpcy5fcG9pbnQgPSAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgdGhpcy5fYXBwZW5kYEwke3QyfSwke24yfWA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaWYgKHRoaXMuX2FwcGVuZGBNJHt0Mn0sJHtuMn1gLCB0aGlzLl9yYWRpdXMgIT09IHRkIHx8IHRoaXMuX2FwcGVuZCAhPT0gSmgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHQzID0gdGhpcy5fcmFkaXVzLCBuMyA9IHRoaXMuXzsKICAgICAgICAgICAgICAgIHRoaXMuXyA9ICIiLCB0aGlzLl9hcHBlbmRgbTAsJHt0M31hJHt0M30sJHt0M30gMCAxLDEgMCwkey0yICogdDN9YSR7dDN9LCR7dDN9IDAgMSwxIDAsJHsyICogdDN9emAsIHRkID0gdDMsIEpoID0gdGhpcy5fYXBwZW5kLCBuZCA9IHRoaXMuXywgdGhpcy5fID0gbjM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuXyArPSBuZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmVzdWx0KCkgewogICAgICAgICAgY29uc3QgdDIgPSB0aGlzLl87CiAgICAgICAgICByZXR1cm4gdGhpcy5fID0gIiIsIHQyLmxlbmd0aCA/IHQyIDogbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcmQodDIpIHsKICAgICAgICBsZXQgbjIgPSAxOwogICAgICAgIHRoaXMuXyArPSB0MlswXTsKICAgICAgICBmb3IgKGNvbnN0IGUyID0gdDIubGVuZ3RoOyBuMiA8IGUyOyArK24yKQogICAgICAgICAgdGhpcy5fICs9IGFyZ3VtZW50c1tuMl0gKyB0MltuMl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaWQodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24objIpIHsKICAgICAgICAgIHZhciBlMiA9IG5ldyBvZCgpOwogICAgICAgICAgZm9yICh2YXIgcjIgaW4gdDIpCiAgICAgICAgICAgIGUyW3IyXSA9IHQyW3IyXTsKICAgICAgICAgIHJldHVybiBlMi5zdHJlYW0gPSBuMiwgZTI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBvZCgpIHsKICAgICAgfQogICAgICBmdW5jdGlvbiBhZCh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gdDIuY2xpcEV4dGVudCAmJiB0Mi5jbGlwRXh0ZW50KCk7CiAgICAgICAgcmV0dXJuIHQyLnNjYWxlKDE1MCkudHJhbnNsYXRlKFswLCAwXSksIG51bGwgIT0gcjIgJiYgdDIuY2xpcEV4dGVudChudWxsKSwgTGYoZTIsIHQyLnN0cmVhbShtaCkpLCBuMihtaC5yZXN1bHQoKSksIG51bGwgIT0gcjIgJiYgdDIuY2xpcEV4dGVudChyMiksIHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVkKHQyLCBuMiwgZTIpIHsKICAgICAgICByZXR1cm4gYWQodDIsIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICB2YXIgcjIgPSBuMlsxXVswXSAtIG4yWzBdWzBdLCBpMiA9IG4yWzFdWzFdIC0gbjJbMF1bMV0sIG8yID0gTWF0aC5taW4ocjIgLyAoZTNbMV1bMF0gLSBlM1swXVswXSksIGkyIC8gKGUzWzFdWzFdIC0gZTNbMF1bMV0pKSwgYTIgPSArbjJbMF1bMF0gKyAocjIgLSBvMiAqIChlM1sxXVswXSArIGUzWzBdWzBdKSkgLyAyLCB1MiA9ICtuMlswXVsxXSArIChpMiAtIG8yICogKGUzWzFdWzFdICsgZTNbMF1bMV0pKSAvIDI7CiAgICAgICAgICB0Mi5zY2FsZSgxNTAgKiBvMikudHJhbnNsYXRlKFthMiwgdTJdKTsKICAgICAgICB9LCBlMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY2QodDIsIG4yLCBlMikgewogICAgICAgIHJldHVybiB1ZCh0MiwgW1swLCAwXSwgbjJdLCBlMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZmQodDIsIG4yLCBlMikgewogICAgICAgIHJldHVybiBhZCh0MiwgZnVuY3Rpb24oZTMpIHsKICAgICAgICAgIHZhciByMiA9ICtuMiwgaTIgPSByMiAvIChlM1sxXVswXSAtIGUzWzBdWzBdKSwgbzIgPSAocjIgLSBpMiAqIChlM1sxXVswXSArIGUzWzBdWzBdKSkgLyAyLCBhMiA9IC1pMiAqIGUzWzBdWzFdOwogICAgICAgICAgdDIuc2NhbGUoMTUwICogaTIpLnRyYW5zbGF0ZShbbzIsIGEyXSk7CiAgICAgICAgfSwgZTIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHNkKHQyLCBuMiwgZTIpIHsKICAgICAgICByZXR1cm4gYWQodDIsIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICB2YXIgcjIgPSArbjIsIGkyID0gcjIgLyAoZTNbMV1bMV0gLSBlM1swXVsxXSksIG8yID0gLWkyICogZTNbMF1bMF0sIGEyID0gKHIyIC0gaTIgKiAoZTNbMV1bMV0gKyBlM1swXVsxXSkpIC8gMjsKICAgICAgICAgIHQyLnNjYWxlKDE1MCAqIGkyKS50cmFuc2xhdGUoW28yLCBhMl0pOwogICAgICAgIH0sIGUyKTsKICAgICAgfQogICAgICBvZC5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiBvZCwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHRoaXMuc3RyZWFtLnBvaW50KHQyLCBuMik7CiAgICAgIH0sIHNwaGVyZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5zdHJlYW0uc3BoZXJlKCk7CiAgICAgIH0sIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5zdHJlYW0ubGluZVN0YXJ0KCk7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuc3RyZWFtLmxpbmVFbmQoKTsKICAgICAgfSwgcG9seWdvblN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLnN0cmVhbS5wb2x5Z29uU3RhcnQoKTsKICAgICAgfSwgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5zdHJlYW0ucG9seWdvbkVuZCgpOwogICAgICB9IH07CiAgICAgIHZhciBsZCA9IDE2LCBoZCA9IFRmKDMwICogbWYpOwogICAgICBmdW5jdGlvbiBkZCh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gK24yID8gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgZnVuY3Rpb24gZTIocjIsIGkyLCBvMiwgYTIsIHUyLCBjMiwgZjIsIHMyLCBsMiwgaDIsIGQyLCBwMiwgZzIsIHkyKSB7CiAgICAgICAgICAgIHZhciB2MiA9IGYyIC0gcjIsIF8yID0gczIgLSBpMiwgYjIgPSB2MiAqIHYyICsgXzIgKiBfMjsKICAgICAgICAgICAgaWYgKGIyID4gNCAqIG4zICYmIGcyLS0pIHsKICAgICAgICAgICAgICB2YXIgbTIgPSBhMiArIGgyLCB4MiA9IHUyICsgZDIsIHcyID0gYzIgKyBwMiwgTTIgPSB6ZihtMiAqIG0yICsgeDIgKiB4MiArIHcyICogdzIpLCBUMiA9IFJmKHcyIC89IE0yKSwgQTIgPSB4Zih4Zih3MikgLSAxKSA8IGRmIHx8IHhmKG8yIC0gbDIpIDwgZGYgPyAobzIgKyBsMikgLyAyIDogTWYoeDIsIG0yKSwgUzIgPSB0MyhBMiwgVDIpLCBFMiA9IFMyWzBdLCBOMiA9IFMyWzFdLCBrMiA9IEUyIC0gcjIsIEMyID0gTjIgLSBpMiwgUDIgPSBfMiAqIGsyIC0gdjIgKiBDMjsKICAgICAgICAgICAgICAoUDIgKiBQMiAvIGIyID4gbjMgfHwgeGYoKHYyICogazIgKyBfMiAqIEMyKSAvIGIyIC0gMC41KSA+IDAuMyB8fCBhMiAqIGgyICsgdTIgKiBkMiArIGMyICogcDIgPCBoZCkgJiYgKGUyKHIyLCBpMiwgbzIsIGEyLCB1MiwgYzIsIEUyLCBOMiwgQTIsIG0yIC89IE0yLCB4MiAvPSBNMiwgdzIsIGcyLCB5MiksIHkyLnBvaW50KEUyLCBOMiksIGUyKEUyLCBOMiwgQTIsIG0yLCB4MiwgdzIsIGYyLCBzMiwgbDIsIGgyLCBkMiwgcDIsIGcyLCB5MikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24objQpIHsKICAgICAgICAgICAgdmFyIHIyLCBpMiwgbzIsIGEyLCB1MiwgYzIsIGYyLCBzMiwgbDIsIGgyLCBkMiwgcDIsIGcyID0geyBwb2ludDogeTIsIGxpbmVTdGFydDogdjIsIGxpbmVFbmQ6IGIyLCBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIG40LnBvbHlnb25TdGFydCgpLCBnMi5saW5lU3RhcnQgPSBtMjsKICAgICAgICAgICAgfSwgcG9seWdvbkVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgbjQucG9seWdvbkVuZCgpLCBnMi5saW5lU3RhcnQgPSB2MjsKICAgICAgICAgICAgfSB9OwogICAgICAgICAgICBmdW5jdGlvbiB5MihlMywgcjMpIHsKICAgICAgICAgICAgICBlMyA9IHQzKGUzLCByMyksIG40LnBvaW50KGUzWzBdLCBlM1sxXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdjIoKSB7CiAgICAgICAgICAgICAgczIgPSBOYU4sIGcyLnBvaW50ID0gXzIsIG40LmxpbmVTdGFydCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIF8yKHIzLCBpMykgewogICAgICAgICAgICAgIHZhciBvMyA9IHBzKFtyMywgaTNdKSwgYTMgPSB0MyhyMywgaTMpOwogICAgICAgICAgICAgIGUyKHMyLCBsMiwgZjIsIGgyLCBkMiwgcDIsIHMyID0gYTNbMF0sIGwyID0gYTNbMV0sIGYyID0gcjMsIGgyID0gbzNbMF0sIGQyID0gbzNbMV0sIHAyID0gbzNbMl0sIGxkLCBuNCksIG40LnBvaW50KHMyLCBsMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYjIoKSB7CiAgICAgICAgICAgICAgZzIucG9pbnQgPSB5MiwgbjQubGluZUVuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG0yKCkgewogICAgICAgICAgICAgIHYyKCksIGcyLnBvaW50ID0geDIsIGcyLmxpbmVFbmQgPSB3MjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB4Mih0NCwgbjUpIHsKICAgICAgICAgICAgICBfMihyMiA9IHQ0LCBuNSksIGkyID0gczIsIG8yID0gbDIsIGEyID0gaDIsIHUyID0gZDIsIGMyID0gcDIsIGcyLnBvaW50ID0gXzI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdzIoKSB7CiAgICAgICAgICAgICAgZTIoczIsIGwyLCBmMiwgaDIsIGQyLCBwMiwgaTIsIG8yLCByMiwgYTIsIHUyLCBjMiwgbGQsIG40KSwgZzIubGluZUVuZCA9IGIyLCBiMigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBnMjsKICAgICAgICAgIH07CiAgICAgICAgfSh0MiwgbjIpIDogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBpZCh7IHBvaW50OiBmdW5jdGlvbihuMywgZTIpIHsKICAgICAgICAgICAgbjMgPSB0MyhuMywgZTIpLCB0aGlzLnN0cmVhbS5wb2ludChuM1swXSwgbjNbMV0pOwogICAgICAgICAgfSB9KTsKICAgICAgICB9KHQyKTsKICAgICAgfQogICAgICB2YXIgcGQgPSBpZCh7IHBvaW50OiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICB0aGlzLnN0cmVhbS5wb2ludCh0MiAqIG1mLCBuMiAqIG1mKTsKICAgICAgfSB9KTsKICAgICAgZnVuY3Rpb24gZ2QodDIsIG4yLCBlMiwgcjIsIGkyLCBvMikgewogICAgICAgIGlmICghbzIpCiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odDMsIG4zLCBlMywgcjMsIGkzKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIG8zKG80LCBhMykgewogICAgICAgICAgICAgIHJldHVybiBbbjMgKyB0MyAqIChvNCAqPSByMyksIGUzIC0gdDMgKiAoYTMgKj0gaTMpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbzMuaW52ZXJ0ID0gZnVuY3Rpb24obzQsIGEzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFsobzQgLSBuMykgLyB0MyAqIHIzLCAoZTMgLSBhMykgLyB0MyAqIGkzXTsKICAgICAgICAgICAgfSwgbzM7CiAgICAgICAgICB9KHQyLCBuMiwgZTIsIHIyLCBpMik7CiAgICAgICAgdmFyIGEyID0gVGYobzIpLCB1MiA9IENmKG8yKSwgYzIgPSBhMiAqIHQyLCBmMiA9IHUyICogdDIsIHMyID0gYTIgLyB0MiwgbDIgPSB1MiAvIHQyLCBoMiA9ICh1MiAqIGUyIC0gYTIgKiBuMikgLyB0MiwgZDIgPSAodTIgKiBuMiArIGEyICogZTIpIC8gdDI7CiAgICAgICAgZnVuY3Rpb24gcDIodDMsIG8zKSB7CiAgICAgICAgICByZXR1cm4gW2MyICogKHQzICo9IHIyKSAtIGYyICogKG8zICo9IGkyKSArIG4yLCBlMiAtIGYyICogdDMgLSBjMiAqIG8zXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHAyLmludmVydCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIFtyMiAqIChzMiAqIHQzIC0gbDIgKiBuMyArIGgyKSwgaTIgKiAoZDIgLSBsMiAqIHQzIC0gczIgKiBuMyldOwogICAgICAgIH0sIHAyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHlkKHQyKSB7CiAgICAgICAgcmV0dXJuIHZkKGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0pKCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdmQodDIpIHsKICAgICAgICB2YXIgbjIsIGUyLCByMiwgaTIsIG8yLCBhMiwgdTIsIGMyLCBmMiwgczIsIGwyID0gMTUwLCBoMiA9IDQ4MCwgZDIgPSAyNTAsIHAyID0gMCwgZzIgPSAwLCB5MiA9IDAsIHYyID0gMCwgXzIgPSAwLCBiMiA9IDAsIG0yID0gMSwgeDIgPSAxLCB3MiA9IG51bGwsIE0yID0gVGwsIFQyID0gbnVsbCwgQTIgPSBlaCwgUzIgPSAwLjU7CiAgICAgICAgZnVuY3Rpb24gRTIodDMpIHsKICAgICAgICAgIHJldHVybiBjMih0M1swXSAqIG1mLCB0M1sxXSAqIG1mKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTjIodDMpIHsKICAgICAgICAgIHJldHVybiAodDMgPSBjMi5pbnZlcnQodDNbMF0sIHQzWzFdKSkgJiYgW3QzWzBdICogYmYsIHQzWzFdICogYmZdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBrMigpIHsKICAgICAgICAgIHZhciB0MyA9IGdkKGwyLCAwLCAwLCBtMiwgeDIsIGIyKS5hcHBseShudWxsLCBuMihwMiwgZzIpKSwgcjMgPSBnZChsMiwgaDIgLSB0M1swXSwgZDIgLSB0M1sxXSwgbTIsIHgyLCBiMik7CiAgICAgICAgICByZXR1cm4gZTIgPSB1bCh5MiwgdjIsIF8yKSwgdTIgPSBvbChuMiwgcjMpLCBjMiA9IG9sKGUyLCB1MiksIGEyID0gZGQodTIsIFMyKSwgQzIoKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQzIoKSB7CiAgICAgICAgICByZXR1cm4gZjIgPSBzMiA9IG51bGwsIEUyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gRTIuc3RyZWFtID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBmMiAmJiBzMiA9PT0gdDMgPyBmMiA6IGYyID0gcGQoZnVuY3Rpb24odDQpIHsKICAgICAgICAgICAgcmV0dXJuIGlkKHsgcG9pbnQ6IGZ1bmN0aW9uKG4zLCBlMykgewogICAgICAgICAgICAgIHZhciByMyA9IHQ0KG4zLCBlMyk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLnBvaW50KHIzWzBdLCByM1sxXSk7CiAgICAgICAgICAgIH0gfSk7CiAgICAgICAgICB9KGUyKShNMihhMihBMihzMiA9IHQzKSkpKSk7CiAgICAgICAgfSwgRTIucHJlY2xpcCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChNMiA9IHQzLCB3MiA9IHZvaWQgMCwgQzIoKSkgOiBNMjsKICAgICAgICB9LCBFMi5wb3N0Y2xpcCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChBMiA9IHQzLCBUMiA9IHIyID0gaTIgPSBvMiA9IG51bGwsIEMyKCkpIDogQTI7CiAgICAgICAgfSwgRTIuY2xpcEFuZ2xlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKE0yID0gK3QzID8gQWwodzIgPSB0MyAqIG1mKSA6ICh3MiA9IG51bGwsIFRsKSwgQzIoKSkgOiB3MiAqIGJmOwogICAgICAgIH0sIEUyLmNsaXBFeHRlbnQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoQTIgPSBudWxsID09IHQzID8gKFQyID0gcjIgPSBpMiA9IG8yID0gbnVsbCwgZWgpIDogemwoVDIgPSArdDNbMF1bMF0sIHIyID0gK3QzWzBdWzFdLCBpMiA9ICt0M1sxXVswXSwgbzIgPSArdDNbMV1bMV0pLCBDMigpKSA6IG51bGwgPT0gVDIgPyBudWxsIDogW1tUMiwgcjJdLCBbaTIsIG8yXV07CiAgICAgICAgfSwgRTIuc2NhbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobDIgPSArdDMsIGsyKCkpIDogbDI7CiAgICAgICAgfSwgRTIudHJhbnNsYXRlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGgyID0gK3QzWzBdLCBkMiA9ICt0M1sxXSwgazIoKSkgOiBbaDIsIGQyXTsKICAgICAgICB9LCBFMi5jZW50ZXIgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocDIgPSB0M1swXSAlIDM2MCAqIG1mLCBnMiA9IHQzWzFdICUgMzYwICogbWYsIGsyKCkpIDogW3AyICogYmYsIGcyICogYmZdOwogICAgICAgIH0sIEUyLnJvdGF0ZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh5MiA9IHQzWzBdICUgMzYwICogbWYsIHYyID0gdDNbMV0gJSAzNjAgKiBtZiwgXzIgPSB0My5sZW5ndGggPiAyID8gdDNbMl0gJSAzNjAgKiBtZiA6IDAsIGsyKCkpIDogW3kyICogYmYsIHYyICogYmYsIF8yICogYmZdOwogICAgICAgIH0sIEUyLmFuZ2xlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGIyID0gdDMgJSAzNjAgKiBtZiwgazIoKSkgOiBiMiAqIGJmOwogICAgICAgIH0sIEUyLnJlZmxlY3RYID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG0yID0gdDMgPyAtMSA6IDEsIGsyKCkpIDogbTIgPCAwOwogICAgICAgIH0sIEUyLnJlZmxlY3RZID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHgyID0gdDMgPyAtMSA6IDEsIGsyKCkpIDogeDIgPCAwOwogICAgICAgIH0sIEUyLnByZWNpc2lvbiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhMiA9IGRkKHUyLCBTMiA9IHQzICogdDMpLCBDMigpKSA6IHpmKFMyKTsKICAgICAgICB9LCBFMi5maXRFeHRlbnQgPSBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiB1ZChFMiwgdDMsIG4zKTsKICAgICAgICB9LCBFMi5maXRTaXplID0gZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICByZXR1cm4gY2QoRTIsIHQzLCBuMyk7CiAgICAgICAgfSwgRTIuZml0V2lkdGggPSBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiBmZChFMiwgdDMsIG4zKTsKICAgICAgICB9LCBFMi5maXRIZWlnaHQgPSBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiBzZChFMiwgdDMsIG4zKTsKICAgICAgICB9LCBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBuMiA9IHQyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIEUyLmludmVydCA9IG4yLmludmVydCAmJiBOMiwgazIoKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIF9kKHQyKSB7CiAgICAgICAgdmFyIG4yID0gMCwgZTIgPSBnZiAvIDMsIHIyID0gdmQodDIpLCBpMiA9IHIyKG4yLCBlMik7CiAgICAgICAgcmV0dXJuIGkyLnBhcmFsbGVscyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IHIyKG4yID0gdDNbMF0gKiBtZiwgZTIgPSB0M1sxXSAqIG1mKSA6IFtuMiAqIGJmLCBlMiAqIGJmXTsKICAgICAgICB9LCBpMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBiZCh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSBDZih0MiksIHIyID0gKGUyICsgQ2YobjIpKSAvIDI7CiAgICAgICAgaWYgKHhmKHIyKSA8IGRmKQogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHZhciBuMyA9IFRmKHQzKTsKICAgICAgICAgICAgZnVuY3Rpb24gZTModDQsIGU0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIFt0NCAqIG4zLCBDZihlNCkgLyBuM107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGUzLmludmVydCA9IGZ1bmN0aW9uKHQ0LCBlNCkgewogICAgICAgICAgICAgIHJldHVybiBbdDQgLyBuMywgUmYoZTQgKiBuMyldOwogICAgICAgICAgICB9LCBlMzsKICAgICAgICAgIH0odDIpOwogICAgICAgIHZhciBpMiA9IDEgKyBlMiAqICgyICogcjIgLSBlMiksIG8yID0gemYoaTIpIC8gcjI7CiAgICAgICAgZnVuY3Rpb24gYTIodDMsIG4zKSB7CiAgICAgICAgICB2YXIgZTMgPSB6ZihpMiAtIDIgKiByMiAqIENmKG4zKSkgLyByMjsKICAgICAgICAgIHJldHVybiBbZTMgKiBDZih0MyAqPSByMiksIG8yIC0gZTMgKiBUZih0MyldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYTIuaW52ZXJ0ID0gZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICB2YXIgZTMgPSBvMiAtIG4zLCBhMyA9IE1mKHQzLCB4ZihlMykpICogUGYoZTMpOwogICAgICAgICAgcmV0dXJuIGUzICogcjIgPCAwICYmIChhMyAtPSBnZiAqIFBmKHQzKSAqIFBmKGUzKSksIFthMyAvIHIyLCBSZigoaTIgLSAodDMgKiB0MyArIGUzICogZTMpICogcjIgKiByMikgLyAoMiAqIHIyKSldOwogICAgICAgIH0sIGEyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1kKCkgewogICAgICAgIHJldHVybiBfZChiZCkuc2NhbGUoMTU1LjQyNCkuY2VudGVyKFswLCAzMy42NDQyXSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24geGQoKSB7CiAgICAgICAgcmV0dXJuIG1kKCkucGFyYWxsZWxzKFsyOS41LCA0NS41XSkuc2NhbGUoMTA3MCkudHJhbnNsYXRlKFs0ODAsIDI1MF0pLnJvdGF0ZShbOTYsIDBdKS5jZW50ZXIoWy0wLjYsIDM4LjddKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB3ZCh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihuMiwgZTIpIHsKICAgICAgICAgIHZhciByMiA9IFRmKG4yKSwgaTIgPSBUZihlMiksIG8yID0gdDIocjIgKiBpMik7CiAgICAgICAgICByZXR1cm4gbzIgPT09IDEgLyAwID8gWzIsIDBdIDogW28yICogaTIgKiBDZihuMiksIG8yICogQ2YoZTIpXTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE1kKHQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG4yLCBlMikgewogICAgICAgICAgdmFyIHIyID0gemYobjIgKiBuMiArIGUyICogZTIpLCBpMiA9IHQyKHIyKSwgbzIgPSBDZihpMiksIGEyID0gVGYoaTIpOwogICAgICAgICAgcmV0dXJuIFtNZihuMiAqIG8yLCByMiAqIGEyKSwgUmYocjIgJiYgZTIgKiBvMiAvIHIyKV07CiAgICAgICAgfTsKICAgICAgfQogICAgICB2YXIgVGQgPSB3ZChmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB6ZigyIC8gKDEgKyB0MikpOwogICAgICB9KTsKICAgICAgVGQuaW52ZXJ0ID0gTWQoZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gMiAqIFJmKHQyIC8gMik7CiAgICAgIH0pOwogICAgICB2YXIgQWQgPSB3ZChmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiAodDIgPSBEZih0MikpICYmIHQyIC8gQ2YodDIpOwogICAgICB9KTsKICAgICAgZnVuY3Rpb24gU2QodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIFt0MiwgTmYoJGYoKHlmICsgbjIpIC8gMikpXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBFZCh0MikgewogICAgICAgIHZhciBuMiwgZTIsIHIyLCBpMiA9IHlkKHQyKSwgbzIgPSBpMi5jZW50ZXIsIGEyID0gaTIuc2NhbGUsIHUyID0gaTIudHJhbnNsYXRlLCBjMiA9IGkyLmNsaXBFeHRlbnQsIGYyID0gbnVsbDsKICAgICAgICBmdW5jdGlvbiBzMigpIHsKICAgICAgICAgIHZhciBvMyA9IGdmICogYTIoKSwgdTMgPSBpMihsbChpMi5yb3RhdGUoKSkuaW52ZXJ0KFswLCAwXSkpOwogICAgICAgICAgcmV0dXJuIGMyKG51bGwgPT0gZjIgPyBbW3UzWzBdIC0gbzMsIHUzWzFdIC0gbzNdLCBbdTNbMF0gKyBvMywgdTNbMV0gKyBvM11dIDogdDIgPT09IFNkID8gW1tNYXRoLm1heCh1M1swXSAtIG8zLCBmMiksIG4yXSwgW01hdGgubWluKHUzWzBdICsgbzMsIGUyKSwgcjJdXSA6IFtbZjIsIE1hdGgubWF4KHUzWzFdIC0gbzMsIG4yKV0sIFtlMiwgTWF0aC5taW4odTNbMV0gKyBvMywgcjIpXV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuc2NhbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIodDMpLCBzMigpKSA6IGEyKCk7CiAgICAgICAgfSwgaTIudHJhbnNsYXRlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHUyKHQzKSwgczIoKSkgOiB1MigpOwogICAgICAgIH0sIGkyLmNlbnRlciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChvMih0MyksIHMyKCkpIDogbzIoKTsKICAgICAgICB9LCBpMi5jbGlwRXh0ZW50ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG51bGwgPT0gdDMgPyBmMiA9IG4yID0gZTIgPSByMiA9IG51bGwgOiAoZjIgPSArdDNbMF1bMF0sIG4yID0gK3QzWzBdWzFdLCBlMiA9ICt0M1sxXVswXSwgcjIgPSArdDNbMV1bMV0pLCBzMigpKSA6IG51bGwgPT0gZjIgPyBudWxsIDogW1tmMiwgbjJdLCBbZTIsIHIyXV07CiAgICAgICAgfSwgczIoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBOZCh0MikgewogICAgICAgIHJldHVybiAkZigoeWYgKyB0MikgLyAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBrZCh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSBUZih0MiksIHIyID0gdDIgPT09IG4yID8gQ2YodDIpIDogTmYoZTIgLyBUZihuMikpIC8gTmYoTmQobjIpIC8gTmQodDIpKSwgaTIgPSBlMiAqIGtmKE5kKHQyKSwgcjIpIC8gcjI7CiAgICAgICAgaWYgKCFyMikKICAgICAgICAgIHJldHVybiBTZDsKICAgICAgICBmdW5jdGlvbiBvMih0MywgbjMpIHsKICAgICAgICAgIGkyID4gMCA/IG4zIDwgLXlmICsgZGYgJiYgKG4zID0gLXlmICsgZGYpIDogbjMgPiB5ZiAtIGRmICYmIChuMyA9IHlmIC0gZGYpOwogICAgICAgICAgdmFyIGUzID0gaTIgLyBrZihOZChuMyksIHIyKTsKICAgICAgICAgIHJldHVybiBbZTMgKiBDZihyMiAqIHQzKSwgaTIgLSBlMyAqIFRmKHIyICogdDMpXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG8yLmludmVydCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgdmFyIGUzID0gaTIgLSBuMywgbzMgPSBQZihyMikgKiB6Zih0MyAqIHQzICsgZTMgKiBlMyksIGEyID0gTWYodDMsIHhmKGUzKSkgKiBQZihlMyk7CiAgICAgICAgICByZXR1cm4gZTMgKiByMiA8IDAgJiYgKGEyIC09IGdmICogUGYodDMpICogUGYoZTMpKSwgW2EyIC8gcjIsIDIgKiB3ZihrZihpMiAvIG8zLCAxIC8gcjIpKSAtIHlmXTsKICAgICAgICB9LCBvMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBDZCh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gW3QyLCBuMl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUGQodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gVGYodDIpLCByMiA9IHQyID09PSBuMiA/IENmKHQyKSA6IChlMiAtIFRmKG4yKSkgLyAobjIgLSB0MiksIGkyID0gZTIgLyByMiArIHQyOwogICAgICAgIGlmICh4ZihyMikgPCBkZikKICAgICAgICAgIHJldHVybiBDZDsKICAgICAgICBmdW5jdGlvbiBvMih0MywgbjMpIHsKICAgICAgICAgIHZhciBlMyA9IGkyIC0gbjMsIG8zID0gcjIgKiB0MzsKICAgICAgICAgIHJldHVybiBbZTMgKiBDZihvMyksIGkyIC0gZTMgKiBUZihvMyldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbzIuaW52ZXJ0ID0gZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICB2YXIgZTMgPSBpMiAtIG4zLCBvMyA9IE1mKHQzLCB4ZihlMykpICogUGYoZTMpOwogICAgICAgICAgcmV0dXJuIGUzICogcjIgPCAwICYmIChvMyAtPSBnZiAqIFBmKHQzKSAqIFBmKGUzKSksIFtvMyAvIHIyLCBpMiAtIFBmKHIyKSAqIHpmKHQzICogdDMgKyBlMyAqIGUzKV07CiAgICAgICAgfSwgbzI7CiAgICAgIH0KICAgICAgQWQuaW52ZXJ0ID0gTWQoZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gdDI7CiAgICAgIH0pLCBTZC5pbnZlcnQgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gW3QyLCAyICogd2YoU2YobjIpKSAtIHlmXTsKICAgICAgfSwgQ2QuaW52ZXJ0ID0gQ2Q7CiAgICAgIHZhciB6ZCA9IDEuMzQwMjY0LCAkZCA9IC0wLjA4MTEwNiwgRGQgPSA4OTNlLTYsIFJkID0gMzc5NmUtNiwgRmQgPSB6ZigzKSAvIDI7CiAgICAgIGZ1bmN0aW9uIHFkKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IFJmKEZkICogQ2YobjIpKSwgcjIgPSBlMiAqIGUyLCBpMiA9IHIyICogcjIgKiByMjsKICAgICAgICByZXR1cm4gW3QyICogVGYoZTIpIC8gKEZkICogKHpkICsgMyAqICRkICogcjIgKyBpMiAqICg3ICogRGQgKyA5ICogUmQgKiByMikpKSwgZTIgKiAoemQgKyAkZCAqIHIyICsgaTIgKiAoRGQgKyBSZCAqIHIyKSldOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFVkKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IFRmKG4yKSwgcjIgPSBUZih0MikgKiBlMjsKICAgICAgICByZXR1cm4gW2UyICogQ2YodDIpIC8gcjIsIENmKG4yKSAvIHIyXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJZCh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSBuMiAqIG4yLCByMiA9IGUyICogZTI7CiAgICAgICAgcmV0dXJuIFt0MiAqICgwLjg3MDcgLSAwLjEzMTk3OSAqIGUyICsgcjIgKiAocjIgKiAoMzk3MWUtNiAqIGUyIC0gMTUyOWUtNiAqIHIyKSAtIDAuMDEzNzkxKSksIG4yICogKDEuMDA3MjI2ICsgZTIgKiAoMC4wMTUwODUgKyByMiAqICgwLjAyODg3NCAqIGUyIC0gMC4wNDQ0NzUgLSA1OTE2ZS02ICogcjIpKSldOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE9kKHQyLCBuMikgewogICAgICAgIHJldHVybiBbVGYobjIpICogQ2YodDIpLCBDZihuMildOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEJkKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IFRmKG4yKSwgcjIgPSAxICsgVGYodDIpICogZTI7CiAgICAgICAgcmV0dXJuIFtlMiAqIENmKHQyKSAvIHIyLCBDZihuMikgLyByMl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWWQodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIFtOZigkZigoeWYgKyBuMikgLyAyKSksIC10Ml07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTGQodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHQyLnBhcmVudCA9PT0gbjIucGFyZW50ID8gMSA6IDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gamQodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHQyICsgbjIueDsKICAgICAgfQogICAgICBmdW5jdGlvbiBIZCh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gTWF0aC5tYXgodDIsIG4yLnkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFhkKHQyKSB7CiAgICAgICAgdmFyIG4yID0gMCwgZTIgPSB0Mi5jaGlsZHJlbiwgcjIgPSBlMiAmJiBlMi5sZW5ndGg7CiAgICAgICAgaWYgKHIyKQogICAgICAgICAgZm9yICg7IC0tcjIgPj0gMDsgKQogICAgICAgICAgICBuMiArPSBlMltyMl0udmFsdWU7CiAgICAgICAgZWxzZQogICAgICAgICAgbjIgPSAxOwogICAgICAgIHQyLnZhbHVlID0gbjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gR2QodDIsIG4yKSB7CiAgICAgICAgdDIgaW5zdGFuY2VvZiBNYXAgPyAodDIgPSBbdm9pZCAwLCB0Ml0sIHZvaWQgMCA9PT0gbjIgJiYgKG4yID0gV2QpKSA6IHZvaWQgMCA9PT0gbjIgJiYgKG4yID0gVmQpOwogICAgICAgIGZvciAodmFyIGUyLCByMiwgaTIsIG8yLCBhMiwgdTIgPSBuZXcgUWQodDIpLCBjMiA9IFt1Ml07IGUyID0gYzIucG9wKCk7ICkKICAgICAgICAgIGlmICgoaTIgPSBuMihlMi5kYXRhKSkgJiYgKGEyID0gKGkyID0gQXJyYXkuZnJvbShpMikpLmxlbmd0aCkpCiAgICAgICAgICAgIGZvciAoZTIuY2hpbGRyZW4gPSBpMiwgbzIgPSBhMiAtIDE7IG8yID49IDA7IC0tbzIpCiAgICAgICAgICAgICAgYzIucHVzaChyMiA9IGkyW28yXSA9IG5ldyBRZChpMltvMl0pKSwgcjIucGFyZW50ID0gZTIsIHIyLmRlcHRoID0gZTIuZGVwdGggKyAxOwogICAgICAgIHJldHVybiB1Mi5lYWNoQmVmb3JlKEtkKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBWZCh0MikgewogICAgICAgIHJldHVybiB0Mi5jaGlsZHJlbjsKICAgICAgfQogICAgICBmdW5jdGlvbiBXZCh0MikgewogICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHQyKSA/IHQyWzFdIDogbnVsbDsKICAgICAgfQogICAgICBmdW5jdGlvbiBaZCh0MikgewogICAgICAgIHZvaWQgMCAhPT0gdDIuZGF0YS52YWx1ZSAmJiAodDIudmFsdWUgPSB0Mi5kYXRhLnZhbHVlKSwgdDIuZGF0YSA9IHQyLmRhdGEuZGF0YTsKICAgICAgfQogICAgICBmdW5jdGlvbiBLZCh0MikgewogICAgICAgIHZhciBuMiA9IDA7CiAgICAgICAgZG8gewogICAgICAgICAgdDIuaGVpZ2h0ID0gbjI7CiAgICAgICAgfSB3aGlsZSAoKHQyID0gdDIucGFyZW50KSAmJiB0Mi5oZWlnaHQgPCArK24yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBRZCh0MikgewogICAgICAgIHRoaXMuZGF0YSA9IHQyLCB0aGlzLmRlcHRoID0gdGhpcy5oZWlnaHQgPSAwLCB0aGlzLnBhcmVudCA9IG51bGw7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSmQodDIpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PSB0MiA/IG51bGwgOiB0cCh0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdHAodDIpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgdDIpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKICAgICAgICByZXR1cm4gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbnAoKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZXAodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBxZC5pbnZlcnQgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiwgcjIgPSBuMiwgaTIgPSByMiAqIHIyLCBvMiA9IGkyICogaTIgKiBpMiwgYTIgPSAwOyBhMiA8IDEyICYmIChvMiA9IChpMiA9IChyMiAtPSBlMiA9IChyMiAqICh6ZCArICRkICogaTIgKyBvMiAqIChEZCArIFJkICogaTIpKSAtIG4yKSAvICh6ZCArIDMgKiAkZCAqIGkyICsgbzIgKiAoNyAqIERkICsgOSAqIFJkICogaTIpKSkgKiByMikgKiBpMiAqIGkyLCAhKHhmKGUyKSA8IHBmKSk7ICsrYTIpCiAgICAgICAgICA7CiAgICAgICAgcmV0dXJuIFtGZCAqIHQyICogKHpkICsgMyAqICRkICogaTIgKyBvMiAqICg3ICogRGQgKyA5ICogUmQgKiBpMikpIC8gVGYocjIpLCBSZihDZihyMikgLyBGZCldOwogICAgICB9LCBVZC5pbnZlcnQgPSBNZCh3ZiksIElkLmludmVydCA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHZhciBlMiwgcjIgPSBuMiwgaTIgPSAyNTsKICAgICAgICBkbyB7CiAgICAgICAgICB2YXIgbzIgPSByMiAqIHIyLCBhMiA9IG8yICogbzI7CiAgICAgICAgICByMiAtPSBlMiA9IChyMiAqICgxLjAwNzIyNiArIG8yICogKDAuMDE1MDg1ICsgYTIgKiAoMC4wMjg4NzQgKiBvMiAtIDAuMDQ0NDc1IC0gNTkxNmUtNiAqIGEyKSkpIC0gbjIpIC8gKDEuMDA3MjI2ICsgbzIgKiAoMC4wNDUyNTUgKyBhMiAqICgwLjI1OTg2NiAqIG8yIC0gMC4zMTEzMjUgLSA1OTE2ZS02ICogMTEgKiBhMikpKTsKICAgICAgICB9IHdoaWxlICh4ZihlMikgPiBkZiAmJiAtLWkyID4gMCk7CiAgICAgICAgcmV0dXJuIFt0MiAvICgwLjg3MDcgKyAobzIgPSByMiAqIHIyKSAqIChvMiAqIChvMiAqIG8yICogbzIgKiAoMzk3MWUtNiAtIDE1MjllLTYgKiBvMikgLSAwLjAxMzc5MSkgLSAwLjEzMTk3OSkpLCByMl07CiAgICAgIH0sIE9kLmludmVydCA9IE1kKFJmKSwgQmQuaW52ZXJ0ID0gTWQoZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gMiAqIHdmKHQyKTsKICAgICAgfSksIFlkLmludmVydCA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiBbLW4yLCAyICogd2YoU2YodDIpKSAtIHlmXTsKICAgICAgfSwgUWQucHJvdG90eXBlID0gR2QucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogUWQsIGNvdW50OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5lYWNoQWZ0ZXIoWGQpOwogICAgICB9LCBlYWNoOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBsZXQgZTIgPSAtMTsKICAgICAgICBmb3IgKGNvbnN0IHIyIG9mIHRoaXMpCiAgICAgICAgICB0Mi5jYWxsKG4yLCByMiwgKytlMiwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sIGVhY2hBZnRlcjogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgZm9yICh2YXIgZTIsIHIyLCBpMiwgbzIgPSB0aGlzLCBhMiA9IFtvMl0sIHUyID0gW10sIGMyID0gLTE7IG8yID0gYTIucG9wKCk7ICkKICAgICAgICAgIGlmICh1Mi5wdXNoKG8yKSwgZTIgPSBvMi5jaGlsZHJlbikKICAgICAgICAgICAgZm9yIChyMiA9IDAsIGkyID0gZTIubGVuZ3RoOyByMiA8IGkyOyArK3IyKQogICAgICAgICAgICAgIGEyLnB1c2goZTJbcjJdKTsKICAgICAgICBmb3IgKDsgbzIgPSB1Mi5wb3AoKTsgKQogICAgICAgICAgdDIuY2FsbChuMiwgbzIsICsrYzIsIHRoaXMpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LCBlYWNoQmVmb3JlOiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiwgcjIsIGkyID0gdGhpcywgbzIgPSBbaTJdLCBhMiA9IC0xOyBpMiA9IG8yLnBvcCgpOyApCiAgICAgICAgICBpZiAodDIuY2FsbChuMiwgaTIsICsrYTIsIHRoaXMpLCBlMiA9IGkyLmNoaWxkcmVuKQogICAgICAgICAgICBmb3IgKHIyID0gZTIubGVuZ3RoIC0gMTsgcjIgPj0gMDsgLS1yMikKICAgICAgICAgICAgICBvMi5wdXNoKGUyW3IyXSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sIGZpbmQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGxldCBlMiA9IC0xOwogICAgICAgIGZvciAoY29uc3QgcjIgb2YgdGhpcykKICAgICAgICAgIGlmICh0Mi5jYWxsKG4yLCByMiwgKytlMiwgdGhpcykpCiAgICAgICAgICAgIHJldHVybiByMjsKICAgICAgfSwgc3VtOiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0aGlzLmVhY2hBZnRlcihmdW5jdGlvbihuMikgewogICAgICAgICAgZm9yICh2YXIgZTIgPSArdDIobjIuZGF0YSkgfHwgMCwgcjIgPSBuMi5jaGlsZHJlbiwgaTIgPSByMiAmJiByMi5sZW5ndGg7IC0taTIgPj0gMDsgKQogICAgICAgICAgICBlMiArPSByMltpMl0udmFsdWU7CiAgICAgICAgICBuMi52YWx1ZSA9IGUyOwogICAgICAgIH0pOwogICAgICB9LCBzb3J0OiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0aGlzLmVhY2hCZWZvcmUoZnVuY3Rpb24objIpIHsKICAgICAgICAgIG4yLmNoaWxkcmVuICYmIG4yLmNoaWxkcmVuLnNvcnQodDIpOwogICAgICAgIH0pOwogICAgICB9LCBwYXRoOiBmdW5jdGlvbih0MikgewogICAgICAgIGZvciAodmFyIG4yID0gdGhpcywgZTIgPSBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIGlmICh0MyA9PT0gbjMpCiAgICAgICAgICAgIHJldHVybiB0MzsKICAgICAgICAgIHZhciBlMyA9IHQzLmFuY2VzdG9ycygpLCByMyA9IG4zLmFuY2VzdG9ycygpLCBpMyA9IG51bGw7CiAgICAgICAgICB0MyA9IGUzLnBvcCgpLCBuMyA9IHIzLnBvcCgpOwogICAgICAgICAgZm9yICg7IHQzID09PSBuMzsgKQogICAgICAgICAgICBpMyA9IHQzLCB0MyA9IGUzLnBvcCgpLCBuMyA9IHIzLnBvcCgpOwogICAgICAgICAgcmV0dXJuIGkzOwogICAgICAgIH0objIsIHQyKSwgcjIgPSBbbjJdOyBuMiAhPT0gZTI7ICkKICAgICAgICAgIG4yID0gbjIucGFyZW50LCByMi5wdXNoKG4yKTsKICAgICAgICBmb3IgKHZhciBpMiA9IHIyLmxlbmd0aDsgdDIgIT09IGUyOyApCiAgICAgICAgICByMi5zcGxpY2UoaTIsIDAsIHQyKSwgdDIgPSB0Mi5wYXJlbnQ7CiAgICAgICAgcmV0dXJuIHIyOwogICAgICB9LCBhbmNlc3RvcnM6IGZ1bmN0aW9uKCkgewogICAgICAgIGZvciAodmFyIHQyID0gdGhpcywgbjIgPSBbdDJdOyB0MiA9IHQyLnBhcmVudDsgKQogICAgICAgICAgbjIucHVzaCh0Mik7CiAgICAgICAgcmV0dXJuIG4yOwogICAgICB9LCBkZXNjZW5kYW50czogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcyk7CiAgICAgIH0sIGxlYXZlczogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyID0gW107CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaEJlZm9yZShmdW5jdGlvbihuMikgewogICAgICAgICAgbjIuY2hpbGRyZW4gfHwgdDIucHVzaChuMik7CiAgICAgICAgfSksIHQyOwogICAgICB9LCBsaW5rczogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyID0gdGhpcywgbjIgPSBbXTsKICAgICAgICByZXR1cm4gdDIuZWFjaChmdW5jdGlvbihlMikgewogICAgICAgICAgZTIgIT09IHQyICYmIG4yLnB1c2goeyBzb3VyY2U6IGUyLnBhcmVudCwgdGFyZ2V0OiBlMiB9KTsKICAgICAgICB9KSwgbjI7CiAgICAgIH0sIGNvcHk6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBHZCh0aGlzKS5lYWNoQmVmb3JlKFpkKTsKICAgICAgfSwgW1N5bWJvbC5pdGVyYXRvcl06IGZ1bmN0aW9uKiAoKSB7CiAgICAgICAgdmFyIHQyLCBuMiwgZTIsIHIyLCBpMiA9IHRoaXMsIG8yID0gW2kyXTsKICAgICAgICBkbyB7CiAgICAgICAgICBmb3IgKHQyID0gbzIucmV2ZXJzZSgpLCBvMiA9IFtdOyBpMiA9IHQyLnBvcCgpOyApCiAgICAgICAgICAgIGlmICh5aWVsZCBpMiwgbjIgPSBpMi5jaGlsZHJlbikKICAgICAgICAgICAgICBmb3IgKGUyID0gMCwgcjIgPSBuMi5sZW5ndGg7IGUyIDwgcjI7ICsrZTIpCiAgICAgICAgICAgICAgICBvMi5wdXNoKG4yW2UyXSk7CiAgICAgICAgfSB3aGlsZSAobzIubGVuZ3RoKTsKICAgICAgfSB9OwogICAgICBjb25zdCBycCA9IDE2NjQ1MjUsIGlwID0gMTAxMzkwNDIyMywgb3AgPSA0Mjk0OTY3Mjk2OwogICAgICBmdW5jdGlvbiBhcCgpIHsKICAgICAgICBsZXQgdDIgPSAxOwogICAgICAgIHJldHVybiAoKSA9PiAodDIgPSAocnAgKiB0MiArIGlwKSAlIG9wKSAvIG9wOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHVwKHQyLCBuMikgewogICAgICAgIGZvciAodmFyIGUyLCByMiwgaTIgPSAwLCBvMiA9ICh0MiA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgbGV0IGUzLCByMywgaTMgPSB0My5sZW5ndGg7CiAgICAgICAgICBmb3IgKDsgaTM7ICkKICAgICAgICAgICAgcjMgPSBuMygpICogaTMtLSB8IDAsIGUzID0gdDNbaTNdLCB0M1tpM10gPSB0M1tyM10sIHQzW3IzXSA9IGUzOwogICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgIH0oQXJyYXkuZnJvbSh0MiksIG4yKSkubGVuZ3RoLCBhMiA9IFtdOyBpMiA8IG8yOyApCiAgICAgICAgICBlMiA9IHQyW2kyXSwgcjIgJiYgc3AocjIsIGUyKSA/ICsraTIgOiAocjIgPSBocChhMiA9IGNwKGEyLCBlMikpLCBpMiA9IDApOwogICAgICAgIHJldHVybiByMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBjcCh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIsIHIyOwogICAgICAgIGlmIChscChuMiwgdDIpKQogICAgICAgICAgcmV0dXJuIFtuMl07CiAgICAgICAgZm9yIChlMiA9IDA7IGUyIDwgdDIubGVuZ3RoOyArK2UyKQogICAgICAgICAgaWYgKGZwKG4yLCB0MltlMl0pICYmIGxwKGRwKHQyW2UyXSwgbjIpLCB0MikpCiAgICAgICAgICAgIHJldHVybiBbdDJbZTJdLCBuMl07CiAgICAgICAgZm9yIChlMiA9IDA7IGUyIDwgdDIubGVuZ3RoIC0gMTsgKytlMikKICAgICAgICAgIGZvciAocjIgPSBlMiArIDE7IHIyIDwgdDIubGVuZ3RoOyArK3IyKQogICAgICAgICAgICBpZiAoZnAoZHAodDJbZTJdLCB0MltyMl0pLCBuMikgJiYgZnAoZHAodDJbZTJdLCBuMiksIHQyW3IyXSkgJiYgZnAoZHAodDJbcjJdLCBuMiksIHQyW2UyXSkgJiYgbHAocHAodDJbZTJdLCB0MltyMl0sIG4yKSwgdDIpKQogICAgICAgICAgICAgIHJldHVybiBbdDJbZTJdLCB0MltyMl0sIG4yXTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBmcCh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSB0Mi5yIC0gbjIuciwgcjIgPSBuMi54IC0gdDIueCwgaTIgPSBuMi55IC0gdDIueTsKICAgICAgICByZXR1cm4gZTIgPCAwIHx8IGUyICogZTIgPCByMiAqIHIyICsgaTIgKiBpMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBzcCh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSB0Mi5yIC0gbjIuciArIDFlLTkgKiBNYXRoLm1heCh0Mi5yLCBuMi5yLCAxKSwgcjIgPSBuMi54IC0gdDIueCwgaTIgPSBuMi55IC0gdDIueTsKICAgICAgICByZXR1cm4gZTIgPiAwICYmIGUyICogZTIgPiByMiAqIHIyICsgaTIgKiBpMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBscCh0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiA9IDA7IGUyIDwgbjIubGVuZ3RoOyArK2UyKQogICAgICAgICAgaWYgKCFzcCh0MiwgbjJbZTJdKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGhwKHQyKSB7CiAgICAgICAgc3dpdGNoICh0Mi5sZW5ndGgpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgeDogdDMueCwgeTogdDMueSwgcjogdDMuciB9OwogICAgICAgICAgICB9KHQyWzBdKTsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuIGRwKHQyWzBdLCB0MlsxXSk7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBwcCh0MlswXSwgdDJbMV0sIHQyWzJdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZHAodDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gdDIueCwgcjIgPSB0Mi55LCBpMiA9IHQyLnIsIG8yID0gbjIueCwgYTIgPSBuMi55LCB1MiA9IG4yLnIsIGMyID0gbzIgLSBlMiwgZjIgPSBhMiAtIHIyLCBzMiA9IHUyIC0gaTIsIGwyID0gTWF0aC5zcXJ0KGMyICogYzIgKyBmMiAqIGYyKTsKICAgICAgICByZXR1cm4geyB4OiAoZTIgKyBvMiArIGMyIC8gbDIgKiBzMikgLyAyLCB5OiAocjIgKyBhMiArIGYyIC8gbDIgKiBzMikgLyAyLCByOiAobDIgKyBpMiArIHUyKSAvIDIgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwcCh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gdDIueCwgaTIgPSB0Mi55LCBvMiA9IHQyLnIsIGEyID0gbjIueCwgdTIgPSBuMi55LCBjMiA9IG4yLnIsIGYyID0gZTIueCwgczIgPSBlMi55LCBsMiA9IGUyLnIsIGgyID0gcjIgLSBhMiwgZDIgPSByMiAtIGYyLCBwMiA9IGkyIC0gdTIsIGcyID0gaTIgLSBzMiwgeTIgPSBjMiAtIG8yLCB2MiA9IGwyIC0gbzIsIF8yID0gcjIgKiByMiArIGkyICogaTIgLSBvMiAqIG8yLCBiMiA9IF8yIC0gYTIgKiBhMiAtIHUyICogdTIgKyBjMiAqIGMyLCBtMiA9IF8yIC0gZjIgKiBmMiAtIHMyICogczIgKyBsMiAqIGwyLCB4MiA9IGQyICogcDIgLSBoMiAqIGcyLCB3MiA9IChwMiAqIG0yIC0gZzIgKiBiMikgLyAoMiAqIHgyKSAtIHIyLCBNMiA9IChnMiAqIHkyIC0gcDIgKiB2MikgLyB4MiwgVDIgPSAoZDIgKiBiMiAtIGgyICogbTIpIC8gKDIgKiB4MikgLSBpMiwgQTIgPSAoaDIgKiB2MiAtIGQyICogeTIpIC8geDIsIFMyID0gTTIgKiBNMiArIEEyICogQTIgLSAxLCBFMiA9IDIgKiAobzIgKyB3MiAqIE0yICsgVDIgKiBBMiksIE4yID0gdzIgKiB3MiArIFQyICogVDIgLSBvMiAqIG8yLCBrMiA9IC0oTWF0aC5hYnMoUzIpID4gMWUtNiA/IChFMiArIE1hdGguc3FydChFMiAqIEUyIC0gNCAqIFMyICogTjIpKSAvICgyICogUzIpIDogTjIgLyBFMik7CiAgICAgICAgcmV0dXJuIHsgeDogcjIgKyB3MiArIE0yICogazIsIHk6IGkyICsgVDIgKyBBMiAqIGsyLCByOiBrMiB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGdwKHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIsIGkyLCBvMiwgYTIsIHUyID0gdDIueCAtIG4yLngsIGMyID0gdDIueSAtIG4yLnksIGYyID0gdTIgKiB1MiArIGMyICogYzI7CiAgICAgICAgZjIgPyAoaTIgPSBuMi5yICsgZTIuciwgaTIgKj0gaTIsIGEyID0gdDIuciArIGUyLnIsIGkyID4gKGEyICo9IGEyKSA/IChyMiA9IChmMiArIGEyIC0gaTIpIC8gKDIgKiBmMiksIG8yID0gTWF0aC5zcXJ0KE1hdGgubWF4KDAsIGEyIC8gZjIgLSByMiAqIHIyKSksIGUyLnggPSB0Mi54IC0gcjIgKiB1MiAtIG8yICogYzIsIGUyLnkgPSB0Mi55IC0gcjIgKiBjMiArIG8yICogdTIpIDogKHIyID0gKGYyICsgaTIgLSBhMikgLyAoMiAqIGYyKSwgbzIgPSBNYXRoLnNxcnQoTWF0aC5tYXgoMCwgaTIgLyBmMiAtIHIyICogcjIpKSwgZTIueCA9IG4yLnggKyByMiAqIHUyIC0gbzIgKiBjMiwgZTIueSA9IG4yLnkgKyByMiAqIGMyICsgbzIgKiB1MikpIDogKGUyLnggPSBuMi54ICsgZTIuciwgZTIueSA9IG4yLnkpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHlwKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IHQyLnIgKyBuMi5yIC0gMWUtNiwgcjIgPSBuMi54IC0gdDIueCwgaTIgPSBuMi55IC0gdDIueTsKICAgICAgICByZXR1cm4gZTIgPiAwICYmIGUyICogZTIgPiByMiAqIHIyICsgaTIgKiBpMjsKICAgICAgfQogICAgICBmdW5jdGlvbiB2cCh0MikgewogICAgICAgIHZhciBuMiA9IHQyLl8sIGUyID0gdDIubmV4dC5fLCByMiA9IG4yLnIgKyBlMi5yLCBpMiA9IChuMi54ICogZTIuciArIGUyLnggKiBuMi5yKSAvIHIyLCBvMiA9IChuMi55ICogZTIuciArIGUyLnkgKiBuMi5yKSAvIHIyOwogICAgICAgIHJldHVybiBpMiAqIGkyICsgbzIgKiBvMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBfcCh0MikgewogICAgICAgIHRoaXMuXyA9IHQyLCB0aGlzLm5leHQgPSBudWxsLCB0aGlzLnByZXZpb3VzID0gbnVsbDsKICAgICAgfQogICAgICBmdW5jdGlvbiBicCh0MiwgbjIpIHsKICAgICAgICBpZiAoIShvMiA9ICh0MiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gIm9iamVjdCIgPT0gdHlwZW9mIHQzICYmICJsZW5ndGgiIGluIHQzID8gdDMgOiBBcnJheS5mcm9tKHQzKTsKICAgICAgICB9KHQyKSkubGVuZ3RoKSkKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIHZhciBlMiwgcjIsIGkyLCBvMiwgYTIsIHUyLCBjMiwgZjIsIHMyLCBsMiwgaDI7CiAgICAgICAgaWYgKChlMiA9IHQyWzBdKS54ID0gMCwgZTIueSA9IDAsICEobzIgPiAxKSkKICAgICAgICAgIHJldHVybiBlMi5yOwogICAgICAgIGlmIChyMiA9IHQyWzFdLCBlMi54ID0gLXIyLnIsIHIyLnggPSBlMi5yLCByMi55ID0gMCwgIShvMiA+IDIpKQogICAgICAgICAgcmV0dXJuIGUyLnIgKyByMi5yOwogICAgICAgIGdwKHIyLCBlMiwgaTIgPSB0MlsyXSksIGUyID0gbmV3IF9wKGUyKSwgcjIgPSBuZXcgX3AocjIpLCBpMiA9IG5ldyBfcChpMiksIGUyLm5leHQgPSBpMi5wcmV2aW91cyA9IHIyLCByMi5uZXh0ID0gZTIucHJldmlvdXMgPSBpMiwgaTIubmV4dCA9IHIyLnByZXZpb3VzID0gZTI7CiAgICAgICAgdDoKICAgICAgICAgIGZvciAoYzIgPSAzOyBjMiA8IG8yOyArK2MyKSB7CiAgICAgICAgICAgIGdwKGUyLl8sIHIyLl8sIGkyID0gdDJbYzJdKSwgaTIgPSBuZXcgX3AoaTIpLCBmMiA9IHIyLm5leHQsIHMyID0gZTIucHJldmlvdXMsIGwyID0gcjIuXy5yLCBoMiA9IGUyLl8ucjsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGlmIChsMiA8PSBoMikgewogICAgICAgICAgICAgICAgaWYgKHlwKGYyLl8sIGkyLl8pKSB7CiAgICAgICAgICAgICAgICAgIHIyID0gZjIsIGUyLm5leHQgPSByMiwgcjIucHJldmlvdXMgPSBlMiwgLS1jMjsKICAgICAgICAgICAgICAgICAgY29udGludWUgdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGwyICs9IGYyLl8uciwgZjIgPSBmMi5uZXh0OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoeXAoczIuXywgaTIuXykpIHsKICAgICAgICAgICAgICAgICAgKGUyID0gczIpLm5leHQgPSByMiwgcjIucHJldmlvdXMgPSBlMiwgLS1jMjsKICAgICAgICAgICAgICAgICAgY29udGludWUgdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGgyICs9IHMyLl8uciwgczIgPSBzMi5wcmV2aW91czsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gd2hpbGUgKGYyICE9PSBzMi5uZXh0KTsKICAgICAgICAgICAgZm9yIChpMi5wcmV2aW91cyA9IGUyLCBpMi5uZXh0ID0gcjIsIGUyLm5leHQgPSByMi5wcmV2aW91cyA9IHIyID0gaTIsIGEyID0gdnAoZTIpOyAoaTIgPSBpMi5uZXh0KSAhPT0gcjI7ICkKICAgICAgICAgICAgICAodTIgPSB2cChpMikpIDwgYTIgJiYgKGUyID0gaTIsIGEyID0gdTIpOwogICAgICAgICAgICByMiA9IGUyLm5leHQ7CiAgICAgICAgICB9CiAgICAgICAgZm9yIChlMiA9IFtyMi5fXSwgaTIgPSByMjsgKGkyID0gaTIubmV4dCkgIT09IHIyOyApCiAgICAgICAgICBlMi5wdXNoKGkyLl8pOwogICAgICAgIGZvciAoaTIgPSB1cChlMiwgbjIpLCBjMiA9IDA7IGMyIDwgbzI7ICsrYzIpCiAgICAgICAgICAoZTIgPSB0MltjMl0pLnggLT0gaTIueCwgZTIueSAtPSBpMi55OwogICAgICAgIHJldHVybiBpMi5yOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1wKHQyKSB7CiAgICAgICAgcmV0dXJuIE1hdGguc3FydCh0Mi52YWx1ZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24geHAodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24objIpIHsKICAgICAgICAgIG4yLmNoaWxkcmVuIHx8IChuMi5yID0gTWF0aC5tYXgoMCwgK3QyKG4yKSB8fCAwKSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiB3cCh0MiwgbjIsIGUyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHIyKSB7CiAgICAgICAgICBpZiAoaTIgPSByMi5jaGlsZHJlbikgewogICAgICAgICAgICB2YXIgaTIsIG8yLCBhMiwgdTIgPSBpMi5sZW5ndGgsIGMyID0gdDIocjIpICogbjIgfHwgMDsKICAgICAgICAgICAgaWYgKGMyKQogICAgICAgICAgICAgIGZvciAobzIgPSAwOyBvMiA8IHUyOyArK28yKQogICAgICAgICAgICAgICAgaTJbbzJdLnIgKz0gYzI7CiAgICAgICAgICAgIGlmIChhMiA9IGJwKGkyLCBlMiksIGMyKQogICAgICAgICAgICAgIGZvciAobzIgPSAwOyBvMiA8IHUyOyArK28yKQogICAgICAgICAgICAgICAgaTJbbzJdLnIgLT0gYzI7CiAgICAgICAgICAgIHIyLnIgPSBhMiArIGMyOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTXAodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24objIpIHsKICAgICAgICAgIHZhciBlMiA9IG4yLnBhcmVudDsKICAgICAgICAgIG4yLnIgKj0gdDIsIGUyICYmIChuMi54ID0gZTIueCArIHQyICogbjIueCwgbjIueSA9IGUyLnkgKyB0MiAqIG4yLnkpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHAodDIpIHsKICAgICAgICB0Mi54MCA9IE1hdGgucm91bmQodDIueDApLCB0Mi55MCA9IE1hdGgucm91bmQodDIueTApLCB0Mi54MSA9IE1hdGgucm91bmQodDIueDEpLCB0Mi55MSA9IE1hdGgucm91bmQodDIueTEpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEFwKHQyLCBuMiwgZTIsIHIyLCBpMikgewogICAgICAgIGZvciAodmFyIG8yLCBhMiA9IHQyLmNoaWxkcmVuLCB1MiA9IC0xLCBjMiA9IGEyLmxlbmd0aCwgZjIgPSB0Mi52YWx1ZSAmJiAocjIgLSBuMikgLyB0Mi52YWx1ZTsgKyt1MiA8IGMyOyApCiAgICAgICAgICAobzIgPSBhMlt1Ml0pLnkwID0gZTIsIG8yLnkxID0gaTIsIG8yLngwID0gbjIsIG8yLngxID0gbjIgKz0gbzIudmFsdWUgKiBmMjsKICAgICAgfQogICAgICB2YXIgU3AgPSB7IGRlcHRoOiAtMSB9LCBFcCA9IHt9LCBOcCA9IHt9OwogICAgICBmdW5jdGlvbiBrcCh0MikgewogICAgICAgIHJldHVybiB0Mi5pZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBDcCh0MikgewogICAgICAgIHJldHVybiB0Mi5wYXJlbnRJZDsKICAgICAgfQogICAgICBmdW5jdGlvbiBQcCh0MikgewogICAgICAgIGxldCBuMiA9IHQyLmxlbmd0aDsKICAgICAgICBpZiAobjIgPCAyKQogICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIGZvciAoOyAtLW4yID4gMSAmJiAhenAodDIsIG4yKTsgKQogICAgICAgICAgOwogICAgICAgIHJldHVybiB0Mi5zbGljZSgwLCBuMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24genAodDIsIG4yKSB7CiAgICAgICAgaWYgKCIvIiA9PT0gdDJbbjJdKSB7CiAgICAgICAgICBsZXQgZTIgPSAwOwogICAgICAgICAgZm9yICg7IG4yID4gMCAmJiAiXFwiID09PSB0MlstLW4yXTsgKQogICAgICAgICAgICArK2UyOwogICAgICAgICAgaWYgKDAgPT0gKDEgJiBlMikpCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gJHAodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHQyLnBhcmVudCA9PT0gbjIucGFyZW50ID8gMSA6IDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRHAodDIpIHsKICAgICAgICB2YXIgbjIgPSB0Mi5jaGlsZHJlbjsKICAgICAgICByZXR1cm4gbjIgPyBuMlswXSA6IHQyLnQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUnAodDIpIHsKICAgICAgICB2YXIgbjIgPSB0Mi5jaGlsZHJlbjsKICAgICAgICByZXR1cm4gbjIgPyBuMltuMi5sZW5ndGggLSAxXSA6IHQyLnQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRnAodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGUyIC8gKG4yLmkgLSB0Mi5pKTsKICAgICAgICBuMi5jIC09IHIyLCBuMi5zICs9IGUyLCB0Mi5jICs9IHIyLCBuMi56ICs9IGUyLCBuMi5tICs9IGUyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHFwKHQyLCBuMiwgZTIpIHsKICAgICAgICByZXR1cm4gdDIuYS5wYXJlbnQgPT09IG4yLnBhcmVudCA/IHQyLmEgOiBlMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBVcCh0MiwgbjIpIHsKICAgICAgICB0aGlzLl8gPSB0MiwgdGhpcy5wYXJlbnQgPSBudWxsLCB0aGlzLmNoaWxkcmVuID0gbnVsbCwgdGhpcy5BID0gbnVsbCwgdGhpcy5hID0gdGhpcywgdGhpcy56ID0gMCwgdGhpcy5tID0gMCwgdGhpcy5jID0gMCwgdGhpcy5zID0gMCwgdGhpcy50ID0gbnVsbCwgdGhpcy5pID0gbjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXAodDIsIG4yLCBlMiwgcjIsIGkyKSB7CiAgICAgICAgZm9yICh2YXIgbzIsIGEyID0gdDIuY2hpbGRyZW4sIHUyID0gLTEsIGMyID0gYTIubGVuZ3RoLCBmMiA9IHQyLnZhbHVlICYmIChpMiAtIGUyKSAvIHQyLnZhbHVlOyArK3UyIDwgYzI7ICkKICAgICAgICAgIChvMiA9IGEyW3UyXSkueDAgPSBuMiwgbzIueDEgPSByMiwgbzIueTAgPSBlMiwgbzIueTEgPSBlMiArPSBvMi52YWx1ZSAqIGYyOwogICAgICB9CiAgICAgIFVwLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoUWQucHJvdG90eXBlKTsKICAgICAgdmFyIE9wID0gKDEgKyBNYXRoLnNxcnQoNSkpIC8gMjsKICAgICAgZnVuY3Rpb24gQnAodDIsIG4yLCBlMiwgcjIsIGkyLCBvMikgewogICAgICAgIGZvciAodmFyIGEyLCB1MiwgYzIsIGYyLCBzMiwgbDIsIGgyLCBkMiwgcDIsIGcyLCB5MiwgdjIgPSBbXSwgXzIgPSBuMi5jaGlsZHJlbiwgYjIgPSAwLCBtMiA9IDAsIHgyID0gXzIubGVuZ3RoLCB3MiA9IG4yLnZhbHVlOyBiMiA8IHgyOyApIHsKICAgICAgICAgIGMyID0gaTIgLSBlMiwgZjIgPSBvMiAtIHIyOwogICAgICAgICAgZG8gewogICAgICAgICAgICBzMiA9IF8yW20yKytdLnZhbHVlOwogICAgICAgICAgfSB3aGlsZSAoIXMyICYmIG0yIDwgeDIpOwogICAgICAgICAgZm9yIChsMiA9IGgyID0gczIsIHkyID0gczIgKiBzMiAqIChnMiA9IE1hdGgubWF4KGYyIC8gYzIsIGMyIC8gZjIpIC8gKHcyICogdDIpKSwgcDIgPSBNYXRoLm1heChoMiAvIHkyLCB5MiAvIGwyKTsgbTIgPCB4MjsgKyttMikgewogICAgICAgICAgICBpZiAoczIgKz0gdTIgPSBfMlttMl0udmFsdWUsIHUyIDwgbDIgJiYgKGwyID0gdTIpLCB1MiA+IGgyICYmIChoMiA9IHUyKSwgeTIgPSBzMiAqIHMyICogZzIsIChkMiA9IE1hdGgubWF4KGgyIC8geTIsIHkyIC8gbDIpKSA+IHAyKSB7CiAgICAgICAgICAgICAgczIgLT0gdTI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcDIgPSBkMjsKICAgICAgICAgIH0KICAgICAgICAgIHYyLnB1c2goYTIgPSB7IHZhbHVlOiBzMiwgZGljZTogYzIgPCBmMiwgY2hpbGRyZW46IF8yLnNsaWNlKGIyLCBtMikgfSksIGEyLmRpY2UgPyBBcChhMiwgZTIsIHIyLCBpMiwgdzIgPyByMiArPSBmMiAqIHMyIC8gdzIgOiBvMikgOiBJcChhMiwgZTIsIHIyLCB3MiA/IGUyICs9IGMyICogczIgLyB3MiA6IGkyLCBvMiksIHcyIC09IHMyLCBiMiA9IG0yOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdjI7CiAgICAgIH0KICAgICAgdmFyIFlwID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MywgZTMsIHIyLCBpMiwgbzIpIHsKICAgICAgICAgIEJwKG4yLCB0MywgZTMsIHIyLCBpMiwgbzIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZTIucmF0aW8gPSBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIHQyKChuMyA9ICtuMykgPiAxID8gbjMgOiAxKTsKICAgICAgICB9LCBlMjsKICAgICAgfShPcCk7CiAgICAgIHZhciBMcCA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgZnVuY3Rpb24gZTIodDMsIGUzLCByMiwgaTIsIG8yKSB7CiAgICAgICAgICBpZiAoKGEyID0gdDMuX3NxdWFyaWZ5KSAmJiBhMi5yYXRpbyA9PT0gbjIpCiAgICAgICAgICAgIGZvciAodmFyIGEyLCB1MiwgYzIsIGYyLCBzMiwgbDIgPSAtMSwgaDIgPSBhMi5sZW5ndGgsIGQyID0gdDMudmFsdWU7ICsrbDIgPCBoMjsgKSB7CiAgICAgICAgICAgICAgZm9yIChjMiA9ICh1MiA9IGEyW2wyXSkuY2hpbGRyZW4sIGYyID0gdTIudmFsdWUgPSAwLCBzMiA9IGMyLmxlbmd0aDsgZjIgPCBzMjsgKytmMikKICAgICAgICAgICAgICAgIHUyLnZhbHVlICs9IGMyW2YyXS52YWx1ZTsKICAgICAgICAgICAgICB1Mi5kaWNlID8gQXAodTIsIGUzLCByMiwgaTIsIGQyID8gcjIgKz0gKG8yIC0gcjIpICogdTIudmFsdWUgLyBkMiA6IG8yKSA6IElwKHUyLCBlMywgcjIsIGQyID8gZTMgKz0gKGkyIC0gZTMpICogdTIudmFsdWUgLyBkMiA6IGkyLCBvMiksIGQyIC09IHUyLnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHQzLl9zcXVhcmlmeSA9IGEyID0gQnAobjIsIHQzLCBlMywgcjIsIGkyLCBvMiksIGEyLnJhdGlvID0gbjI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlMi5yYXRpbyA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gdDIoKG4zID0gK24zKSA+IDEgPyBuMyA6IDEpOwogICAgICAgIH0sIGUyOwogICAgICB9KE9wKTsKICAgICAgZnVuY3Rpb24ganAodDIsIG4yLCBlMikgewogICAgICAgIHJldHVybiAobjJbMF0gLSB0MlswXSkgKiAoZTJbMV0gLSB0MlsxXSkgLSAobjJbMV0gLSB0MlsxXSkgKiAoZTJbMF0gLSB0MlswXSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSHAodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIHQyWzBdIC0gbjJbMF0gfHwgdDJbMV0gLSBuMlsxXTsKICAgICAgfQogICAgICBmdW5jdGlvbiBYcCh0MikgewogICAgICAgIGNvbnN0IG4yID0gdDIubGVuZ3RoLCBlMiA9IFswLCAxXTsKICAgICAgICBsZXQgcjIsIGkyID0gMjsKICAgICAgICBmb3IgKHIyID0gMjsgcjIgPCBuMjsgKytyMikgewogICAgICAgICAgZm9yICg7IGkyID4gMSAmJiBqcCh0MltlMltpMiAtIDJdXSwgdDJbZTJbaTIgLSAxXV0sIHQyW3IyXSkgPD0gMDsgKQogICAgICAgICAgICAtLWkyOwogICAgICAgICAgZTJbaTIrK10gPSByMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLnNsaWNlKDAsIGkyKTsKICAgICAgfQogICAgICB2YXIgR3AgPSBNYXRoLnJhbmRvbSwgVnAgPSBmdW5jdGlvbiB0MihuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKHQzLCBlMykgewogICAgICAgICAgcmV0dXJuIHQzID0gbnVsbCA9PSB0MyA/IDAgOiArdDMsIGUzID0gbnVsbCA9PSBlMyA/IDEgOiArZTMsIDEgPT09IGFyZ3VtZW50cy5sZW5ndGggPyAoZTMgPSB0MywgdDMgPSAwKSA6IGUzIC09IHQzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG4yKCkgKiBlMyArIHQzOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLnNvdXJjZSA9IHQyLCBlMjsKICAgICAgfShHcCksIFdwID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MywgZTMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoIDwgMiAmJiAoZTMgPSB0MywgdDMgPSAwKSwgdDMgPSBNYXRoLmZsb29yKHQzKSwgZTMgPSBNYXRoLmZsb29yKGUzKSAtIHQzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IobjIoKSAqIGUzICsgdDMpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLnNvdXJjZSA9IHQyLCBlMjsKICAgICAgfShHcCksIFpwID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MywgZTMpIHsKICAgICAgICAgIHZhciByMiwgaTI7CiAgICAgICAgICByZXR1cm4gdDMgPSBudWxsID09IHQzID8gMCA6ICt0MywgZTMgPSBudWxsID09IGUzID8gMSA6ICtlMywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBvMjsKICAgICAgICAgICAgaWYgKG51bGwgIT0gcjIpCiAgICAgICAgICAgICAgbzIgPSByMiwgcjIgPSBudWxsOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgcjIgPSAyICogbjIoKSAtIDEsIG8yID0gMiAqIG4yKCkgLSAxLCBpMiA9IHIyICogcjIgKyBvMiAqIG8yOwogICAgICAgICAgICAgIH0gd2hpbGUgKCFpMiB8fCBpMiA+IDEpOwogICAgICAgICAgICByZXR1cm4gdDMgKyBlMyAqIG8yICogTWF0aC5zcXJ0KC0yICogTWF0aC5sb2coaTIpIC8gaTIpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLnNvdXJjZSA9IHQyLCBlMjsKICAgICAgfShHcCksIEtwID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICB2YXIgZTIgPSBacC5zb3VyY2UobjIpOwogICAgICAgIGZ1bmN0aW9uIHIyKCkgewogICAgICAgICAgdmFyIHQzID0gZTIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguZXhwKHQzKCkpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHIyLnNvdXJjZSA9IHQyLCByMjsKICAgICAgfShHcCksIFFwID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MykgewogICAgICAgICAgcmV0dXJuICh0MyA9ICt0MykgPD0gMCA/ICgpID0+IDAgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgZTMgPSAwLCByMiA9IHQzOyByMiA+IDE7IC0tcjIpCiAgICAgICAgICAgICAgZTMgKz0gbjIoKTsKICAgICAgICAgICAgcmV0dXJuIGUzICsgcjIgKiBuMigpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLnNvdXJjZSA9IHQyLCBlMjsKICAgICAgfShHcCksIEpwID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICB2YXIgZTIgPSBRcC5zb3VyY2UobjIpOwogICAgICAgIGZ1bmN0aW9uIHIyKHQzKSB7CiAgICAgICAgICBpZiAoMCA9PSAodDMgPSArdDMpKQogICAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgICB2YXIgcjMgPSBlMih0Myk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiByMygpIC8gdDM7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjIuc291cmNlID0gdDIsIHIyOwogICAgICB9KEdwKSwgdGcgPSBmdW5jdGlvbiB0MihuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKHQzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAtTWF0aC5sb2cxcCgtbjIoKSkgLyB0MzsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBlMi5zb3VyY2UgPSB0MiwgZTI7CiAgICAgIH0oR3ApLCBuZyA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgZnVuY3Rpb24gZTIodDMpIHsKICAgICAgICAgIGlmICgodDMgPSArdDMpIDwgMCkKICAgICAgICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoImludmFsaWQgYWxwaGEiKTsKICAgICAgICAgIHJldHVybiB0MyA9IDEgLyAtdDMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5wb3coMSAtIG4yKCksIHQzKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBlMi5zb3VyY2UgPSB0MiwgZTI7CiAgICAgIH0oR3ApLCBlZyA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgZnVuY3Rpb24gZTIodDMpIHsKICAgICAgICAgIGlmICgodDMgPSArdDMpIDwgMCB8fCB0MyA+IDEpCiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIHAiKTsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IobjIoKSArIHQzKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBlMi5zb3VyY2UgPSB0MiwgZTI7CiAgICAgIH0oR3ApLCByZyA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgZnVuY3Rpb24gZTIodDMpIHsKICAgICAgICAgIGlmICgodDMgPSArdDMpIDwgMCB8fCB0MyA+IDEpCiAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIHAiKTsKICAgICAgICAgIHJldHVybiAwID09PSB0MyA/ICgpID0+IDEgLyAwIDogMSA9PT0gdDMgPyAoKSA9PiAxIDogKHQzID0gTWF0aC5sb2cxcCgtdDMpLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIDEgKyBNYXRoLmZsb29yKE1hdGgubG9nMXAoLW4yKCkpIC8gdDMpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlMi5zb3VyY2UgPSB0MiwgZTI7CiAgICAgIH0oR3ApLCBpZyA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgdmFyIGUyID0gWnAuc291cmNlKG4yKSgpOwogICAgICAgIGZ1bmN0aW9uIHIyKHQzLCByMykgewogICAgICAgICAgaWYgKCh0MyA9ICt0MykgPCAwKQogICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCBrIik7CiAgICAgICAgICBpZiAoMCA9PT0gdDMpCiAgICAgICAgICAgIHJldHVybiAoKSA9PiAwOwogICAgICAgICAgaWYgKHIzID0gbnVsbCA9PSByMyA/IDEgOiArcjMsIDEgPT09IHQzKQogICAgICAgICAgICByZXR1cm4gKCkgPT4gLU1hdGgubG9nMXAoLW4yKCkpICogcjM7CiAgICAgICAgICB2YXIgaTIgPSAodDMgPCAxID8gdDMgKyAxIDogdDMpIC0gMSAvIDMsIG8yID0gMSAvICgzICogTWF0aC5zcXJ0KGkyKSksIGEyID0gdDMgPCAxID8gKCkgPT4gTWF0aC5wb3cobjIoKSwgMSAvIHQzKSA6ICgpID0+IDE7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICB2YXIgdDQgPSBlMigpLCB1MiA9IDEgKyBvMiAqIHQ0OwogICAgICAgICAgICAgIH0gd2hpbGUgKHUyIDw9IDApOwogICAgICAgICAgICAgIHUyICo9IHUyICogdTI7CiAgICAgICAgICAgICAgdmFyIGMyID0gMSAtIG4yKCk7CiAgICAgICAgICAgIH0gd2hpbGUgKGMyID49IDEgLSAwLjAzMzEgKiB0NCAqIHQ0ICogdDQgKiB0NCAmJiBNYXRoLmxvZyhjMikgPj0gMC41ICogdDQgKiB0NCArIGkyICogKDEgLSB1MiArIE1hdGgubG9nKHUyKSkpOwogICAgICAgICAgICByZXR1cm4gaTIgKiB1MiAqIGEyKCkgKiByMzsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiByMi5zb3VyY2UgPSB0MiwgcjI7CiAgICAgIH0oR3ApLCBvZyA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgdmFyIGUyID0gaWcuc291cmNlKG4yKTsKICAgICAgICBmdW5jdGlvbiByMih0MywgbjMpIHsKICAgICAgICAgIHZhciByMyA9IGUyKHQzKSwgaTIgPSBlMihuMyk7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB0NCA9IHIzKCk7CiAgICAgICAgICAgIHJldHVybiAwID09PSB0NCA/IDAgOiB0NCAvICh0NCArIGkyKCkpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHIyLnNvdXJjZSA9IHQyLCByMjsKICAgICAgfShHcCksIGFnID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICB2YXIgZTIgPSByZy5zb3VyY2UobjIpLCByMiA9IG9nLnNvdXJjZShuMik7CiAgICAgICAgZnVuY3Rpb24gaTIodDMsIG4zKSB7CiAgICAgICAgICByZXR1cm4gdDMgPSArdDMsIChuMyA9ICtuMykgPj0gMSA/ICgpID0+IHQzIDogbjMgPD0gMCA/ICgpID0+IDAgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgaTMgPSAwLCBvMiA9IHQzLCBhMiA9IG4zOyBvMiAqIGEyID4gMTYgJiYgbzIgKiAoMSAtIGEyKSA+IDE2OyApIHsKICAgICAgICAgICAgICB2YXIgdTIgPSBNYXRoLmZsb29yKChvMiArIDEpICogYTIpLCBjMiA9IHIyKHUyLCBvMiAtIHUyICsgMSkoKTsKICAgICAgICAgICAgICBjMiA8PSBhMiA/IChpMyArPSB1MiwgbzIgLT0gdTIsIGEyID0gKGEyIC0gYzIpIC8gKDEgLSBjMikpIDogKG8yID0gdTIgLSAxLCBhMiAvPSBjMik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yICh2YXIgZjIgPSBhMiA8IDAuNSwgczIgPSBlMihmMiA/IGEyIDogMSAtIGEyKSwgbDIgPSBzMigpLCBoMiA9IDA7IGwyIDw9IG8yOyArK2gyKQogICAgICAgICAgICAgIGwyICs9IHMyKCk7CiAgICAgICAgICAgIHJldHVybiBpMyArIChmMiA/IGgyIDogbzIgLSBoMik7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuc291cmNlID0gdDIsIGkyOwogICAgICB9KEdwKSwgdWcgPSBmdW5jdGlvbiB0MihuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKHQzLCBlMywgcjIpIHsKICAgICAgICAgIHZhciBpMjsKICAgICAgICAgIHJldHVybiAwID09ICh0MyA9ICt0MykgPyBpMiA9ICh0NCkgPT4gLU1hdGgubG9nKHQ0KSA6ICh0MyA9IDEgLyB0MywgaTIgPSAobjMpID0+IE1hdGgucG93KG4zLCB0MykpLCBlMyA9IG51bGwgPT0gZTMgPyAwIDogK2UzLCByMiA9IG51bGwgPT0gcjIgPyAxIDogK3IyLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGUzICsgcjIgKiBpMigtTWF0aC5sb2cxcCgtbjIoKSkpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLnNvdXJjZSA9IHQyLCBlMjsKICAgICAgfShHcCksIGNnID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MywgZTMpIHsKICAgICAgICAgIHJldHVybiB0MyA9IG51bGwgPT0gdDMgPyAwIDogK3QzLCBlMyA9IG51bGwgPT0gZTMgPyAxIDogK2UzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHQzICsgZTMgKiBNYXRoLnRhbihNYXRoLlBJICogbjIoKSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gZTIuc291cmNlID0gdDIsIGUyOwogICAgICB9KEdwKSwgZmcgPSBmdW5jdGlvbiB0MihuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKHQzLCBlMykgewogICAgICAgICAgcmV0dXJuIHQzID0gbnVsbCA9PSB0MyA/IDAgOiArdDMsIGUzID0gbnVsbCA9PSBlMyA/IDEgOiArZTMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgcjIgPSBuMigpOwogICAgICAgICAgICByZXR1cm4gdDMgKyBlMyAqIE1hdGgubG9nKHIyIC8gKDEgLSByMikpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLnNvdXJjZSA9IHQyLCBlMjsKICAgICAgfShHcCksIHNnID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICB2YXIgZTIgPSBpZy5zb3VyY2UobjIpLCByMiA9IGFnLnNvdXJjZShuMik7CiAgICAgICAgZnVuY3Rpb24gaTIodDMpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgaTMgPSAwLCBvMiA9IHQzOyBvMiA+IDE2OyApIHsKICAgICAgICAgICAgICB2YXIgYTIgPSBNYXRoLmZsb29yKDAuODc1ICogbzIpLCB1MiA9IGUyKGEyKSgpOwogICAgICAgICAgICAgIGlmICh1MiA+IG8yKQogICAgICAgICAgICAgICAgcmV0dXJuIGkzICsgcjIoYTIgLSAxLCBvMiAvIHUyKSgpOwogICAgICAgICAgICAgIGkzICs9IGEyLCBvMiAtPSB1MjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKHZhciBjMiA9IC1NYXRoLmxvZzFwKC1uMigpKSwgZjIgPSAwOyBjMiA8PSBvMjsgKytmMikKICAgICAgICAgICAgICBjMiAtPSBNYXRoLmxvZzFwKC1uMigpKTsKICAgICAgICAgICAgcmV0dXJuIGkzICsgZjI7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuc291cmNlID0gdDIsIGkyOwogICAgICB9KEdwKTsKICAgICAgY29uc3QgbGcgPSAxIC8gNDI5NDk2NzI5NjsKICAgICAgZnVuY3Rpb24gaGcodDIsIG4yKSB7CiAgICAgICAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0aGlzLnJhbmdlKHQyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aGlzLnJhbmdlKG4yKS5kb21haW4odDIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBmdW5jdGlvbiBkZyh0MiwgbjIpIHsKICAgICAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQyID8gdGhpcy5pbnRlcnBvbGF0b3IodDIpIDogdGhpcy5yYW5nZSh0Mik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhpcy5kb21haW4odDIpLCAiZnVuY3Rpb24iID09IHR5cGVvZiBuMiA/IHRoaXMuaW50ZXJwb2xhdG9yKG4yKSA6IHRoaXMucmFuZ2UobjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBjb25zdCBwZyA9IFN5bWJvbCgiaW1wbGljaXQiKTsKICAgICAgZnVuY3Rpb24gZ2coKSB7CiAgICAgICAgdmFyIHQyID0gbmV3IEludGVybk1hcCgpLCBuMiA9IFtdLCBlMiA9IFtdLCByMiA9IHBnOwogICAgICAgIGZ1bmN0aW9uIGkyKGkzKSB7CiAgICAgICAgICBsZXQgbzIgPSB0Mi5nZXQoaTMpOwogICAgICAgICAgaWYgKHZvaWQgMCA9PT0gbzIpIHsKICAgICAgICAgICAgaWYgKHIyICE9PSBwZykKICAgICAgICAgICAgICByZXR1cm4gcjI7CiAgICAgICAgICAgIHQyLnNldChpMywgbzIgPSBuMi5wdXNoKGkzKSAtIDEpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGUyW28yICUgZTIubGVuZ3RoXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGkyLmRvbWFpbiA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBuMi5zbGljZSgpOwogICAgICAgICAgbjIgPSBbXSwgdDIgPSBuZXcgSW50ZXJuTWFwKCk7CiAgICAgICAgICBmb3IgKGNvbnN0IHIzIG9mIGUzKQogICAgICAgICAgICB0Mi5oYXMocjMpIHx8IHQyLnNldChyMywgbjIucHVzaChyMykgLSAxKTsKICAgICAgICAgIHJldHVybiBpMjsKICAgICAgICB9LCBpMi5yYW5nZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9IEFycmF5LmZyb20odDMpLCBpMikgOiBlMi5zbGljZSgpOwogICAgICAgIH0sIGkyLnVua25vd24gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSB0MywgaTIpIDogcjI7CiAgICAgICAgfSwgaTIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGdnKG4yLCBlMikudW5rbm93bihyMik7CiAgICAgICAgfSwgaGcuYXBwbHkoaTIsIGFyZ3VtZW50cyksIGkyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHlnKCkgewogICAgICAgIHZhciB0MiwgbjIsIGUyID0gZ2coKS51bmtub3duKHZvaWQgMCksIHIyID0gZTIuZG9tYWluLCBpMiA9IGUyLnJhbmdlLCBvMiA9IDAsIGEyID0gMSwgdTIgPSBmYWxzZSwgYzIgPSAwLCBmMiA9IDAsIHMyID0gMC41OwogICAgICAgIGZ1bmN0aW9uIGwyKCkgewogICAgICAgICAgdmFyIGUzID0gcjIoKS5sZW5ndGgsIGwzID0gYTIgPCBvMiwgaDIgPSBsMyA/IGEyIDogbzIsIGQyID0gbDMgPyBvMiA6IGEyOwogICAgICAgICAgdDIgPSAoZDIgLSBoMikgLyBNYXRoLm1heCgxLCBlMyAtIGMyICsgMiAqIGYyKSwgdTIgJiYgKHQyID0gTWF0aC5mbG9vcih0MikpLCBoMiArPSAoZDIgLSBoMiAtIHQyICogKGUzIC0gYzIpKSAqIHMyLCBuMiA9IHQyICogKDEgLSBjMiksIHUyICYmIChoMiA9IE1hdGgucm91bmQoaDIpLCBuMiA9IE1hdGgucm91bmQobjIpKTsKICAgICAgICAgIHZhciBwMiA9IGx0KGUzKS5tYXAoZnVuY3Rpb24objMpIHsKICAgICAgICAgICAgcmV0dXJuIGgyICsgdDIgKiBuMzsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIGkyKGwzID8gcDIucmV2ZXJzZSgpIDogcDIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVsZXRlIGUyLnVua25vd24sIGUyLmRvbWFpbiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyMih0MyksIGwyKCkpIDogcjIoKTsKICAgICAgICB9LCBlMi5yYW5nZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChbbzIsIGEyXSA9IHQzLCBvMiA9ICtvMiwgYTIgPSArYTIsIGwyKCkpIDogW28yLCBhMl07CiAgICAgICAgfSwgZTIucmFuZ2VSb3VuZCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gW28yLCBhMl0gPSB0MywgbzIgPSArbzIsIGEyID0gK2EyLCB1MiA9IHRydWUsIGwyKCk7CiAgICAgICAgfSwgZTIuYmFuZHdpZHRoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbjI7CiAgICAgICAgfSwgZTIuc3RlcCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIH0sIGUyLnJvdW5kID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHUyID0gISF0MywgbDIoKSkgOiB1MjsKICAgICAgICB9LCBlMi5wYWRkaW5nID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGMyID0gTWF0aC5taW4oMSwgZjIgPSArdDMpLCBsMigpKSA6IGMyOwogICAgICAgIH0sIGUyLnBhZGRpbmdJbm5lciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjMiA9IE1hdGgubWluKDEsIHQzKSwgbDIoKSkgOiBjMjsKICAgICAgICB9LCBlMi5wYWRkaW5nT3V0ZXIgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZjIgPSArdDMsIGwyKCkpIDogZjI7CiAgICAgICAgfSwgZTIuYWxpZ24gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoczIgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB0MykpLCBsMigpKSA6IHMyOwogICAgICAgIH0sIGUyLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB5ZyhyMigpLCBbbzIsIGEyXSkucm91bmQodTIpLnBhZGRpbmdJbm5lcihjMikucGFkZGluZ091dGVyKGYyKS5hbGlnbihzMik7CiAgICAgICAgfSwgaGcuYXBwbHkobDIoKSwgYXJndW1lbnRzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB2Zyh0MikgewogICAgICAgIHZhciBuMiA9IHQyLmNvcHk7CiAgICAgICAgcmV0dXJuIHQyLnBhZGRpbmcgPSB0Mi5wYWRkaW5nT3V0ZXIsIGRlbGV0ZSB0Mi5wYWRkaW5nSW5uZXIsIGRlbGV0ZSB0Mi5wYWRkaW5nT3V0ZXIsIHQyLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB2ZyhuMigpKTsKICAgICAgICB9LCB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBfZyh0MikgewogICAgICAgIHJldHVybiArdDI7CiAgICAgIH0KICAgICAgdmFyIGJnID0gWzAsIDFdOwogICAgICBmdW5jdGlvbiBtZyh0MikgewogICAgICAgIHJldHVybiB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiB4Zyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gKG4yIC09IHQyID0gK3QyKSA/IGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gKGUyIC0gdDIpIC8gbjI7CiAgICAgICAgfSA6IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9OwogICAgICAgIH0oaXNOYU4objIpID8gTmFOIDogMC41KTsKICAgICAgfQogICAgICBmdW5jdGlvbiB3Zyh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gdDJbMF0sIGkyID0gdDJbMV0sIG8yID0gbjJbMF0sIGEyID0gbjJbMV07CiAgICAgICAgcmV0dXJuIGkyIDwgcjIgPyAocjIgPSB4ZyhpMiwgcjIpLCBvMiA9IGUyKGEyLCBvMikpIDogKHIyID0geGcocjIsIGkyKSwgbzIgPSBlMihvMiwgYTIpKSwgZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBvMihyMih0MykpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTWcodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IE1hdGgubWluKHQyLmxlbmd0aCwgbjIubGVuZ3RoKSAtIDEsIGkyID0gbmV3IEFycmF5KHIyKSwgbzIgPSBuZXcgQXJyYXkocjIpLCBhMiA9IC0xOwogICAgICAgIGZvciAodDJbcjJdIDwgdDJbMF0gJiYgKHQyID0gdDIuc2xpY2UoKS5yZXZlcnNlKCksIG4yID0gbjIuc2xpY2UoKS5yZXZlcnNlKCkpOyArK2EyIDwgcjI7ICkKICAgICAgICAgIGkyW2EyXSA9IHhnKHQyW2EyXSwgdDJbYTIgKyAxXSksIG8yW2EyXSA9IGUyKG4yW2EyXSwgbjJbYTIgKyAxXSk7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICB2YXIgZTMgPSBzKHQyLCBuMywgMSwgcjIpIC0gMTsKICAgICAgICAgIHJldHVybiBvMltlM10oaTJbZTNdKG4zKSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUZyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gbjIuZG9tYWluKHQyLmRvbWFpbigpKS5yYW5nZSh0Mi5yYW5nZSgpKS5pbnRlcnBvbGF0ZSh0Mi5pbnRlcnBvbGF0ZSgpKS5jbGFtcCh0Mi5jbGFtcCgpKS51bmtub3duKHQyLnVua25vd24oKSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQWcoKSB7CiAgICAgICAgdmFyIHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIsIGEyID0gYmcsIHUyID0gYmcsIGMyID0gR3IsIGYyID0gbWc7CiAgICAgICAgZnVuY3Rpb24gczIoKSB7CiAgICAgICAgICB2YXIgdDMgPSBNYXRoLm1pbihhMi5sZW5ndGgsIHUyLmxlbmd0aCk7CiAgICAgICAgICByZXR1cm4gZjIgIT09IG1nICYmIChmMiA9IGZ1bmN0aW9uKHQ0LCBuMykgewogICAgICAgICAgICB2YXIgZTM7CiAgICAgICAgICAgIHJldHVybiB0NCA+IG4zICYmIChlMyA9IHQ0LCB0NCA9IG4zLCBuMyA9IGUzKSwgZnVuY3Rpb24oZTQpIHsKICAgICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgodDQsIE1hdGgubWluKG4zLCBlNCkpOwogICAgICAgICAgICB9OwogICAgICAgICAgfShhMlswXSwgYTJbdDMgLSAxXSkpLCByMiA9IHQzID4gMiA/IE1nIDogd2csIGkyID0gbzIgPSBudWxsLCBsMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbDIobjMpIHsKICAgICAgICAgIHJldHVybiBudWxsID09IG4zIHx8IGlzTmFOKG4zID0gK24zKSA/IGUyIDogKGkyIHx8IChpMiA9IHIyKGEyLm1hcCh0MiksIHUyLCBjMikpKSh0MihmMihuMykpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGwyLmludmVydCA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICByZXR1cm4gZjIobjIoKG8yIHx8IChvMiA9IHIyKHUyLCBhMi5tYXAodDIpLCBZcikpKShlMykpKTsKICAgICAgICB9LCBsMi5kb21haW4gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIgPSBBcnJheS5mcm9tKHQzLCBfZyksIHMyKCkpIDogYTIuc2xpY2UoKTsKICAgICAgICB9LCBsMi5yYW5nZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh1MiA9IEFycmF5LmZyb20odDMpLCBzMigpKSA6IHUyLnNsaWNlKCk7CiAgICAgICAgfSwgbDIucmFuZ2VSb3VuZCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gdTIgPSBBcnJheS5mcm9tKHQzKSwgYzIgPSBWciwgczIoKTsKICAgICAgICB9LCBsMi5jbGFtcCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChmMiA9ICEhdDMgfHwgbWcsIHMyKCkpIDogZjIgIT09IG1nOwogICAgICAgIH0sIGwyLmludGVycG9sYXRlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGMyID0gdDMsIHMyKCkpIDogYzI7CiAgICAgICAgfSwgbDIudW5rbm93biA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9IHQzLCBsMikgOiBlMjsKICAgICAgICB9LCBmdW5jdGlvbihlMywgcjMpIHsKICAgICAgICAgIHJldHVybiB0MiA9IGUzLCBuMiA9IHIzLCBzMigpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU2coKSB7CiAgICAgICAgcmV0dXJuIEFnKCkobWcsIG1nKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBFZyhuMiwgZTIsIHIyLCBpMikgewogICAgICAgIHZhciBvMiwgYTIgPSBXKG4yLCBlMiwgcjIpOwogICAgICAgIHN3aXRjaCAoKGkyID0gSmMobnVsbCA9PSBpMiA/ICIsZiIgOiBpMikpLnR5cGUpIHsKICAgICAgICAgIGNhc2UgInMiOgogICAgICAgICAgICB2YXIgdTIgPSBNYXRoLm1heChNYXRoLmFicyhuMiksIE1hdGguYWJzKGUyKSk7CiAgICAgICAgICAgIHJldHVybiBudWxsICE9IGkyLnByZWNpc2lvbiB8fCBpc05hTihvMiA9IGxmKGEyLCB1MikpIHx8IChpMi5wcmVjaXNpb24gPSBvMiksIHQuZm9ybWF0UHJlZml4KGkyLCB1Mik7CiAgICAgICAgICBjYXNlICIiOgogICAgICAgICAgY2FzZSAiZSI6CiAgICAgICAgICBjYXNlICJnIjoKICAgICAgICAgIGNhc2UgInAiOgogICAgICAgICAgY2FzZSAiciI6CiAgICAgICAgICAgIG51bGwgIT0gaTIucHJlY2lzaW9uIHx8IGlzTmFOKG8yID0gaGYoYTIsIE1hdGgubWF4KE1hdGguYWJzKG4yKSwgTWF0aC5hYnMoZTIpKSkpIHx8IChpMi5wcmVjaXNpb24gPSBvMiAtICgiZSIgPT09IGkyLnR5cGUpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJmIjoKICAgICAgICAgIGNhc2UgIiUiOgogICAgICAgICAgICBudWxsICE9IGkyLnByZWNpc2lvbiB8fCBpc05hTihvMiA9IHNmKGEyKSkgfHwgKGkyLnByZWNpc2lvbiA9IG8yIC0gMiAqICgiJSIgPT09IGkyLnR5cGUpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHQuZm9ybWF0KGkyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBOZyh0MikgewogICAgICAgIHZhciBuMiA9IHQyLmRvbWFpbjsKICAgICAgICByZXR1cm4gdDIudGlja3MgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgdmFyIGUyID0gbjIoKTsKICAgICAgICAgIHJldHVybiBHKGUyWzBdLCBlMltlMi5sZW5ndGggLSAxXSwgbnVsbCA9PSB0MyA/IDEwIDogdDMpOwogICAgICAgIH0sIHQyLnRpY2tGb3JtYXQgPSBmdW5jdGlvbih0MywgZTIpIHsKICAgICAgICAgIHZhciByMiA9IG4yKCk7CiAgICAgICAgICByZXR1cm4gRWcocjJbMF0sIHIyW3IyLmxlbmd0aCAtIDFdLCBudWxsID09IHQzID8gMTAgOiB0MywgZTIpOwogICAgICAgIH0sIHQyLm5pY2UgPSBmdW5jdGlvbihlMikgewogICAgICAgICAgbnVsbCA9PSBlMiAmJiAoZTIgPSAxMCk7CiAgICAgICAgICB2YXIgcjIsIGkyLCBvMiA9IG4yKCksIGEyID0gMCwgdTIgPSBvMi5sZW5ndGggLSAxLCBjMiA9IG8yW2EyXSwgZjIgPSBvMlt1Ml0sIHMyID0gMTA7CiAgICAgICAgICBmb3IgKGYyIDwgYzIgJiYgKGkyID0gYzIsIGMyID0gZjIsIGYyID0gaTIsIGkyID0gYTIsIGEyID0gdTIsIHUyID0gaTIpOyBzMi0tID4gMDsgKSB7CiAgICAgICAgICAgIGlmICgoaTIgPSBWKGMyLCBmMiwgZTIpKSA9PT0gcjIpCiAgICAgICAgICAgICAgcmV0dXJuIG8yW2EyXSA9IGMyLCBvMlt1Ml0gPSBmMiwgbjIobzIpOwogICAgICAgICAgICBpZiAoaTIgPiAwKQogICAgICAgICAgICAgIGMyID0gTWF0aC5mbG9vcihjMiAvIGkyKSAqIGkyLCBmMiA9IE1hdGguY2VpbChmMiAvIGkyKSAqIGkyOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBpZiAoIShpMiA8IDApKQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgYzIgPSBNYXRoLmNlaWwoYzIgKiBpMikgLyBpMiwgZjIgPSBNYXRoLmZsb29yKGYyICogaTIpIC8gaTI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcjIgPSBpMjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0MjsKICAgICAgICB9LCB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBrZyh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIsIHIyID0gMCwgaTIgPSAodDIgPSB0Mi5zbGljZSgpKS5sZW5ndGggLSAxLCBvMiA9IHQyW3IyXSwgYTIgPSB0MltpMl07CiAgICAgICAgcmV0dXJuIGEyIDwgbzIgJiYgKGUyID0gcjIsIHIyID0gaTIsIGkyID0gZTIsIGUyID0gbzIsIG8yID0gYTIsIGEyID0gZTIpLCB0MltyMl0gPSBuMi5mbG9vcihvMiksIHQyW2kyXSA9IG4yLmNlaWwoYTIpLCB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBDZyh0MikgewogICAgICAgIHJldHVybiBNYXRoLmxvZyh0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUGcodDIpIHsKICAgICAgICByZXR1cm4gTWF0aC5leHAodDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHpnKHQyKSB7CiAgICAgICAgcmV0dXJuIC1NYXRoLmxvZygtdDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uICRnKHQyKSB7CiAgICAgICAgcmV0dXJuIC1NYXRoLmV4cCgtdDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIERnKHQyKSB7CiAgICAgICAgcmV0dXJuIGlzRmluaXRlKHQyKSA/ICsoIjFlIiArIHQyKSA6IHQyIDwgMCA/IDAgOiB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBSZyh0MikgewogICAgICAgIHJldHVybiAobjIsIGUyKSA9PiAtdDIoLW4yLCBlMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRmcobjIpIHsKICAgICAgICBjb25zdCBlMiA9IG4yKENnLCBQZyksIHIyID0gZTIuZG9tYWluOwogICAgICAgIGxldCBpMiwgbzIsIGEyID0gMTA7CiAgICAgICAgZnVuY3Rpb24gdTIoKSB7CiAgICAgICAgICByZXR1cm4gaTIgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgICByZXR1cm4gdDIgPT09IE1hdGguRSA/IE1hdGgubG9nIDogMTAgPT09IHQyICYmIE1hdGgubG9nMTAgfHwgMiA9PT0gdDIgJiYgTWF0aC5sb2cyIHx8ICh0MiA9IE1hdGgubG9nKHQyKSwgKG4zKSA9PiBNYXRoLmxvZyhuMykgLyB0Mik7CiAgICAgICAgICB9KGEyKSwgbzIgPSAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24odDIpIHsKICAgICAgICAgICAgcmV0dXJuIDEwID09PSB0MiA/IERnIDogdDIgPT09IE1hdGguRSA/IE1hdGguZXhwIDogKG4zKSA9PiBNYXRoLnBvdyh0MiwgbjMpOwogICAgICAgICAgfShhMiksIHIyKClbMF0gPCAwID8gKGkyID0gUmcoaTIpLCBvMiA9IFJnKG8yKSwgbjIoemcsICRnKSkgOiBuMihDZywgUGcpLCBlMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLmJhc2UgPSBmdW5jdGlvbih0MikgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIgPSArdDIsIHUyKCkpIDogYTI7CiAgICAgICAgfSwgZTIuZG9tYWluID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyKHQyKSwgdTIoKSkgOiByMigpOwogICAgICAgIH0sIGUyLnRpY2tzID0gKHQyKSA9PiB7CiAgICAgICAgICBjb25zdCBuMyA9IHIyKCk7CiAgICAgICAgICBsZXQgZTMgPSBuM1swXSwgdTMgPSBuM1tuMy5sZW5ndGggLSAxXTsKICAgICAgICAgIGNvbnN0IGMyID0gdTMgPCBlMzsKICAgICAgICAgIGMyICYmIChbZTMsIHUzXSA9IFt1MywgZTNdKTsKICAgICAgICAgIGxldCBmMiwgczIsIGwyID0gaTIoZTMpLCBoMiA9IGkyKHUzKTsKICAgICAgICAgIGNvbnN0IGQyID0gbnVsbCA9PSB0MiA/IDEwIDogK3QyOwogICAgICAgICAgbGV0IHAyID0gW107CiAgICAgICAgICBpZiAoIShhMiAlIDEpICYmIGgyIC0gbDIgPCBkMikgewogICAgICAgICAgICBpZiAobDIgPSBNYXRoLmZsb29yKGwyKSwgaDIgPSBNYXRoLmNlaWwoaDIpLCBlMyA+IDApIHsKICAgICAgICAgICAgICBmb3IgKDsgbDIgPD0gaDI7ICsrbDIpCiAgICAgICAgICAgICAgICBmb3IgKGYyID0gMTsgZjIgPCBhMjsgKytmMikKICAgICAgICAgICAgICAgICAgaWYgKHMyID0gbDIgPCAwID8gZjIgLyBvMigtbDIpIDogZjIgKiBvMihsMiksICEoczIgPCBlMykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoczIgPiB1MykKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIHAyLnB1c2goczIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIGZvciAoOyBsMiA8PSBoMjsgKytsMikKICAgICAgICAgICAgICAgIGZvciAoZjIgPSBhMiAtIDE7IGYyID49IDE7IC0tZjIpCiAgICAgICAgICAgICAgICAgIGlmIChzMiA9IGwyID4gMCA/IGYyIC8gbzIoLWwyKSA6IGYyICogbzIobDIpLCAhKHMyIDwgZTMpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHMyID4gdTMpCiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBwMi5wdXNoKHMyKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAyICogcDIubGVuZ3RoIDwgZDIgJiYgKHAyID0gRyhlMywgdTMsIGQyKSk7CiAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgcDIgPSBHKGwyLCBoMiwgTWF0aC5taW4oaDIgLSBsMiwgZDIpKS5tYXAobzIpOwogICAgICAgICAgcmV0dXJuIGMyID8gcDIucmV2ZXJzZSgpIDogcDI7CiAgICAgICAgfSwgZTIudGlja0Zvcm1hdCA9IChuMywgcjMpID0+IHsKICAgICAgICAgIGlmIChudWxsID09IG4zICYmIChuMyA9IDEwKSwgbnVsbCA9PSByMyAmJiAocjMgPSAxMCA9PT0gYTIgPyAicyIgOiAiLCIpLCAiZnVuY3Rpb24iICE9IHR5cGVvZiByMyAmJiAoYTIgJSAxIHx8IG51bGwgIT0gKHIzID0gSmMocjMpKS5wcmVjaXNpb24gfHwgKHIzLnRyaW0gPSB0cnVlKSwgcjMgPSB0LmZvcm1hdChyMykpLCBuMyA9PT0gMSAvIDApCiAgICAgICAgICAgIHJldHVybiByMzsKICAgICAgICAgIGNvbnN0IHUzID0gTWF0aC5tYXgoMSwgYTIgKiBuMyAvIGUyLnRpY2tzKCkubGVuZ3RoKTsKICAgICAgICAgIHJldHVybiAodDIpID0+IHsKICAgICAgICAgICAgbGV0IG40ID0gdDIgLyBvMihNYXRoLnJvdW5kKGkyKHQyKSkpOwogICAgICAgICAgICByZXR1cm4gbjQgKiBhMiA8IGEyIC0gMC41ICYmIChuNCAqPSBhMiksIG40IDw9IHUzID8gcjModDIpIDogIiI7CiAgICAgICAgICB9OwogICAgICAgIH0sIGUyLm5pY2UgPSAoKSA9PiByMihrZyhyMigpLCB7IGZsb29yOiAodDIpID0+IG8yKE1hdGguZmxvb3IoaTIodDIpKSksIGNlaWw6ICh0MikgPT4gbzIoTWF0aC5jZWlsKGkyKHQyKSkpIH0pKSwgZTI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcWcodDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24objIpIHsKICAgICAgICAgIHJldHVybiBNYXRoLnNpZ24objIpICogTWF0aC5sb2cxcChNYXRoLmFicyhuMiAvIHQyKSk7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBVZyh0MikgewogICAgICAgIHJldHVybiBmdW5jdGlvbihuMikgewogICAgICAgICAgcmV0dXJuIE1hdGguc2lnbihuMikgKiBNYXRoLmV4cG0xKE1hdGguYWJzKG4yKSkgKiB0MjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIElnKHQyKSB7CiAgICAgICAgdmFyIG4yID0gMSwgZTIgPSB0MihxZyhuMiksIFVnKG4yKSk7CiAgICAgICAgcmV0dXJuIGUyLmNvbnN0YW50ID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gdDIocWcobjIgPSArZTMpLCBVZyhuMikpIDogbjI7CiAgICAgICAgfSwgTmcoZTIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE9nKHQyKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG4yKSB7CiAgICAgICAgICByZXR1cm4gbjIgPCAwID8gLU1hdGgucG93KC1uMiwgdDIpIDogTWF0aC5wb3cobjIsIHQyKTsKICAgICAgICB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEJnKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyIDwgMCA/IC1NYXRoLnNxcnQoLXQyKSA6IE1hdGguc3FydCh0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWWcodDIpIHsKICAgICAgICByZXR1cm4gdDIgPCAwID8gLXQyICogdDIgOiB0MiAqIHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIExnKHQyKSB7CiAgICAgICAgdmFyIG4yID0gdDIobWcsIG1nKSwgZTIgPSAxOwogICAgICAgIHJldHVybiBuMi5leHBvbmVudCA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IDEgPT09IChlMiA9ICtuMykgPyB0MihtZywgbWcpIDogMC41ID09PSBlMiA/IHQyKEJnLCBZZykgOiB0MihPZyhlMiksIE9nKDEgLyBlMikpIDogZTI7CiAgICAgICAgfSwgTmcobjIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGpnKCkgewogICAgICAgIHZhciB0MiA9IExnKEFnKCkpOwogICAgICAgIHJldHVybiB0Mi5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gVGcodDIsIGpnKCkpLmV4cG9uZW50KHQyLmV4cG9uZW50KCkpOwogICAgICAgIH0sIGhnLmFwcGx5KHQyLCBhcmd1bWVudHMpLCB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBIZyh0MikgewogICAgICAgIHJldHVybiBNYXRoLnNpZ24odDIpICogdDIgKiB0MjsKICAgICAgfQogICAgICBjb25zdCBYZyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpLCBHZyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpOwogICAgICBmdW5jdGlvbiBWZyh0MiwgbjIsIGUyLCByMikgewogICAgICAgIGZ1bmN0aW9uIGkyKG4zKSB7CiAgICAgICAgICByZXR1cm4gdDIobjMgPSAwID09PSBhcmd1bWVudHMubGVuZ3RoID8gLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCkgOiAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoK24zKSksIG4zOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuZmxvb3IgPSAobjMpID0+ICh0MihuMyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgrbjMpKSwgbjMpLCBpMi5jZWlsID0gKGUzKSA9PiAodDIoZTMgPSBuZXcgRGF0ZShlMyAtIDEpKSwgbjIoZTMsIDEpLCB0MihlMyksIGUzKSwgaTIucm91bmQgPSAodDMpID0+IHsKICAgICAgICAgIGNvbnN0IG4zID0gaTIodDMpLCBlMyA9IGkyLmNlaWwodDMpOwogICAgICAgICAgcmV0dXJuIHQzIC0gbjMgPCBlMyAtIHQzID8gbjMgOiBlMzsKICAgICAgICB9LCBpMi5vZmZzZXQgPSAodDMsIGUzKSA9PiAobjIodDMgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoK3QzKSwgbnVsbCA9PSBlMyA/IDEgOiBNYXRoLmZsb29yKGUzKSksIHQzKSwgaTIucmFuZ2UgPSAoZTMsIHIzLCBvMikgPT4gewogICAgICAgICAgY29uc3QgYTIgPSBbXTsKICAgICAgICAgIGlmIChlMyA9IGkyLmNlaWwoZTMpLCBvMiA9IG51bGwgPT0gbzIgPyAxIDogTWF0aC5mbG9vcihvMiksICEoZTMgPCByMyAmJiBvMiA+IDApKQogICAgICAgICAgICByZXR1cm4gYTI7CiAgICAgICAgICBsZXQgdTI7CiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIGEyLnB1c2godTIgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoK2UzKSksIG4yKGUzLCBvMiksIHQyKGUzKTsKICAgICAgICAgIH0gd2hpbGUgKHUyIDwgZTMgJiYgZTMgPCByMyk7CiAgICAgICAgICByZXR1cm4gYTI7CiAgICAgICAgfSwgaTIuZmlsdGVyID0gKGUzKSA9PiBWZygobjMpID0+IHsKICAgICAgICAgIGlmIChuMyA+PSBuMykKICAgICAgICAgICAgZm9yICg7IHQyKG4zKSwgIWUzKG4zKTsgKQogICAgICAgICAgICAgIG4zLnNldFRpbWUobjMgLSAxKTsKICAgICAgICB9LCAodDMsIHIzKSA9PiB7CiAgICAgICAgICBpZiAodDMgPj0gdDMpCiAgICAgICAgICAgIGlmIChyMyA8IDApCiAgICAgICAgICAgICAgZm9yICg7ICsrcjMgPD0gMDsgKQogICAgICAgICAgICAgICAgZm9yICg7IG4yKHQzLCAtMSksICFlMyh0Myk7ICkKICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgZm9yICg7IC0tcjMgPj0gMDsgKQogICAgICAgICAgICAgICAgZm9yICg7IG4yKHQzLCAxKSwgIWUzKHQzKTsgKQogICAgICAgICAgICAgICAgICA7CiAgICAgICAgfSksIGUyICYmIChpMi5jb3VudCA9IChuMywgcjMpID0+IChYZy5zZXRUaW1lKCtuMyksIEdnLnNldFRpbWUoK3IzKSwgdDIoWGcpLCB0MihHZyksIE1hdGguZmxvb3IoZTIoWGcsIEdnKSkpLCBpMi5ldmVyeSA9ICh0MykgPT4gKHQzID0gTWF0aC5mbG9vcih0MyksIGlzRmluaXRlKHQzKSAmJiB0MyA+IDAgPyB0MyA+IDEgPyBpMi5maWx0ZXIocjIgPyAobjMpID0+IHIyKG4zKSAlIHQzID09IDAgOiAobjMpID0+IGkyLmNvdW50KDAsIG4zKSAlIHQzID09IDApIDogaTIgOiBudWxsKSksIGkyOwogICAgICB9CiAgICAgIGNvbnN0IFdnID0gVmcoKCkgPT4gewogICAgICB9LCAodDIsIG4yKSA9PiB7CiAgICAgICAgdDIuc2V0VGltZSgrdDIgKyBuMik7CiAgICAgIH0sICh0MiwgbjIpID0+IG4yIC0gdDIpOwogICAgICBXZy5ldmVyeSA9ICh0MikgPT4gKHQyID0gTWF0aC5mbG9vcih0MiksIGlzRmluaXRlKHQyKSAmJiB0MiA+IDAgPyB0MiA+IDEgPyBWZygobjIpID0+IHsKICAgICAgICBuMi5zZXRUaW1lKE1hdGguZmxvb3IobjIgLyB0MikgKiB0Mik7CiAgICAgIH0sIChuMiwgZTIpID0+IHsKICAgICAgICBuMi5zZXRUaW1lKCtuMiArIGUyICogdDIpOwogICAgICB9LCAobjIsIGUyKSA9PiAoZTIgLSBuMikgLyB0MikgOiBXZyA6IG51bGwpOwogICAgICBjb25zdCBaZyA9IFdnLnJhbmdlLCBLZyA9IDFlMywgUWcgPSA2ZTQsIEpnID0gMzZlNSwgdHkgPSA4NjRlNSwgbnkgPSA2MDQ4ZTUsIGV5ID0gMjU5MmU2LCByeSA9IDMxNTM2ZTYsIGl5ID0gVmcoKHQyKSA9PiB7CiAgICAgICAgdDIuc2V0VGltZSh0MiAtIHQyLmdldE1pbGxpc2Vjb25kcygpKTsKICAgICAgfSwgKHQyLCBuMikgPT4gewogICAgICAgIHQyLnNldFRpbWUoK3QyICsgbjIgKiBLZyk7CiAgICAgIH0sICh0MiwgbjIpID0+IChuMiAtIHQyKSAvIEtnLCAodDIpID0+IHQyLmdldFVUQ1NlY29uZHMoKSksIG95ID0gaXkucmFuZ2UsIGF5ID0gVmcoKHQyKSA9PiB7CiAgICAgICAgdDIuc2V0VGltZSh0MiAtIHQyLmdldE1pbGxpc2Vjb25kcygpIC0gdDIuZ2V0U2Vjb25kcygpICogS2cpOwogICAgICB9LCAodDIsIG4yKSA9PiB7CiAgICAgICAgdDIuc2V0VGltZSgrdDIgKyBuMiAqIFFnKTsKICAgICAgfSwgKHQyLCBuMikgPT4gKG4yIC0gdDIpIC8gUWcsICh0MikgPT4gdDIuZ2V0TWludXRlcygpKSwgdXkgPSBheS5yYW5nZSwgY3kgPSBWZygodDIpID0+IHsKICAgICAgICB0Mi5zZXRVVENTZWNvbmRzKDAsIDApOwogICAgICB9LCAodDIsIG4yKSA9PiB7CiAgICAgICAgdDIuc2V0VGltZSgrdDIgKyBuMiAqIFFnKTsKICAgICAgfSwgKHQyLCBuMikgPT4gKG4yIC0gdDIpIC8gUWcsICh0MikgPT4gdDIuZ2V0VVRDTWludXRlcygpKSwgZnkgPSBjeS5yYW5nZSwgc3kgPSBWZygodDIpID0+IHsKICAgICAgICB0Mi5zZXRUaW1lKHQyIC0gdDIuZ2V0TWlsbGlzZWNvbmRzKCkgLSB0Mi5nZXRTZWNvbmRzKCkgKiBLZyAtIHQyLmdldE1pbnV0ZXMoKSAqIFFnKTsKICAgICAgfSwgKHQyLCBuMikgPT4gewogICAgICAgIHQyLnNldFRpbWUoK3QyICsgbjIgKiBKZyk7CiAgICAgIH0sICh0MiwgbjIpID0+IChuMiAtIHQyKSAvIEpnLCAodDIpID0+IHQyLmdldEhvdXJzKCkpLCBseSA9IHN5LnJhbmdlLCBoeSA9IFZnKCh0MikgPT4gewogICAgICAgIHQyLnNldFVUQ01pbnV0ZXMoMCwgMCwgMCk7CiAgICAgIH0sICh0MiwgbjIpID0+IHsKICAgICAgICB0Mi5zZXRUaW1lKCt0MiArIG4yICogSmcpOwogICAgICB9LCAodDIsIG4yKSA9PiAobjIgLSB0MikgLyBKZywgKHQyKSA9PiB0Mi5nZXRVVENIb3VycygpKSwgZHkgPSBoeS5yYW5nZSwgcHkgPSBWZygodDIpID0+IHQyLnNldEhvdXJzKDAsIDAsIDAsIDApLCAodDIsIG4yKSA9PiB0Mi5zZXREYXRlKHQyLmdldERhdGUoKSArIG4yKSwgKHQyLCBuMikgPT4gKG4yIC0gdDIgLSAobjIuZ2V0VGltZXpvbmVPZmZzZXQoKSAtIHQyLmdldFRpbWV6b25lT2Zmc2V0KCkpICogUWcpIC8gdHksICh0MikgPT4gdDIuZ2V0RGF0ZSgpIC0gMSksIGd5ID0gcHkucmFuZ2UsIHl5ID0gVmcoKHQyKSA9PiB7CiAgICAgICAgdDIuc2V0VVRDSG91cnMoMCwgMCwgMCwgMCk7CiAgICAgIH0sICh0MiwgbjIpID0+IHsKICAgICAgICB0Mi5zZXRVVENEYXRlKHQyLmdldFVUQ0RhdGUoKSArIG4yKTsKICAgICAgfSwgKHQyLCBuMikgPT4gKG4yIC0gdDIpIC8gdHksICh0MikgPT4gdDIuZ2V0VVRDRGF0ZSgpIC0gMSksIHZ5ID0geXkucmFuZ2UsIF95ID0gVmcoKHQyKSA9PiB7CiAgICAgICAgdDIuc2V0VVRDSG91cnMoMCwgMCwgMCwgMCk7CiAgICAgIH0sICh0MiwgbjIpID0+IHsKICAgICAgICB0Mi5zZXRVVENEYXRlKHQyLmdldFVUQ0RhdGUoKSArIG4yKTsKICAgICAgfSwgKHQyLCBuMikgPT4gKG4yIC0gdDIpIC8gdHksICh0MikgPT4gTWF0aC5mbG9vcih0MiAvIHR5KSksIGJ5ID0gX3kucmFuZ2U7CiAgICAgIGZ1bmN0aW9uIG15KHQyKSB7CiAgICAgICAgcmV0dXJuIFZnKChuMikgPT4gewogICAgICAgICAgbjIuc2V0RGF0ZShuMi5nZXREYXRlKCkgLSAobjIuZ2V0RGF5KCkgKyA3IC0gdDIpICUgNyksIG4yLnNldEhvdXJzKDAsIDAsIDAsIDApOwogICAgICAgIH0sICh0MywgbjIpID0+IHsKICAgICAgICAgIHQzLnNldERhdGUodDMuZ2V0RGF0ZSgpICsgNyAqIG4yKTsKICAgICAgICB9LCAodDMsIG4yKSA9PiAobjIgLSB0MyAtIChuMi5nZXRUaW1lem9uZU9mZnNldCgpIC0gdDMuZ2V0VGltZXpvbmVPZmZzZXQoKSkgKiBRZykgLyBueSk7CiAgICAgIH0KICAgICAgY29uc3QgeHkgPSBteSgwKSwgd3kgPSBteSgxKSwgTXkgPSBteSgyKSwgVHkgPSBteSgzKSwgQXkgPSBteSg0KSwgU3kgPSBteSg1KSwgRXkgPSBteSg2KSwgTnkgPSB4eS5yYW5nZSwga3kgPSB3eS5yYW5nZSwgQ3kgPSBNeS5yYW5nZSwgUHkgPSBUeS5yYW5nZSwgenkgPSBBeS5yYW5nZSwgJHkgPSBTeS5yYW5nZSwgRHkgPSBFeS5yYW5nZTsKICAgICAgZnVuY3Rpb24gUnkodDIpIHsKICAgICAgICByZXR1cm4gVmcoKG4yKSA9PiB7CiAgICAgICAgICBuMi5zZXRVVENEYXRlKG4yLmdldFVUQ0RhdGUoKSAtIChuMi5nZXRVVENEYXkoKSArIDcgLSB0MikgJSA3KSwgbjIuc2V0VVRDSG91cnMoMCwgMCwgMCwgMCk7CiAgICAgICAgfSwgKHQzLCBuMikgPT4gewogICAgICAgICAgdDMuc2V0VVRDRGF0ZSh0My5nZXRVVENEYXRlKCkgKyA3ICogbjIpOwogICAgICAgIH0sICh0MywgbjIpID0+IChuMiAtIHQzKSAvIG55KTsKICAgICAgfQogICAgICBjb25zdCBGeSA9IFJ5KDApLCBxeSA9IFJ5KDEpLCBVeSA9IFJ5KDIpLCBJeSA9IFJ5KDMpLCBPeSA9IFJ5KDQpLCBCeSA9IFJ5KDUpLCBZeSA9IFJ5KDYpLCBMeSA9IEZ5LnJhbmdlLCBqeSA9IHF5LnJhbmdlLCBIeSA9IFV5LnJhbmdlLCBYeSA9IEl5LnJhbmdlLCBHeSA9IE95LnJhbmdlLCBWeSA9IEJ5LnJhbmdlLCBXeSA9IFl5LnJhbmdlLCBaeSA9IFZnKCh0MikgPT4gewogICAgICAgIHQyLnNldERhdGUoMSksIHQyLnNldEhvdXJzKDAsIDAsIDAsIDApOwogICAgICB9LCAodDIsIG4yKSA9PiB7CiAgICAgICAgdDIuc2V0TW9udGgodDIuZ2V0TW9udGgoKSArIG4yKTsKICAgICAgfSwgKHQyLCBuMikgPT4gbjIuZ2V0TW9udGgoKSAtIHQyLmdldE1vbnRoKCkgKyAxMiAqIChuMi5nZXRGdWxsWWVhcigpIC0gdDIuZ2V0RnVsbFllYXIoKSksICh0MikgPT4gdDIuZ2V0TW9udGgoKSksIEt5ID0gWnkucmFuZ2UsIFF5ID0gVmcoKHQyKSA9PiB7CiAgICAgICAgdDIuc2V0VVRDRGF0ZSgxKSwgdDIuc2V0VVRDSG91cnMoMCwgMCwgMCwgMCk7CiAgICAgIH0sICh0MiwgbjIpID0+IHsKICAgICAgICB0Mi5zZXRVVENNb250aCh0Mi5nZXRVVENNb250aCgpICsgbjIpOwogICAgICB9LCAodDIsIG4yKSA9PiBuMi5nZXRVVENNb250aCgpIC0gdDIuZ2V0VVRDTW9udGgoKSArIDEyICogKG4yLmdldFVUQ0Z1bGxZZWFyKCkgLSB0Mi5nZXRVVENGdWxsWWVhcigpKSwgKHQyKSA9PiB0Mi5nZXRVVENNb250aCgpKSwgSnkgPSBReS5yYW5nZSwgdHYgPSBWZygodDIpID0+IHsKICAgICAgICB0Mi5zZXRNb250aCgwLCAxKSwgdDIuc2V0SG91cnMoMCwgMCwgMCwgMCk7CiAgICAgIH0sICh0MiwgbjIpID0+IHsKICAgICAgICB0Mi5zZXRGdWxsWWVhcih0Mi5nZXRGdWxsWWVhcigpICsgbjIpOwogICAgICB9LCAodDIsIG4yKSA9PiBuMi5nZXRGdWxsWWVhcigpIC0gdDIuZ2V0RnVsbFllYXIoKSwgKHQyKSA9PiB0Mi5nZXRGdWxsWWVhcigpKTsKICAgICAgdHYuZXZlcnkgPSAodDIpID0+IGlzRmluaXRlKHQyID0gTWF0aC5mbG9vcih0MikpICYmIHQyID4gMCA/IFZnKChuMikgPT4gewogICAgICAgIG4yLnNldEZ1bGxZZWFyKE1hdGguZmxvb3IobjIuZ2V0RnVsbFllYXIoKSAvIHQyKSAqIHQyKSwgbjIuc2V0TW9udGgoMCwgMSksIG4yLnNldEhvdXJzKDAsIDAsIDAsIDApOwogICAgICB9LCAobjIsIGUyKSA9PiB7CiAgICAgICAgbjIuc2V0RnVsbFllYXIobjIuZ2V0RnVsbFllYXIoKSArIGUyICogdDIpOwogICAgICB9KSA6IG51bGw7CiAgICAgIGNvbnN0IG52ID0gdHYucmFuZ2UsIGV2ID0gVmcoKHQyKSA9PiB7CiAgICAgICAgdDIuc2V0VVRDTW9udGgoMCwgMSksIHQyLnNldFVUQ0hvdXJzKDAsIDAsIDAsIDApOwogICAgICB9LCAodDIsIG4yKSA9PiB7CiAgICAgICAgdDIuc2V0VVRDRnVsbFllYXIodDIuZ2V0VVRDRnVsbFllYXIoKSArIG4yKTsKICAgICAgfSwgKHQyLCBuMikgPT4gbjIuZ2V0VVRDRnVsbFllYXIoKSAtIHQyLmdldFVUQ0Z1bGxZZWFyKCksICh0MikgPT4gdDIuZ2V0VVRDRnVsbFllYXIoKSk7CiAgICAgIGV2LmV2ZXJ5ID0gKHQyKSA9PiBpc0Zpbml0ZSh0MiA9IE1hdGguZmxvb3IodDIpKSAmJiB0MiA+IDAgPyBWZygobjIpID0+IHsKICAgICAgICBuMi5zZXRVVENGdWxsWWVhcihNYXRoLmZsb29yKG4yLmdldFVUQ0Z1bGxZZWFyKCkgLyB0MikgKiB0MiksIG4yLnNldFVUQ01vbnRoKDAsIDEpLCBuMi5zZXRVVENIb3VycygwLCAwLCAwLCAwKTsKICAgICAgfSwgKG4yLCBlMikgPT4gewogICAgICAgIG4yLnNldFVUQ0Z1bGxZZWFyKG4yLmdldFVUQ0Z1bGxZZWFyKCkgKyBlMiAqIHQyKTsKICAgICAgfSkgOiBudWxsOwogICAgICBjb25zdCBydiA9IGV2LnJhbmdlOwogICAgICBmdW5jdGlvbiBpdih0MiwgbjIsIGUyLCBpMiwgbzIsIGEyKSB7CiAgICAgICAgY29uc3QgdTIgPSBbW2l5LCAxLCBLZ10sIFtpeSwgNSwgNWUzXSwgW2l5LCAxNSwgMTVlM10sIFtpeSwgMzAsIDNlNF0sIFthMiwgMSwgUWddLCBbYTIsIDUsIDNlNV0sIFthMiwgMTUsIDllNV0sIFthMiwgMzAsIDE4ZTVdLCBbbzIsIDEsIEpnXSwgW28yLCAzLCAxMDhlNV0sIFtvMiwgNiwgMjE2ZTVdLCBbbzIsIDEyLCA0MzJlNV0sIFtpMiwgMSwgdHldLCBbaTIsIDIsIDE3MjhlNV0sIFtlMiwgMSwgbnldLCBbbjIsIDEsIGV5XSwgW24yLCAzLCA3Nzc2ZTZdLCBbdDIsIDEsIHJ5XV07CiAgICAgICAgZnVuY3Rpb24gYzIobjMsIGUzLCBpMykgewogICAgICAgICAgY29uc3QgbzMgPSBNYXRoLmFicyhlMyAtIG4zKSAvIGkzLCBhMyA9IHIoKFssICwgdDNdKSA9PiB0MykucmlnaHQodTIsIG8zKTsKICAgICAgICAgIGlmIChhMyA9PT0gdTIubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gdDIuZXZlcnkoVyhuMyAvIHJ5LCBlMyAvIHJ5LCBpMykpOwogICAgICAgICAgaWYgKDAgPT09IGEzKQogICAgICAgICAgICByZXR1cm4gV2cuZXZlcnkoTWF0aC5tYXgoVyhuMywgZTMsIGkzKSwgMSkpOwogICAgICAgICAgY29uc3QgW2MzLCBmMl0gPSB1MltvMyAvIHUyW2EzIC0gMV1bMl0gPCB1MlthM11bMl0gLyBvMyA/IGEzIC0gMSA6IGEzXTsKICAgICAgICAgIHJldHVybiBjMy5ldmVyeShmMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBbZnVuY3Rpb24odDMsIG4zLCBlMykgewogICAgICAgICAgY29uc3QgcjIgPSBuMyA8IHQzOwogICAgICAgICAgcjIgJiYgKFt0MywgbjNdID0gW24zLCB0M10pOwogICAgICAgICAgY29uc3QgaTMgPSBlMyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBlMy5yYW5nZSA/IGUzIDogYzIodDMsIG4zLCBlMyksIG8zID0gaTMgPyBpMy5yYW5nZSh0MywgK24zICsgMSkgOiBbXTsKICAgICAgICAgIHJldHVybiByMiA/IG8zLnJldmVyc2UoKSA6IG8zOwogICAgICAgIH0sIGMyXTsKICAgICAgfQogICAgICBjb25zdCBbb3YsIGF2XSA9IGl2KGV2LCBReSwgRnksIF95LCBoeSwgY3kpLCBbdXYsIGN2XSA9IGl2KHR2LCBaeSwgeHksIHB5LCBzeSwgYXkpOwogICAgICBmdW5jdGlvbiBmdih0MikgewogICAgICAgIGlmICgwIDw9IHQyLnkgJiYgdDIueSA8IDEwMCkgewogICAgICAgICAgdmFyIG4yID0gbmV3IERhdGUoLTEsIHQyLm0sIHQyLmQsIHQyLkgsIHQyLk0sIHQyLlMsIHQyLkwpOwogICAgICAgICAgcmV0dXJuIG4yLnNldEZ1bGxZZWFyKHQyLnkpLCBuMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKHQyLnksIHQyLm0sIHQyLmQsIHQyLkgsIHQyLk0sIHQyLlMsIHQyLkwpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHN2KHQyKSB7CiAgICAgICAgaWYgKDAgPD0gdDIueSAmJiB0Mi55IDwgMTAwKSB7CiAgICAgICAgICB2YXIgbjIgPSBuZXcgRGF0ZShEYXRlLlVUQygtMSwgdDIubSwgdDIuZCwgdDIuSCwgdDIuTSwgdDIuUywgdDIuTCkpOwogICAgICAgICAgcmV0dXJuIG4yLnNldFVUQ0Z1bGxZZWFyKHQyLnkpLCBuMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKHQyLnksIHQyLm0sIHQyLmQsIHQyLkgsIHQyLk0sIHQyLlMsIHQyLkwpKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBsdih0MiwgbjIsIGUyKSB7CiAgICAgICAgcmV0dXJuIHsgeTogdDIsIG06IG4yLCBkOiBlMiwgSDogMCwgTTogMCwgUzogMCwgTDogMCB9OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGh2KHQyKSB7CiAgICAgICAgdmFyIG4yID0gdDIuZGF0ZVRpbWUsIGUyID0gdDIuZGF0ZSwgcjIgPSB0Mi50aW1lLCBpMiA9IHQyLnBlcmlvZHMsIG8yID0gdDIuZGF5cywgYTIgPSB0Mi5zaG9ydERheXMsIHUyID0gdDIubW9udGhzLCBjMiA9IHQyLnNob3J0TW9udGhzLCBmMiA9IG12KGkyKSwgczIgPSB4dihpMiksIGwyID0gbXYobzIpLCBoMiA9IHh2KG8yKSwgZDIgPSBtdihhMiksIHAyID0geHYoYTIpLCBnMiA9IG12KHUyKSwgeTIgPSB4dih1MiksIHYyID0gbXYoYzIpLCBfMiA9IHh2KGMyKSwgYjIgPSB7IGE6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYTJbdDMuZ2V0RGF5KCldOwogICAgICAgIH0sIEE6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gbzJbdDMuZ2V0RGF5KCldOwogICAgICAgIH0sIGI6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYzJbdDMuZ2V0TW9udGgoKV07CiAgICAgICAgfSwgQjogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiB1Mlt0My5nZXRNb250aCgpXTsKICAgICAgICB9LCBjOiBudWxsLCBkOiBZdiwgZTogWXYsIGY6IEd2LCBnOiBpXywgRzogYV8sIEg6IEx2LCBJOiBqdiwgajogSHYsIEw6IFh2LCBtOiBWdiwgTTogV3YsIHA6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gaTJbKyh0My5nZXRIb3VycygpID49IDEyKV07CiAgICAgICAgfSwgcTogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiAxICsgfn4odDMuZ2V0TW9udGgoKSAvIDMpOwogICAgICAgIH0sIFE6IGtfLCBzOiBDXywgUzogWnYsIHU6IEt2LCBVOiBRdiwgVjogdF8sIHc6IG5fLCBXOiBlXywgeDogbnVsbCwgWDogbnVsbCwgeTogcl8sIFk6IG9fLCBaOiB1XywgIiUiOiBOXyB9LCBtMiA9IHsgYTogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhMlt0My5nZXRVVENEYXkoKV07CiAgICAgICAgfSwgQTogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBvMlt0My5nZXRVVENEYXkoKV07CiAgICAgICAgfSwgYjogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBjMlt0My5nZXRVVENNb250aCgpXTsKICAgICAgICB9LCBCOiBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIHUyW3QzLmdldFVUQ01vbnRoKCldOwogICAgICAgIH0sIGM6IG51bGwsIGQ6IGNfLCBlOiBjXywgZjogZF8sIGc6IFRfLCBHOiBTXywgSDogZl8sIEk6IHNfLCBqOiBsXywgTDogaF8sIG06IHBfLCBNOiBnXywgcDogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBpMlsrKHQzLmdldFVUQ0hvdXJzKCkgPj0gMTIpXTsKICAgICAgICB9LCBxOiBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIDEgKyB+fih0My5nZXRVVENNb250aCgpIC8gMyk7CiAgICAgICAgfSwgUToga18sIHM6IENfLCBTOiB5XywgdTogdl8sIFU6IF9fLCBWOiBtXywgdzogeF8sIFc6IHdfLCB4OiBudWxsLCBYOiBudWxsLCB5OiBNXywgWTogQV8sIFo6IEVfLCAiJSI6IE5fIH0sIHgyID0geyBhOiBmdW5jdGlvbih0MywgbjMsIGUzKSB7CiAgICAgICAgICB2YXIgcjMgPSBkMi5leGVjKG4zLnNsaWNlKGUzKSk7CiAgICAgICAgICByZXR1cm4gcjMgPyAodDMudyA9IHAyLmdldChyM1swXS50b0xvd2VyQ2FzZSgpKSwgZTMgKyByM1swXS5sZW5ndGgpIDogLTE7CiAgICAgICAgfSwgQTogZnVuY3Rpb24odDMsIG4zLCBlMykgewogICAgICAgICAgdmFyIHIzID0gbDIuZXhlYyhuMy5zbGljZShlMykpOwogICAgICAgICAgcmV0dXJuIHIzID8gKHQzLncgPSBoMi5nZXQocjNbMF0udG9Mb3dlckNhc2UoKSksIGUzICsgcjNbMF0ubGVuZ3RoKSA6IC0xOwogICAgICAgIH0sIGI6IGZ1bmN0aW9uKHQzLCBuMywgZTMpIHsKICAgICAgICAgIHZhciByMyA9IHYyLmV4ZWMobjMuc2xpY2UoZTMpKTsKICAgICAgICAgIHJldHVybiByMyA/ICh0My5tID0gXzIuZ2V0KHIzWzBdLnRvTG93ZXJDYXNlKCkpLCBlMyArIHIzWzBdLmxlbmd0aCkgOiAtMTsKICAgICAgICB9LCBCOiBmdW5jdGlvbih0MywgbjMsIGUzKSB7CiAgICAgICAgICB2YXIgcjMgPSBnMi5leGVjKG4zLnNsaWNlKGUzKSk7CiAgICAgICAgICByZXR1cm4gcjMgPyAodDMubSA9IHkyLmdldChyM1swXS50b0xvd2VyQ2FzZSgpKSwgZTMgKyByM1swXS5sZW5ndGgpIDogLTE7CiAgICAgICAgfSwgYzogZnVuY3Rpb24odDMsIGUzLCByMykgewogICAgICAgICAgcmV0dXJuIFQyKHQzLCBuMiwgZTMsIHIzKTsKICAgICAgICB9LCBkOiB6diwgZTogenYsIGY6IFV2LCBnOiBOdiwgRzogRXYsIEg6IER2LCBJOiBEdiwgajogJHYsIEw6IHF2LCBtOiBQdiwgTTogUnYsIHA6IGZ1bmN0aW9uKHQzLCBuMywgZTMpIHsKICAgICAgICAgIHZhciByMyA9IGYyLmV4ZWMobjMuc2xpY2UoZTMpKTsKICAgICAgICAgIHJldHVybiByMyA/ICh0My5wID0gczIuZ2V0KHIzWzBdLnRvTG93ZXJDYXNlKCkpLCBlMyArIHIzWzBdLmxlbmd0aCkgOiAtMTsKICAgICAgICB9LCBxOiBDdiwgUTogT3YsIHM6IEJ2LCBTOiBGdiwgdTogTXYsIFU6IFR2LCBWOiBBdiwgdzogd3YsIFc6IFN2LCB4OiBmdW5jdGlvbih0MywgbjMsIHIzKSB7CiAgICAgICAgICByZXR1cm4gVDIodDMsIGUyLCBuMywgcjMpOwogICAgICAgIH0sIFg6IGZ1bmN0aW9uKHQzLCBuMywgZTMpIHsKICAgICAgICAgIHJldHVybiBUMih0MywgcjIsIG4zLCBlMyk7CiAgICAgICAgfSwgeTogTnYsIFk6IEV2LCBaOiBrdiwgIiUiOiBJdiB9OwogICAgICAgIGZ1bmN0aW9uIHcyKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHZhciByMywgaTMsIG8zLCBhMyA9IFtdLCB1MyA9IC0xLCBjMyA9IDAsIGYzID0gdDMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGUzIGluc3RhbmNlb2YgRGF0ZSB8fCAoZTMgPSAvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoK2UzKSk7ICsrdTMgPCBmMzsgKQogICAgICAgICAgICAgIDM3ID09PSB0My5jaGFyQ29kZUF0KHUzKSAmJiAoYTMucHVzaCh0My5zbGljZShjMywgdTMpKSwgbnVsbCAhPSAoaTMgPSBwdltyMyA9IHQzLmNoYXJBdCgrK3UzKV0pID8gcjMgPSB0My5jaGFyQXQoKyt1MykgOiBpMyA9ICJlIiA9PT0gcjMgPyAiICIgOiAiMCIsIChvMyA9IG4zW3IzXSkgJiYgKHIzID0gbzMoZTMsIGkzKSksIGEzLnB1c2gocjMpLCBjMyA9IHUzICsgMSk7CiAgICAgICAgICAgIHJldHVybiBhMy5wdXNoKHQzLnNsaWNlKGMzLCB1MykpLCBhMy5qb2luKCIiKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE0yKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICAgIHZhciByMywgaTMsIG8zID0gbHYoMTkwMCwgdm9pZCAwLCAxKTsKICAgICAgICAgICAgaWYgKFQyKG8zLCB0MywgZTMgKz0gIiIsIDApICE9IGUzLmxlbmd0aCkKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCJRIiBpbiBvMykKICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUobzMuUSk7CiAgICAgICAgICAgIGlmICgicyIgaW4gbzMpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKDFlMyAqIG8zLnMgKyAoIkwiIGluIG8zID8gbzMuTCA6IDApKTsKICAgICAgICAgICAgaWYgKG4zICYmICEoIloiIGluIG8zKSAmJiAobzMuWiA9IDApLCAicCIgaW4gbzMgJiYgKG8zLkggPSBvMy5IICUgMTIgKyAxMiAqIG8zLnApLCB2b2lkIDAgPT09IG8zLm0gJiYgKG8zLm0gPSAicSIgaW4gbzMgPyBvMy5xIDogMCksICJWIiBpbiBvMykgewogICAgICAgICAgICAgIGlmIChvMy5WIDwgMSB8fCBvMy5WID4gNTMpCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAidyIgaW4gbzMgfHwgKG8zLncgPSAxKSwgIloiIGluIG8zID8gKGkzID0gKHIzID0gc3YobHYobzMueSwgMCwgMSkpKS5nZXRVVENEYXkoKSwgcjMgPSBpMyA+IDQgfHwgMCA9PT0gaTMgPyBxeS5jZWlsKHIzKSA6IHF5KHIzKSwgcjMgPSB5eS5vZmZzZXQocjMsIDcgKiAobzMuViAtIDEpKSwgbzMueSA9IHIzLmdldFVUQ0Z1bGxZZWFyKCksIG8zLm0gPSByMy5nZXRVVENNb250aCgpLCBvMy5kID0gcjMuZ2V0VVRDRGF0ZSgpICsgKG8zLncgKyA2KSAlIDcpIDogKGkzID0gKHIzID0gZnYobHYobzMueSwgMCwgMSkpKS5nZXREYXkoKSwgcjMgPSBpMyA+IDQgfHwgMCA9PT0gaTMgPyB3eS5jZWlsKHIzKSA6IHd5KHIzKSwgcjMgPSBweS5vZmZzZXQocjMsIDcgKiAobzMuViAtIDEpKSwgbzMueSA9IHIzLmdldEZ1bGxZZWFyKCksIG8zLm0gPSByMy5nZXRNb250aCgpLCBvMy5kID0gcjMuZ2V0RGF0ZSgpICsgKG8zLncgKyA2KSAlIDcpOwogICAgICAgICAgICB9IGVsc2UKICAgICAgICAgICAgICAoIlciIGluIG8zIHx8ICJVIiBpbiBvMykgJiYgKCJ3IiBpbiBvMyB8fCAobzMudyA9ICJ1IiBpbiBvMyA/IG8zLnUgJSA3IDogIlciIGluIG8zID8gMSA6IDApLCBpMyA9ICJaIiBpbiBvMyA/IHN2KGx2KG8zLnksIDAsIDEpKS5nZXRVVENEYXkoKSA6IGZ2KGx2KG8zLnksIDAsIDEpKS5nZXREYXkoKSwgbzMubSA9IDAsIG8zLmQgPSAiVyIgaW4gbzMgPyAobzMudyArIDYpICUgNyArIDcgKiBvMy5XIC0gKGkzICsgNSkgJSA3IDogbzMudyArIDcgKiBvMy5VIC0gKGkzICsgNikgJSA3KTsKICAgICAgICAgICAgcmV0dXJuICJaIiBpbiBvMyA/IChvMy5IICs9IG8zLlogLyAxMDAgfCAwLCBvMy5NICs9IG8zLlogJSAxMDAsIHN2KG8zKSkgOiBmdihvMyk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBUMih0MywgbjMsIGUzLCByMykgewogICAgICAgICAgZm9yICh2YXIgaTMsIG8zLCBhMyA9IDAsIHUzID0gbjMubGVuZ3RoLCBjMyA9IGUzLmxlbmd0aDsgYTMgPCB1MzsgKSB7CiAgICAgICAgICAgIGlmIChyMyA+PSBjMykKICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIGlmICgzNyA9PT0gKGkzID0gbjMuY2hhckNvZGVBdChhMysrKSkpIHsKICAgICAgICAgICAgICBpZiAoaTMgPSBuMy5jaGFyQXQoYTMrKyksICEobzMgPSB4MltpMyBpbiBwdiA/IG4zLmNoYXJBdChhMysrKSA6IGkzXSkgfHwgKHIzID0gbzModDMsIGUzLCByMykpIDwgMCkKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgfSBlbHNlIGlmIChpMyAhPSBlMy5jaGFyQ29kZUF0KHIzKyspKQogICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByMzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGIyLnggPSB3MihlMiwgYjIpLCBiMi5YID0gdzIocjIsIGIyKSwgYjIuYyA9IHcyKG4yLCBiMiksIG0yLnggPSB3MihlMiwgbTIpLCBtMi5YID0gdzIocjIsIG0yKSwgbTIuYyA9IHcyKG4yLCBtMiksIHsgZm9ybWF0OiBmdW5jdGlvbih0MykgewogICAgICAgICAgdmFyIG4zID0gdzIodDMgKz0gIiIsIGIyKTsKICAgICAgICAgIHJldHVybiBuMy50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9LCBuMzsKICAgICAgICB9LCBwYXJzZTogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHZhciBuMyA9IE0yKHQzICs9ICIiLCBmYWxzZSk7CiAgICAgICAgICByZXR1cm4gbjMudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfSwgbjM7CiAgICAgICAgfSwgdXRjRm9ybWF0OiBmdW5jdGlvbih0MykgewogICAgICAgICAgdmFyIG4zID0gdzIodDMgKz0gIiIsIG0yKTsKICAgICAgICAgIHJldHVybiBuMy50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9LCBuMzsKICAgICAgICB9LCB1dGNQYXJzZTogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHZhciBuMyA9IE0yKHQzICs9ICIiLCB0cnVlKTsKICAgICAgICAgIHJldHVybiBuMy50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9LCBuMzsKICAgICAgICB9IH07CiAgICAgIH0KICAgICAgdmFyIGR2LCBwdiA9IHsgIi0iOiAiIiwgXzogIiAiLCAwOiAiMCIgfSwgZ3YgPSAvXlxzKlxkKy8sIHl2ID0gL14lLywgdnYgPSAvW1xcXiQqKz98W1xdKCkue31dL2c7CiAgICAgIGZ1bmN0aW9uIF92KHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSB0MiA8IDAgPyAiLSIgOiAiIiwgaTIgPSAocjIgPyAtdDIgOiB0MikgKyAiIiwgbzIgPSBpMi5sZW5ndGg7CiAgICAgICAgcmV0dXJuIHIyICsgKG8yIDwgZTIgPyBuZXcgQXJyYXkoZTIgLSBvMiArIDEpLmpvaW4objIpICsgaTIgOiBpMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYnYodDIpIHsKICAgICAgICByZXR1cm4gdDIucmVwbGFjZSh2diwgIlxcJCYiKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBtdih0MikgewogICAgICAgIHJldHVybiBuZXcgUmVnRXhwKCJeKD86IiArIHQyLm1hcChidikuam9pbigifCIpICsgIikiLCAiaSIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHh2KHQyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBNYXAodDIubWFwKCh0MywgbjIpID0+IFt0My50b0xvd2VyQ2FzZSgpLCBuMl0pKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB3dih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gZ3YuZXhlYyhuMi5zbGljZShlMiwgZTIgKyAxKSk7CiAgICAgICAgcmV0dXJuIHIyID8gKHQyLncgPSArcjJbMF0sIGUyICsgcjJbMF0ubGVuZ3RoKSA6IC0xOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE12KHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSBndi5leGVjKG4yLnNsaWNlKGUyLCBlMiArIDEpKTsKICAgICAgICByZXR1cm4gcjIgPyAodDIudSA9ICtyMlswXSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVHYodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGd2LmV4ZWMobjIuc2xpY2UoZTIsIGUyICsgMikpOwogICAgICAgIHJldHVybiByMiA/ICh0Mi5VID0gK3IyWzBdLCBlMiArIHIyWzBdLmxlbmd0aCkgOiAtMTsKICAgICAgfQogICAgICBmdW5jdGlvbiBBdih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gZ3YuZXhlYyhuMi5zbGljZShlMiwgZTIgKyAyKSk7CiAgICAgICAgcmV0dXJuIHIyID8gKHQyLlYgPSArcjJbMF0sIGUyICsgcjJbMF0ubGVuZ3RoKSA6IC0xOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFN2KHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSBndi5leGVjKG4yLnNsaWNlKGUyLCBlMiArIDIpKTsKICAgICAgICByZXR1cm4gcjIgPyAodDIuVyA9ICtyMlswXSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRXYodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGd2LmV4ZWMobjIuc2xpY2UoZTIsIGUyICsgNCkpOwogICAgICAgIHJldHVybiByMiA/ICh0Mi55ID0gK3IyWzBdLCBlMiArIHIyWzBdLmxlbmd0aCkgOiAtMTsKICAgICAgfQogICAgICBmdW5jdGlvbiBOdih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gZ3YuZXhlYyhuMi5zbGljZShlMiwgZTIgKyAyKSk7CiAgICAgICAgcmV0dXJuIHIyID8gKHQyLnkgPSArcjJbMF0gKyAoK3IyWzBdID4gNjggPyAxOTAwIDogMmUzKSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24ga3YodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IC9eKFopfChbKy1dXGRcZCkoPzo6PyhcZFxkKSk/Ly5leGVjKG4yLnNsaWNlKGUyLCBlMiArIDYpKTsKICAgICAgICByZXR1cm4gcjIgPyAodDIuWiA9IHIyWzFdID8gMCA6IC0ocjJbMl0gKyAocjJbM10gfHwgIjAwIikpLCBlMiArIHIyWzBdLmxlbmd0aCkgOiAtMTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDdih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gZ3YuZXhlYyhuMi5zbGljZShlMiwgZTIgKyAxKSk7CiAgICAgICAgcmV0dXJuIHIyID8gKHQyLnEgPSAzICogcjJbMF0gLSAzLCBlMiArIHIyWzBdLmxlbmd0aCkgOiAtMTsKICAgICAgfQogICAgICBmdW5jdGlvbiBQdih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gZ3YuZXhlYyhuMi5zbGljZShlMiwgZTIgKyAyKSk7CiAgICAgICAgcmV0dXJuIHIyID8gKHQyLm0gPSByMlswXSAtIDEsIGUyICsgcjJbMF0ubGVuZ3RoKSA6IC0xOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHp2KHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSBndi5leGVjKG4yLnNsaWNlKGUyLCBlMiArIDIpKTsKICAgICAgICByZXR1cm4gcjIgPyAodDIuZCA9ICtyMlswXSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gJHYodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGd2LmV4ZWMobjIuc2xpY2UoZTIsIGUyICsgMykpOwogICAgICAgIHJldHVybiByMiA/ICh0Mi5tID0gMCwgdDIuZCA9ICtyMlswXSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRHYodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGd2LmV4ZWMobjIuc2xpY2UoZTIsIGUyICsgMikpOwogICAgICAgIHJldHVybiByMiA/ICh0Mi5IID0gK3IyWzBdLCBlMiArIHIyWzBdLmxlbmd0aCkgOiAtMTsKICAgICAgfQogICAgICBmdW5jdGlvbiBSdih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gZ3YuZXhlYyhuMi5zbGljZShlMiwgZTIgKyAyKSk7CiAgICAgICAgcmV0dXJuIHIyID8gKHQyLk0gPSArcjJbMF0sIGUyICsgcjJbMF0ubGVuZ3RoKSA6IC0xOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEZ2KHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSBndi5leGVjKG4yLnNsaWNlKGUyLCBlMiArIDIpKTsKICAgICAgICByZXR1cm4gcjIgPyAodDIuUyA9ICtyMlswXSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcXYodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGd2LmV4ZWMobjIuc2xpY2UoZTIsIGUyICsgMykpOwogICAgICAgIHJldHVybiByMiA/ICh0Mi5MID0gK3IyWzBdLCBlMiArIHIyWzBdLmxlbmd0aCkgOiAtMTsKICAgICAgfQogICAgICBmdW5jdGlvbiBVdih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gZ3YuZXhlYyhuMi5zbGljZShlMiwgZTIgKyA2KSk7CiAgICAgICAgcmV0dXJuIHIyID8gKHQyLkwgPSBNYXRoLmZsb29yKHIyWzBdIC8gMWUzKSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gSXYodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IHl2LmV4ZWMobjIuc2xpY2UoZTIsIGUyICsgMSkpOwogICAgICAgIHJldHVybiByMiA/IGUyICsgcjJbMF0ubGVuZ3RoIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gT3YodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGd2LmV4ZWMobjIuc2xpY2UoZTIpKTsKICAgICAgICByZXR1cm4gcjIgPyAodDIuUSA9ICtyMlswXSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gQnYodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IGd2LmV4ZWMobjIuc2xpY2UoZTIpKTsKICAgICAgICByZXR1cm4gcjIgPyAodDIucyA9ICtyMlswXSwgZTIgKyByMlswXS5sZW5ndGgpIDogLTE7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWXYodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KHQyLmdldERhdGUoKSwgbjIsIDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEx2KHQyLCBuMikgewogICAgICAgIHJldHVybiBfdih0Mi5nZXRIb3VycygpLCBuMiwgMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24ganYodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KHQyLmdldEhvdXJzKCkgJSAxMiB8fCAxMiwgbjIsIDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEh2KHQyLCBuMikgewogICAgICAgIHJldHVybiBfdigxICsgcHkuY291bnQodHYodDIpLCB0MiksIG4yLCAzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBYdih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3YodDIuZ2V0TWlsbGlzZWNvbmRzKCksIG4yLCAzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBHdih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gWHYodDIsIG4yKSArICIwMDAiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFZ2KHQyLCBuMikgewogICAgICAgIHJldHVybiBfdih0Mi5nZXRNb250aCgpICsgMSwgbjIsIDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFd2KHQyLCBuMikgewogICAgICAgIHJldHVybiBfdih0Mi5nZXRNaW51dGVzKCksIG4yLCAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBadih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3YodDIuZ2V0U2Vjb25kcygpLCBuMiwgMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gS3YodDIpIHsKICAgICAgICB2YXIgbjIgPSB0Mi5nZXREYXkoKTsKICAgICAgICByZXR1cm4gMCA9PT0gbjIgPyA3IDogbjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUXYodDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KHh5LmNvdW50KHR2KHQyKSAtIDEsIHQyKSwgbjIsIDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEp2KHQyKSB7CiAgICAgICAgdmFyIG4yID0gdDIuZ2V0RGF5KCk7CiAgICAgICAgcmV0dXJuIG4yID49IDQgfHwgMCA9PT0gbjIgPyBBeSh0MikgOiBBeS5jZWlsKHQyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB0Xyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gdDIgPSBKdih0MiksIF92KEF5LmNvdW50KHR2KHQyKSwgdDIpICsgKDQgPT09IHR2KHQyKS5nZXREYXkoKSksIG4yLCAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBuXyh0MikgewogICAgICAgIHJldHVybiB0Mi5nZXREYXkoKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBlXyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3Yod3kuY291bnQodHYodDIpIC0gMSwgdDIpLCBuMiwgMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcl8odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KHQyLmdldEZ1bGxZZWFyKCkgJSAxMDAsIG4yLCAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBpXyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3YoKHQyID0gSnYodDIpKS5nZXRGdWxsWWVhcigpICUgMTAwLCBuMiwgMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gb18odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KHQyLmdldEZ1bGxZZWFyKCkgJSAxZTQsIG4yLCA0KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBhXyh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSB0Mi5nZXREYXkoKTsKICAgICAgICByZXR1cm4gX3YoKHQyID0gZTIgPj0gNCB8fCAwID09PSBlMiA/IEF5KHQyKSA6IEF5LmNlaWwodDIpKS5nZXRGdWxsWWVhcigpICUgMWU0LCBuMiwgNCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdV8odDIpIHsKICAgICAgICB2YXIgbjIgPSB0Mi5nZXRUaW1lem9uZU9mZnNldCgpOwogICAgICAgIHJldHVybiAobjIgPiAwID8gIi0iIDogKG4yICo9IC0xLCAiKyIpKSArIF92KG4yIC8gNjAgfCAwLCAiMCIsIDIpICsgX3YobjIgJSA2MCwgIjAiLCAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjXyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3YodDIuZ2V0VVRDRGF0ZSgpLCBuMiwgMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZl8odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KHQyLmdldFVUQ0hvdXJzKCksIG4yLCAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBzXyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3YodDIuZ2V0VVRDSG91cnMoKSAlIDEyIHx8IDEyLCBuMiwgMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbF8odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KDEgKyB5eS5jb3VudChldih0MiksIHQyKSwgbjIsIDMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGhfKHQyLCBuMikgewogICAgICAgIHJldHVybiBfdih0Mi5nZXRVVENNaWxsaXNlY29uZHMoKSwgbjIsIDMpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRfKHQyLCBuMikgewogICAgICAgIHJldHVybiBoXyh0MiwgbjIpICsgIjAwMCI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcF8odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KHQyLmdldFVUQ01vbnRoKCkgKyAxLCBuMiwgMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZ18odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF92KHQyLmdldFVUQ01pbnV0ZXMoKSwgbjIsIDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHlfKHQyLCBuMikgewogICAgICAgIHJldHVybiBfdih0Mi5nZXRVVENTZWNvbmRzKCksIG4yLCAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiB2Xyh0MikgewogICAgICAgIHZhciBuMiA9IHQyLmdldFVUQ0RheSgpOwogICAgICAgIHJldHVybiAwID09PSBuMiA/IDcgOiBuMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBfXyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3YoRnkuY291bnQoZXYodDIpIC0gMSwgdDIpLCBuMiwgMik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gYl8odDIpIHsKICAgICAgICB2YXIgbjIgPSB0Mi5nZXRVVENEYXkoKTsKICAgICAgICByZXR1cm4gbjIgPj0gNCB8fCAwID09PSBuMiA/IE95KHQyKSA6IE95LmNlaWwodDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1fKHQyLCBuMikgewogICAgICAgIHJldHVybiB0MiA9IGJfKHQyKSwgX3YoT3kuY291bnQoZXYodDIpLCB0MikgKyAoNCA9PT0gZXYodDIpLmdldFVUQ0RheSgpKSwgbjIsIDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHhfKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLmdldFVUQ0RheSgpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHdfKHQyLCBuMikgewogICAgICAgIHJldHVybiBfdihxeS5jb3VudChldih0MikgLSAxLCB0MiksIG4yLCAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBNXyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3YodDIuZ2V0VVRDRnVsbFllYXIoKSAlIDEwMCwgbjIsIDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFRfKHQyLCBuMikgewogICAgICAgIHJldHVybiBfdigodDIgPSBiXyh0MikpLmdldFVUQ0Z1bGxZZWFyKCkgJSAxMDAsIG4yLCAyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBBXyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gX3YodDIuZ2V0VVRDRnVsbFllYXIoKSAlIDFlNCwgbjIsIDQpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFNfKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IHQyLmdldFVUQ0RheSgpOwogICAgICAgIHJldHVybiBfdigodDIgPSBlMiA+PSA0IHx8IDAgPT09IGUyID8gT3kodDIpIDogT3kuY2VpbCh0MikpLmdldFVUQ0Z1bGxZZWFyKCkgJSAxZTQsIG4yLCA0KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBFXygpIHsKICAgICAgICByZXR1cm4gIiswMDAwIjsKICAgICAgfQogICAgICBmdW5jdGlvbiBOXygpIHsKICAgICAgICByZXR1cm4gIiUiOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGtfKHQyKSB7CiAgICAgICAgcmV0dXJuICt0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBDXyh0MikgewogICAgICAgIHJldHVybiBNYXRoLmZsb29yKCt0MiAvIDFlMyk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUF8objIpIHsKICAgICAgICByZXR1cm4gZHYgPSBodihuMiksIHQudGltZUZvcm1hdCA9IGR2LmZvcm1hdCwgdC50aW1lUGFyc2UgPSBkdi5wYXJzZSwgdC51dGNGb3JtYXQgPSBkdi51dGNGb3JtYXQsIHQudXRjUGFyc2UgPSBkdi51dGNQYXJzZSwgZHY7CiAgICAgIH0KICAgICAgdC50aW1lRm9ybWF0ID0gdm9pZCAwLCB0LnRpbWVQYXJzZSA9IHZvaWQgMCwgdC51dGNGb3JtYXQgPSB2b2lkIDAsIHQudXRjUGFyc2UgPSB2b2lkIDAsIFBfKHsgZGF0ZVRpbWU6ICIleCwgJVgiLCBkYXRlOiAiJS1tLyUtZC8lWSIsIHRpbWU6ICIlLUk6JU06JVMgJXAiLCBwZXJpb2RzOiBbIkFNIiwgIlBNIl0sIGRheXM6IFsiU3VuZGF5IiwgIk1vbmRheSIsICJUdWVzZGF5IiwgIldlZG5lc2RheSIsICJUaHVyc2RheSIsICJGcmlkYXkiLCAiU2F0dXJkYXkiXSwgc2hvcnREYXlzOiBbIlN1biIsICJNb24iLCAiVHVlIiwgIldlZCIsICJUaHUiLCAiRnJpIiwgIlNhdCJdLCBtb250aHM6IFsiSmFudWFyeSIsICJGZWJydWFyeSIsICJNYXJjaCIsICJBcHJpbCIsICJNYXkiLCAiSnVuZSIsICJKdWx5IiwgIkF1Z3VzdCIsICJTZXB0ZW1iZXIiLCAiT2N0b2JlciIsICJOb3ZlbWJlciIsICJEZWNlbWJlciJdLCBzaG9ydE1vbnRoczogWyJKYW4iLCAiRmViIiwgIk1hciIsICJBcHIiLCAiTWF5IiwgIkp1biIsICJKdWwiLCAiQXVnIiwgIlNlcCIsICJPY3QiLCAiTm92IiwgIkRlYyJdIH0pOwogICAgICB2YXIgel8gPSAiJVktJW0tJWRUJUg6JU06JVMuJUxaIjsKICAgICAgdmFyICRfID0gRGF0ZS5wcm90b3R5cGUudG9JU09TdHJpbmcgPyBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0Mi50b0lTT1N0cmluZygpOwogICAgICB9IDogdC51dGNGb3JtYXQoel8pLCBEXyA9ICRfOwogICAgICB2YXIgUl8gPSArLyogQF9fUFVSRV9fICovIG5ldyBEYXRlKCIyMDAwLTAxLTAxVDAwOjAwOjAwLjAwMFoiKSA/IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgdmFyIG4yID0gbmV3IERhdGUodDIpOwogICAgICAgIHJldHVybiBpc05hTihuMikgPyBudWxsIDogbjI7CiAgICAgIH0gOiB0LnV0Y1BhcnNlKHpfKSwgRl8gPSBSXzsKICAgICAgZnVuY3Rpb24gcV8odDIpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUodDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFVfKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyIGluc3RhbmNlb2YgRGF0ZSA/ICt0MiA6ICsvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoK3QyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBJXyh0MiwgbjIsIGUyLCByMiwgaTIsIG8yLCBhMiwgdTIsIGMyLCBmMikgewogICAgICAgIHZhciBzMiA9IFNnKCksIGwyID0gczIuaW52ZXJ0LCBoMiA9IHMyLmRvbWFpbiwgZDIgPSBmMigiLiVMIiksIHAyID0gZjIoIjolUyIpLCBnMiA9IGYyKCIlSTolTSIpLCB5MiA9IGYyKCIlSSAlcCIpLCB2MiA9IGYyKCIlYSAlZCIpLCBfMiA9IGYyKCIlYiAlZCIpLCBiMiA9IGYyKCIlQiIpLCBtMiA9IGYyKCIlWSIpOwogICAgICAgIGZ1bmN0aW9uIHgyKHQzKSB7CiAgICAgICAgICByZXR1cm4gKGMyKHQzKSA8IHQzID8gZDIgOiB1Mih0MykgPCB0MyA/IHAyIDogYTIodDMpIDwgdDMgPyBnMiA6IG8yKHQzKSA8IHQzID8geTIgOiByMih0MykgPCB0MyA/IGkyKHQzKSA8IHQzID8gdjIgOiBfMiA6IGUyKHQzKSA8IHQzID8gYjIgOiBtMikodDMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gczIuaW52ZXJ0ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShsMih0MykpOwogICAgICAgIH0sIHMyLmRvbWFpbiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IGgyKEFycmF5LmZyb20odDMsIFVfKSkgOiBoMigpLm1hcChxXyk7CiAgICAgICAgfSwgczIudGlja3MgPSBmdW5jdGlvbihuMykgewogICAgICAgICAgdmFyIGUzID0gaDIoKTsKICAgICAgICAgIHJldHVybiB0MihlM1swXSwgZTNbZTMubGVuZ3RoIC0gMV0sIG51bGwgPT0gbjMgPyAxMCA6IG4zKTsKICAgICAgICB9LCBzMi50aWNrRm9ybWF0ID0gZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICByZXR1cm4gbnVsbCA9PSBuMyA/IHgyIDogZjIobjMpOwogICAgICAgIH0sIHMyLm5pY2UgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgdmFyIGUzID0gaDIoKTsKICAgICAgICAgIHJldHVybiB0MyAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiB0My5yYW5nZSB8fCAodDMgPSBuMihlM1swXSwgZTNbZTMubGVuZ3RoIC0gMV0sIG51bGwgPT0gdDMgPyAxMCA6IHQzKSksIHQzID8gaDIoa2coZTMsIHQzKSkgOiBzMjsKICAgICAgICB9LCBzMi5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gVGcoczIsIElfKHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIsIGEyLCB1MiwgYzIsIGYyKSk7CiAgICAgICAgfSwgczI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gT18oKSB7CiAgICAgICAgdmFyIHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIgPSAwLCBhMiA9IDEsIHUyID0gbWcsIGMyID0gZmFsc2U7CiAgICAgICAgZnVuY3Rpb24gZjIobjMpIHsKICAgICAgICAgIHJldHVybiBudWxsID09IG4zIHx8IGlzTmFOKG4zID0gK24zKSA/IGkyIDogdTIoMCA9PT0gZTIgPyAwLjUgOiAobjMgPSAocjIobjMpIC0gdDIpICogZTIsIGMyID8gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgbjMpKSA6IG4zKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHMyKHQzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24objMpIHsKICAgICAgICAgICAgdmFyIGUzLCByMzsKICAgICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoW2UzLCByM10gPSBuMywgdTIgPSB0MyhlMywgcjMpLCBmMikgOiBbdTIoMCksIHUyKDEpXTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBmMi5kb21haW4gPSBmdW5jdGlvbihpMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoW28yLCBhMl0gPSBpMywgdDIgPSByMihvMiA9ICtvMiksIG4yID0gcjIoYTIgPSArYTIpLCBlMiA9IHQyID09PSBuMiA/IDAgOiAxIC8gKG4yIC0gdDIpLCBmMikgOiBbbzIsIGEyXTsKICAgICAgICB9LCBmMi5jbGFtcCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjMiA9ICEhdDMsIGYyKSA6IGMyOwogICAgICAgIH0sIGYyLmludGVycG9sYXRvciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh1MiA9IHQzLCBmMikgOiB1MjsKICAgICAgICB9LCBmMi5yYW5nZSA9IHMyKEdyKSwgZjIucmFuZ2VSb3VuZCA9IHMyKFZyKSwgZjIudW5rbm93biA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9IHQzLCBmMikgOiBpMjsKICAgICAgICB9LCBmdW5jdGlvbihpMykgewogICAgICAgICAgcmV0dXJuIHIyID0gaTMsIHQyID0gaTMobzIpLCBuMiA9IGkzKGEyKSwgZTIgPSB0MiA9PT0gbjIgPyAwIDogMSAvIChuMiAtIHQyKSwgZjI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBCXyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gbjIuZG9tYWluKHQyLmRvbWFpbigpKS5pbnRlcnBvbGF0b3IodDIuaW50ZXJwb2xhdG9yKCkpLmNsYW1wKHQyLmNsYW1wKCkpLnVua25vd24odDIudW5rbm93bigpKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBZXygpIHsKICAgICAgICB2YXIgdDIgPSBMZyhPXygpKTsKICAgICAgICByZXR1cm4gdDIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIEJfKHQyLCBZXygpKS5leHBvbmVudCh0Mi5leHBvbmVudCgpKTsKICAgICAgICB9LCBkZy5hcHBseSh0MiwgYXJndW1lbnRzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBMXygpIHsKICAgICAgICB2YXIgdDIsIG4yLCBlMiwgcjIsIGkyLCBvMiwgYTIsIHUyID0gMCwgYzIgPSAwLjUsIGYyID0gMSwgczIgPSAxLCBsMiA9IG1nLCBoMiA9IGZhbHNlOwogICAgICAgIGZ1bmN0aW9uIGQyKHQzKSB7CiAgICAgICAgICByZXR1cm4gaXNOYU4odDMgPSArdDMpID8gYTIgOiAodDMgPSAwLjUgKyAoKHQzID0gK28yKHQzKSkgLSBuMikgKiAoczIgKiB0MyA8IHMyICogbjIgPyByMiA6IGkyKSwgbDIoaDIgPyBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB0MykpIDogdDMpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcDIodDMpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihuMykgewogICAgICAgICAgICB2YXIgZTMsIHIzLCBpMzsKICAgICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoW2UzLCByMywgaTNdID0gbjMsIGwyID0gZGkodDMsIFtlMywgcjMsIGkzXSksIGQyKSA6IFtsMigwKSwgbDIoMC41KSwgbDIoMSldOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGQyLmRvbWFpbiA9IGZ1bmN0aW9uKGEzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChbdTIsIGMyLCBmMl0gPSBhMywgdDIgPSBvMih1MiA9ICt1MiksIG4yID0gbzIoYzIgPSArYzIpLCBlMiA9IG8yKGYyID0gK2YyKSwgcjIgPSB0MiA9PT0gbjIgPyAwIDogMC41IC8gKG4yIC0gdDIpLCBpMiA9IG4yID09PSBlMiA/IDAgOiAwLjUgLyAoZTIgLSBuMiksIHMyID0gbjIgPCB0MiA/IC0xIDogMSwgZDIpIDogW3UyLCBjMiwgZjJdOwogICAgICAgIH0sIGQyLmNsYW1wID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGgyID0gISF0MywgZDIpIDogaDI7CiAgICAgICAgfSwgZDIuaW50ZXJwb2xhdG9yID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGwyID0gdDMsIGQyKSA6IGwyOwogICAgICAgIH0sIGQyLnJhbmdlID0gcDIoR3IpLCBkMi5yYW5nZVJvdW5kID0gcDIoVnIpLCBkMi51bmtub3duID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGEyID0gdDMsIGQyKSA6IGEyOwogICAgICAgIH0sIGZ1bmN0aW9uKGEzKSB7CiAgICAgICAgICByZXR1cm4gbzIgPSBhMywgdDIgPSBhMyh1MiksIG4yID0gYTMoYzIpLCBlMiA9IGEzKGYyKSwgcjIgPSB0MiA9PT0gbjIgPyAwIDogMC41IC8gKG4yIC0gdDIpLCBpMiA9IG4yID09PSBlMiA/IDAgOiAwLjUgLyAoZTIgLSBuMiksIHMyID0gbjIgPCB0MiA/IC0xIDogMSwgZDI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBmdW5jdGlvbiBqXygpIHsKICAgICAgICB2YXIgdDIgPSBMZyhMXygpKTsKICAgICAgICByZXR1cm4gdDIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIEJfKHQyLCBqXygpKS5leHBvbmVudCh0Mi5leHBvbmVudCgpKTsKICAgICAgICB9LCBkZy5hcHBseSh0MiwgYXJndW1lbnRzKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBIXyh0MikgewogICAgICAgIGZvciAodmFyIG4yID0gdDIubGVuZ3RoIC8gNiB8IDAsIGUyID0gbmV3IEFycmF5KG4yKSwgcjIgPSAwOyByMiA8IG4yOyApCiAgICAgICAgICBlMltyMl0gPSAiIyIgKyB0Mi5zbGljZSg2ICogcjIsIDYgKiArK3IyKTsKICAgICAgICByZXR1cm4gZTI7CiAgICAgIH0KICAgICAgdmFyIFhfID0gSF8oIjFmNzdiNGZmN2YwZTJjYTAyY2Q2MjcyODk0NjdiZDhjNTY0YmUzNzdjMjdmN2Y3ZmJjYmQyMjE3YmVjZiIpLCBHXyA9IEhfKCI3ZmM5N2ZiZWFlZDRmZGMwODZmZmZmOTkzODZjYjBmMDAyN2ZiZjViMTc2NjY2NjYiKSwgVl8gPSBIXygiMWI5ZTc3ZDk1ZjAyNzU3MGIzZTcyOThhNjZhNjFlZTZhYjAyYTY3NjFkNjY2NjY2IiksIFdfID0gSF8oImE2Y2VlMzFmNzhiNGIyZGY4YTMzYTAyY2ZiOWE5OWUzMWExY2ZkYmY2ZmZmN2YwMGNhYjJkNjZhM2Q5YWZmZmY5OWIxNTkyOCIpLCBaXyA9IEhfKCJmYmI0YWViM2NkZTNjY2ViYzVkZWNiZTRmZWQ5YTZmZmZmY2NlNWQ4YmRmZGRhZWNmMmYyZjIiKSwgS18gPSBIXygiYjNlMmNkZmRjZGFjY2JkNWU4ZjRjYWU0ZTZmNWM5ZmZmMmFlZjFlMmNjY2NjY2NjIiksIFFfID0gSF8oImU0MWExYzM3N2ViODRkYWY0YTk4NGVhM2ZmN2YwMGZmZmYzM2E2NTYyOGY3ODFiZjk5OTk5OSIpLCBKXyA9IEhfKCI2NmMyYTVmYzhkNjI4ZGEwY2JlNzhhYzNhNmQ4NTRmZmQ5MmZlNWM0OTRiM2IzYjMiKSwgdGIgPSBIXygiOGRkM2M3ZmZmZmIzYmViYWRhZmI4MDcyODBiMWQzZmRiNDYyYjNkZTY5ZmNjZGU1ZDlkOWQ5YmM4MGJkY2NlYmM1ZmZlZDZmIiksIG5iID0gSF8oIjRlNzlhN2YyOGUyY2UxNTc1OTc2YjdiMjU5YTE0ZmVkYzk0OWFmN2FhMWZmOWRhNzljNzU1ZmJhYjBhYiIpLCBlYiA9ICh0MikgPT4gRnIodDJbdDIubGVuZ3RoIC0gMV0pLCByYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImQ4YjM2NWY1ZjVmNTVhYjRhYyIsICJhNjYxMWFkZmMyN2Q4MGNkYzEwMTg1NzEiLCAiYTY2MTFhZGZjMjdkZjVmNWY1ODBjZGMxMDE4NTcxIiwgIjhjNTEwYWQ4YjM2NWY2ZThjM2M3ZWFlNTVhYjRhYzAxNjY1ZSIsICI4YzUxMGFkOGIzNjVmNmU4YzNmNWY1ZjVjN2VhZTU1YWI0YWMwMTY2NWUiLCAiOGM1MTBhYmY4MTJkZGZjMjdkZjZlOGMzYzdlYWU1ODBjZGMxMzU5NzhmMDE2NjVlIiwgIjhjNTEwYWJmODEyZGRmYzI3ZGY2ZThjM2Y1ZjVmNWM3ZWFlNTgwY2RjMTM1OTc4ZjAxNjY1ZSIsICI1NDMwMDU4YzUxMGFiZjgxMmRkZmMyN2RmNmU4YzNjN2VhZTU4MGNkYzEzNTk3OGYwMTY2NWUwMDNjMzAiLCAiNTQzMDA1OGM1MTBhYmY4MTJkZGZjMjdkZjZlOGMzZjVmNWY1YzdlYWU1ODBjZGMxMzU5NzhmMDE2NjVlMDAzYzMwIikubWFwKEhfKSwgaWIgPSBlYihyYiksIG9iID0gbmV3IEFycmF5KDMpLmNvbmNhdCgiYWY4ZGMzZjdmN2Y3N2ZiZjdiIiwgIjdiMzI5NGMyYTVjZmE2ZGJhMDAwODgzNyIsICI3YjMyOTRjMmE1Y2ZmN2Y3ZjdhNmRiYTAwMDg4MzciLCAiNzYyYTgzYWY4ZGMzZTdkNGU4ZDlmMGQzN2ZiZjdiMWI3ODM3IiwgIjc2MmE4M2FmOGRjM2U3ZDRlOGY3ZjdmN2Q5ZjBkMzdmYmY3YjFiNzgzNyIsICI3NjJhODM5OTcwYWJjMmE1Y2ZlN2Q0ZThkOWYwZDNhNmRiYTA1YWFlNjExYjc4MzciLCAiNzYyYTgzOTk3MGFiYzJhNWNmZTdkNGU4ZjdmN2Y3ZDlmMGQzYTZkYmEwNWFhZTYxMWI3ODM3IiwgIjQwMDA0Yjc2MmE4Mzk5NzBhYmMyYTVjZmU3ZDRlOGQ5ZjBkM2E2ZGJhMDVhYWU2MTFiNzgzNzAwNDQxYiIsICI0MDAwNGI3NjJhODM5OTcwYWJjMmE1Y2ZlN2Q0ZThmN2Y3ZjdkOWYwZDNhNmRiYTA1YWFlNjExYjc4MzcwMDQ0MWIiKS5tYXAoSF8pLCBhYiA9IGViKG9iKSwgdWIgPSBuZXcgQXJyYXkoMykuY29uY2F0KCJlOWEzYzlmN2Y3ZjdhMWQ3NmEiLCAiZDAxYzhiZjFiNmRhYjhlMTg2NGRhYzI2IiwgImQwMWM4YmYxYjZkYWY3ZjdmN2I4ZTE4NjRkYWMyNiIsICJjNTFiN2RlOWEzYzlmZGUwZWZlNmY1ZDBhMWQ3NmE0ZDkyMjEiLCAiYzUxYjdkZTlhM2M5ZmRlMGVmZjdmN2Y3ZTZmNWQwYTFkNzZhNGQ5MjIxIiwgImM1MWI3ZGRlNzdhZWYxYjZkYWZkZTBlZmU2ZjVkMGI4ZTE4NjdmYmM0MTRkOTIyMSIsICJjNTFiN2RkZTc3YWVmMWI2ZGFmZGUwZWZmN2Y3ZjdlNmY1ZDBiOGUxODY3ZmJjNDE0ZDkyMjEiLCAiOGUwMTUyYzUxYjdkZGU3N2FlZjFiNmRhZmRlMGVmZTZmNWQwYjhlMTg2N2ZiYzQxNGQ5MjIxMjc2NDE5IiwgIjhlMDE1MmM1MWI3ZGRlNzdhZWYxYjZkYWZkZTBlZmY3ZjdmN2U2ZjVkMGI4ZTE4NjdmYmM0MTRkOTIyMTI3NjQxOSIpLm1hcChIXyksIGNiID0gZWIodWIpLCBmYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoIjk5OGVjM2Y3ZjdmN2YxYTM0MCIsICI1ZTNjOTliMmFiZDJmZGI4NjNlNjYxMDEiLCAiNWUzYzk5YjJhYmQyZjdmN2Y3ZmRiODYzZTY2MTAxIiwgIjU0Mjc4ODk5OGVjM2Q4ZGFlYmZlZTBiNmYxYTM0MGIzNTgwNiIsICI1NDI3ODg5OThlYzNkOGRhZWJmN2Y3ZjdmZWUwYjZmMWEzNDBiMzU4MDYiLCAiNTQyNzg4ODA3M2FjYjJhYmQyZDhkYWViZmVlMGI2ZmRiODYzZTA4MjE0YjM1ODA2IiwgIjU0Mjc4ODgwNzNhY2IyYWJkMmQ4ZGFlYmY3ZjdmN2ZlZTBiNmZkYjg2M2UwODIxNGIzNTgwNiIsICIyZDAwNGI1NDI3ODg4MDczYWNiMmFiZDJkOGRhZWJmZWUwYjZmZGI4NjNlMDgyMTRiMzU4MDY3ZjNiMDgiLCAiMmQwMDRiNTQyNzg4ODA3M2FjYjJhYmQyZDhkYWViZjdmN2Y3ZmVlMGI2ZmRiODYzZTA4MjE0YjM1ODA2N2YzYjA4IikubWFwKEhfKSwgc2IgPSBlYihmYiksIGxiID0gbmV3IEFycmF5KDMpLmNvbmNhdCgiZWY4YTYyZjdmN2Y3NjdhOWNmIiwgImNhMDAyMGY0YTU4MjkyYzVkZTA1NzFiMCIsICJjYTAwMjBmNGE1ODJmN2Y3Zjc5MmM1ZGUwNTcxYjAiLCAiYjIxODJiZWY4YTYyZmRkYmM3ZDFlNWYwNjdhOWNmMjE2NmFjIiwgImIyMTgyYmVmOGE2MmZkZGJjN2Y3ZjdmN2QxZTVmMDY3YTljZjIxNjZhYyIsICJiMjE4MmJkNjYwNGRmNGE1ODJmZGRiYzdkMWU1ZjA5MmM1ZGU0MzkzYzMyMTY2YWMiLCAiYjIxODJiZDY2MDRkZjRhNTgyZmRkYmM3ZjdmN2Y3ZDFlNWYwOTJjNWRlNDM5M2MzMjE2NmFjIiwgIjY3MDAxZmIyMTgyYmQ2NjA0ZGY0YTU4MmZkZGJjN2QxZTVmMDkyYzVkZTQzOTNjMzIxNjZhYzA1MzA2MSIsICI2NzAwMWZiMjE4MmJkNjYwNGRmNGE1ODJmZGRiYzdmN2Y3ZjdkMWU1ZjA5MmM1ZGU0MzkzYzMyMTY2YWMwNTMwNjEiKS5tYXAoSF8pLCBoYiA9IGViKGxiKSwgZGIgPSBuZXcgQXJyYXkoMykuY29uY2F0KCJlZjhhNjJmZmZmZmY5OTk5OTkiLCAiY2EwMDIwZjRhNTgyYmFiYWJhNDA0MDQwIiwgImNhMDAyMGY0YTU4MmZmZmZmZmJhYmFiYTQwNDA0MCIsICJiMjE4MmJlZjhhNjJmZGRiYzdlMGUwZTA5OTk5OTk0ZDRkNGQiLCAiYjIxODJiZWY4YTYyZmRkYmM3ZmZmZmZmZTBlMGUwOTk5OTk5NGQ0ZDRkIiwgImIyMTgyYmQ2NjA0ZGY0YTU4MmZkZGJjN2UwZTBlMGJhYmFiYTg3ODc4NzRkNGQ0ZCIsICJiMjE4MmJkNjYwNGRmNGE1ODJmZGRiYzdmZmZmZmZlMGUwZTBiYWJhYmE4Nzg3ODc0ZDRkNGQiLCAiNjcwMDFmYjIxODJiZDY2MDRkZjRhNTgyZmRkYmM3ZTBlMGUwYmFiYWJhODc4Nzg3NGQ0ZDRkMWExYTFhIiwgIjY3MDAxZmIyMTgyYmQ2NjA0ZGY0YTU4MmZkZGJjN2ZmZmZmZmUwZTBlMGJhYmFiYTg3ODc4NzRkNGQ0ZDFhMWExYSIpLm1hcChIXyksIHBiID0gZWIoZGIpLCBnYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImZjOGQ1OWZmZmZiZjkxYmZkYiIsICJkNzE5MWNmZGFlNjFhYmQ5ZTkyYzdiYjYiLCAiZDcxOTFjZmRhZTYxZmZmZmJmYWJkOWU5MmM3YmI2IiwgImQ3MzAyN2ZjOGQ1OWZlZTA5MGUwZjNmODkxYmZkYjQ1NzViNCIsICJkNzMwMjdmYzhkNTlmZWUwOTBmZmZmYmZlMGYzZjg5MWJmZGI0NTc1YjQiLCAiZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDkwZTBmM2Y4YWJkOWU5NzRhZGQxNDU3NWI0IiwgImQ3MzAyN2Y0NmQ0M2ZkYWU2MWZlZTA5MGZmZmZiZmUwZjNmOGFiZDllOTc0YWRkMTQ1NzViNCIsICJhNTAwMjZkNzMwMjdmNDZkNDNmZGFlNjFmZWUwOTBlMGYzZjhhYmQ5ZTk3NGFkZDE0NTc1YjQzMTM2OTUiLCAiYTUwMDI2ZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDkwZmZmZmJmZTBmM2Y4YWJkOWU5NzRhZGQxNDU3NWI0MzEzNjk1IikubWFwKEhfKSwgeWIgPSBlYihnYiksIHZiID0gbmV3IEFycmF5KDMpLmNvbmNhdCgiZmM4ZDU5ZmZmZmJmOTFjZjYwIiwgImQ3MTkxY2ZkYWU2MWE2ZDk2YTFhOTY0MSIsICJkNzE5MWNmZGFlNjFmZmZmYmZhNmQ5NmExYTk2NDEiLCAiZDczMDI3ZmM4ZDU5ZmVlMDhiZDllZjhiOTFjZjYwMWE5ODUwIiwgImQ3MzAyN2ZjOGQ1OWZlZTA4YmZmZmZiZmQ5ZWY4YjkxY2Y2MDFhOTg1MCIsICJkNzMwMjdmNDZkNDNmZGFlNjFmZWUwOGJkOWVmOGJhNmQ5NmE2NmJkNjMxYTk4NTAiLCAiZDczMDI3ZjQ2ZDQzZmRhZTYxZmVlMDhiZmZmZmJmZDllZjhiYTZkOTZhNjZiZDYzMWE5ODUwIiwgImE1MDAyNmQ3MzAyN2Y0NmQ0M2ZkYWU2MWZlZTA4YmQ5ZWY4YmE2ZDk2YTY2YmQ2MzFhOTg1MDAwNjgzNyIsICJhNTAwMjZkNzMwMjdmNDZkNDNmZGFlNjFmZWUwOGJmZmZmYmZkOWVmOGJhNmQ5NmE2NmJkNjMxYTk4NTAwMDY4MzciKS5tYXAoSF8pLCBfYiA9IGViKHZiKSwgYmIgPSBuZXcgQXJyYXkoMykuY29uY2F0KCJmYzhkNTlmZmZmYmY5OWQ1OTQiLCAiZDcxOTFjZmRhZTYxYWJkZGE0MmI4M2JhIiwgImQ3MTkxY2ZkYWU2MWZmZmZiZmFiZGRhNDJiODNiYSIsICJkNTNlNGZmYzhkNTlmZWUwOGJlNmY1OTg5OWQ1OTQzMjg4YmQiLCAiZDUzZTRmZmM4ZDU5ZmVlMDhiZmZmZmJmZTZmNTk4OTlkNTk0MzI4OGJkIiwgImQ1M2U0ZmY0NmQ0M2ZkYWU2MWZlZTA4YmU2ZjU5OGFiZGRhNDY2YzJhNTMyODhiZCIsICJkNTNlNGZmNDZkNDNmZGFlNjFmZWUwOGJmZmZmYmZlNmY1OThhYmRkYTQ2NmMyYTUzMjg4YmQiLCAiOWUwMTQyZDUzZTRmZjQ2ZDQzZmRhZTYxZmVlMDhiZTZmNTk4YWJkZGE0NjZjMmE1MzI4OGJkNWU0ZmEyIiwgIjllMDE0MmQ1M2U0ZmY0NmQ0M2ZkYWU2MWZlZTA4YmZmZmZiZmU2ZjU5OGFiZGRhNDY2YzJhNTMyODhiZDVlNGZhMiIpLm1hcChIXyksIG1iID0gZWIoYmIpLCB4YiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImU1ZjVmOTk5ZDhjOTJjYTI1ZiIsICJlZGY4ZmJiMmUyZTI2NmMyYTQyMzhiNDUiLCAiZWRmOGZiYjJlMmUyNjZjMmE0MmNhMjVmMDA2ZDJjIiwgImVkZjhmYmNjZWNlNjk5ZDhjOTY2YzJhNDJjYTI1ZjAwNmQyYyIsICJlZGY4ZmJjY2VjZTY5OWQ4Yzk2NmMyYTQ0MWFlNzYyMzhiNDUwMDU4MjQiLCAiZjdmY2ZkZTVmNWY5Y2NlY2U2OTlkOGM5NjZjMmE0NDFhZTc2MjM4YjQ1MDA1ODI0IiwgImY3ZmNmZGU1ZjVmOWNjZWNlNjk5ZDhjOTY2YzJhNDQxYWU3NjIzOGI0NTAwNmQyYzAwNDQxYiIpLm1hcChIXyksIHdiID0gZWIoeGIpLCBNYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImUwZWNmNDllYmNkYTg4NTZhNyIsICJlZGY4ZmJiM2NkZTM4Yzk2YzY4ODQxOWQiLCAiZWRmOGZiYjNjZGUzOGM5NmM2ODg1NmE3ODEwZjdjIiwgImVkZjhmYmJmZDNlNjllYmNkYThjOTZjNjg4NTZhNzgxMGY3YyIsICJlZGY4ZmJiZmQzZTY5ZWJjZGE4Yzk2YzY4YzZiYjE4ODQxOWQ2ZTAxNmIiLCAiZjdmY2ZkZTBlY2Y0YmZkM2U2OWViY2RhOGM5NmM2OGM2YmIxODg0MTlkNmUwMTZiIiwgImY3ZmNmZGUwZWNmNGJmZDNlNjllYmNkYThjOTZjNjhjNmJiMTg4NDE5ZDgxMGY3YzRkMDA0YiIpLm1hcChIXyksIFRiID0gZWIoTWIpLCBBYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImUwZjNkYmE4ZGRiNTQzYTJjYSIsICJmMGY5ZThiYWU0YmM3YmNjYzQyYjhjYmUiLCAiZjBmOWU4YmFlNGJjN2JjY2M0NDNhMmNhMDg2OGFjIiwgImYwZjllOGNjZWJjNWE4ZGRiNTdiY2NjNDQzYTJjYTA4NjhhYyIsICJmMGY5ZThjY2ViYzVhOGRkYjU3YmNjYzQ0ZWIzZDMyYjhjYmUwODU4OWUiLCAiZjdmY2YwZTBmM2RiY2NlYmM1YThkZGI1N2JjY2M0NGViM2QzMmI4Y2JlMDg1ODllIiwgImY3ZmNmMGUwZjNkYmNjZWJjNWE4ZGRiNTdiY2NjNDRlYjNkMzJiOGNiZTA4NjhhYzA4NDA4MSIpLm1hcChIXyksIFNiID0gZWIoQWIpLCBFYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImZlZThjOGZkYmI4NGUzNGEzMyIsICJmZWYwZDlmZGNjOGFmYzhkNTlkNzMwMWYiLCAiZmVmMGQ5ZmRjYzhhZmM4ZDU5ZTM0YTMzYjMwMDAwIiwgImZlZjBkOWZkZDQ5ZWZkYmI4NGZjOGQ1OWUzNGEzM2IzMDAwMCIsICJmZWYwZDlmZGQ0OWVmZGJiODRmYzhkNTllZjY1NDhkNzMwMWY5OTAwMDAiLCAiZmZmN2VjZmVlOGM4ZmRkNDllZmRiYjg0ZmM4ZDU5ZWY2NTQ4ZDczMDFmOTkwMDAwIiwgImZmZjdlY2ZlZThjOGZkZDQ5ZWZkYmI4NGZjOGQ1OWVmNjU0OGQ3MzAxZmIzMDAwMDdmMDAwMCIpLm1hcChIXyksIE5iID0gZWIoRWIpLCBrYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImVjZTJmMGE2YmRkYjFjOTA5OSIsICJmNmVmZjdiZGM5ZTE2N2E5Y2YwMjgxOGEiLCAiZjZlZmY3YmRjOWUxNjdhOWNmMWM5MDk5MDE2YzU5IiwgImY2ZWZmN2QwZDFlNmE2YmRkYjY3YTljZjFjOTA5OTAxNmM1OSIsICJmNmVmZjdkMGQxZTZhNmJkZGI2N2E5Y2YzNjkwYzAwMjgxOGEwMTY0NTAiLCAiZmZmN2ZiZWNlMmYwZDBkMWU2YTZiZGRiNjdhOWNmMzY5MGMwMDI4MThhMDE2NDUwIiwgImZmZjdmYmVjZTJmMGQwZDFlNmE2YmRkYjY3YTljZjM2OTBjMDAyODE4YTAxNmM1OTAxNDYzNiIpLm1hcChIXyksIENiID0gZWIoa2IpLCBQYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImVjZTdmMmE2YmRkYjJiOGNiZSIsICJmMWVlZjZiZGM5ZTE3NGE5Y2YwNTcwYjAiLCAiZjFlZWY2YmRjOWUxNzRhOWNmMmI4Y2JlMDQ1YThkIiwgImYxZWVmNmQwZDFlNmE2YmRkYjc0YTljZjJiOGNiZTA0NWE4ZCIsICJmMWVlZjZkMGQxZTZhNmJkZGI3NGE5Y2YzNjkwYzAwNTcwYjAwMzRlN2IiLCAiZmZmN2ZiZWNlN2YyZDBkMWU2YTZiZGRiNzRhOWNmMzY5MGMwMDU3MGIwMDM0ZTdiIiwgImZmZjdmYmVjZTdmMmQwZDFlNmE2YmRkYjc0YTljZjM2OTBjMDA1NzBiMDA0NWE4ZDAyMzg1OCIpLm1hcChIXyksIHpiID0gZWIoUGIpLCAkYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImU3ZTFlZmM5OTRjN2RkMWM3NyIsICJmMWVlZjZkN2I1ZDhkZjY1YjBjZTEyNTYiLCAiZjFlZWY2ZDdiNWQ4ZGY2NWIwZGQxYzc3OTgwMDQzIiwgImYxZWVmNmQ0YjlkYWM5OTRjN2RmNjViMGRkMWM3Nzk4MDA0MyIsICJmMWVlZjZkNGI5ZGFjOTk0YzdkZjY1YjBlNzI5OGFjZTEyNTY5MTAwM2YiLCAiZjdmNGY5ZTdlMWVmZDRiOWRhYzk5NGM3ZGY2NWIwZTcyOThhY2UxMjU2OTEwMDNmIiwgImY3ZjRmOWU3ZTFlZmQ0YjlkYWM5OTRjN2RmNjViMGU3Mjk4YWNlMTI1Njk4MDA0MzY3MDAxZiIpLm1hcChIXyksIERiID0gZWIoJGIpLCBSYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImZkZTBkZGZhOWZiNWM1MWI4YSIsICJmZWViZTJmYmI0YjlmNzY4YTFhZTAxN2UiLCAiZmVlYmUyZmJiNGI5Zjc2OGExYzUxYjhhN2EwMTc3IiwgImZlZWJlMmZjYzVjMGZhOWZiNWY3NjhhMWM1MWI4YTdhMDE3NyIsICJmZWViZTJmY2M1YzBmYTlmYjVmNzY4YTFkZDM0OTdhZTAxN2U3YTAxNzciLCAiZmZmN2YzZmRlMGRkZmNjNWMwZmE5ZmI1Zjc2OGExZGQzNDk3YWUwMTdlN2EwMTc3IiwgImZmZjdmM2ZkZTBkZGZjYzVjMGZhOWZiNWY3NjhhMWRkMzQ5N2FlMDE3ZTdhMDE3NzQ5MDA2YSIpLm1hcChIXyksIEZiID0gZWIoUmIpLCBxYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImVkZjhiMTdmY2RiYjJjN2ZiOCIsICJmZmZmY2NhMWRhYjQ0MWI2YzQyMjVlYTgiLCAiZmZmZmNjYTFkYWI0NDFiNmM0MmM3ZmI4MjUzNDk0IiwgImZmZmZjY2M3ZTliNDdmY2RiYjQxYjZjNDJjN2ZiODI1MzQ5NCIsICJmZmZmY2NjN2U5YjQ3ZmNkYmI0MWI2YzQxZDkxYzAyMjVlYTgwYzJjODQiLCAiZmZmZmQ5ZWRmOGIxYzdlOWI0N2ZjZGJiNDFiNmM0MWQ5MWMwMjI1ZWE4MGMyYzg0IiwgImZmZmZkOWVkZjhiMWM3ZTliNDdmY2RiYjQxYjZjNDFkOTFjMDIyNWVhODI1MzQ5NDA4MWQ1OCIpLm1hcChIXyksIFViID0gZWIocWIpLCBJYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImY3ZmNiOWFkZGQ4ZTMxYTM1NCIsICJmZmZmY2NjMmU2OTk3OGM2NzkyMzg0NDMiLCAiZmZmZmNjYzJlNjk5NzhjNjc5MzFhMzU0MDA2ODM3IiwgImZmZmZjY2Q5ZjBhM2FkZGQ4ZTc4YzY3OTMxYTM1NDAwNjgzNyIsICJmZmZmY2NkOWYwYTNhZGRkOGU3OGM2Nzk0MWFiNWQyMzg0NDMwMDVhMzIiLCAiZmZmZmU1ZjdmY2I5ZDlmMGEzYWRkZDhlNzhjNjc5NDFhYjVkMjM4NDQzMDA1YTMyIiwgImZmZmZlNWY3ZmNiOWQ5ZjBhM2FkZGQ4ZTc4YzY3OTQxYWI1ZDIzODQ0MzAwNjgzNzAwNDUyOSIpLm1hcChIXyksIE9iID0gZWIoSWIpLCBCYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImZmZjdiY2ZlYzQ0ZmQ5NWYwZSIsICJmZmZmZDRmZWQ5OGVmZTk5MjljYzRjMDIiLCAiZmZmZmQ0ZmVkOThlZmU5OTI5ZDk1ZjBlOTkzNDA0IiwgImZmZmZkNGZlZTM5MWZlYzQ0ZmZlOTkyOWQ5NWYwZTk5MzQwNCIsICJmZmZmZDRmZWUzOTFmZWM0NGZmZTk5MjllYzcwMTRjYzRjMDI4YzJkMDQiLCAiZmZmZmU1ZmZmN2JjZmVlMzkxZmVjNDRmZmU5OTI5ZWM3MDE0Y2M0YzAyOGMyZDA0IiwgImZmZmZlNWZmZjdiY2ZlZTM5MWZlYzQ0ZmZlOTkyOWVjNzAxNGNjNGMwMjk5MzQwNDY2MjUwNiIpLm1hcChIXyksIFliID0gZWIoQmIpLCBMYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImZmZWRhMGZlYjI0Y2YwM2IyMCIsICJmZmZmYjJmZWNjNWNmZDhkM2NlMzFhMWMiLCAiZmZmZmIyZmVjYzVjZmQ4ZDNjZjAzYjIwYmQwMDI2IiwgImZmZmZiMmZlZDk3NmZlYjI0Y2ZkOGQzY2YwM2IyMGJkMDAyNiIsICJmZmZmYjJmZWQ5NzZmZWIyNGNmZDhkM2NmYzRlMmFlMzFhMWNiMTAwMjYiLCAiZmZmZmNjZmZlZGEwZmVkOTc2ZmViMjRjZmQ4ZDNjZmM0ZTJhZTMxYTFjYjEwMDI2IiwgImZmZmZjY2ZmZWRhMGZlZDk3NmZlYjI0Y2ZkOGQzY2ZjNGUyYWUzMWExY2JkMDAyNjgwMDAyNiIpLm1hcChIXyksIGpiID0gZWIoTGIpLCBIYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImRlZWJmNzllY2FlMTMxODJiZCIsICJlZmYzZmZiZGQ3ZTc2YmFlZDYyMTcxYjUiLCAiZWZmM2ZmYmRkN2U3NmJhZWQ2MzE4MmJkMDg1MTljIiwgImVmZjNmZmM2ZGJlZjllY2FlMTZiYWVkNjMxODJiZDA4NTE5YyIsICJlZmYzZmZjNmRiZWY5ZWNhZTE2YmFlZDY0MjkyYzYyMTcxYjUwODQ1OTQiLCAiZjdmYmZmZGVlYmY3YzZkYmVmOWVjYWUxNmJhZWQ2NDI5MmM2MjE3MWI1MDg0NTk0IiwgImY3ZmJmZmRlZWJmN2M2ZGJlZjllY2FlMTZiYWVkNjQyOTJjNjIxNzFiNTA4NTE5YzA4MzA2YiIpLm1hcChIXyksIFhiID0gZWIoSGIpLCBHYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImU1ZjVlMGExZDk5YjMxYTM1NCIsICJlZGY4ZTliYWU0YjM3NGM0NzYyMzhiNDUiLCAiZWRmOGU5YmFlNGIzNzRjNDc2MzFhMzU0MDA2ZDJjIiwgImVkZjhlOWM3ZTljMGExZDk5Yjc0YzQ3NjMxYTM1NDAwNmQyYyIsICJlZGY4ZTljN2U5YzBhMWQ5OWI3NGM0NzY0MWFiNWQyMzhiNDUwMDVhMzIiLCAiZjdmY2Y1ZTVmNWUwYzdlOWMwYTFkOTliNzRjNDc2NDFhYjVkMjM4YjQ1MDA1YTMyIiwgImY3ZmNmNWU1ZjVlMGM3ZTljMGExZDk5Yjc0YzQ3NjQxYWI1ZDIzOGI0NTAwNmQyYzAwNDQxYiIpLm1hcChIXyksIFZiID0gZWIoR2IpLCBXYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImYwZjBmMGJkYmRiZDYzNjM2MyIsICJmN2Y3ZjdjY2NjY2M5Njk2OTY1MjUyNTIiLCAiZjdmN2Y3Y2NjY2NjOTY5Njk2NjM2MzYzMjUyNTI1IiwgImY3ZjdmN2Q5ZDlkOWJkYmRiZDk2OTY5NjYzNjM2MzI1MjUyNSIsICJmN2Y3ZjdkOWQ5ZDliZGJkYmQ5Njk2OTY3MzczNzM1MjUyNTIyNTI1MjUiLCAiZmZmZmZmZjBmMGYwZDlkOWQ5YmRiZGJkOTY5Njk2NzM3MzczNTI1MjUyMjUyNTI1IiwgImZmZmZmZmYwZjBmMGQ5ZDlkOWJkYmRiZDk2OTY5NjczNzM3MzUyNTI1MjI1MjUyNTAwMDAwMCIpLm1hcChIXyksIFpiID0gZWIoV2IpLCBLYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImVmZWRmNWJjYmRkYzc1NmJiMSIsICJmMmYwZjdjYmM5ZTI5ZTlhYzg2YTUxYTMiLCAiZjJmMGY3Y2JjOWUyOWU5YWM4NzU2YmIxNTQyNzhmIiwgImYyZjBmN2RhZGFlYmJjYmRkYzllOWFjODc1NmJiMTU0Mjc4ZiIsICJmMmYwZjdkYWRhZWJiY2JkZGM5ZTlhYzg4MDdkYmE2YTUxYTM0YTE0ODYiLCAiZmNmYmZkZWZlZGY1ZGFkYWViYmNiZGRjOWU5YWM4ODA3ZGJhNmE1MWEzNGExNDg2IiwgImZjZmJmZGVmZWRmNWRhZGFlYmJjYmRkYzllOWFjODgwN2RiYTZhNTFhMzU0Mjc4ZjNmMDA3ZCIpLm1hcChIXyksIFFiID0gZWIoS2IpLCBKYiA9IG5ldyBBcnJheSgzKS5jb25jYXQoImZlZTBkMmZjOTI3MmRlMmQyNiIsICJmZWU1ZDlmY2FlOTFmYjZhNGFjYjE4MWQiLCAiZmVlNWQ5ZmNhZTkxZmI2YTRhZGUyZDI2YTUwZjE1IiwgImZlZTVkOWZjYmJhMWZjOTI3MmZiNmE0YWRlMmQyNmE1MGYxNSIsICJmZWU1ZDlmY2JiYTFmYzkyNzJmYjZhNGFlZjNiMmNjYjE4MWQ5OTAwMGQiLCAiZmZmNWYwZmVlMGQyZmNiYmExZmM5MjcyZmI2YTRhZWYzYjJjY2IxODFkOTkwMDBkIiwgImZmZjVmMGZlZTBkMmZjYmJhMWZjOTI3MmZiNmE0YWVmM2IyY2NiMTgxZGE1MGYxNTY3MDAwZCIpLm1hcChIXyksIHRtID0gZWIoSmIpLCBubSA9IG5ldyBBcnJheSgzKS5jb25jYXQoImZlZTZjZWZkYWU2YmU2NTUwZCIsICJmZWVkZGVmZGJlODVmZDhkM2NkOTQ3MDEiLCAiZmVlZGRlZmRiZTg1ZmQ4ZDNjZTY1NTBkYTYzNjAzIiwgImZlZWRkZWZkZDBhMmZkYWU2YmZkOGQzY2U2NTUwZGE2MzYwMyIsICJmZWVkZGVmZGQwYTJmZGFlNmJmZDhkM2NmMTY5MTNkOTQ4MDE4YzJkMDQiLCAiZmZmNWViZmVlNmNlZmRkMGEyZmRhZTZiZmQ4ZDNjZjE2OTEzZDk0ODAxOGMyZDA0IiwgImZmZjVlYmZlZTZjZWZkZDBhMmZkYWU2YmZkOGQzY2YxNjkxM2Q5NDgwMWE2MzYwMzdmMjcwNCIpLm1hcChIXyksIGVtID0gZWIobm0pOwogICAgICB2YXIgcm0gPSBoaShUcigzMDAsIDAuNSwgMCksIFRyKC0yNDAsIDAuNSwgMSkpLCBpbSA9IGhpKFRyKC0xMDAsIDAuNzUsIDAuMzUpLCBUcig4MCwgMS41LCAwLjgpKSwgb20gPSBoaShUcigyNjAsIDAuNzUsIDAuMzUpLCBUcig4MCwgMS41LCAwLjgpKSwgYW0gPSBUcigpOwogICAgICB2YXIgdW0gPSBGZSgpLCBjbSA9IE1hdGguUEkgLyAzLCBmbSA9IDIgKiBNYXRoLlBJIC8gMzsKICAgICAgZnVuY3Rpb24gc20odDIpIHsKICAgICAgICB2YXIgbjIgPSB0Mi5sZW5ndGg7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGUyKSB7CiAgICAgICAgICByZXR1cm4gdDJbTWF0aC5tYXgoMCwgTWF0aC5taW4objIgLSAxLCBNYXRoLmZsb29yKGUyICogbjIpKSldOwogICAgICAgIH07CiAgICAgIH0KICAgICAgdmFyIGxtID0gc20oSF8oIjQ0MDE1NDQ0MDI1NjQ1MDQ1NzQ1MDU1OTQ2MDc1YTQ2MDg1YzQ2MGE1ZDQ2MGI1ZTQ3MGQ2MDQ3MGU2MTQ3MTA2MzQ3MTE2NDQ3MTM2NTQ4MTQ2NzQ4MTY2ODQ4MTc2OTQ4MTg2YTQ4MWE2YzQ4MWI2ZDQ4MWM2ZTQ4MWQ2ZjQ4MWY3MDQ4MjA3MTQ4MjE3MzQ4MjM3NDQ4MjQ3NTQ4MjU3NjQ4MjY3NzQ4Mjg3ODQ4Mjk3OTQ3MmE3YTQ3MmM3YTQ3MmQ3YjQ3MmU3YzQ3MmY3ZDQ2MzA3ZTQ2MzI3ZTQ2MzM3ZjQ2MzQ4MDQ1MzU4MTQ1Mzc4MTQ1Mzg4MjQ0Mzk4MzQ0M2E4MzQ0M2I4NDQzM2Q4NDQzM2U4NTQyM2Y4NTQyNDA4NjQyNDE4NjQxNDI4NzQxNDQ4NzQwNDU4ODQwNDY4ODNmNDc4ODNmNDg4OTNlNDk4OTNlNGE4OTNlNGM4YTNkNGQ4YTNkNGU4YTNjNGY4YTNjNTA4YjNiNTE4YjNiNTI4YjNhNTM4YjNhNTQ4YzM5NTU4YzM5NTY4YzM4NTg4YzM4NTk4YzM3NWE4YzM3NWI4ZDM2NWM4ZDM2NWQ4ZDM1NWU4ZDM1NWY4ZDM0NjA4ZDM0NjE4ZDMzNjI4ZDMzNjM4ZDMyNjQ4ZTMyNjU4ZTMxNjY4ZTMxNjc4ZTMxNjg4ZTMwNjk4ZTMwNmE4ZTJmNmI4ZTJmNmM4ZTJlNmQ4ZTJlNmU4ZTJlNmY4ZTJkNzA4ZTJkNzE4ZTJjNzE4ZTJjNzI4ZTJjNzM4ZTJiNzQ4ZTJiNzU4ZTJhNzY4ZTJhNzc4ZTJhNzg4ZTI5Nzk4ZTI5N2E4ZTI5N2I4ZTI4N2M4ZTI4N2Q4ZTI3N2U4ZTI3N2Y4ZTI3ODA4ZTI2ODE4ZTI2ODI4ZTI2ODI4ZTI1ODM4ZTI1ODQ4ZTI1ODU4ZTI0ODY4ZTI0ODc4ZTIzODg4ZTIzODk4ZTIzOGE4ZDIyOGI4ZDIyOGM4ZDIyOGQ4ZDIxOGU4ZDIxOGY4ZDIxOTA4ZDIxOTE4YzIwOTI4YzIwOTI4YzIwOTM4YzFmOTQ4YzFmOTU4YjFmOTY4YjFmOTc4YjFmOTg4YjFmOTk4YTFmOWE4YTFlOWI4YTFlOWM4OTFlOWQ4OTFmOWU4OTFmOWY4ODFmYTA4ODFmYTE4ODFmYTE4NzFmYTI4NzIwYTM4NjIwYTQ4NjIxYTU4NTIxYTY4NTIyYTc4NTIyYTg4NDIzYTk4MzI0YWE4MzI1YWI4MjI1YWM4MjI2YWQ4MTI3YWQ4MTI4YWU4MDI5YWY3ZjJhYjA3ZjJjYjE3ZTJkYjI3ZDJlYjM3YzJmYjQ3YzMxYjU3YjMyYjY3YTM0YjY3OTM1Yjc3OTM3Yjg3ODM4Yjk3NzNhYmE3NjNiYmI3NTNkYmM3NDNmYmM3MzQwYmQ3MjQyYmU3MTQ0YmY3MDQ2YzA2ZjQ4YzE2ZTRhYzE2ZDRjYzI2YzRlYzM2YjUwYzQ2YTUyYzU2OTU0YzU2ODU2YzY2NzU4Yzc2NTVhYzg2NDVjYzg2MzVlYzk2MjYwY2E2MDYzY2I1ZjY1Y2I1ZTY3Y2M1YzY5Y2Q1YjZjY2Q1YTZlY2U1ODcwY2Y1NzczZDA1Njc1ZDA1NDc3ZDE1MzdhZDE1MTdjZDI1MDdmZDM0ZTgxZDM0ZDg0ZDQ0Yjg2ZDU0OTg5ZDU0ODhiZDY0NjhlZDY0NTkwZDc0MzkzZDc0MTk1ZDg0MDk4ZDgzZTliZDkzYzlkZDkzYmEwZGEzOWEyZGEzN2E1ZGIzNmE4ZGIzNGFhZGMzMmFkZGMzMGIwZGQyZmIyZGQyZGI1ZGUyYmI4ZGUyOWJhZGUyOGJkZGYyNmMwZGYyNWMyZGYyM2M1ZTAyMWM4ZTAyMGNhZTExZmNkZTExZGQwZTExY2QyZTIxYmQ1ZTIxYWQ4ZTIxOWRhZTMxOWRkZTMxOGRmZTMxOGUyZTQxOGU1ZTQxOWU3ZTQxOWVhZTUxYWVjZTUxYmVmZTUxY2YxZTUxZGY0ZTYxZWY2ZTYyMGY4ZTYyMWZiZTcyM2ZkZTcyNSIpKSwgaG0gPSBzbShIXygiMDAwMDA0MDEwMDA1MDEwMTA2MDEwMTA4MDIwMTA5MDIwMjBiMDIwMjBkMDMwMzBmMDMwMzEyMDQwNDE0MDUwNDE2MDYwNTE4MDYwNTFhMDcwNjFjMDgwNzFlMDkwNzIwMGEwODIyMGIwOTI0MGMwOTI2MGQwYTI5MGUwYjJiMTAwYjJkMTEwYzJmMTIwZDMxMTMwZDM0MTQwZTM2MTUwZTM4MTYwZjNiMTgwZjNkMTkxMDNmMWExMDQyMWMxMDQ0MWQxMTQ3MWUxMTQ5MjAxMTRiMjExMTRlMjIxMTUwMjQxMjUzMjUxMjU1MjcxMjU4MjkxMTVhMmExMTVjMmMxMTVmMmQxMTYxMmYxMTYzMzExMTY1MzMxMDY3MzQxMDY5MzYxMDZiMzgxMDZjMzkwZjZlM2IwZjcwM2QwZjcxM2YwZjcyNDAwZjc0NDIwZjc1NDQwZjc2NDUxMDc3NDcxMDc4NDkxMDc4NGExMDc5NGMxMTdhNGUxMTdiNGYxMjdiNTExMjdjNTIxMzdjNTQxMzdkNTYxNDdkNTcxNTdlNTkxNTdlNWExNjdlNWMxNjdmNWQxNzdmNWYxODdmNjAxODgwNjIxOTgwNjQxYTgwNjUxYTgwNjcxYjgwNjgxYzgxNmExYzgxNmIxZDgxNmQxZDgxNmUxZTgxNzAxZjgxNzIxZjgxNzMyMDgxNzUyMTgxNzYyMTgxNzgyMjgxNzkyMjgyN2IyMzgyN2MyMzgyN2UyNDgyODAyNTgyODEyNTgxODMyNjgxODQyNjgxODYyNzgxODgyNzgxODkyODgxOGIyOTgxOGMyOTgxOGUyYTgxOTAyYTgxOTEyYjgxOTMyYjgwOTQyYzgwOTYyYzgwOTgyZDgwOTkyZDgwOWIyZTdmOWMyZTdmOWUyZjdmYTAyZjdmYTEzMDdlYTMzMDdlYTUzMTdlYTYzMTdkYTgzMjdkYWEzMzdkYWIzMzdjYWQzNDdjYWUzNDdiYjAzNTdiYjIzNTdiYjMzNjdhYjUzNjdhYjczNzc5YjgzNzc5YmEzODc4YmMzOTc4YmQzOTc3YmYzYTc3YzAzYTc2YzIzYjc1YzQzYzc1YzUzYzc0YzczZDczYzgzZTczY2EzZTcyY2MzZjcxY2Q0MDcxY2Y0MDcwZDA0MTZmZDI0MjZmZDM0MzZlZDU0NDZkZDY0NTZjZDg0NTZjZDk0NjZiZGI0NzZhZGM0ODY5ZGU0OTY4ZGY0YTY4ZTA0YzY3ZTI0ZDY2ZTM0ZTY1ZTQ0ZjY0ZTU1MDY0ZTc1MjYzZTg1MzYyZTk1NDYyZWE1NjYxZWI1NzYwZWM1ODYwZWQ1YTVmZWU1YjVlZWY1ZDVlZjA1ZjVlZjE2MDVkZjI2MjVkZjI2NDVjZjM2NTVjZjQ2NzVjZjQ2OTVjZjU2YjVjZjY2YzVjZjY2ZTVjZjc3MDVjZjc3MjVjZjg3NDVjZjg3NjVjZjk3ODVkZjk3OTVkZjk3YjVkZmE3ZDVlZmE3ZjVlZmE4MTVmZmI4MzVmZmI4NTYwZmI4NzYxZmM4OTYxZmM4YTYyZmM4YzYzZmM4ZTY0ZmM5MDY1ZmQ5MjY2ZmQ5NDY3ZmQ5NjY4ZmQ5ODY5ZmQ5YTZhZmQ5YjZiZmU5ZDZjZmU5ZjZkZmVhMTZlZmVhMzZmZmVhNTcxZmVhNzcyZmVhOTczZmVhYTc0ZmVhYzc2ZmVhZTc3ZmViMDc4ZmViMjdhZmViNDdiZmViNjdjZmViNzdlZmViOTdmZmViYjgxZmViZDgyZmViZjg0ZmVjMTg1ZmVjMjg3ZmVjNDg4ZmVjNjhhZmVjODhjZmVjYThkZmVjYzhmZmVjZDkwZmVjZjkyZmVkMTk0ZmVkMzk1ZmVkNTk3ZmVkNzk5ZmVkODlhZmRkYTljZmRkYzllZmRkZWEwZmRlMGExZmRlMmEzZmRlM2E1ZmRlNWE3ZmRlN2E5ZmRlOWFhZmRlYmFjZmNlY2FlZmNlZWIwZmNmMGIyZmNmMmI0ZmNmNGI2ZmNmNmI4ZmNmN2I5ZmNmOWJiZmNmYmJkZmNmZGJmIikpLCBkbSA9IHNtKEhfKCIwMDAwMDQwMTAwMDUwMTAxMDYwMTAxMDgwMjAxMGEwMjAyMGMwMjAyMGUwMzAyMTAwNDAzMTIwNDAzMTQwNTA0MTcwNjA0MTkwNzA1MWIwODA1MWQwOTA2MWYwYTA3MjIwYjA3MjQwYzA4MjYwZDA4MjkwZTA5MmIxMDA5MmQxMTBhMzAxMjBhMzIxNDBiMzQxNTBiMzcxNjBiMzkxODBjM2MxOTBjM2UxYjBjNDExYzBjNDMxZTBjNDUxZjBjNDgyMTBjNGEyMzBjNGMyNDBjNGYyNjBjNTEyODBiNTMyOTBiNTUyYjBiNTcyZDBiNTkyZjBhNWIzMTBhNWMzMjBhNWUzNDBhNWYzNjA5NjEzODA5NjIzOTA5NjMzYjA5NjQzZDA5NjUzZTA5NjY0MDBhNjc0MjBhNjg0NDBhNjg0NTBhNjk0NzBiNmE0OTBiNmE0YTBjNmI0YzBjNmI0ZDBkNmM0ZjBkNmM1MTBlNmM1MjBlNmQ1NDBmNmQ1NTBmNmQ1NzEwNmU1OTEwNmU1YTExNmU1YzEyNmU1ZDEyNmU1ZjEzNmU2MTEzNmU2MjE0NmU2NDE1NmU2NTE1NmU2NzE2NmU2OTE2NmU2YTE3NmU2YzE4NmU2ZDE4NmU2ZjE5NmU3MTE5NmU3MjFhNmU3NDFhNmU3NTFiNmU3NzFjNmQ3ODFjNmQ3YTFkNmQ3YzFkNmQ3ZDFlNmQ3ZjFlNmM4MDFmNmM4MjIwNmM4NDIwNmI4NTIxNmI4NzIxNmI4ODIyNmE4YTIyNmE4YzIzNjk4ZDIzNjk4ZjI0Njk5MDI1Njg5MjI1Njg5MzI2Njc5NTI2Njc5NzI3NjY5ODI3NjY5YTI4NjU5YjI5NjQ5ZDI5NjQ5ZjJhNjNhMDJhNjNhMjJiNjJhMzJjNjFhNTJjNjBhNjJkNjBhODJlNWZhOTJlNWVhYjJmNWVhZDMwNWRhZTMwNWNiMDMxNWJiMTMyNWFiMzMyNWFiNDMzNTliNjM0NThiNzM1NTdiOTM1NTZiYTM2NTViYzM3NTRiZDM4NTNiZjM5NTJjMDNhNTFjMTNhNTBjMzNiNGZjNDNjNGVjNjNkNGRjNzNlNGNjODNmNGJjYTQwNGFjYjQxNDljYzQyNDhjZTQzNDdjZjQ0NDZkMDQ1NDVkMjQ2NDRkMzQ3NDNkNDQ4NDJkNTRhNDFkNzRiM2ZkODRjM2VkOTRkM2RkYTRlM2NkYjUwM2JkZDUxM2FkZTUyMzhkZjUzMzdlMDU1MzZlMTU2MzVlMjU3MzRlMzU5MzNlNDVhMzFlNTVjMzBlNjVkMmZlNzVlMmVlODYwMmRlOTYxMmJlYTYzMmFlYjY0MjllYjY2MjhlYzY3MjZlZDY5MjVlZTZhMjRlZjZjMjNlZjZlMjFmMDZmMjBmMTcxMWZmMTczMWRmMjc0MWNmMzc2MWJmMzc4MTlmNDc5MThmNTdiMTdmNTdkMTVmNjdlMTRmNjgwMTNmNzgyMTJmNzg0MTBmODg1MGZmODg3MGVmODg5MGNmOThiMGJmOThjMGFmOThlMDlmYTkwMDhmYTkyMDdmYTk0MDdmYjk2MDZmYjk3MDZmYjk5MDZmYjliMDZmYjlkMDdmYzlmMDdmY2ExMDhmY2EzMDlmY2E1MGFmY2E2MGNmY2E4MGRmY2FhMGZmY2FjMTFmY2FlMTJmY2IwMTRmY2IyMTZmY2I0MThmYmI2MWFmYmI4MWRmYmJhMWZmYmJjMjFmYmJlMjNmYWMwMjZmYWMyMjhmYWM0MmFmYWM2MmRmOWM3MmZmOWM5MzJmOWNiMzVmOGNkMzdmOGNmM2FmN2QxM2RmN2QzNDBmNmQ1NDNmNmQ3NDZmNWQ5NDlmNWRiNGNmNGRkNGZmNGRmNTNmNGUxNTZmM2UzNWFmM2U1NWRmMmU2NjFmMmU4NjVmMmVhNjlmMWVjNmRmMWVkNzFmMWVmNzVmMWYxNzlmMmYyN2RmMmY0ODJmM2Y1ODZmM2Y2OGFmNGY4OGVmNWY5OTJmNmZhOTZmOGZiOWFmOWZjOWRmYWZkYTFmY2ZmYTQiKSksIHBtID0gc20oSF8oIjBkMDg4NzEwMDc4ODEzMDc4OTE2MDc4YTE5MDY4YzFiMDY4ZDFkMDY4ZTIwMDY4ZjIyMDY5MDI0MDY5MTI2MDU5MTI4MDU5MjJhMDU5MzJjMDU5NDJlMDU5NTJmMDU5NjMxMDU5NzMzMDU5NzM1MDQ5ODM3MDQ5OTM4MDQ5YTNhMDQ5YTNjMDQ5YjNlMDQ5YzNmMDQ5YzQxMDQ5ZDQzMDM5ZTQ0MDM5ZTQ2MDM5ZjQ4MDM5ZjQ5MDNhMDRiMDNhMTRjMDJhMTRlMDJhMjUwMDJhMjUxMDJhMzUzMDJhMzU1MDJhNDU2MDFhNDU4MDFhNDU5MDFhNTViMDFhNTVjMDFhNjVlMDFhNjYwMDFhNjYxMDBhNzYzMDBhNzY0MDBhNzY2MDBhNzY3MDBhODY5MDBhODZhMDBhODZjMDBhODZlMDBhODZmMDBhODcxMDBhODcyMDFhODc0MDFhODc1MDFhODc3MDFhODc4MDFhODdhMDJhODdiMDJhODdkMDNhODdlMDNhODgwMDRhODgxMDRhNzgzMDVhNzg0MDVhNzg2MDZhNjg3MDdhNjg4MDhhNjhhMDlhNThiMGFhNThkMGJhNThlMGNhNDhmMGRhNDkxMGVhMzkyMGZhMzk0MTBhMjk1MTFhMTk2MTNhMTk4MTRhMDk5MTU5ZjlhMTY5ZjljMTc5ZTlkMTg5ZDllMTk5ZGEwMWE5Y2ExMWI5YmEyMWQ5YWEzMWU5YWE1MWY5OWE2MjA5OGE3MjE5N2E4MjI5NmFhMjM5NWFiMjQ5NGFjMjY5NGFkMjc5M2FlMjg5MmIwMjk5MWIxMmE5MGIyMmI4ZmIzMmM4ZWI0MmU4ZGI1MmY4Y2I2MzA4YmI3MzE4YWI4MzI4OWJhMzM4OGJiMzQ4OGJjMzU4N2JkMzc4NmJlMzg4NWJmMzk4NGMwM2E4M2MxM2I4MmMyM2M4MWMzM2Q4MGM0M2U3ZmM1NDA3ZWM2NDE3ZGM3NDI3Y2M4NDM3YmM5NDQ3YWNhNDU3YWNiNDY3OWNjNDc3OGNjNDk3N2NkNGE3NmNlNGI3NWNmNGM3NGQwNGQ3M2QxNGU3MmQyNGY3MWQzNTE3MWQ0NTI3MGQ1NTM2ZmQ1NTQ2ZWQ2NTU2ZGQ3NTY2Y2Q4NTc2YmQ5NTg2YWRhNWE2YWRhNWI2OWRiNWM2OGRjNWQ2N2RkNWU2NmRlNWY2NWRlNjE2NGRmNjI2M2UwNjM2M2UxNjQ2MmUyNjU2MWUyNjY2MGUzNjg1ZmU0Njk1ZWU1NmE1ZGU1NmI1ZGU2NmM1Y2U3NmU1YmU3NmY1YWU4NzA1OWU5NzE1OGU5NzI1N2VhNzQ1N2ViNzU1NmViNzY1NWVjNzc1NGVkNzk1M2VkN2E1MmVlN2I1MWVmN2M1MWVmN2U1MGYwN2Y0ZmYwODA0ZWYxODE0ZGYxODM0Y2YyODQ0YmYzODU0YmYzODc0YWY0ODg0OWY0ODk0OGY1OGI0N2Y1OGM0NmY2OGQ0NWY2OGY0NGY3OTA0NGY3OTE0M2Y3OTM0MmY4OTQ0MWY4OTU0MGY5OTczZmY5OTgzZWY5OWEzZWZhOWIzZGZhOWMzY2ZhOWUzYmZiOWYzYWZiYTEzOWZiYTIzOGZjYTMzOGZjYTUzN2ZjYTYzNmZjYTgzNWZjYTkzNGZkYWIzM2ZkYWMzM2ZkYWUzMmZkYWYzMWZkYjEzMGZkYjIyZmZkYjQyZmZkYjUyZWZlYjcyZGZlYjgyY2ZlYmEyY2ZlYmIyYmZlYmQyYWZlYmUyYWZlYzAyOWZkYzIyOWZkYzMyOGZkYzUyN2ZkYzYyN2ZkYzgyN2ZkY2EyNmZkY2IyNmZjY2QyNWZjY2UyNWZjZDAyNWZjZDIyNWZiZDMyNGZiZDUyNGZiZDcyNGZhZDgyNGZhZGEyNGY5ZGMyNGY5ZGQyNWY4ZGYyNWY4ZTEyNWY3ZTIyNWY3ZTQyNWY2ZTYyNmY2ZTgyNmY1ZTkyNmY1ZWIyN2Y0ZWQyN2YzZWUyN2YzZjAyN2YyZjIyN2YxZjQyNmYxZjUyNWYwZjcyNGYwZjkyMSIpKTsKICAgICAgZnVuY3Rpb24gZ20odDIpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfTsKICAgICAgfQogICAgICBjb25zdCB5bSA9IE1hdGguYWJzLCB2bSA9IE1hdGguYXRhbjIsIF9tID0gTWF0aC5jb3MsIGJtID0gTWF0aC5tYXgsIG1tID0gTWF0aC5taW4sIHhtID0gTWF0aC5zaW4sIHdtID0gTWF0aC5zcXJ0LCBNbSA9IDFlLTEyLCBUbSA9IE1hdGguUEksIEFtID0gVG0gLyAyLCBTbSA9IDIgKiBUbTsKICAgICAgZnVuY3Rpb24gRW0odDIpIHsKICAgICAgICByZXR1cm4gdDIgPj0gMSA/IEFtIDogdDIgPD0gLTEgPyAtQW0gOiBNYXRoLmFzaW4odDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE5tKHQyKSB7CiAgICAgICAgbGV0IG4yID0gMzsKICAgICAgICByZXR1cm4gdDIuZGlnaXRzID0gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIG4yOwogICAgICAgICAgaWYgKG51bGwgPT0gZTIpCiAgICAgICAgICAgIG4yID0gbnVsbDsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBjb25zdCB0MyA9IE1hdGguZmxvb3IoZTIpOwogICAgICAgICAgICBpZiAoISh0MyA+PSAwKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcihgaW52YWxpZCBkaWdpdHM6ICR7ZTJ9YCk7CiAgICAgICAgICAgIG4yID0gdDM7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdDI7CiAgICAgICAgfSwgKCkgPT4gbmV3IFVhKG4yKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBrbSh0MikgewogICAgICAgIHJldHVybiB0Mi5pbm5lclJhZGl1czsKICAgICAgfQogICAgICBmdW5jdGlvbiBDbSh0MikgewogICAgICAgIHJldHVybiB0Mi5vdXRlclJhZGl1czsKICAgICAgfQogICAgICBmdW5jdGlvbiBQbSh0MikgewogICAgICAgIHJldHVybiB0Mi5zdGFydEFuZ2xlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHptKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLmVuZEFuZ2xlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uICRtKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyICYmIHQyLnBhZEFuZ2xlOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIERtKHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIsIGEyKSB7CiAgICAgICAgdmFyIHUyID0gdDIgLSBlMiwgYzIgPSBuMiAtIHIyLCBmMiA9IChhMiA/IG8yIDogLW8yKSAvIHdtKHUyICogdTIgKyBjMiAqIGMyKSwgczIgPSBmMiAqIGMyLCBsMiA9IC1mMiAqIHUyLCBoMiA9IHQyICsgczIsIGQyID0gbjIgKyBsMiwgcDIgPSBlMiArIHMyLCBnMiA9IHIyICsgbDIsIHkyID0gKGgyICsgcDIpIC8gMiwgdjIgPSAoZDIgKyBnMikgLyAyLCBfMiA9IHAyIC0gaDIsIGIyID0gZzIgLSBkMiwgbTIgPSBfMiAqIF8yICsgYjIgKiBiMiwgeDIgPSBpMiAtIG8yLCB3MiA9IGgyICogZzIgLSBwMiAqIGQyLCBNMiA9IChiMiA8IDAgPyAtMSA6IDEpICogd20oYm0oMCwgeDIgKiB4MiAqIG0yIC0gdzIgKiB3MikpLCBUMiA9ICh3MiAqIGIyIC0gXzIgKiBNMikgLyBtMiwgQTIgPSAoLXcyICogXzIgLSBiMiAqIE0yKSAvIG0yLCBTMiA9ICh3MiAqIGIyICsgXzIgKiBNMikgLyBtMiwgRTIgPSAoLXcyICogXzIgKyBiMiAqIE0yKSAvIG0yLCBOMiA9IFQyIC0geTIsIGsyID0gQTIgLSB2MiwgQzIgPSBTMiAtIHkyLCBQMiA9IEUyIC0gdjI7CiAgICAgICAgcmV0dXJuIE4yICogTjIgKyBrMiAqIGsyID4gQzIgKiBDMiArIFAyICogUDIgJiYgKFQyID0gUzIsIEEyID0gRTIpLCB7IGN4OiBUMiwgY3k6IEEyLCB4MDE6IC1zMiwgeTAxOiAtbDIsIHgxMTogVDIgKiAoaTIgLyB4MiAtIDEpLCB5MTE6IEEyICogKGkyIC8geDIgLSAxKSB9OwogICAgICB9CiAgICAgIHZhciBSbSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKICAgICAgZnVuY3Rpb24gRm0odDIpIHsKICAgICAgICByZXR1cm4gIm9iamVjdCIgPT0gdHlwZW9mIHQyICYmICJsZW5ndGgiIGluIHQyID8gdDIgOiBBcnJheS5mcm9tKHQyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBxbSh0MikgewogICAgICAgIHRoaXMuX2NvbnRleHQgPSB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBVbSh0MikgewogICAgICAgIHJldHVybiBuZXcgcW0odDIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEltKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyWzBdOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIE9tKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyWzFdOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEJtKHQyLCBuMikgewogICAgICAgIHZhciBlMiA9IGdtKHRydWUpLCByMiA9IG51bGwsIGkyID0gVW0sIG8yID0gbnVsbCwgYTIgPSBObSh1Mik7CiAgICAgICAgZnVuY3Rpb24gdTIodTMpIHsKICAgICAgICAgIHZhciBjMiwgZjIsIHMyLCBsMiA9ICh1MyA9IEZtKHUzKSkubGVuZ3RoLCBoMiA9IGZhbHNlOwogICAgICAgICAgZm9yIChudWxsID09IHIyICYmIChvMiA9IGkyKHMyID0gYTIoKSkpLCBjMiA9IDA7IGMyIDw9IGwyOyArK2MyKQogICAgICAgICAgICAhKGMyIDwgbDIgJiYgZTIoZjIgPSB1M1tjMl0sIGMyLCB1MykpID09PSBoMiAmJiAoKGgyID0gIWgyKSA/IG8yLmxpbmVTdGFydCgpIDogbzIubGluZUVuZCgpKSwgaDIgJiYgbzIucG9pbnQoK3QyKGYyLCBjMiwgdTMpLCArbjIoZjIsIGMyLCB1MykpOwogICAgICAgICAgaWYgKHMyKQogICAgICAgICAgICByZXR1cm4gbzIgPSBudWxsLCBzMiArICIiIHx8IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0MiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQyID8gdDIgOiB2b2lkIDAgPT09IHQyID8gSW0gOiBnbSh0MiksIG4yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjIgPyBuMiA6IHZvaWQgMCA9PT0gbjIgPyBPbSA6IGdtKG4yKSwgdTIueCA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4zID8gbjMgOiBnbSgrbjMpLCB1MikgOiB0MjsKICAgICAgICB9LCB1Mi55ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGdtKCt0MyksIHUyKSA6IG4yOwogICAgICAgIH0sIHUyLmRlZmluZWQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZ20oISF0MyksIHUyKSA6IGUyOwogICAgICAgIH0sIHUyLmN1cnZlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGkyID0gdDMsIG51bGwgIT0gcjIgJiYgKG8yID0gaTIocjIpKSwgdTIpIDogaTI7CiAgICAgICAgfSwgdTIuY29udGV4dCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChudWxsID09IHQzID8gcjIgPSBvMiA9IG51bGwgOiBvMiA9IGkyKHIyID0gdDMpLCB1MikgOiByMjsKICAgICAgICB9LCB1MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBZbSh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gbnVsbCwgaTIgPSBnbSh0cnVlKSwgbzIgPSBudWxsLCBhMiA9IFVtLCB1MiA9IG51bGwsIGMyID0gTm0oZjIpOwogICAgICAgIGZ1bmN0aW9uIGYyKGYzKSB7CiAgICAgICAgICB2YXIgczMsIGwyLCBoMiwgZDIsIHAyLCBnMiA9IChmMyA9IEZtKGYzKSkubGVuZ3RoLCB5MiA9IGZhbHNlLCB2MiA9IG5ldyBBcnJheShnMiksIF8yID0gbmV3IEFycmF5KGcyKTsKICAgICAgICAgIGZvciAobnVsbCA9PSBvMiAmJiAodTIgPSBhMihwMiA9IGMyKCkpKSwgczMgPSAwOyBzMyA8PSBnMjsgKytzMykgewogICAgICAgICAgICBpZiAoIShzMyA8IGcyICYmIGkyKGQyID0gZjNbczNdLCBzMywgZjMpKSA9PT0geTIpCiAgICAgICAgICAgICAgaWYgKHkyID0gIXkyKQogICAgICAgICAgICAgICAgbDIgPSBzMywgdTIuYXJlYVN0YXJ0KCksIHUyLmxpbmVTdGFydCgpOwogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZm9yICh1Mi5saW5lRW5kKCksIHUyLmxpbmVTdGFydCgpLCBoMiA9IHMzIC0gMTsgaDIgPj0gbDI7IC0taDIpCiAgICAgICAgICAgICAgICAgIHUyLnBvaW50KHYyW2gyXSwgXzJbaDJdKTsKICAgICAgICAgICAgICAgIHUyLmxpbmVFbmQoKSwgdTIuYXJlYUVuZCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgeTIgJiYgKHYyW3MzXSA9ICt0MihkMiwgczMsIGYzKSwgXzJbczNdID0gK24yKGQyLCBzMywgZjMpLCB1Mi5wb2ludChyMiA/ICtyMihkMiwgczMsIGYzKSA6IHYyW3MzXSwgZTIgPyArZTIoZDIsIHMzLCBmMykgOiBfMltzM10pKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChwMikKICAgICAgICAgICAgcmV0dXJuIHUyID0gbnVsbCwgcDIgKyAiIiB8fCBudWxsOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzMigpIHsKICAgICAgICAgIHJldHVybiBCbSgpLmRlZmluZWQoaTIpLmN1cnZlKGEyKS5jb250ZXh0KG8yKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHQyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDIgPyB0MiA6IHZvaWQgMCA9PT0gdDIgPyBJbSA6IGdtKCt0MiksIG4yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjIgPyBuMiA6IGdtKHZvaWQgMCA9PT0gbjIgPyAwIDogK24yKSwgZTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBlMiA/IGUyIDogdm9pZCAwID09PSBlMiA/IE9tIDogZ20oK2UyKSwgZjIueCA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4zID8gbjMgOiBnbSgrbjMpLCByMiA9IG51bGwsIGYyKSA6IHQyOwogICAgICAgIH0sIGYyLngwID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHQyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjMgPyBuMyA6IGdtKCtuMyksIGYyKSA6IHQyOwogICAgICAgIH0sIGYyLngxID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gbnVsbCA9PSB0MyA/IG51bGwgOiAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZ20oK3QzKSwgZjIpIDogcjI7CiAgICAgICAgfSwgZjIueSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChuMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBnbSgrdDMpLCBlMiA9IG51bGwsIGYyKSA6IG4yOwogICAgICAgIH0sIGYyLnkwID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGdtKCt0MyksIGYyKSA6IG4yOwogICAgICAgIH0sIGYyLnkxID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGUyID0gbnVsbCA9PSB0MyA/IG51bGwgOiAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZ20oK3QzKSwgZjIpIDogZTI7CiAgICAgICAgfSwgZjIubGluZVgwID0gZjIubGluZVkwID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gczIoKS54KHQyKS55KG4yKTsKICAgICAgICB9LCBmMi5saW5lWTEgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBzMigpLngodDIpLnkoZTIpOwogICAgICAgIH0sIGYyLmxpbmVYMSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHMyKCkueChyMikueShuMik7CiAgICAgICAgfSwgZjIuZGVmaW5lZCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBnbSghIXQzKSwgZjIpIDogaTI7CiAgICAgICAgfSwgZjIuY3VydmUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIgPSB0MywgbnVsbCAhPSBvMiAmJiAodTIgPSBhMihvMikpLCBmMikgOiBhMjsKICAgICAgICB9LCBmMi5jb250ZXh0ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG51bGwgPT0gdDMgPyBvMiA9IHUyID0gbnVsbCA6IHUyID0gYTIobzIgPSB0MyksIGYyKSA6IG8yOwogICAgICAgIH0sIGYyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIExtKHQyLCBuMikgewogICAgICAgIHJldHVybiBuMiA8IHQyID8gLTEgOiBuMiA+IHQyID8gMSA6IG4yID49IHQyID8gMCA6IE5hTjsKICAgICAgfQogICAgICBmdW5jdGlvbiBqbSh0MikgewogICAgICAgIHJldHVybiB0MjsKICAgICAgfQogICAgICBxbS5wcm90b3R5cGUgPSB7IGFyZWFTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbGluZSA9IDA7CiAgICAgIH0sIGFyZWFFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgICAgIH0sIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fcG9pbnQgPSAwOwogICAgICB9LCBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAodGhpcy5fbGluZSB8fCAwICE9PSB0aGlzLl9saW5lICYmIDEgPT09IHRoaXMuX3BvaW50KSAmJiB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpLCB0aGlzLl9saW5lID0gMSAtIHRoaXMuX2xpbmU7CiAgICAgIH0sIHBvaW50OiBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBzd2l0Y2ggKHQyID0gK3QyLCBuMiA9ICtuMiwgdGhpcy5fcG9pbnQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAxLCB0aGlzLl9saW5lID8gdGhpcy5fY29udGV4dC5saW5lVG8odDIsIG4yKSA6IHRoaXMuX2NvbnRleHQubW92ZVRvKHQyLCBuMik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDI7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aGlzLl9jb250ZXh0LmxpbmVUbyh0MiwgbjIpOwogICAgICAgIH0KICAgICAgfSB9OwogICAgICB2YXIgSG0gPSBHbShVbSk7CiAgICAgIGZ1bmN0aW9uIFhtKHQyKSB7CiAgICAgICAgdGhpcy5fY3VydmUgPSB0MjsKICAgICAgfQogICAgICBmdW5jdGlvbiBHbSh0MikgewogICAgICAgIGZ1bmN0aW9uIG4yKG4zKSB7CiAgICAgICAgICByZXR1cm4gbmV3IFhtKHQyKG4zKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuMi5fY3VydmUgPSB0MiwgbjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVm0odDIpIHsKICAgICAgICB2YXIgbjIgPSB0Mi5jdXJ2ZTsKICAgICAgICByZXR1cm4gdDIuYW5nbGUgPSB0Mi54LCBkZWxldGUgdDIueCwgdDIucmFkaXVzID0gdDIueSwgZGVsZXRlIHQyLnksIHQyLmN1cnZlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gbjIoR20odDMpKSA6IG4yKCkuX2N1cnZlOwogICAgICAgIH0sIHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFdtKCkgewogICAgICAgIHJldHVybiBWbShCbSgpLmN1cnZlKEhtKSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gWm0oKSB7CiAgICAgICAgdmFyIHQyID0gWW0oKS5jdXJ2ZShIbSksIG4yID0gdDIuY3VydmUsIGUyID0gdDIubGluZVgwLCByMiA9IHQyLmxpbmVYMSwgaTIgPSB0Mi5saW5lWTAsIG8yID0gdDIubGluZVkxOwogICAgICAgIHJldHVybiB0Mi5hbmdsZSA9IHQyLngsIGRlbGV0ZSB0Mi54LCB0Mi5zdGFydEFuZ2xlID0gdDIueDAsIGRlbGV0ZSB0Mi54MCwgdDIuZW5kQW5nbGUgPSB0Mi54MSwgZGVsZXRlIHQyLngxLCB0Mi5yYWRpdXMgPSB0Mi55LCBkZWxldGUgdDIueSwgdDIuaW5uZXJSYWRpdXMgPSB0Mi55MCwgZGVsZXRlIHQyLnkwLCB0Mi5vdXRlclJhZGl1cyA9IHQyLnkxLCBkZWxldGUgdDIueTEsIHQyLmxpbmVTdGFydEFuZ2xlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gVm0oZTIoKSk7CiAgICAgICAgfSwgZGVsZXRlIHQyLmxpbmVYMCwgdDIubGluZUVuZEFuZ2xlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gVm0ocjIoKSk7CiAgICAgICAgfSwgZGVsZXRlIHQyLmxpbmVYMSwgdDIubGluZUlubmVyUmFkaXVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gVm0oaTIoKSk7CiAgICAgICAgfSwgZGVsZXRlIHQyLmxpbmVZMCwgdDIubGluZU91dGVyUmFkaXVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gVm0obzIoKSk7CiAgICAgICAgfSwgZGVsZXRlIHQyLmxpbmVZMSwgdDIuY3VydmUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyBuMihHbSh0MykpIDogbjIoKS5fY3VydmU7CiAgICAgICAgfSwgdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gS20odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIFsobjIgPSArbjIpICogTWF0aC5jb3ModDIgLT0gTWF0aC5QSSAvIDIpLCBuMiAqIE1hdGguc2luKHQyKV07CiAgICAgIH0KICAgICAgWG0ucHJvdG90eXBlID0geyBhcmVhU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2N1cnZlLmFyZWFTdGFydCgpOwogICAgICB9LCBhcmVhRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9jdXJ2ZS5hcmVhRW5kKCk7CiAgICAgIH0sIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fY3VydmUubGluZVN0YXJ0KCk7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2N1cnZlLmxpbmVFbmQoKTsKICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHRoaXMuX2N1cnZlLnBvaW50KG4yICogTWF0aC5zaW4odDIpLCBuMiAqIC1NYXRoLmNvcyh0MikpOwogICAgICB9IH07CiAgICAgIGNsYXNzIFFtIHsKICAgICAgICBjb25zdHJ1Y3Rvcih0MiwgbjIpIHsKICAgICAgICAgIHRoaXMuX2NvbnRleHQgPSB0MiwgdGhpcy5feCA9IG4yOwogICAgICAgIH0KICAgICAgICBhcmVhU3RhcnQoKSB7CiAgICAgICAgICB0aGlzLl9saW5lID0gMDsKICAgICAgICB9CiAgICAgICAgYXJlYUVuZCgpIHsKICAgICAgICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgICAgICAgfQogICAgICAgIGxpbmVTdGFydCgpIHsKICAgICAgICAgIHRoaXMuX3BvaW50ID0gMDsKICAgICAgICB9CiAgICAgICAgbGluZUVuZCgpIHsKICAgICAgICAgICh0aGlzLl9saW5lIHx8IDAgIT09IHRoaXMuX2xpbmUgJiYgMSA9PT0gdGhpcy5fcG9pbnQpICYmIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCksIHRoaXMuX2xpbmUgPSAxIC0gdGhpcy5fbGluZTsKICAgICAgICB9CiAgICAgICAgcG9pbnQodDIsIG4yKSB7CiAgICAgICAgICBzd2l0Y2ggKHQyID0gK3QyLCBuMiA9ICtuMiwgdGhpcy5fcG9pbnQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMSwgdGhpcy5fbGluZSA/IHRoaXMuX2NvbnRleHQubGluZVRvKHQyLCBuMikgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh0MiwgbjIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAyOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRoaXMuX3ggPyB0aGlzLl9jb250ZXh0LmJlemllckN1cnZlVG8odGhpcy5feDAgPSAodGhpcy5feDAgKyB0MikgLyAyLCB0aGlzLl95MCwgdGhpcy5feDAsIG4yLCB0MiwgbjIpIDogdGhpcy5fY29udGV4dC5iZXppZXJDdXJ2ZVRvKHRoaXMuX3gwLCB0aGlzLl95MCA9ICh0aGlzLl95MCArIG4yKSAvIDIsIHQyLCB0aGlzLl95MCwgdDIsIG4yKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX3gwID0gdDIsIHRoaXMuX3kwID0gbjI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNsYXNzIEptIHsKICAgICAgICBjb25zdHJ1Y3Rvcih0MikgewogICAgICAgICAgdGhpcy5fY29udGV4dCA9IHQyOwogICAgICAgIH0KICAgICAgICBsaW5lU3RhcnQoKSB7CiAgICAgICAgICB0aGlzLl9wb2ludCA9IDA7CiAgICAgICAgfQogICAgICAgIGxpbmVFbmQoKSB7CiAgICAgICAgfQogICAgICAgIHBvaW50KHQyLCBuMikgewogICAgICAgICAgaWYgKHQyID0gK3QyLCBuMiA9ICtuMiwgMCA9PT0gdGhpcy5fcG9pbnQpCiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMTsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBjb25zdCBlMiA9IEttKHRoaXMuX3gwLCB0aGlzLl95MCksIHIyID0gS20odGhpcy5feDAsIHRoaXMuX3kwID0gKHRoaXMuX3kwICsgbjIpIC8gMiksIGkyID0gS20odDIsIHRoaXMuX3kwKSwgbzIgPSBLbSh0MiwgbjIpOwogICAgICAgICAgICB0aGlzLl9jb250ZXh0Lm1vdmVUbyguLi5lMiksIHRoaXMuX2NvbnRleHQuYmV6aWVyQ3VydmVUbyguLi5yMiwgLi4uaTIsIC4uLm8yKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX3gwID0gdDIsIHRoaXMuX3kwID0gbjI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIHR4KHQyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBRbSh0MiwgdHJ1ZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbngodDIpIHsKICAgICAgICByZXR1cm4gbmV3IFFtKHQyLCBmYWxzZSk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZXgodDIpIHsKICAgICAgICByZXR1cm4gbmV3IEptKHQyKTsKICAgICAgfQogICAgICBmdW5jdGlvbiByeCh0MikgewogICAgICAgIHJldHVybiB0Mi5zb3VyY2U7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaXgodDIpIHsKICAgICAgICByZXR1cm4gdDIudGFyZ2V0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG94KHQyKSB7CiAgICAgICAgbGV0IG4yID0gcngsIGUyID0gaXgsIHIyID0gSW0sIGkyID0gT20sIG8yID0gbnVsbCwgYTIgPSBudWxsLCB1MiA9IE5tKGMyKTsKICAgICAgICBmdW5jdGlvbiBjMigpIHsKICAgICAgICAgIGxldCBjMzsKICAgICAgICAgIGNvbnN0IGYyID0gUm0uY2FsbChhcmd1bWVudHMpLCBzMiA9IG4yLmFwcGx5KHRoaXMsIGYyKSwgbDIgPSBlMi5hcHBseSh0aGlzLCBmMik7CiAgICAgICAgICBpZiAobnVsbCA9PSBvMiAmJiAoYTIgPSB0MihjMyA9IHUyKCkpKSwgYTIubGluZVN0YXJ0KCksIGYyWzBdID0gczIsIGEyLnBvaW50KCtyMi5hcHBseSh0aGlzLCBmMiksICtpMi5hcHBseSh0aGlzLCBmMikpLCBmMlswXSA9IGwyLCBhMi5wb2ludCgrcjIuYXBwbHkodGhpcywgZjIpLCAraTIuYXBwbHkodGhpcywgZjIpKSwgYTIubGluZUVuZCgpLCBjMykKICAgICAgICAgICAgcmV0dXJuIGEyID0gbnVsbCwgYzMgKyAiIiB8fCBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYzIuc291cmNlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gdDMsIGMyKSA6IG4yOwogICAgICAgIH0sIGMyLnRhcmdldCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9IHQzLCBjMikgOiBlMjsKICAgICAgICB9LCBjMi54ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGdtKCt0MyksIGMyKSA6IHIyOwogICAgICAgIH0sIGMyLnkgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZ20oK3QzKSwgYzIpIDogaTI7CiAgICAgICAgfSwgYzIuY29udGV4dCA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChudWxsID09IG4zID8gbzIgPSBhMiA9IG51bGwgOiBhMiA9IHQyKG8yID0gbjMpLCBjMikgOiBvMjsKICAgICAgICB9LCBjMjsKICAgICAgfQogICAgICBjb25zdCBheCA9IHdtKDMpOwogICAgICB2YXIgdXggPSB7IGRyYXcodDIsIG4yKSB7CiAgICAgICAgY29uc3QgZTIgPSAwLjU5NDM2ICogd20objIgKyBtbShuMiAvIDI4LCAwLjc1KSksIHIyID0gZTIgLyAyLCBpMiA9IHIyICogYXg7CiAgICAgICAgdDIubW92ZVRvKDAsIGUyKSwgdDIubGluZVRvKDAsIC1lMiksIHQyLm1vdmVUbygtaTIsIC1yMiksIHQyLmxpbmVUbyhpMiwgcjIpLCB0Mi5tb3ZlVG8oLWkyLCByMiksIHQyLmxpbmVUbyhpMiwgLXIyKTsKICAgICAgfSB9LCBjeCA9IHsgZHJhdyh0MiwgbjIpIHsKICAgICAgICBjb25zdCBlMiA9IHdtKG4yIC8gVG0pOwogICAgICAgIHQyLm1vdmVUbyhlMiwgMCksIHQyLmFyYygwLCAwLCBlMiwgMCwgU20pOwogICAgICB9IH0sIGZ4ID0geyBkcmF3KHQyLCBuMikgewogICAgICAgIGNvbnN0IGUyID0gd20objIgLyA1KSAvIDI7CiAgICAgICAgdDIubW92ZVRvKC0zICogZTIsIC1lMiksIHQyLmxpbmVUbygtZTIsIC1lMiksIHQyLmxpbmVUbygtZTIsIC0zICogZTIpLCB0Mi5saW5lVG8oZTIsIC0zICogZTIpLCB0Mi5saW5lVG8oZTIsIC1lMiksIHQyLmxpbmVUbygzICogZTIsIC1lMiksIHQyLmxpbmVUbygzICogZTIsIGUyKSwgdDIubGluZVRvKGUyLCBlMiksIHQyLmxpbmVUbyhlMiwgMyAqIGUyKSwgdDIubGluZVRvKC1lMiwgMyAqIGUyKSwgdDIubGluZVRvKC1lMiwgZTIpLCB0Mi5saW5lVG8oLTMgKiBlMiwgZTIpLCB0Mi5jbG9zZVBhdGgoKTsKICAgICAgfSB9OwogICAgICBjb25zdCBzeCA9IHdtKDEgLyAzKSwgbHggPSAyICogc3g7CiAgICAgIHZhciBoeCA9IHsgZHJhdyh0MiwgbjIpIHsKICAgICAgICBjb25zdCBlMiA9IHdtKG4yIC8gbHgpLCByMiA9IGUyICogc3g7CiAgICAgICAgdDIubW92ZVRvKDAsIC1lMiksIHQyLmxpbmVUbyhyMiwgMCksIHQyLmxpbmVUbygwLCBlMiksIHQyLmxpbmVUbygtcjIsIDApLCB0Mi5jbG9zZVBhdGgoKTsKICAgICAgfSB9LCBkeCA9IHsgZHJhdyh0MiwgbjIpIHsKICAgICAgICBjb25zdCBlMiA9IDAuNjI2MjUgKiB3bShuMik7CiAgICAgICAgdDIubW92ZVRvKDAsIC1lMiksIHQyLmxpbmVUbyhlMiwgMCksIHQyLmxpbmVUbygwLCBlMiksIHQyLmxpbmVUbygtZTIsIDApLCB0Mi5jbG9zZVBhdGgoKTsKICAgICAgfSB9LCBweCA9IHsgZHJhdyh0MiwgbjIpIHsKICAgICAgICBjb25zdCBlMiA9IDAuODc1NTkgKiB3bShuMiAtIG1tKG4yIC8gNywgMikpOwogICAgICAgIHQyLm1vdmVUbygtZTIsIDApLCB0Mi5saW5lVG8oZTIsIDApLCB0Mi5tb3ZlVG8oMCwgZTIpLCB0Mi5saW5lVG8oMCwgLWUyKTsKICAgICAgfSB9LCBneCA9IHsgZHJhdyh0MiwgbjIpIHsKICAgICAgICBjb25zdCBlMiA9IHdtKG4yKSwgcjIgPSAtZTIgLyAyOwogICAgICAgIHQyLnJlY3QocjIsIHIyLCBlMiwgZTIpOwogICAgICB9IH0sIHl4ID0geyBkcmF3KHQyLCBuMikgewogICAgICAgIGNvbnN0IGUyID0gMC40NDMxICogd20objIpOwogICAgICAgIHQyLm1vdmVUbyhlMiwgZTIpLCB0Mi5saW5lVG8oZTIsIC1lMiksIHQyLmxpbmVUbygtZTIsIC1lMiksIHQyLmxpbmVUbygtZTIsIGUyKSwgdDIuY2xvc2VQYXRoKCk7CiAgICAgIH0gfTsKICAgICAgY29uc3QgdnggPSB4bShUbSAvIDEwKSAvIHhtKDcgKiBUbSAvIDEwKSwgX3ggPSB4bShTbSAvIDEwKSAqIHZ4LCBieCA9IC1fbShTbSAvIDEwKSAqIHZ4OwogICAgICB2YXIgbXggPSB7IGRyYXcodDIsIG4yKSB7CiAgICAgICAgY29uc3QgZTIgPSB3bSgwLjg5MDgxMzA5MTUyOTI4NTIgKiBuMiksIHIyID0gX3ggKiBlMiwgaTIgPSBieCAqIGUyOwogICAgICAgIHQyLm1vdmVUbygwLCAtZTIpLCB0Mi5saW5lVG8ocjIsIGkyKTsKICAgICAgICBmb3IgKGxldCBuMyA9IDE7IG4zIDwgNTsgKytuMykgewogICAgICAgICAgY29uc3QgbzIgPSBTbSAqIG4zIC8gNSwgYTIgPSBfbShvMiksIHUyID0geG0obzIpOwogICAgICAgICAgdDIubGluZVRvKHUyICogZTIsIC1hMiAqIGUyKSwgdDIubGluZVRvKGEyICogcjIgLSB1MiAqIGkyLCB1MiAqIHIyICsgYTIgKiBpMik7CiAgICAgICAgfQogICAgICAgIHQyLmNsb3NlUGF0aCgpOwogICAgICB9IH07CiAgICAgIGNvbnN0IHh4ID0gd20oMyk7CiAgICAgIHZhciB3eCA9IHsgZHJhdyh0MiwgbjIpIHsKICAgICAgICBjb25zdCBlMiA9IC13bShuMiAvICgzICogeHgpKTsKICAgICAgICB0Mi5tb3ZlVG8oMCwgMiAqIGUyKSwgdDIubGluZVRvKC14eCAqIGUyLCAtZTIpLCB0Mi5saW5lVG8oeHggKiBlMiwgLWUyKSwgdDIuY2xvc2VQYXRoKCk7CiAgICAgIH0gfTsKICAgICAgY29uc3QgTXggPSB3bSgzKTsKICAgICAgdmFyIFR4ID0geyBkcmF3KHQyLCBuMikgewogICAgICAgIGNvbnN0IGUyID0gMC42ODI0ICogd20objIpLCByMiA9IGUyIC8gMiwgaTIgPSBlMiAqIE14IC8gMjsKICAgICAgICB0Mi5tb3ZlVG8oMCwgLWUyKSwgdDIubGluZVRvKGkyLCByMiksIHQyLmxpbmVUbygtaTIsIHIyKSwgdDIuY2xvc2VQYXRoKCk7CiAgICAgIH0gfTsKICAgICAgY29uc3QgQXggPSAtMC41LCBTeCA9IHdtKDMpIC8gMiwgRXggPSAxIC8gd20oMTIpLCBOeCA9IDMgKiAoRXggLyAyICsgMSk7CiAgICAgIHZhciBreCA9IHsgZHJhdyh0MiwgbjIpIHsKICAgICAgICBjb25zdCBlMiA9IHdtKG4yIC8gTngpLCByMiA9IGUyIC8gMiwgaTIgPSBlMiAqIEV4LCBvMiA9IHIyLCBhMiA9IGUyICogRXggKyBlMiwgdTIgPSAtbzIsIGMyID0gYTI7CiAgICAgICAgdDIubW92ZVRvKHIyLCBpMiksIHQyLmxpbmVUbyhvMiwgYTIpLCB0Mi5saW5lVG8odTIsIGMyKSwgdDIubGluZVRvKEF4ICogcjIgLSBTeCAqIGkyLCBTeCAqIHIyICsgQXggKiBpMiksIHQyLmxpbmVUbyhBeCAqIG8yIC0gU3ggKiBhMiwgU3ggKiBvMiArIEF4ICogYTIpLCB0Mi5saW5lVG8oQXggKiB1MiAtIFN4ICogYzIsIFN4ICogdTIgKyBBeCAqIGMyKSwgdDIubGluZVRvKEF4ICogcjIgKyBTeCAqIGkyLCBBeCAqIGkyIC0gU3ggKiByMiksIHQyLmxpbmVUbyhBeCAqIG8yICsgU3ggKiBhMiwgQXggKiBhMiAtIFN4ICogbzIpLCB0Mi5saW5lVG8oQXggKiB1MiArIFN4ICogYzIsIEF4ICogYzIgLSBTeCAqIHUyKSwgdDIuY2xvc2VQYXRoKCk7CiAgICAgIH0gfSwgQ3ggPSB7IGRyYXcodDIsIG4yKSB7CiAgICAgICAgY29uc3QgZTIgPSAwLjYxODkgKiB3bShuMiAtIG1tKG4yIC8gNiwgMS43KSk7CiAgICAgICAgdDIubW92ZVRvKC1lMiwgLWUyKSwgdDIubGluZVRvKGUyLCBlMiksIHQyLm1vdmVUbygtZTIsIGUyKSwgdDIubGluZVRvKGUyLCAtZTIpOwogICAgICB9IH07CiAgICAgIGNvbnN0IFB4ID0gW2N4LCBmeCwgaHgsIGd4LCBteCwgd3gsIGt4XSwgenggPSBbY3gsIHB4LCBDeCwgVHgsIHV4LCB5eCwgZHhdOwogICAgICBmdW5jdGlvbiAkeCgpIHsKICAgICAgfQogICAgICBmdW5jdGlvbiBEeCh0MiwgbjIsIGUyKSB7CiAgICAgICAgdDIuX2NvbnRleHQuYmV6aWVyQ3VydmVUbygoMiAqIHQyLl94MCArIHQyLl94MSkgLyAzLCAoMiAqIHQyLl95MCArIHQyLl95MSkgLyAzLCAodDIuX3gwICsgMiAqIHQyLl94MSkgLyAzLCAodDIuX3kwICsgMiAqIHQyLl95MSkgLyAzLCAodDIuX3gwICsgNCAqIHQyLl94MSArIG4yKSAvIDYsICh0Mi5feTAgKyA0ICogdDIuX3kxICsgZTIpIC8gNik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUngodDIpIHsKICAgICAgICB0aGlzLl9jb250ZXh0ID0gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gRngodDIpIHsKICAgICAgICB0aGlzLl9jb250ZXh0ID0gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gcXgodDIpIHsKICAgICAgICB0aGlzLl9jb250ZXh0ID0gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gVXgodDIsIG4yKSB7CiAgICAgICAgdGhpcy5fYmFzaXMgPSBuZXcgUngodDIpLCB0aGlzLl9iZXRhID0gbjI7CiAgICAgIH0KICAgICAgUngucHJvdG90eXBlID0geyBhcmVhU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSAwOwogICAgICB9LCBhcmVhRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9saW5lID0gTmFOOwogICAgICB9LCBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX3gwID0gdGhpcy5feDEgPSB0aGlzLl95MCA9IHRoaXMuX3kxID0gTmFOLCB0aGlzLl9wb2ludCA9IDA7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgRHgodGhpcywgdGhpcy5feDEsIHRoaXMuX3kxKTsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGhpcy5fY29udGV4dC5saW5lVG8odGhpcy5feDEsIHRoaXMuX3kxKTsKICAgICAgICB9CiAgICAgICAgKHRoaXMuX2xpbmUgfHwgMCAhPT0gdGhpcy5fbGluZSAmJiAxID09PSB0aGlzLl9wb2ludCkgJiYgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKSwgdGhpcy5fbGluZSA9IDEgLSB0aGlzLl9saW5lOwogICAgICB9LCBwb2ludDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgc3dpdGNoICh0MiA9ICt0MiwgbjIgPSArbjIsIHRoaXMuX3BvaW50KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMSwgdGhpcy5fbGluZSA/IHRoaXMuX2NvbnRleHQubGluZVRvKHQyLCBuMikgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh0MiwgbjIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAzLCB0aGlzLl9jb250ZXh0LmxpbmVUbygoNSAqIHRoaXMuX3gwICsgdGhpcy5feDEpIC8gNiwgKDUgKiB0aGlzLl95MCArIHRoaXMuX3kxKSAvIDYpOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgRHgodGhpcywgdDIsIG4yKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB0MiwgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSBuMjsKICAgICAgfSB9LCBGeC5wcm90b3R5cGUgPSB7IGFyZWFTdGFydDogJHgsIGFyZWFFbmQ6ICR4LCBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX3gwID0gdGhpcy5feDEgPSB0aGlzLl94MiA9IHRoaXMuX3gzID0gdGhpcy5feDQgPSB0aGlzLl95MCA9IHRoaXMuX3kxID0gdGhpcy5feTIgPSB0aGlzLl95MyA9IHRoaXMuX3k0ID0gTmFOLCB0aGlzLl9wb2ludCA9IDA7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdGhpcy5fY29udGV4dC5tb3ZlVG8odGhpcy5feDIsIHRoaXMuX3kyKSwgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHRoaXMuX2NvbnRleHQubW92ZVRvKCh0aGlzLl94MiArIDIgKiB0aGlzLl94MykgLyAzLCAodGhpcy5feTIgKyAyICogdGhpcy5feTMpIC8gMyksIHRoaXMuX2NvbnRleHQubGluZVRvKCh0aGlzLl94MyArIDIgKiB0aGlzLl94MikgLyAzLCAodGhpcy5feTMgKyAyICogdGhpcy5feTIpIC8gMyksIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB0aGlzLnBvaW50KHRoaXMuX3gyLCB0aGlzLl95MiksIHRoaXMucG9pbnQodGhpcy5feDMsIHRoaXMuX3kzKSwgdGhpcy5wb2ludCh0aGlzLl94NCwgdGhpcy5feTQpOwogICAgICAgIH0KICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHN3aXRjaCAodDIgPSArdDIsIG4yID0gK24yLCB0aGlzLl9wb2ludCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDEsIHRoaXMuX3gyID0gdDIsIHRoaXMuX3kyID0gbjI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDIsIHRoaXMuX3gzID0gdDIsIHRoaXMuX3kzID0gbjI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDMsIHRoaXMuX3g0ID0gdDIsIHRoaXMuX3k0ID0gbjIsIHRoaXMuX2NvbnRleHQubW92ZVRvKCh0aGlzLl94MCArIDQgKiB0aGlzLl94MSArIHQyKSAvIDYsICh0aGlzLl95MCArIDQgKiB0aGlzLl95MSArIG4yKSAvIDYpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIER4KHRoaXMsIHQyLCBuMik7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3gwID0gdGhpcy5feDEsIHRoaXMuX3gxID0gdDIsIHRoaXMuX3kwID0gdGhpcy5feTEsIHRoaXMuX3kxID0gbjI7CiAgICAgIH0gfSwgcXgucHJvdG90eXBlID0geyBhcmVhU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSAwOwogICAgICB9LCBhcmVhRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9saW5lID0gTmFOOwogICAgICB9LCBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX3gwID0gdGhpcy5feDEgPSB0aGlzLl95MCA9IHRoaXMuX3kxID0gTmFOLCB0aGlzLl9wb2ludCA9IDA7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICh0aGlzLl9saW5lIHx8IDAgIT09IHRoaXMuX2xpbmUgJiYgMyA9PT0gdGhpcy5fcG9pbnQpICYmIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCksIHRoaXMuX2xpbmUgPSAxIC0gdGhpcy5fbGluZTsKICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHN3aXRjaCAodDIgPSArdDIsIG4yID0gK24yLCB0aGlzLl9wb2ludCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDM7CiAgICAgICAgICAgIHZhciBlMiA9ICh0aGlzLl94MCArIDQgKiB0aGlzLl94MSArIHQyKSAvIDYsIHIyID0gKHRoaXMuX3kwICsgNCAqIHRoaXMuX3kxICsgbjIpIC8gNjsKICAgICAgICAgICAgdGhpcy5fbGluZSA/IHRoaXMuX2NvbnRleHQubGluZVRvKGUyLCByMikgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyhlMiwgcjIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSA0OwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgRHgodGhpcywgdDIsIG4yKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB0MiwgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSBuMjsKICAgICAgfSB9LCBVeC5wcm90b3R5cGUgPSB7IGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5feCA9IFtdLCB0aGlzLl95ID0gW10sIHRoaXMuX2Jhc2lzLmxpbmVTdGFydCgpOwogICAgICB9LCBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSB0aGlzLl94LCBuMiA9IHRoaXMuX3ksIGUyID0gdDIubGVuZ3RoIC0gMTsKICAgICAgICBpZiAoZTIgPiAwKQogICAgICAgICAgZm9yICh2YXIgcjIsIGkyID0gdDJbMF0sIG8yID0gbjJbMF0sIGEyID0gdDJbZTJdIC0gaTIsIHUyID0gbjJbZTJdIC0gbzIsIGMyID0gLTE7ICsrYzIgPD0gZTI7ICkKICAgICAgICAgICAgcjIgPSBjMiAvIGUyLCB0aGlzLl9iYXNpcy5wb2ludCh0aGlzLl9iZXRhICogdDJbYzJdICsgKDEgLSB0aGlzLl9iZXRhKSAqIChpMiArIHIyICogYTIpLCB0aGlzLl9iZXRhICogbjJbYzJdICsgKDEgLSB0aGlzLl9iZXRhKSAqIChvMiArIHIyICogdTIpKTsKICAgICAgICB0aGlzLl94ID0gdGhpcy5feSA9IG51bGwsIHRoaXMuX2Jhc2lzLmxpbmVFbmQoKTsKICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHRoaXMuX3gucHVzaCgrdDIpLCB0aGlzLl95LnB1c2goK24yKTsKICAgICAgfSB9OwogICAgICB2YXIgSXggPSBmdW5jdGlvbiB0MihuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKHQzKSB7CiAgICAgICAgICByZXR1cm4gMSA9PT0gbjIgPyBuZXcgUngodDMpIDogbmV3IFV4KHQzLCBuMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlMi5iZXRhID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiB0MigrbjMpOwogICAgICAgIH0sIGUyOwogICAgICB9KDAuODUpOwogICAgICBmdW5jdGlvbiBPeCh0MiwgbjIsIGUyKSB7CiAgICAgICAgdDIuX2NvbnRleHQuYmV6aWVyQ3VydmVUbyh0Mi5feDEgKyB0Mi5fayAqICh0Mi5feDIgLSB0Mi5feDApLCB0Mi5feTEgKyB0Mi5fayAqICh0Mi5feTIgLSB0Mi5feTApLCB0Mi5feDIgKyB0Mi5fayAqICh0Mi5feDEgLSBuMiksIHQyLl95MiArIHQyLl9rICogKHQyLl95MSAtIGUyKSwgdDIuX3gyLCB0Mi5feTIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEJ4KHQyLCBuMikgewogICAgICAgIHRoaXMuX2NvbnRleHQgPSB0MiwgdGhpcy5fayA9ICgxIC0gbjIpIC8gNjsKICAgICAgfQogICAgICBCeC5wcm90b3R5cGUgPSB7IGFyZWFTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbGluZSA9IDA7CiAgICAgIH0sIGFyZWFFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgICAgIH0sIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0gdGhpcy5feTAgPSB0aGlzLl95MSA9IHRoaXMuX3kyID0gTmFOLCB0aGlzLl9wb2ludCA9IDA7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGhpcy5fY29udGV4dC5saW5lVG8odGhpcy5feDIsIHRoaXMuX3kyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIE94KHRoaXMsIHRoaXMuX3gxLCB0aGlzLl95MSk7CiAgICAgICAgfQogICAgICAgICh0aGlzLl9saW5lIHx8IDAgIT09IHRoaXMuX2xpbmUgJiYgMSA9PT0gdGhpcy5fcG9pbnQpICYmIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCksIHRoaXMuX2xpbmUgPSAxIC0gdGhpcy5fbGluZTsKICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHN3aXRjaCAodDIgPSArdDIsIG4yID0gK24yLCB0aGlzLl9wb2ludCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDEsIHRoaXMuX2xpbmUgPyB0aGlzLl9jb250ZXh0LmxpbmVUbyh0MiwgbjIpIDogdGhpcy5fY29udGV4dC5tb3ZlVG8odDIsIG4yKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMiwgdGhpcy5feDEgPSB0MiwgdGhpcy5feTEgPSBuMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMzsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIE94KHRoaXMsIHQyLCBuMik7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3gwID0gdGhpcy5feDEsIHRoaXMuX3gxID0gdGhpcy5feDIsIHRoaXMuX3gyID0gdDIsIHRoaXMuX3kwID0gdGhpcy5feTEsIHRoaXMuX3kxID0gdGhpcy5feTIsIHRoaXMuX3kyID0gbjI7CiAgICAgIH0gfTsKICAgICAgdmFyIFl4ID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MykgewogICAgICAgICAgcmV0dXJuIG5ldyBCeCh0MywgbjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZTIudGVuc2lvbiA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gdDIoK24zKTsKICAgICAgICB9LCBlMjsKICAgICAgfSgwKTsKICAgICAgZnVuY3Rpb24gTHgodDIsIG4yKSB7CiAgICAgICAgdGhpcy5fY29udGV4dCA9IHQyLCB0aGlzLl9rID0gKDEgLSBuMikgLyA2OwogICAgICB9CiAgICAgIEx4LnByb3RvdHlwZSA9IHsgYXJlYVN0YXJ0OiAkeCwgYXJlYUVuZDogJHgsIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0gdGhpcy5feDMgPSB0aGlzLl94NCA9IHRoaXMuX3g1ID0gdGhpcy5feTAgPSB0aGlzLl95MSA9IHRoaXMuX3kyID0gdGhpcy5feTMgPSB0aGlzLl95NCA9IHRoaXMuX3k1ID0gTmFOLCB0aGlzLl9wb2ludCA9IDA7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdGhpcy5fY29udGV4dC5tb3ZlVG8odGhpcy5feDMsIHRoaXMuX3kzKSwgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHRoaXMuX2NvbnRleHQubGluZVRvKHRoaXMuX3gzLCB0aGlzLl95MyksIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB0aGlzLnBvaW50KHRoaXMuX3gzLCB0aGlzLl95MyksIHRoaXMucG9pbnQodGhpcy5feDQsIHRoaXMuX3k0KSwgdGhpcy5wb2ludCh0aGlzLl94NSwgdGhpcy5feTUpOwogICAgICAgIH0KICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHN3aXRjaCAodDIgPSArdDIsIG4yID0gK24yLCB0aGlzLl9wb2ludCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDEsIHRoaXMuX3gzID0gdDIsIHRoaXMuX3kzID0gbjI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDIsIHRoaXMuX2NvbnRleHQubW92ZVRvKHRoaXMuX3g0ID0gdDIsIHRoaXMuX3k0ID0gbjIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAzLCB0aGlzLl94NSA9IHQyLCB0aGlzLl95NSA9IG4yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIE94KHRoaXMsIHQyLCBuMik7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3gwID0gdGhpcy5feDEsIHRoaXMuX3gxID0gdGhpcy5feDIsIHRoaXMuX3gyID0gdDIsIHRoaXMuX3kwID0gdGhpcy5feTEsIHRoaXMuX3kxID0gdGhpcy5feTIsIHRoaXMuX3kyID0gbjI7CiAgICAgIH0gfTsKICAgICAgdmFyIGp4ID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MykgewogICAgICAgICAgcmV0dXJuIG5ldyBMeCh0MywgbjIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZTIudGVuc2lvbiA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gdDIoK24zKTsKICAgICAgICB9LCBlMjsKICAgICAgfSgwKTsKICAgICAgZnVuY3Rpb24gSHgodDIsIG4yKSB7CiAgICAgICAgdGhpcy5fY29udGV4dCA9IHQyLCB0aGlzLl9rID0gKDEgLSBuMikgLyA2OwogICAgICB9CiAgICAgIEh4LnByb3RvdHlwZSA9IHsgYXJlYVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9saW5lID0gMDsKICAgICAgfSwgYXJlYUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbGluZSA9IE5hTjsKICAgICAgfSwgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl94MCA9IHRoaXMuX3gxID0gdGhpcy5feDIgPSB0aGlzLl95MCA9IHRoaXMuX3kxID0gdGhpcy5feTIgPSBOYU4sIHRoaXMuX3BvaW50ID0gMDsKICAgICAgfSwgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgKHRoaXMuX2xpbmUgfHwgMCAhPT0gdGhpcy5fbGluZSAmJiAzID09PSB0aGlzLl9wb2ludCkgJiYgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKSwgdGhpcy5fbGluZSA9IDEgLSB0aGlzLl9saW5lOwogICAgICB9LCBwb2ludDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgc3dpdGNoICh0MiA9ICt0MiwgbjIgPSArbjIsIHRoaXMuX3BvaW50KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMywgdGhpcy5fbGluZSA/IHRoaXMuX2NvbnRleHQubGluZVRvKHRoaXMuX3gyLCB0aGlzLl95MikgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh0aGlzLl94MiwgdGhpcy5feTIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSA0OwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgT3godGhpcywgdDIsIG4yKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB0aGlzLl94MiwgdGhpcy5feDIgPSB0MiwgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSB0aGlzLl95MiwgdGhpcy5feTIgPSBuMjsKICAgICAgfSB9OwogICAgICB2YXIgWHggPSBmdW5jdGlvbiB0MihuMikgewogICAgICAgIGZ1bmN0aW9uIGUyKHQzKSB7CiAgICAgICAgICByZXR1cm4gbmV3IEh4KHQzLCBuMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlMi50ZW5zaW9uID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiB0MigrbjMpOwogICAgICAgIH0sIGUyOwogICAgICB9KDApOwogICAgICBmdW5jdGlvbiBHeCh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gdDIuX3gxLCBpMiA9IHQyLl95MSwgbzIgPSB0Mi5feDIsIGEyID0gdDIuX3kyOwogICAgICAgIGlmICh0Mi5fbDAxX2EgPiBNbSkgewogICAgICAgICAgdmFyIHUyID0gMiAqIHQyLl9sMDFfMmEgKyAzICogdDIuX2wwMV9hICogdDIuX2wxMl9hICsgdDIuX2wxMl8yYSwgYzIgPSAzICogdDIuX2wwMV9hICogKHQyLl9sMDFfYSArIHQyLl9sMTJfYSk7CiAgICAgICAgICByMiA9IChyMiAqIHUyIC0gdDIuX3gwICogdDIuX2wxMl8yYSArIHQyLl94MiAqIHQyLl9sMDFfMmEpIC8gYzIsIGkyID0gKGkyICogdTIgLSB0Mi5feTAgKiB0Mi5fbDEyXzJhICsgdDIuX3kyICogdDIuX2wwMV8yYSkgLyBjMjsKICAgICAgICB9CiAgICAgICAgaWYgKHQyLl9sMjNfYSA+IE1tKSB7CiAgICAgICAgICB2YXIgZjIgPSAyICogdDIuX2wyM18yYSArIDMgKiB0Mi5fbDIzX2EgKiB0Mi5fbDEyX2EgKyB0Mi5fbDEyXzJhLCBzMiA9IDMgKiB0Mi5fbDIzX2EgKiAodDIuX2wyM19hICsgdDIuX2wxMl9hKTsKICAgICAgICAgIG8yID0gKG8yICogZjIgKyB0Mi5feDEgKiB0Mi5fbDIzXzJhIC0gbjIgKiB0Mi5fbDEyXzJhKSAvIHMyLCBhMiA9IChhMiAqIGYyICsgdDIuX3kxICogdDIuX2wyM18yYSAtIGUyICogdDIuX2wxMl8yYSkgLyBzMjsKICAgICAgICB9CiAgICAgICAgdDIuX2NvbnRleHQuYmV6aWVyQ3VydmVUbyhyMiwgaTIsIG8yLCBhMiwgdDIuX3gyLCB0Mi5feTIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIFZ4KHQyLCBuMikgewogICAgICAgIHRoaXMuX2NvbnRleHQgPSB0MiwgdGhpcy5fYWxwaGEgPSBuMjsKICAgICAgfQogICAgICBWeC5wcm90b3R5cGUgPSB7IGFyZWFTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbGluZSA9IDA7CiAgICAgIH0sIGFyZWFFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgICAgIH0sIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0gdGhpcy5feTAgPSB0aGlzLl95MSA9IHRoaXMuX3kyID0gTmFOLCB0aGlzLl9sMDFfYSA9IHRoaXMuX2wxMl9hID0gdGhpcy5fbDIzX2EgPSB0aGlzLl9sMDFfMmEgPSB0aGlzLl9sMTJfMmEgPSB0aGlzLl9sMjNfMmEgPSB0aGlzLl9wb2ludCA9IDA7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGhpcy5fY29udGV4dC5saW5lVG8odGhpcy5feDIsIHRoaXMuX3kyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHRoaXMucG9pbnQodGhpcy5feDIsIHRoaXMuX3kyKTsKICAgICAgICB9CiAgICAgICAgKHRoaXMuX2xpbmUgfHwgMCAhPT0gdGhpcy5fbGluZSAmJiAxID09PSB0aGlzLl9wb2ludCkgJiYgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKSwgdGhpcy5fbGluZSA9IDEgLSB0aGlzLl9saW5lOwogICAgICB9LCBwb2ludDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgaWYgKHQyID0gK3QyLCBuMiA9ICtuMiwgdGhpcy5fcG9pbnQpIHsKICAgICAgICAgIHZhciBlMiA9IHRoaXMuX3gyIC0gdDIsIHIyID0gdGhpcy5feTIgLSBuMjsKICAgICAgICAgIHRoaXMuX2wyM19hID0gTWF0aC5zcXJ0KHRoaXMuX2wyM18yYSA9IE1hdGgucG93KGUyICogZTIgKyByMiAqIHIyLCB0aGlzLl9hbHBoYSkpOwogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMSwgdGhpcy5fbGluZSA/IHRoaXMuX2NvbnRleHQubGluZVRvKHQyLCBuMikgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh0MiwgbjIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAyOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAzOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgR3godGhpcywgdDIsIG4yKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fbDAxX2EgPSB0aGlzLl9sMTJfYSwgdGhpcy5fbDEyX2EgPSB0aGlzLl9sMjNfYSwgdGhpcy5fbDAxXzJhID0gdGhpcy5fbDEyXzJhLCB0aGlzLl9sMTJfMmEgPSB0aGlzLl9sMjNfMmEsIHRoaXMuX3gwID0gdGhpcy5feDEsIHRoaXMuX3gxID0gdGhpcy5feDIsIHRoaXMuX3gyID0gdDIsIHRoaXMuX3kwID0gdGhpcy5feTEsIHRoaXMuX3kxID0gdGhpcy5feTIsIHRoaXMuX3kyID0gbjI7CiAgICAgIH0gfTsKICAgICAgdmFyIFd4ID0gZnVuY3Rpb24gdDIobjIpIHsKICAgICAgICBmdW5jdGlvbiBlMih0MykgewogICAgICAgICAgcmV0dXJuIG4yID8gbmV3IFZ4KHQzLCBuMikgOiBuZXcgQngodDMsIDApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZTIuYWxwaGEgPSBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIHQyKCtuMyk7CiAgICAgICAgfSwgZTI7CiAgICAgIH0oMC41KTsKICAgICAgZnVuY3Rpb24gWngodDIsIG4yKSB7CiAgICAgICAgdGhpcy5fY29udGV4dCA9IHQyLCB0aGlzLl9hbHBoYSA9IG4yOwogICAgICB9CiAgICAgIFp4LnByb3RvdHlwZSA9IHsgYXJlYVN0YXJ0OiAkeCwgYXJlYUVuZDogJHgsIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0gdGhpcy5feDMgPSB0aGlzLl94NCA9IHRoaXMuX3g1ID0gdGhpcy5feTAgPSB0aGlzLl95MSA9IHRoaXMuX3kyID0gdGhpcy5feTMgPSB0aGlzLl95NCA9IHRoaXMuX3k1ID0gTmFOLCB0aGlzLl9sMDFfYSA9IHRoaXMuX2wxMl9hID0gdGhpcy5fbDIzX2EgPSB0aGlzLl9sMDFfMmEgPSB0aGlzLl9sMTJfMmEgPSB0aGlzLl9sMjNfMmEgPSB0aGlzLl9wb2ludCA9IDA7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHN3aXRjaCAodGhpcy5fcG9pbnQpIHsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdGhpcy5fY29udGV4dC5tb3ZlVG8odGhpcy5feDMsIHRoaXMuX3kzKSwgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHRoaXMuX2NvbnRleHQubGluZVRvKHRoaXMuX3gzLCB0aGlzLl95MyksIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICB0aGlzLnBvaW50KHRoaXMuX3gzLCB0aGlzLl95MyksIHRoaXMucG9pbnQodGhpcy5feDQsIHRoaXMuX3k0KSwgdGhpcy5wb2ludCh0aGlzLl94NSwgdGhpcy5feTUpOwogICAgICAgIH0KICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGlmICh0MiA9ICt0MiwgbjIgPSArbjIsIHRoaXMuX3BvaW50KSB7CiAgICAgICAgICB2YXIgZTIgPSB0aGlzLl94MiAtIHQyLCByMiA9IHRoaXMuX3kyIC0gbjI7CiAgICAgICAgICB0aGlzLl9sMjNfYSA9IE1hdGguc3FydCh0aGlzLl9sMjNfMmEgPSBNYXRoLnBvdyhlMiAqIGUyICsgcjIgKiByMiwgdGhpcy5fYWxwaGEpKTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDEsIHRoaXMuX3gzID0gdDIsIHRoaXMuX3kzID0gbjI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDIsIHRoaXMuX2NvbnRleHQubW92ZVRvKHRoaXMuX3g0ID0gdDIsIHRoaXMuX3k0ID0gbjIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAzLCB0aGlzLl94NSA9IHQyLCB0aGlzLl95NSA9IG4yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIEd4KHRoaXMsIHQyLCBuMik7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2wwMV9hID0gdGhpcy5fbDEyX2EsIHRoaXMuX2wxMl9hID0gdGhpcy5fbDIzX2EsIHRoaXMuX2wwMV8yYSA9IHRoaXMuX2wxMl8yYSwgdGhpcy5fbDEyXzJhID0gdGhpcy5fbDIzXzJhLCB0aGlzLl94MCA9IHRoaXMuX3gxLCB0aGlzLl94MSA9IHRoaXMuX3gyLCB0aGlzLl94MiA9IHQyLCB0aGlzLl95MCA9IHRoaXMuX3kxLCB0aGlzLl95MSA9IHRoaXMuX3kyLCB0aGlzLl95MiA9IG4yOwogICAgICB9IH07CiAgICAgIHZhciBLeCA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgZnVuY3Rpb24gZTIodDMpIHsKICAgICAgICAgIHJldHVybiBuMiA/IG5ldyBaeCh0MywgbjIpIDogbmV3IEx4KHQzLCAwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLmFscGhhID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiB0MigrbjMpOwogICAgICAgIH0sIGUyOwogICAgICB9KDAuNSk7CiAgICAgIGZ1bmN0aW9uIFF4KHQyLCBuMikgewogICAgICAgIHRoaXMuX2NvbnRleHQgPSB0MiwgdGhpcy5fYWxwaGEgPSBuMjsKICAgICAgfQogICAgICBReC5wcm90b3R5cGUgPSB7IGFyZWFTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbGluZSA9IDA7CiAgICAgIH0sIGFyZWFFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgICAgIH0sIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3gyID0gdGhpcy5feTAgPSB0aGlzLl95MSA9IHRoaXMuX3kyID0gTmFOLCB0aGlzLl9sMDFfYSA9IHRoaXMuX2wxMl9hID0gdGhpcy5fbDIzX2EgPSB0aGlzLl9sMDFfMmEgPSB0aGlzLl9sMTJfMmEgPSB0aGlzLl9sMjNfMmEgPSB0aGlzLl9wb2ludCA9IDA7CiAgICAgIH0sIGxpbmVFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgICh0aGlzLl9saW5lIHx8IDAgIT09IHRoaXMuX2xpbmUgJiYgMyA9PT0gdGhpcy5fcG9pbnQpICYmIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCksIHRoaXMuX2xpbmUgPSAxIC0gdGhpcy5fbGluZTsKICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGlmICh0MiA9ICt0MiwgbjIgPSArbjIsIHRoaXMuX3BvaW50KSB7CiAgICAgICAgICB2YXIgZTIgPSB0aGlzLl94MiAtIHQyLCByMiA9IHRoaXMuX3kyIC0gbjI7CiAgICAgICAgICB0aGlzLl9sMjNfYSA9IE1hdGguc3FydCh0aGlzLl9sMjNfMmEgPSBNYXRoLnBvdyhlMiAqIGUyICsgcjIgKiByMiwgdGhpcy5fYWxwaGEpKTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoICh0aGlzLl9wb2ludCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB0aGlzLl9wb2ludCA9IDMsIHRoaXMuX2xpbmUgPyB0aGlzLl9jb250ZXh0LmxpbmVUbyh0aGlzLl94MiwgdGhpcy5feTIpIDogdGhpcy5fY29udGV4dC5tb3ZlVG8odGhpcy5feDIsIHRoaXMuX3kyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gNDsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIEd4KHRoaXMsIHQyLCBuMik7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2wwMV9hID0gdGhpcy5fbDEyX2EsIHRoaXMuX2wxMl9hID0gdGhpcy5fbDIzX2EsIHRoaXMuX2wwMV8yYSA9IHRoaXMuX2wxMl8yYSwgdGhpcy5fbDEyXzJhID0gdGhpcy5fbDIzXzJhLCB0aGlzLl94MCA9IHRoaXMuX3gxLCB0aGlzLl94MSA9IHRoaXMuX3gyLCB0aGlzLl94MiA9IHQyLCB0aGlzLl95MCA9IHRoaXMuX3kxLCB0aGlzLl95MSA9IHRoaXMuX3kyLCB0aGlzLl95MiA9IG4yOwogICAgICB9IH07CiAgICAgIHZhciBKeCA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgZnVuY3Rpb24gZTIodDMpIHsKICAgICAgICAgIHJldHVybiBuMiA/IG5ldyBReCh0MywgbjIpIDogbmV3IEh4KHQzLCAwKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyLmFscGhhID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiB0MigrbjMpOwogICAgICAgIH0sIGUyOwogICAgICB9KDAuNSk7CiAgICAgIGZ1bmN0aW9uIHR3KHQyKSB7CiAgICAgICAgdGhpcy5fY29udGV4dCA9IHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG53KHQyKSB7CiAgICAgICAgcmV0dXJuIHQyIDwgMCA/IC0xIDogMTsKICAgICAgfQogICAgICBmdW5jdGlvbiBldyh0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyID0gdDIuX3gxIC0gdDIuX3gwLCBpMiA9IG4yIC0gdDIuX3gxLCBvMiA9ICh0Mi5feTEgLSB0Mi5feTApIC8gKHIyIHx8IGkyIDwgMCAmJiAtMCksIGEyID0gKGUyIC0gdDIuX3kxKSAvIChpMiB8fCByMiA8IDAgJiYgLTApLCB1MiA9IChvMiAqIGkyICsgYTIgKiByMikgLyAocjIgKyBpMik7CiAgICAgICAgcmV0dXJuIChudyhvMikgKyBudyhhMikpICogTWF0aC5taW4oTWF0aC5hYnMobzIpLCBNYXRoLmFicyhhMiksIDAuNSAqIE1hdGguYWJzKHUyKSkgfHwgMDsKICAgICAgfQogICAgICBmdW5jdGlvbiBydyh0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSB0Mi5feDEgLSB0Mi5feDA7CiAgICAgICAgcmV0dXJuIGUyID8gKDMgKiAodDIuX3kxIC0gdDIuX3kwKSAvIGUyIC0gbjIpIC8gMiA6IG4yOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGl3KHQyLCBuMiwgZTIpIHsKICAgICAgICB2YXIgcjIgPSB0Mi5feDAsIGkyID0gdDIuX3kwLCBvMiA9IHQyLl94MSwgYTIgPSB0Mi5feTEsIHUyID0gKG8yIC0gcjIpIC8gMzsKICAgICAgICB0Mi5fY29udGV4dC5iZXppZXJDdXJ2ZVRvKHIyICsgdTIsIGkyICsgdTIgKiBuMiwgbzIgLSB1MiwgYTIgLSB1MiAqIGUyLCBvMiwgYTIpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG93KHQyKSB7CiAgICAgICAgdGhpcy5fY29udGV4dCA9IHQyOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGF3KHQyKSB7CiAgICAgICAgdGhpcy5fY29udGV4dCA9IG5ldyB1dyh0Mik7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gdXcodDIpIHsKICAgICAgICB0aGlzLl9jb250ZXh0ID0gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY3codDIpIHsKICAgICAgICB0aGlzLl9jb250ZXh0ID0gdDI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gZncodDIpIHsKICAgICAgICB2YXIgbjIsIGUyLCByMiA9IHQyLmxlbmd0aCAtIDEsIGkyID0gbmV3IEFycmF5KHIyKSwgbzIgPSBuZXcgQXJyYXkocjIpLCBhMiA9IG5ldyBBcnJheShyMik7CiAgICAgICAgZm9yIChpMlswXSA9IDAsIG8yWzBdID0gMiwgYTJbMF0gPSB0MlswXSArIDIgKiB0MlsxXSwgbjIgPSAxOyBuMiA8IHIyIC0gMTsgKytuMikKICAgICAgICAgIGkyW24yXSA9IDEsIG8yW24yXSA9IDQsIGEyW24yXSA9IDQgKiB0MltuMl0gKyAyICogdDJbbjIgKyAxXTsKICAgICAgICBmb3IgKGkyW3IyIC0gMV0gPSAyLCBvMltyMiAtIDFdID0gNywgYTJbcjIgLSAxXSA9IDggKiB0MltyMiAtIDFdICsgdDJbcjJdLCBuMiA9IDE7IG4yIDwgcjI7ICsrbjIpCiAgICAgICAgICBlMiA9IGkyW24yXSAvIG8yW24yIC0gMV0sIG8yW24yXSAtPSBlMiwgYTJbbjJdIC09IGUyICogYTJbbjIgLSAxXTsKICAgICAgICBmb3IgKGkyW3IyIC0gMV0gPSBhMltyMiAtIDFdIC8gbzJbcjIgLSAxXSwgbjIgPSByMiAtIDI7IG4yID49IDA7IC0tbjIpCiAgICAgICAgICBpMltuMl0gPSAoYTJbbjJdIC0gaTJbbjIgKyAxXSkgLyBvMltuMl07CiAgICAgICAgZm9yIChvMltyMiAtIDFdID0gKHQyW3IyXSArIGkyW3IyIC0gMV0pIC8gMiwgbjIgPSAwOyBuMiA8IHIyIC0gMTsgKytuMikKICAgICAgICAgIG8yW24yXSA9IDIgKiB0MltuMiArIDFdIC0gaTJbbjIgKyAxXTsKICAgICAgICByZXR1cm4gW2kyLCBvMl07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gc3codDIsIG4yKSB7CiAgICAgICAgdGhpcy5fY29udGV4dCA9IHQyLCB0aGlzLl90ID0gbjI7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbHcodDIsIG4yKSB7CiAgICAgICAgaWYgKChpMiA9IHQyLmxlbmd0aCkgPiAxKQogICAgICAgICAgZm9yICh2YXIgZTIsIHIyLCBpMiwgbzIgPSAxLCBhMiA9IHQyW24yWzBdXSwgdTIgPSBhMi5sZW5ndGg7IG8yIDwgaTI7ICsrbzIpCiAgICAgICAgICAgIGZvciAocjIgPSBhMiwgYTIgPSB0MltuMltvMl1dLCBlMiA9IDA7IGUyIDwgdTI7ICsrZTIpCiAgICAgICAgICAgICAgYTJbZTJdWzFdICs9IGEyW2UyXVswXSA9IGlzTmFOKHIyW2UyXVsxXSkgPyByMltlMl1bMF0gOiByMltlMl1bMV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gaHcodDIpIHsKICAgICAgICBmb3IgKHZhciBuMiA9IHQyLmxlbmd0aCwgZTIgPSBuZXcgQXJyYXkobjIpOyAtLW4yID49IDA7ICkKICAgICAgICAgIGUyW24yXSA9IG4yOwogICAgICAgIHJldHVybiBlMjsKICAgICAgfQogICAgICBmdW5jdGlvbiBkdyh0MiwgbjIpIHsKICAgICAgICByZXR1cm4gdDJbbjJdOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHB3KHQyKSB7CiAgICAgICAgY29uc3QgbjIgPSBbXTsKICAgICAgICByZXR1cm4gbjIua2V5ID0gdDIsIG4yOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGd3KHQyKSB7CiAgICAgICAgdmFyIG4yID0gdDIubWFwKHl3KTsKICAgICAgICByZXR1cm4gaHcodDIpLnNvcnQoZnVuY3Rpb24odDMsIGUyKSB7CiAgICAgICAgICByZXR1cm4gbjJbdDNdIC0gbjJbZTJdOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIHl3KHQyKSB7CiAgICAgICAgZm9yICh2YXIgbjIsIGUyID0gLTEsIHIyID0gMCwgaTIgPSB0Mi5sZW5ndGgsIG8yID0gLTEgLyAwOyArK2UyIDwgaTI7ICkKICAgICAgICAgIChuMiA9ICt0MltlMl1bMV0pID4gbzIgJiYgKG8yID0gbjIsIHIyID0gZTIpOwogICAgICAgIHJldHVybiByMjsKICAgICAgfQogICAgICBmdW5jdGlvbiB2dyh0MikgewogICAgICAgIHZhciBuMiA9IHQyLm1hcChfdyk7CiAgICAgICAgcmV0dXJuIGh3KHQyKS5zb3J0KGZ1bmN0aW9uKHQzLCBlMikgewogICAgICAgICAgcmV0dXJuIG4yW3QzXSAtIG4yW2UyXTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiBfdyh0MikgewogICAgICAgIGZvciAodmFyIG4yLCBlMiA9IDAsIHIyID0gLTEsIGkyID0gdDIubGVuZ3RoOyArK3IyIDwgaTI7ICkKICAgICAgICAgIChuMiA9ICt0MltyMl1bMV0pICYmIChlMiArPSBuMik7CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9CiAgICAgIHR3LnByb3RvdHlwZSA9IHsgYXJlYVN0YXJ0OiAkeCwgYXJlYUVuZDogJHgsIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fcG9pbnQgPSAwOwogICAgICB9LCBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9wb2ludCAmJiB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpOwogICAgICB9LCBwb2ludDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdDIgPSArdDIsIG4yID0gK24yLCB0aGlzLl9wb2ludCA/IHRoaXMuX2NvbnRleHQubGluZVRvKHQyLCBuMikgOiAodGhpcy5fcG9pbnQgPSAxLCB0aGlzLl9jb250ZXh0Lm1vdmVUbyh0MiwgbjIpKTsKICAgICAgfSB9LCBvdy5wcm90b3R5cGUgPSB7IGFyZWFTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbGluZSA9IDA7CiAgICAgIH0sIGFyZWFFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgICAgIH0sIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSA9IHRoaXMuX3kwID0gdGhpcy5feTEgPSB0aGlzLl90MCA9IE5hTiwgdGhpcy5fcG9pbnQgPSAwOwogICAgICB9LCBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIHRoaXMuX2NvbnRleHQubGluZVRvKHRoaXMuX3gxLCB0aGlzLl95MSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBpdyh0aGlzLCB0aGlzLl90MCwgcncodGhpcywgdGhpcy5fdDApKTsKICAgICAgICB9CiAgICAgICAgKHRoaXMuX2xpbmUgfHwgMCAhPT0gdGhpcy5fbGluZSAmJiAxID09PSB0aGlzLl9wb2ludCkgJiYgdGhpcy5fY29udGV4dC5jbG9zZVBhdGgoKSwgdGhpcy5fbGluZSA9IDEgLSB0aGlzLl9saW5lOwogICAgICB9LCBwb2ludDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gTmFOOwogICAgICAgIGlmIChuMiA9ICtuMiwgKHQyID0gK3QyKSAhPT0gdGhpcy5feDEgfHwgbjIgIT09IHRoaXMuX3kxKSB7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMuX3BvaW50KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLl9wb2ludCA9IDEsIHRoaXMuX2xpbmUgPyB0aGlzLl9jb250ZXh0LmxpbmVUbyh0MiwgbjIpIDogdGhpcy5fY29udGV4dC5tb3ZlVG8odDIsIG4yKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMywgaXcodGhpcywgcncodGhpcywgZTIgPSBldyh0aGlzLCB0MiwgbjIpKSwgZTIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGl3KHRoaXMsIHRoaXMuX3QwLCBlMiA9IGV3KHRoaXMsIHQyLCBuMikpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5feDAgPSB0aGlzLl94MSwgdGhpcy5feDEgPSB0MiwgdGhpcy5feTAgPSB0aGlzLl95MSwgdGhpcy5feTEgPSBuMiwgdGhpcy5fdDAgPSBlMjsKICAgICAgICB9CiAgICAgIH0gfSwgKGF3LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUob3cucHJvdG90eXBlKSkucG9pbnQgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBvdy5wcm90b3R5cGUucG9pbnQuY2FsbCh0aGlzLCBuMiwgdDIpOwogICAgICB9LCB1dy5wcm90b3R5cGUgPSB7IG1vdmVUbzogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdGhpcy5fY29udGV4dC5tb3ZlVG8objIsIHQyKTsKICAgICAgfSwgY2xvc2VQYXRoOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpOwogICAgICB9LCBsaW5lVG86IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHRoaXMuX2NvbnRleHQubGluZVRvKG4yLCB0Mik7CiAgICAgIH0sIGJlemllckN1cnZlVG86IGZ1bmN0aW9uKHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIpIHsKICAgICAgICB0aGlzLl9jb250ZXh0LmJlemllckN1cnZlVG8objIsIHQyLCByMiwgZTIsIG8yLCBpMik7CiAgICAgIH0gfSwgY3cucHJvdG90eXBlID0geyBhcmVhU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSAwOwogICAgICB9LCBhcmVhRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9saW5lID0gTmFOOwogICAgICB9LCBsaW5lU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX3ggPSBbXSwgdGhpcy5feSA9IFtdOwogICAgICB9LCBsaW5lRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSB0aGlzLl94LCBuMiA9IHRoaXMuX3ksIGUyID0gdDIubGVuZ3RoOwogICAgICAgIGlmIChlMikKICAgICAgICAgIGlmICh0aGlzLl9saW5lID8gdGhpcy5fY29udGV4dC5saW5lVG8odDJbMF0sIG4yWzBdKSA6IHRoaXMuX2NvbnRleHQubW92ZVRvKHQyWzBdLCBuMlswXSksIDIgPT09IGUyKQogICAgICAgICAgICB0aGlzLl9jb250ZXh0LmxpbmVUbyh0MlsxXSwgbjJbMV0pOwogICAgICAgICAgZWxzZQogICAgICAgICAgICBmb3IgKHZhciByMiA9IGZ3KHQyKSwgaTIgPSBmdyhuMiksIG8yID0gMCwgYTIgPSAxOyBhMiA8IGUyOyArK28yLCArK2EyKQogICAgICAgICAgICAgIHRoaXMuX2NvbnRleHQuYmV6aWVyQ3VydmVUbyhyMlswXVtvMl0sIGkyWzBdW28yXSwgcjJbMV1bbzJdLCBpMlsxXVtvMl0sIHQyW2EyXSwgbjJbYTJdKTsKICAgICAgICAodGhpcy5fbGluZSB8fCAwICE9PSB0aGlzLl9saW5lICYmIDEgPT09IGUyKSAmJiB0aGlzLl9jb250ZXh0LmNsb3NlUGF0aCgpLCB0aGlzLl9saW5lID0gMSAtIHRoaXMuX2xpbmUsIHRoaXMuX3ggPSB0aGlzLl95ID0gbnVsbDsKICAgICAgfSwgcG9pbnQ6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHRoaXMuX3gucHVzaCgrdDIpLCB0aGlzLl95LnB1c2goK24yKTsKICAgICAgfSB9LCBzdy5wcm90b3R5cGUgPSB7IGFyZWFTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbGluZSA9IDA7CiAgICAgIH0sIGFyZWFFbmQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuX2xpbmUgPSBOYU47CiAgICAgIH0sIGxpbmVTdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5feCA9IHRoaXMuX3kgPSBOYU4sIHRoaXMuX3BvaW50ID0gMDsKICAgICAgfSwgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgMCA8IHRoaXMuX3QgJiYgdGhpcy5fdCA8IDEgJiYgMiA9PT0gdGhpcy5fcG9pbnQgJiYgdGhpcy5fY29udGV4dC5saW5lVG8odGhpcy5feCwgdGhpcy5feSksICh0aGlzLl9saW5lIHx8IDAgIT09IHRoaXMuX2xpbmUgJiYgMSA9PT0gdGhpcy5fcG9pbnQpICYmIHRoaXMuX2NvbnRleHQuY2xvc2VQYXRoKCksIHRoaXMuX2xpbmUgPj0gMCAmJiAodGhpcy5fdCA9IDEgLSB0aGlzLl90LCB0aGlzLl9saW5lID0gMSAtIHRoaXMuX2xpbmUpOwogICAgICB9LCBwb2ludDogZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgc3dpdGNoICh0MiA9ICt0MiwgbjIgPSArbjIsIHRoaXMuX3BvaW50KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHRoaXMuX3BvaW50ID0gMSwgdGhpcy5fbGluZSA/IHRoaXMuX2NvbnRleHQubGluZVRvKHQyLCBuMikgOiB0aGlzLl9jb250ZXh0Lm1vdmVUbyh0MiwgbjIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgdGhpcy5fcG9pbnQgPSAyOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgaWYgKHRoaXMuX3QgPD0gMCkKICAgICAgICAgICAgICB0aGlzLl9jb250ZXh0LmxpbmVUbyh0aGlzLl94LCBuMiksIHRoaXMuX2NvbnRleHQubGluZVRvKHQyLCBuMik7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIHZhciBlMiA9IHRoaXMuX3ggKiAoMSAtIHRoaXMuX3QpICsgdDIgKiB0aGlzLl90OwogICAgICAgICAgICAgIHRoaXMuX2NvbnRleHQubGluZVRvKGUyLCB0aGlzLl95KSwgdGhpcy5fY29udGV4dC5saW5lVG8oZTIsIG4yKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLl94ID0gdDIsIHRoaXMuX3kgPSBuMjsKICAgICAgfSB9OwogICAgICB2YXIgYncgPSAodDIpID0+ICgpID0+IHQyOwogICAgICBmdW5jdGlvbiBtdyh0MiwgeyBzb3VyY2VFdmVudDogbjIsIHRhcmdldDogZTIsIHRyYW5zZm9ybTogcjIsIGRpc3BhdGNoOiBpMiB9KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgeyB0eXBlOiB7IHZhbHVlOiB0MiwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0sIHNvdXJjZUV2ZW50OiB7IHZhbHVlOiBuMiwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0sIHRhcmdldDogeyB2YWx1ZTogZTIsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9LCB0cmFuc2Zvcm06IHsgdmFsdWU6IHIyLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSwgXzogeyB2YWx1ZTogaTIgfSB9KTsKICAgICAgfQogICAgICBmdW5jdGlvbiB4dyh0MiwgbjIsIGUyKSB7CiAgICAgICAgdGhpcy5rID0gdDIsIHRoaXMueCA9IG4yLCB0aGlzLnkgPSBlMjsKICAgICAgfQogICAgICB4dy5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiB4dywgc2NhbGU6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIDEgPT09IHQyID8gdGhpcyA6IG5ldyB4dyh0aGlzLmsgKiB0MiwgdGhpcy54LCB0aGlzLnkpOwogICAgICB9LCB0cmFuc2xhdGU6IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiAwID09PSB0MiAmIDAgPT09IG4yID8gdGhpcyA6IG5ldyB4dyh0aGlzLmssIHRoaXMueCArIHRoaXMuayAqIHQyLCB0aGlzLnkgKyB0aGlzLmsgKiBuMik7CiAgICAgIH0sIGFwcGx5OiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBbdDJbMF0gKiB0aGlzLmsgKyB0aGlzLngsIHQyWzFdICogdGhpcy5rICsgdGhpcy55XTsKICAgICAgfSwgYXBwbHlYOiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0MiAqIHRoaXMuayArIHRoaXMueDsKICAgICAgfSwgYXBwbHlZOiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0MiAqIHRoaXMuayArIHRoaXMueTsKICAgICAgfSwgaW52ZXJ0OiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBbKHQyWzBdIC0gdGhpcy54KSAvIHRoaXMuaywgKHQyWzFdIC0gdGhpcy55KSAvIHRoaXMua107CiAgICAgIH0sIGludmVydFg6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuICh0MiAtIHRoaXMueCkgLyB0aGlzLms7CiAgICAgIH0sIGludmVydFk6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuICh0MiAtIHRoaXMueSkgLyB0aGlzLms7CiAgICAgIH0sIHJlc2NhbGVYOiBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0Mi5jb3B5KCkuZG9tYWluKHQyLnJhbmdlKCkubWFwKHRoaXMuaW52ZXJ0WCwgdGhpcykubWFwKHQyLmludmVydCwgdDIpKTsKICAgICAgfSwgcmVzY2FsZVk6IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyLmNvcHkoKS5kb21haW4odDIucmFuZ2UoKS5tYXAodGhpcy5pbnZlcnRZLCB0aGlzKS5tYXAodDIuaW52ZXJ0LCB0MikpOwogICAgICB9LCB0b1N0cmluZzogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoIiArIHRoaXMueCArICIsIiArIHRoaXMueSArICIpIHNjYWxlKCIgKyB0aGlzLmsgKyAiKSI7CiAgICAgIH0gfTsKICAgICAgdmFyIHd3ID0gbmV3IHh3KDEsIDAsIDApOwogICAgICBmdW5jdGlvbiBNdyh0MikgewogICAgICAgIGZvciAoOyAhdDIuX196b29tOyApCiAgICAgICAgICBpZiAoISh0MiA9IHQyLnBhcmVudE5vZGUpKQogICAgICAgICAgICByZXR1cm4gd3c7CiAgICAgICAgcmV0dXJuIHQyLl9fem9vbTsKICAgICAgfQogICAgICBmdW5jdGlvbiBUdyh0MikgewogICAgICAgIHQyLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIEF3KHQyKSB7CiAgICAgICAgdDIucHJldmVudERlZmF1bHQoKSwgdDIuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gU3codDIpIHsKICAgICAgICByZXR1cm4gISh0Mi5jdHJsS2V5ICYmICJ3aGVlbCIgIT09IHQyLnR5cGUgfHwgdDIuYnV0dG9uKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBFdygpIHsKICAgICAgICB2YXIgdDIgPSB0aGlzOwogICAgICAgIHJldHVybiB0MiBpbnN0YW5jZW9mIFNWR0VsZW1lbnQgPyAodDIgPSB0Mi5vd25lclNWR0VsZW1lbnQgfHwgdDIpLmhhc0F0dHJpYnV0ZSgidmlld0JveCIpID8gW1sodDIgPSB0Mi52aWV3Qm94LmJhc2VWYWwpLngsIHQyLnldLCBbdDIueCArIHQyLndpZHRoLCB0Mi55ICsgdDIuaGVpZ2h0XV0gOiBbWzAsIDBdLCBbdDIud2lkdGguYmFzZVZhbC52YWx1ZSwgdDIuaGVpZ2h0LmJhc2VWYWwudmFsdWVdXSA6IFtbMCwgMF0sIFt0Mi5jbGllbnRXaWR0aCwgdDIuY2xpZW50SGVpZ2h0XV07CiAgICAgIH0KICAgICAgZnVuY3Rpb24gTncoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX196b29tIHx8IHd3OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIGt3KHQyKSB7CiAgICAgICAgcmV0dXJuIC10Mi5kZWx0YVkgKiAoMSA9PT0gdDIuZGVsdGFNb2RlID8gMC4wNSA6IHQyLmRlbHRhTW9kZSA/IDEgOiAyZS0zKSAqICh0Mi5jdHJsS2V5ID8gMTAgOiAxKTsKICAgICAgfQogICAgICBmdW5jdGlvbiBDdygpIHsKICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1heFRvdWNoUG9pbnRzIHx8ICJvbnRvdWNoc3RhcnQiIGluIHRoaXM7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gUHcodDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IHQyLmludmVydFgobjJbMF1bMF0pIC0gZTJbMF1bMF0sIGkyID0gdDIuaW52ZXJ0WChuMlsxXVswXSkgLSBlMlsxXVswXSwgbzIgPSB0Mi5pbnZlcnRZKG4yWzBdWzFdKSAtIGUyWzBdWzFdLCBhMiA9IHQyLmludmVydFkobjJbMV1bMV0pIC0gZTJbMV1bMV07CiAgICAgICAgcmV0dXJuIHQyLnRyYW5zbGF0ZShpMiA+IHIyID8gKHIyICsgaTIpIC8gMiA6IE1hdGgubWluKDAsIHIyKSB8fCBNYXRoLm1heCgwLCBpMiksIGEyID4gbzIgPyAobzIgKyBhMikgLyAyIDogTWF0aC5taW4oMCwgbzIpIHx8IE1hdGgubWF4KDAsIGEyKSk7CiAgICAgIH0KICAgICAgTXcucHJvdG90eXBlID0geHcucHJvdG90eXBlLCB0LkFkZGVyID0gVCwgdC5EZWxhdW5heSA9IEx1LCB0LkZvcm1hdFNwZWNpZmllciA9IHRmLCB0LkludGVybk1hcCA9IEludGVybk1hcCwgdC5JbnRlcm5TZXQgPSBJbnRlcm5TZXQsIHQuTm9kZSA9IFFkLCB0LlBhdGggPSBVYSwgdC5Wb3Jvbm9pID0gcXUsIHQuWm9vbVRyYW5zZm9ybSA9IHh3LCB0LmFjdGl2ZSA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHZhciBlMiwgcjIsIGkyID0gdDIuX190cmFuc2l0aW9uOwogICAgICAgIGlmIChpMikgewogICAgICAgICAgZm9yIChyMiBpbiBuMiA9IG51bGwgPT0gbjIgPyBudWxsIDogbjIgKyAiIiwgaTIpCiAgICAgICAgICAgIGlmICgoZTIgPSBpMltyMl0pLnN0YXRlID4gcWkgJiYgZTIubmFtZSA9PT0gbjIpCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBwbyhbW3QyXV0sIFpvLCBuMiwgK3IyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0sIHQuYXJjID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyID0ga20sIG4yID0gQ20sIGUyID0gZ20oMCksIHIyID0gbnVsbCwgaTIgPSBQbSwgbzIgPSB6bSwgYTIgPSAkbSwgdTIgPSBudWxsLCBjMiA9IE5tKGYyKTsKICAgICAgICBmdW5jdGlvbiBmMigpIHsKICAgICAgICAgIHZhciBmMywgczIsIGwyID0gK3QyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGgyID0gK24yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIGQyID0gaTIuYXBwbHkodGhpcywgYXJndW1lbnRzKSAtIEFtLCBwMiA9IG8yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgLSBBbSwgZzIgPSB5bShwMiAtIGQyKSwgeTIgPSBwMiA+IGQyOwogICAgICAgICAgaWYgKHUyIHx8ICh1MiA9IGYzID0gYzIoKSksIGgyIDwgbDIgJiYgKHMyID0gaDIsIGgyID0gbDIsIGwyID0gczIpLCBoMiA+IE1tKQogICAgICAgICAgICBpZiAoZzIgPiBTbSAtIE1tKQogICAgICAgICAgICAgIHUyLm1vdmVUbyhoMiAqIF9tKGQyKSwgaDIgKiB4bShkMikpLCB1Mi5hcmMoMCwgMCwgaDIsIGQyLCBwMiwgIXkyKSwgbDIgPiBNbSAmJiAodTIubW92ZVRvKGwyICogX20ocDIpLCBsMiAqIHhtKHAyKSksIHUyLmFyYygwLCAwLCBsMiwgcDIsIGQyLCB5MikpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICB2YXIgdjIsIF8yLCBiMiA9IGQyLCBtMiA9IHAyLCB4MiA9IGQyLCB3MiA9IHAyLCBNMiA9IGcyLCBUMiA9IGcyLCBBMiA9IGEyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgLyAyLCBTMiA9IEEyID4gTW0gJiYgKHIyID8gK3IyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiB3bShsMiAqIGwyICsgaDIgKiBoMikpLCBFMiA9IG1tKHltKGgyIC0gbDIpIC8gMiwgK2UyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpLCBOMiA9IEUyLCBrMiA9IEUyOwogICAgICAgICAgICAgIGlmIChTMiA+IE1tKSB7CiAgICAgICAgICAgICAgICB2YXIgQzIgPSBFbShTMiAvIGwyICogeG0oQTIpKSwgUDIgPSBFbShTMiAvIGgyICogeG0oQTIpKTsKICAgICAgICAgICAgICAgIChNMiAtPSAyICogQzIpID4gTW0gPyAoeDIgKz0gQzIgKj0geTIgPyAxIDogLTEsIHcyIC09IEMyKSA6IChNMiA9IDAsIHgyID0gdzIgPSAoZDIgKyBwMikgLyAyKSwgKFQyIC09IDIgKiBQMikgPiBNbSA/IChiMiArPSBQMiAqPSB5MiA/IDEgOiAtMSwgbTIgLT0gUDIpIDogKFQyID0gMCwgYjIgPSBtMiA9IChkMiArIHAyKSAvIDIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YXIgejIgPSBoMiAqIF9tKGIyKSwgJDIgPSBoMiAqIHhtKGIyKSwgRDIgPSBsMiAqIF9tKHcyKSwgUjIgPSBsMiAqIHhtKHcyKTsKICAgICAgICAgICAgICBpZiAoRTIgPiBNbSkgewogICAgICAgICAgICAgICAgdmFyIEYyLCBxMiA9IGgyICogX20obTIpLCBVMiA9IGgyICogeG0obTIpLCBJMiA9IGwyICogX20oeDIpLCBPMiA9IGwyICogeG0oeDIpOwogICAgICAgICAgICAgICAgaWYgKGcyIDwgVG0pCiAgICAgICAgICAgICAgICAgIGlmIChGMiA9IGZ1bmN0aW9uKHQzLCBuMywgZTMsIHIzLCBpMywgbzMsIGEzLCB1MykgewogICAgICAgICAgICAgICAgICAgIHZhciBjMyA9IGUzIC0gdDMsIGY0ID0gcjMgLSBuMywgczMgPSBhMyAtIGkzLCBsMyA9IHUzIC0gbzMsIGgzID0gbDMgKiBjMyAtIHMzICogZjQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoaDMgKiBoMyA8IE1tKSkKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbdDMgKyAoaDMgPSAoczMgKiAobjMgLSBvMykgLSBsMyAqICh0MyAtIGkzKSkgLyBoMykgKiBjMywgbjMgKyBoMyAqIGY0XTsKICAgICAgICAgICAgICAgICAgfSh6MiwgJDIsIEkyLCBPMiwgcTIsIFUyLCBEMiwgUjIpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIEIyID0gejIgLSBGMlswXSwgWTIgPSAkMiAtIEYyWzFdLCBMMiA9IHEyIC0gRjJbMF0sIGoyID0gVTIgLSBGMlsxXSwgSDIgPSAxIC8geG0oZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0MyA+IDEgPyAwIDogdDMgPCAtMSA/IFRtIDogTWF0aC5hY29zKHQzKTsKICAgICAgICAgICAgICAgICAgICB9KChCMiAqIEwyICsgWTIgKiBqMikgLyAod20oQjIgKiBCMiArIFkyICogWTIpICogd20oTDIgKiBMMiArIGoyICogajIpKSkgLyAyKSwgWDIgPSB3bShGMlswXSAqIEYyWzBdICsgRjJbMV0gKiBGMlsxXSk7CiAgICAgICAgICAgICAgICAgICAgTjIgPSBtbShFMiwgKGwyIC0gWDIpIC8gKEgyIC0gMSkpLCBrMiA9IG1tKEUyLCAoaDIgLSBYMikgLyAoSDIgKyAxKSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgICAgICAgIE4yID0gazIgPSAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBUMiA+IE1tID8gazIgPiBNbSA/ICh2MiA9IERtKEkyLCBPMiwgejIsICQyLCBoMiwgazIsIHkyKSwgXzIgPSBEbShxMiwgVTIsIEQyLCBSMiwgaDIsIGsyLCB5MiksIHUyLm1vdmVUbyh2Mi5jeCArIHYyLngwMSwgdjIuY3kgKyB2Mi55MDEpLCBrMiA8IEUyID8gdTIuYXJjKHYyLmN4LCB2Mi5jeSwgazIsIHZtKHYyLnkwMSwgdjIueDAxKSwgdm0oXzIueTAxLCBfMi54MDEpLCAheTIpIDogKHUyLmFyYyh2Mi5jeCwgdjIuY3ksIGsyLCB2bSh2Mi55MDEsIHYyLngwMSksIHZtKHYyLnkxMSwgdjIueDExKSwgIXkyKSwgdTIuYXJjKDAsIDAsIGgyLCB2bSh2Mi5jeSArIHYyLnkxMSwgdjIuY3ggKyB2Mi54MTEpLCB2bShfMi5jeSArIF8yLnkxMSwgXzIuY3ggKyBfMi54MTEpLCAheTIpLCB1Mi5hcmMoXzIuY3gsIF8yLmN5LCBrMiwgdm0oXzIueTExLCBfMi54MTEpLCB2bShfMi55MDEsIF8yLngwMSksICF5MikpKSA6ICh1Mi5tb3ZlVG8oejIsICQyKSwgdTIuYXJjKDAsIDAsIGgyLCBiMiwgbTIsICF5MikpIDogdTIubW92ZVRvKHoyLCAkMiksIGwyID4gTW0gJiYgTTIgPiBNbSA/IE4yID4gTW0gPyAodjIgPSBEbShEMiwgUjIsIHEyLCBVMiwgbDIsIC1OMiwgeTIpLCBfMiA9IERtKHoyLCAkMiwgSTIsIE8yLCBsMiwgLU4yLCB5MiksIHUyLmxpbmVUbyh2Mi5jeCArIHYyLngwMSwgdjIuY3kgKyB2Mi55MDEpLCBOMiA8IEUyID8gdTIuYXJjKHYyLmN4LCB2Mi5jeSwgTjIsIHZtKHYyLnkwMSwgdjIueDAxKSwgdm0oXzIueTAxLCBfMi54MDEpLCAheTIpIDogKHUyLmFyYyh2Mi5jeCwgdjIuY3ksIE4yLCB2bSh2Mi55MDEsIHYyLngwMSksIHZtKHYyLnkxMSwgdjIueDExKSwgIXkyKSwgdTIuYXJjKDAsIDAsIGwyLCB2bSh2Mi5jeSArIHYyLnkxMSwgdjIuY3ggKyB2Mi54MTEpLCB2bShfMi5jeSArIF8yLnkxMSwgXzIuY3ggKyBfMi54MTEpLCB5MiksIHUyLmFyYyhfMi5jeCwgXzIuY3ksIE4yLCB2bShfMi55MTEsIF8yLngxMSksIHZtKF8yLnkwMSwgXzIueDAxKSwgIXkyKSkpIDogdTIuYXJjKDAsIDAsIGwyLCB3MiwgeDIsIHkyKSA6IHUyLmxpbmVUbyhEMiwgUjIpOwogICAgICAgICAgICB9CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIHUyLm1vdmVUbygwLCAwKTsKICAgICAgICAgIGlmICh1Mi5jbG9zZVBhdGgoKSwgZjMpCiAgICAgICAgICAgIHJldHVybiB1MiA9IG51bGwsIGYzICsgIiIgfHwgbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGYyLmNlbnRyb2lkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgZTMgPSAoK3QyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgKyArbjIuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgLyAyLCByMyA9ICgraTIuYXBwbHkodGhpcywgYXJndW1lbnRzKSArICtvMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSAvIDIgLSBUbSAvIDI7CiAgICAgICAgICByZXR1cm4gW19tKHIzKSAqIGUzLCB4bShyMykgKiBlM107CiAgICAgICAgfSwgZjIuaW5uZXJSYWRpdXMgPSBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodDIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBuMyA/IG4zIDogZ20oK24zKSwgZjIpIDogdDI7CiAgICAgICAgfSwgZjIub3V0ZXJSYWRpdXMgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobjIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZ20oK3QzKSwgZjIpIDogbjI7CiAgICAgICAgfSwgZjIuY29ybmVyUmFkaXVzID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGUyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGdtKCt0MyksIGYyKSA6IGUyOwogICAgICAgIH0sIGYyLnBhZFJhZGl1cyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyMiA9IG51bGwgPT0gdDMgPyBudWxsIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGdtKCt0MyksIGYyKSA6IHIyOwogICAgICAgIH0sIGYyLnN0YXJ0QW5nbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZ20oK3QzKSwgZjIpIDogaTI7CiAgICAgICAgfSwgZjIuZW5kQW5nbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobzIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZ20oK3QzKSwgZjIpIDogbzI7CiAgICAgICAgfSwgZjIucGFkQW5nbGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZ20oK3QzKSwgZjIpIDogYTI7CiAgICAgICAgfSwgZjIuY29udGV4dCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh1MiA9IG51bGwgPT0gdDMgPyBudWxsIDogdDMsIGYyKSA6IHUyOwogICAgICAgIH0sIGYyOwogICAgICB9LCB0LmFyZWEgPSBZbSwgdC5hcmVhUmFkaWFsID0gWm0sIHQuYXNjZW5kaW5nID0gbiwgdC5hdXRvVHlwZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgZm9yICh2YXIgbjIgaW4gdDIpIHsKICAgICAgICAgIHZhciBlMiwgcjIsIGkyID0gdDJbbjJdLnRyaW0oKTsKICAgICAgICAgIGlmIChpMikKICAgICAgICAgICAgaWYgKCJ0cnVlIiA9PT0gaTIpCiAgICAgICAgICAgICAgaTIgPSB0cnVlOwogICAgICAgICAgICBlbHNlIGlmICgiZmFsc2UiID09PSBpMikKICAgICAgICAgICAgICBpMiA9IGZhbHNlOwogICAgICAgICAgICBlbHNlIGlmICgiTmFOIiA9PT0gaTIpCiAgICAgICAgICAgICAgaTIgPSBOYU47CiAgICAgICAgICAgIGVsc2UgaWYgKGlzTmFOKGUyID0gK2kyKSkgewogICAgICAgICAgICAgIGlmICghKHIyID0gaTIubWF0Y2goL14oWy0rXVxkezJ9KT9cZHs0fSgtXGR7Mn0oLVxkezJ9KT8pPyhUXGR7Mn06XGR7Mn0oOlxkezJ9KFwuXGR7M30pPyk/KFp8Wy0rXVxkezJ9OlxkezJ9KT8pPyQvKSkpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB5YyAmJiByMls0XSAmJiAhcjJbN10gJiYgKGkyID0gaTIucmVwbGFjZSgvLS9nLCAiLyIpLnJlcGxhY2UoL1QvLCAiICIpKSwgaTIgPSBuZXcgRGF0ZShpMik7CiAgICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICAgIGkyID0gZTI7CiAgICAgICAgICBlbHNlCiAgICAgICAgICAgIGkyID0gbnVsbDsKICAgICAgICAgIHQyW24yXSA9IGkyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDI7CiAgICAgIH0sIHQuYXhpc0JvdHRvbSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIFB0KE10LCB0Mik7CiAgICAgIH0sIHQuYXhpc0xlZnQgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBQdChUdCwgdDIpOwogICAgICB9LCB0LmF4aXNSaWdodCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIFB0KHd0LCB0Mik7CiAgICAgIH0sIHQuYXhpc1RvcCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIFB0KHh0LCB0Mik7CiAgICAgIH0sIHQuYmluID0gUSwgdC5iaXNlY3QgPSBzLCB0LmJpc2VjdENlbnRlciA9IGYsIHQuYmlzZWN0TGVmdCA9IGMsIHQuYmlzZWN0UmlnaHQgPSB1LCB0LmJpc2VjdG9yID0gciwgdC5ibG9iID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIGZldGNoKHQyLCBuMikudGhlbih2Yyk7CiAgICAgIH0sIHQuYmx1ciA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGlmICghKChuMiA9ICtuMikgPj0gMCkpCiAgICAgICAgICB0aHJvdyBuZXcgUmFuZ2VFcnJvcigiaW52YWxpZCByIik7CiAgICAgICAgbGV0IGUyID0gdDIubGVuZ3RoOwogICAgICAgIGlmICghKChlMiA9IE1hdGguZmxvb3IoZTIpKSA+PSAwKSkKICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCJpbnZhbGlkIGxlbmd0aCIpOwogICAgICAgIGlmICghZTIgfHwgIW4yKQogICAgICAgICAgcmV0dXJuIHQyOwogICAgICAgIGNvbnN0IHIyID0geShuMiksIGkyID0gdDIuc2xpY2UoKTsKICAgICAgICByZXR1cm4gcjIodDIsIGkyLCAwLCBlMiwgMSksIHIyKGkyLCB0MiwgMCwgZTIsIDEpLCByMih0MiwgaTIsIDAsIGUyLCAxKSwgdDI7CiAgICAgIH0sIHQuYmx1cjIgPSBsLCB0LmJsdXJJbWFnZSA9IGgsIHQuYnJ1c2ggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gd2EobGEpOwogICAgICB9LCB0LmJydXNoU2VsZWN0aW9uID0gZnVuY3Rpb24odDIpIHsKICAgICAgICB2YXIgbjIgPSB0Mi5fX2JydXNoOwogICAgICAgIHJldHVybiBuMiA/IG4yLmRpbS5vdXRwdXQobjIuc2VsZWN0aW9uKSA6IG51bGw7CiAgICAgIH0sIHQuYnJ1c2hYID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHdhKGZhKTsKICAgICAgfSwgdC5icnVzaFkgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gd2Eoc2EpOwogICAgICB9LCB0LmJ1ZmZlciA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiBmZXRjaCh0MiwgbjIpLnRoZW4oX2MpOwogICAgICB9LCB0LmNob3JkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHphKGZhbHNlLCBmYWxzZSk7CiAgICAgIH0sIHQuY2hvcmREaXJlY3RlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB6YSh0cnVlLCBmYWxzZSk7CiAgICAgIH0sIHQuY2hvcmRUcmFuc3Bvc2UgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gemEoZmFsc2UsIHRydWUpOwogICAgICB9LCB0LmNsdXN0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBMZCwgbjIgPSAxLCBlMiA9IDEsIHIyID0gZmFsc2U7CiAgICAgICAgZnVuY3Rpb24gaTIoaTMpIHsKICAgICAgICAgIHZhciBvMiwgYTIgPSAwOwogICAgICAgICAgaTMuZWFjaEFmdGVyKGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICAgIHZhciBlMyA9IG4zLmNoaWxkcmVuOwogICAgICAgICAgICBlMyA/IChuMy54ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICByZXR1cm4gdDMucmVkdWNlKGpkLCAwKSAvIHQzLmxlbmd0aDsKICAgICAgICAgICAgfShlMyksIG4zLnkgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgICAgIHJldHVybiAxICsgdDMucmVkdWNlKEhkLCAwKTsKICAgICAgICAgICAgfShlMykpIDogKG4zLnggPSBvMiA/IGEyICs9IHQyKG4zLCBvMikgOiAwLCBuMy55ID0gMCwgbzIgPSBuMyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciB1MiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGZvciAodmFyIG4zOyBuMyA9IHQzLmNoaWxkcmVuOyApCiAgICAgICAgICAgICAgdDMgPSBuM1swXTsKICAgICAgICAgICAgcmV0dXJuIHQzOwogICAgICAgICAgfShpMyksIGMyID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgZm9yICh2YXIgbjM7IG4zID0gdDMuY2hpbGRyZW47ICkKICAgICAgICAgICAgICB0MyA9IG4zW24zLmxlbmd0aCAtIDFdOwogICAgICAgICAgICByZXR1cm4gdDM7CiAgICAgICAgICB9KGkzKSwgZjIgPSB1Mi54IC0gdDIodTIsIGMyKSAvIDIsIHMyID0gYzIueCArIHQyKGMyLCB1MikgLyAyOwogICAgICAgICAgcmV0dXJuIGkzLmVhY2hBZnRlcihyMiA/IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIHQzLnggPSAodDMueCAtIGkzLngpICogbjIsIHQzLnkgPSAoaTMueSAtIHQzLnkpICogZTI7CiAgICAgICAgICB9IDogZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgdDMueCA9ICh0My54IC0gZjIpIC8gKHMyIC0gZjIpICogbjIsIHQzLnkgPSAoMSAtIChpMy55ID8gdDMueSAvIGkzLnkgOiAxKSkgKiBlMjsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuc2VwYXJhdGlvbiA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9IG4zLCBpMikgOiB0MjsKICAgICAgICB9LCBpMi5zaXplID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gZmFsc2UsIG4yID0gK3QzWzBdLCBlMiA9ICt0M1sxXSwgaTIpIDogcjIgPyBudWxsIDogW24yLCBlMl07CiAgICAgICAgfSwgaTIubm9kZVNpemUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSB0cnVlLCBuMiA9ICt0M1swXSwgZTIgPSArdDNbMV0sIGkyKSA6IHIyID8gW24yLCBlMl0gOiBudWxsOwogICAgICAgIH0sIGkyOwogICAgICB9LCB0LmNvbG9yID0gemUsIHQuY29udG91ckRlbnNpdHkgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBmdSwgbjIgPSBzdSwgZTIgPSBsdSwgcjIgPSA5NjAsIGkyID0gNTAwLCBvMiA9IDIwLCBhMiA9IDIsIHUyID0gMyAqIG8yLCBjMiA9IHIyICsgMiAqIHUyID4+IGEyLCBmMiA9IGkyICsgMiAqIHUyID4+IGEyLCBzMiA9IFFhKDIwKTsKICAgICAgICBmdW5jdGlvbiBoMihyMykgewogICAgICAgICAgdmFyIGkzID0gbmV3IEZsb2F0MzJBcnJheShjMiAqIGYyKSwgczMgPSBNYXRoLnBvdygyLCAtYTIpLCBoMyA9IC0xOwogICAgICAgICAgZm9yIChjb25zdCBvMyBvZiByMykgewogICAgICAgICAgICB2YXIgZDQgPSAodDIobzMsICsraDMsIHIzKSArIHUyKSAqIHMzLCBwMyA9IChuMihvMywgaDMsIHIzKSArIHUyKSAqIHMzLCBnMyA9ICtlMihvMywgaDMsIHIzKTsKICAgICAgICAgICAgaWYgKGczICYmIGQ0ID49IDAgJiYgZDQgPCBjMiAmJiBwMyA+PSAwICYmIHAzIDwgZjIpIHsKICAgICAgICAgICAgICB2YXIgeTMgPSBNYXRoLmZsb29yKGQ0KSwgdjMgPSBNYXRoLmZsb29yKHAzKSwgXzMgPSBkNCAtIHkzIC0gMC41LCBiMiA9IHAzIC0gdjMgLSAwLjU7CiAgICAgICAgICAgICAgaTNbeTMgKyB2MyAqIGMyXSArPSAoMSAtIF8zKSAqICgxIC0gYjIpICogZzMsIGkzW3kzICsgMSArIHYzICogYzJdICs9IF8zICogKDEgLSBiMikgKiBnMywgaTNbeTMgKyAxICsgKHYzICsgMSkgKiBjMl0gKz0gXzMgKiBiMiAqIGczLCBpM1t5MyArICh2MyArIDEpICogYzJdICs9ICgxIC0gXzMpICogYjIgKiBnMzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGwoeyBkYXRhOiBpMywgd2lkdGg6IGMyLCBoZWlnaHQ6IGYyIH0sIG8yICogczMpLCBpMzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZDIodDMpIHsKICAgICAgICAgIHZhciBuMyA9IGgyKHQzKSwgZTMgPSBzMihuMyksIHIzID0gTWF0aC5wb3coMiwgMiAqIGEyKTsKICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KGUzKSB8fCAoZTMgPSBHKE51bWJlci5NSU5fVkFMVUUsIEoobjMpIC8gcjMsIGUzKSksIGl1KCkuc2l6ZShbYzIsIGYyXSkudGhyZXNob2xkcyhlMy5tYXAoKHQ0KSA9PiB0NCAqIHIzKSkobjMpLm1hcCgodDQsIG40KSA9PiAodDQudmFsdWUgPSArZTNbbjRdLCBwMih0NCkpKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcDIodDMpIHsKICAgICAgICAgIHJldHVybiB0My5jb29yZGluYXRlcy5mb3JFYWNoKGcyKSwgdDM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGcyKHQzKSB7CiAgICAgICAgICB0My5mb3JFYWNoKHkyKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24geTIodDMpIHsKICAgICAgICAgIHQzLmZvckVhY2godjIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB2Mih0MykgewogICAgICAgICAgdDNbMF0gPSB0M1swXSAqIE1hdGgucG93KDIsIGEyKSAtIHUyLCB0M1sxXSA9IHQzWzFdICogTWF0aC5wb3coMiwgYTIpIC0gdTI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF8yKCkgewogICAgICAgICAgcmV0dXJuIGMyID0gcjIgKyAyICogKHUyID0gMyAqIG8yKSA+PiBhMiwgZjIgPSBpMiArIDIgKiB1MiA+PiBhMiwgZDI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkMi5jb250b3VycyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICB2YXIgbjMgPSBoMih0MyksIGUzID0gaXUoKS5zaXplKFtjMiwgZjJdKSwgcjMgPSBNYXRoLnBvdygyLCAyICogYTIpLCBpMyA9ICh0NCkgPT4gewogICAgICAgICAgICB0NCA9ICt0NDsKICAgICAgICAgICAgdmFyIGk0ID0gcDIoZTMuY29udG91cihuMywgdDQgKiByMykpOwogICAgICAgICAgICByZXR1cm4gaTQudmFsdWUgPSB0NCwgaTQ7CiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpMywgIm1heCIsIHsgZ2V0OiAoKSA9PiBKKG4zKSAvIHIzIH0pLCBpMzsKICAgICAgICB9LCBkMi54ID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHQyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjMgPyBuMyA6IFFhKCtuMyksIGQyKSA6IHQyOwogICAgICAgIH0sIGQyLnkgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobjIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogUWEoK3QzKSwgZDIpIDogbjI7CiAgICAgICAgfSwgZDIud2VpZ2h0ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGUyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IFFhKCt0MyksIGQyKSA6IGUyOwogICAgICAgIH0sIGQyLnNpemUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gW3IyLCBpMl07CiAgICAgICAgICB2YXIgbjMgPSArdDNbMF0sIGUzID0gK3QzWzFdOwogICAgICAgICAgaWYgKCEobjMgPj0gMCAmJiBlMyA+PSAwKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHNpemUiKTsKICAgICAgICAgIHJldHVybiByMiA9IG4zLCBpMiA9IGUzLCBfMigpOwogICAgICAgIH0sIGQyLmNlbGxTaXplID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIDEgPDwgYTI7CiAgICAgICAgICBpZiAoISgodDMgPSArdDMpID49IDEpKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgY2VsbCBzaXplIik7CiAgICAgICAgICByZXR1cm4gYTIgPSBNYXRoLmZsb29yKE1hdGgubG9nKHQzKSAvIE1hdGguTE4yKSwgXzIoKTsKICAgICAgICB9LCBkMi50aHJlc2hvbGRzID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHMyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IEFycmF5LmlzQXJyYXkodDMpID8gUWEoWmEuY2FsbCh0MykpIDogUWEodDMpLCBkMikgOiBzMjsKICAgICAgICB9LCBkMi5iYW5kd2lkdGggPSBmdW5jdGlvbih0MykgewogICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KG8yICogKG8yICsgMSkpOwogICAgICAgICAgaWYgKCEoKHQzID0gK3QzKSA+PSAwKSkKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGJhbmR3aWR0aCIpOwogICAgICAgICAgcmV0dXJuIG8yID0gKE1hdGguc3FydCg0ICogdDMgKiB0MyArIDEpIC0gMSkgLyAyLCBfMigpOwogICAgICAgIH0sIGQyOwogICAgICB9LCB0LmNvbnRvdXJzID0gaXUsIHQuY291bnQgPSB2LCB0LmNyZWF0ZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIFpuKFl0KHQyKS5jYWxsKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkpOwogICAgICB9LCB0LmNyZWF0b3IgPSBZdCwgdC5jcm9zcyA9IGZ1bmN0aW9uKC4uLnQyKSB7CiAgICAgICAgY29uc3QgbjIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0Mlt0Mi5sZW5ndGggLSAxXSAmJiAvKiBAX19QVVJFX18gKi8gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiAobjMpID0+IHQzKC4uLm4zKTsKICAgICAgICB9KHQyLnBvcCgpKSwgZTIgPSAodDIgPSB0Mi5tYXAobSkpLm1hcChfKSwgcjIgPSB0Mi5sZW5ndGggLSAxLCBpMiA9IG5ldyBBcnJheShyMiArIDEpLmZpbGwoMCksIG8yID0gW107CiAgICAgICAgaWYgKHIyIDwgMCB8fCBlMi5zb21lKGIpKQogICAgICAgICAgcmV0dXJuIG8yOwogICAgICAgIGZvciAoOyA7ICkgewogICAgICAgICAgbzIucHVzaChpMi5tYXAoKG4zLCBlMykgPT4gdDJbZTNdW24zXSkpOwogICAgICAgICAgbGV0IGEyID0gcjI7CiAgICAgICAgICBmb3IgKDsgKytpMlthMl0gPT09IGUyW2EyXTsgKSB7CiAgICAgICAgICAgIGlmICgwID09PSBhMikKICAgICAgICAgICAgICByZXR1cm4gbjIgPyBvMi5tYXAobjIpIDogbzI7CiAgICAgICAgICAgIGkyW2EyLS1dID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHQuY3N2ID0gd2MsIHQuY3N2Rm9ybWF0ID0gcmMsIHQuY3N2Rm9ybWF0Qm9keSA9IGljLCB0LmNzdkZvcm1hdFJvdyA9IGFjLCB0LmNzdkZvcm1hdFJvd3MgPSBvYywgdC5jc3ZGb3JtYXRWYWx1ZSA9IHVjLCB0LmNzdlBhcnNlID0gbmMsIHQuY3N2UGFyc2VSb3dzID0gZWMsIHQuY3ViZWhlbGl4ID0gVHIsIHQuY3Vtc3VtID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gMCwgcjIgPSAwOwogICAgICAgIHJldHVybiBGbG9hdDY0QXJyYXkuZnJvbSh0Miwgdm9pZCAwID09PSBuMiA/ICh0MykgPT4gZTIgKz0gK3QzIHx8IDAgOiAoaTIpID0+IGUyICs9ICtuMihpMiwgcjIrKywgdDIpIHx8IDApOwogICAgICB9LCB0LmN1cnZlQmFzaXMgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBuZXcgUngodDIpOwogICAgICB9LCB0LmN1cnZlQmFzaXNDbG9zZWQgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBuZXcgRngodDIpOwogICAgICB9LCB0LmN1cnZlQmFzaXNPcGVuID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gbmV3IHF4KHQyKTsKICAgICAgfSwgdC5jdXJ2ZUJ1bXBYID0gdHgsIHQuY3VydmVCdW1wWSA9IG54LCB0LmN1cnZlQnVuZGxlID0gSXgsIHQuY3VydmVDYXJkaW5hbCA9IFl4LCB0LmN1cnZlQ2FyZGluYWxDbG9zZWQgPSBqeCwgdC5jdXJ2ZUNhcmRpbmFsT3BlbiA9IFh4LCB0LmN1cnZlQ2F0bXVsbFJvbSA9IFd4LCB0LmN1cnZlQ2F0bXVsbFJvbUNsb3NlZCA9IEt4LCB0LmN1cnZlQ2F0bXVsbFJvbU9wZW4gPSBKeCwgdC5jdXJ2ZUxpbmVhciA9IFVtLCB0LmN1cnZlTGluZWFyQ2xvc2VkID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gbmV3IHR3KHQyKTsKICAgICAgfSwgdC5jdXJ2ZU1vbm90b25lWCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBvdyh0Mik7CiAgICAgIH0sIHQuY3VydmVNb25vdG9uZVkgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBuZXcgYXcodDIpOwogICAgICB9LCB0LmN1cnZlTmF0dXJhbCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBjdyh0Mik7CiAgICAgIH0sIHQuY3VydmVTdGVwID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gbmV3IHN3KHQyLCAwLjUpOwogICAgICB9LCB0LmN1cnZlU3RlcEFmdGVyID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gbmV3IHN3KHQyLCAxKTsKICAgICAgfSwgdC5jdXJ2ZVN0ZXBCZWZvcmUgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBuZXcgc3codDIsIDApOwogICAgICB9LCB0LmRlc2NlbmRpbmcgPSBlLCB0LmRldmlhdGlvbiA9IHcsIHQuZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKHQyLCAuLi5uMikgewogICAgICAgIHQyID0gbmV3IEludGVyblNldCh0Mik7CiAgICAgICAgZm9yIChjb25zdCBlMiBvZiBuMikKICAgICAgICAgIGZvciAoY29uc3QgbjMgb2YgZTIpCiAgICAgICAgICAgIHQyLmRlbGV0ZShuMyk7CiAgICAgICAgcmV0dXJuIHQyOwogICAgICB9LCB0LmRpc2pvaW50ID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgY29uc3QgZTIgPSBuMltTeW1ib2wuaXRlcmF0b3JdKCksIHIyID0gbmV3IEludGVyblNldCgpOwogICAgICAgIGZvciAoY29uc3QgbjMgb2YgdDIpIHsKICAgICAgICAgIGlmIChyMi5oYXMobjMpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICBsZXQgdDMsIGkyOwogICAgICAgICAgZm9yICg7ICh7IHZhbHVlOiB0MywgZG9uZTogaTIgfSA9IGUyLm5leHQoKSkgJiYgIWkyOyApIHsKICAgICAgICAgICAgaWYgKE9iamVjdC5pcyhuMywgdDMpKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcjIuYWRkKHQzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0sIHQuZGlzcGF0Y2ggPSAkdCwgdC5kcmFnID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyLCBuMiwgZTIsIHIyLCBpMiA9IHNlLCBvMiA9IGxlLCBhMiA9IGhlLCB1MiA9IGRlLCBjMiA9IHt9LCBmMiA9ICR0KCJzdGFydCIsICJkcmFnIiwgImVuZCIpLCBzMiA9IDAsIGwyID0gMDsKICAgICAgICBmdW5jdGlvbiBoMih0MykgewogICAgICAgICAgdDMub24oIm1vdXNlZG93bi5kcmFnIiwgZDIpLmZpbHRlcih1Mikub24oInRvdWNoc3RhcnQuZHJhZyIsIHkyKS5vbigidG91Y2htb3ZlLmRyYWciLCB2MiwgZWUpLm9uKCJ0b3VjaGVuZC5kcmFnIHRvdWNoY2FuY2VsLmRyYWciLCBfMikuc3R5bGUoInRvdWNoLWFjdGlvbiIsICJub25lIikuc3R5bGUoIi13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvciIsICJyZ2JhKDAsMCwwLDApIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGQyKGEzLCB1MykgewogICAgICAgICAgaWYgKCFyMiAmJiBpMi5jYWxsKHRoaXMsIGEzLCB1MykpIHsKICAgICAgICAgICAgdmFyIGMzID0gYjIodGhpcywgbzIuY2FsbCh0aGlzLCBhMywgdTMpLCBhMywgdTMsICJtb3VzZSIpOwogICAgICAgICAgICBjMyAmJiAoWm4oYTMudmlldykub24oIm1vdXNlbW92ZS5kcmFnIiwgcDIsIHJlKS5vbigibW91c2V1cC5kcmFnIiwgZzIsIHJlKSwgYWUoYTMudmlldyksIGllKGEzKSwgZTIgPSBmYWxzZSwgdDIgPSBhMy5jbGllbnRYLCBuMiA9IGEzLmNsaWVudFksIGMzKCJzdGFydCIsIGEzKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHAyKHIzKSB7CiAgICAgICAgICBpZiAob2UocjMpLCAhZTIpIHsKICAgICAgICAgICAgdmFyIGkzID0gcjMuY2xpZW50WCAtIHQyLCBvMyA9IHIzLmNsaWVudFkgLSBuMjsKICAgICAgICAgICAgZTIgPSBpMyAqIGkzICsgbzMgKiBvMyA+IGwyOwogICAgICAgICAgfQogICAgICAgICAgYzIubW91c2UoImRyYWciLCByMyk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGcyKHQzKSB7CiAgICAgICAgICBabih0My52aWV3KS5vbigibW91c2Vtb3ZlLmRyYWcgbW91c2V1cC5kcmFnIiwgbnVsbCksIHVlKHQzLnZpZXcsIGUyKSwgb2UodDMpLCBjMi5tb3VzZSgiZW5kIiwgdDMpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB5Mih0MywgbjMpIHsKICAgICAgICAgIGlmIChpMi5jYWxsKHRoaXMsIHQzLCBuMykpIHsKICAgICAgICAgICAgdmFyIGUzLCByMywgYTMgPSB0My5jaGFuZ2VkVG91Y2hlcywgdTMgPSBvMi5jYWxsKHRoaXMsIHQzLCBuMyksIGMzID0gYTMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGUzID0gMDsgZTMgPCBjMzsgKytlMykKICAgICAgICAgICAgICAocjMgPSBiMih0aGlzLCB1MywgdDMsIG4zLCBhM1tlM10uaWRlbnRpZmllciwgYTNbZTNdKSkgJiYgKGllKHQzKSwgcjMoInN0YXJ0IiwgdDMsIGEzW2UzXSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB2Mih0MykgewogICAgICAgICAgdmFyIG4zLCBlMywgcjMgPSB0My5jaGFuZ2VkVG91Y2hlcywgaTMgPSByMy5sZW5ndGg7CiAgICAgICAgICBmb3IgKG4zID0gMDsgbjMgPCBpMzsgKytuMykKICAgICAgICAgICAgKGUzID0gYzJbcjNbbjNdLmlkZW50aWZpZXJdKSAmJiAob2UodDMpLCBlMygiZHJhZyIsIHQzLCByM1tuM10pKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gXzIodDMpIHsKICAgICAgICAgIHZhciBuMywgZTMsIGkzID0gdDMuY2hhbmdlZFRvdWNoZXMsIG8zID0gaTMubGVuZ3RoOwogICAgICAgICAgZm9yIChyMiAmJiBjbGVhclRpbWVvdXQocjIpLCByMiA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHIyID0gbnVsbDsKICAgICAgICAgIH0sIDUwMCksIG4zID0gMDsgbjMgPCBvMzsgKytuMykKICAgICAgICAgICAgKGUzID0gYzJbaTNbbjNdLmlkZW50aWZpZXJdKSAmJiAoaWUodDMpLCBlMygiZW5kIiwgdDMsIGkzW24zXSkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBiMih0MywgbjMsIGUzLCByMywgaTMsIG8zKSB7CiAgICAgICAgICB2YXIgdTMsIGwzLCBkNCwgcDMgPSBmMi5jb3B5KCksIGczID0gbmUobzMgfHwgZTMsIG4zKTsKICAgICAgICAgIGlmIChudWxsICE9IChkNCA9IGEyLmNhbGwodDMsIG5ldyBmZSgiYmVmb3Jlc3RhcnQiLCB7IHNvdXJjZUV2ZW50OiBlMywgdGFyZ2V0OiBoMiwgaWRlbnRpZmllcjogaTMsIGFjdGl2ZTogczIsIHg6IGczWzBdLCB5OiBnM1sxXSwgZHg6IDAsIGR5OiAwLCBkaXNwYXRjaDogcDMgfSksIHIzKSkpCiAgICAgICAgICAgIHJldHVybiB1MyA9IGQ0LnggLSBnM1swXSB8fCAwLCBsMyA9IGQ0LnkgLSBnM1sxXSB8fCAwLCBmdW5jdGlvbiBlNChvNCwgYTMsIGYzKSB7CiAgICAgICAgICAgICAgdmFyIHkzLCB2MyA9IGczOwogICAgICAgICAgICAgIHN3aXRjaCAobzQpIHsKICAgICAgICAgICAgICAgIGNhc2UgInN0YXJ0IjoKICAgICAgICAgICAgICAgICAgYzJbaTNdID0gZTQsIHkzID0gczIrKzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICBkZWxldGUgYzJbaTNdLCAtLXMyOwogICAgICAgICAgICAgICAgY2FzZSAiZHJhZyI6CiAgICAgICAgICAgICAgICAgIGczID0gbmUoZjMgfHwgYTMsIG4zKSwgeTMgPSBzMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcDMuY2FsbChvNCwgdDMsIG5ldyBmZShvNCwgeyBzb3VyY2VFdmVudDogYTMsIHN1YmplY3Q6IGQ0LCB0YXJnZXQ6IGgyLCBpZGVudGlmaWVyOiBpMywgYWN0aXZlOiB5MywgeDogZzNbMF0gKyB1MywgeTogZzNbMV0gKyBsMywgZHg6IGczWzBdIC0gdjNbMF0sIGR5OiBnM1sxXSAtIHYzWzFdLCBkaXNwYXRjaDogcDMgfSksIHIzKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGgyLmZpbHRlciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBjZSghIXQzKSwgaDIpIDogaTI7CiAgICAgICAgfSwgaDIuY29udGFpbmVyID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG8yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGNlKHQzKSwgaDIpIDogbzI7CiAgICAgICAgfSwgaDIuc3ViamVjdCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBjZSh0MyksIGgyKSA6IGEyOwogICAgICAgIH0sIGgyLnRvdWNoYWJsZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh1MiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBjZSghIXQzKSwgaDIpIDogdTI7CiAgICAgICAgfSwgaDIub24gPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciB0MyA9IGYyLm9uLmFwcGx5KGYyLCBhcmd1bWVudHMpOwogICAgICAgICAgcmV0dXJuIHQzID09PSBmMiA/IGgyIDogdDM7CiAgICAgICAgfSwgaDIuY2xpY2tEaXN0YW5jZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChsMiA9ICh0MyA9ICt0MykgKiB0MywgaDIpIDogTWF0aC5zcXJ0KGwyKTsKICAgICAgICB9LCBoMjsKICAgICAgfSwgdC5kcmFnRGlzYWJsZSA9IGFlLCB0LmRyYWdFbmFibGUgPSB1ZSwgdC5kc3YgPSBmdW5jdGlvbih0MiwgbjIsIGUyLCByMikgewogICAgICAgIDMgPT09IGFyZ3VtZW50cy5sZW5ndGggJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgZTIgJiYgKHIyID0gZTIsIGUyID0gdm9pZCAwKTsKICAgICAgICB2YXIgaTIgPSBKdSh0Mik7CiAgICAgICAgcmV0dXJuIG1jKG4yLCBlMikudGhlbihmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGkyLnBhcnNlKHQzLCByMik7CiAgICAgICAgfSk7CiAgICAgIH0sIHQuZHN2Rm9ybWF0ID0gSnUsIHQuZWFzZUJhY2sgPSBMbywgdC5lYXNlQmFja0luID0gQm8sIHQuZWFzZUJhY2tJbk91dCA9IExvLCB0LmVhc2VCYWNrT3V0ID0gWW8sIHQuZWFzZUJvdW5jZSA9IElvLCB0LmVhc2VCb3VuY2VJbiA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIDEgLSBJbygxIC0gdDIpOwogICAgICB9LCB0LmVhc2VCb3VuY2VJbk91dCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuICgodDIgKj0gMikgPD0gMSA/IDEgLSBJbygxIC0gdDIpIDogSW8odDIgLSAxKSArIDEpIC8gMjsKICAgICAgfSwgdC5lYXNlQm91bmNlT3V0ID0gSW8sIHQuZWFzZUNpcmNsZSA9IE5vLCB0LmVhc2VDaXJjbGVJbiA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIDEgLSBNYXRoLnNxcnQoMSAtIHQyICogdDIpOwogICAgICB9LCB0LmVhc2VDaXJjbGVJbk91dCA9IE5vLCB0LmVhc2VDaXJjbGVPdXQgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiBNYXRoLnNxcnQoMSAtIC0tdDIgKiB0Mik7CiAgICAgIH0sIHQuZWFzZUN1YmljID0gYm8sIHQuZWFzZUN1YmljSW4gPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0MiAqIHQyICogdDI7CiAgICAgIH0sIHQuZWFzZUN1YmljSW5PdXQgPSBibywgdC5lYXNlQ3ViaWNPdXQgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiAtLXQyICogdDIgKiB0MiArIDE7CiAgICAgIH0sIHQuZWFzZUVsYXN0aWMgPSBYbywgdC5lYXNlRWxhc3RpY0luID0gSG8sIHQuZWFzZUVsYXN0aWNJbk91dCA9IEdvLCB0LmVhc2VFbGFzdGljT3V0ID0gWG8sIHQuZWFzZUV4cCA9IEVvLCB0LmVhc2VFeHBJbiA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIFNvKDEgLSArdDIpOwogICAgICB9LCB0LmVhc2VFeHBJbk91dCA9IEVvLCB0LmVhc2VFeHBPdXQgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiAxIC0gU28odDIpOwogICAgICB9LCB0LmVhc2VMaW5lYXIgPSAodDIpID0+ICt0MiwgdC5lYXNlUG9seSA9IHdvLCB0LmVhc2VQb2x5SW4gPSBtbywgdC5lYXNlUG9seUluT3V0ID0gd28sIHQuZWFzZVBvbHlPdXQgPSB4bywgdC5lYXNlUXVhZCA9IF9vLCB0LmVhc2VRdWFkSW4gPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0MiAqIHQyOwogICAgICB9LCB0LmVhc2VRdWFkSW5PdXQgPSBfbywgdC5lYXNlUXVhZE91dCA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHQyICogKDIgLSB0Mik7CiAgICAgIH0sIHQuZWFzZVNpbiA9IEFvLCB0LmVhc2VTaW5JbiA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIDEgPT0gK3QyID8gMSA6IDEgLSBNYXRoLmNvcyh0MiAqIFRvKTsKICAgICAgfSwgdC5lYXNlU2luSW5PdXQgPSBBbywgdC5lYXNlU2luT3V0ID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gTWF0aC5zaW4odDIgKiBUbyk7CiAgICAgIH0sIHQuZXZlcnkgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgbjIpCiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJ0ZXN0IGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgbGV0IGUyID0gLTE7CiAgICAgICAgZm9yIChjb25zdCByMiBvZiB0MikKICAgICAgICAgIGlmICghbjIocjIsICsrZTIsIHQyKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9LCB0LmV4dGVudCA9IE0sIHQuZmN1bXN1bSA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGNvbnN0IGUyID0gbmV3IFQoKTsKICAgICAgICBsZXQgcjIgPSAtMTsKICAgICAgICByZXR1cm4gRmxvYXQ2NEFycmF5LmZyb20odDIsIHZvaWQgMCA9PT0gbjIgPyAodDMpID0+IGUyLmFkZCgrdDMgfHwgMCkgOiAoaTIpID0+IGUyLmFkZCgrbjIoaTIsICsrcjIsIHQyKSB8fCAwKSk7CiAgICAgIH0sIHQuZmlsdGVyID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgaWYgKCJmdW5jdGlvbiIgIT0gdHlwZW9mIG4yKQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigidGVzdCBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIGNvbnN0IGUyID0gW107CiAgICAgICAgbGV0IHIyID0gLTE7CiAgICAgICAgZm9yIChjb25zdCBpMiBvZiB0MikKICAgICAgICAgIG4yKGkyLCArK3IyLCB0MikgJiYgZTIucHVzaChpMik7CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9LCB0LmZsYXRHcm91cCA9IGZ1bmN0aW9uKHQyLCAuLi5uMikgewogICAgICAgIHJldHVybiB6KFAodDIsIC4uLm4yKSwgbjIpOwogICAgICB9LCB0LmZsYXRSb2xsdXAgPSBmdW5jdGlvbih0MiwgbjIsIC4uLmUyKSB7CiAgICAgICAgcmV0dXJuIHooRCh0MiwgbjIsIC4uLmUyKSwgZTIpOwogICAgICB9LCB0LmZvcmNlQ2VudGVyID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdmFyIGUyLCByMiA9IDE7CiAgICAgICAgZnVuY3Rpb24gaTIoKSB7CiAgICAgICAgICB2YXIgaTMsIG8yLCBhMiA9IGUyLmxlbmd0aCwgdTIgPSAwLCBjMiA9IDA7CiAgICAgICAgICBmb3IgKGkzID0gMDsgaTMgPCBhMjsgKytpMykKICAgICAgICAgICAgdTIgKz0gKG8yID0gZTJbaTNdKS54LCBjMiArPSBvMi55OwogICAgICAgICAgZm9yICh1MiA9ICh1MiAvIGEyIC0gdDIpICogcjIsIGMyID0gKGMyIC8gYTIgLSBuMikgKiByMiwgaTMgPSAwOyBpMyA8IGEyOyArK2kzKQogICAgICAgICAgICAobzIgPSBlMltpM10pLnggLT0gdTIsIG8yLnkgLT0gYzI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsID09IHQyICYmICh0MiA9IDApLCBudWxsID09IG4yICYmIChuMiA9IDApLCBpMi5pbml0aWFsaXplID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIGUyID0gdDM7CiAgICAgICAgfSwgaTIueCA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9ICtuMywgaTIpIDogdDI7CiAgICAgICAgfSwgaTIueSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChuMiA9ICt0MywgaTIpIDogbjI7CiAgICAgICAgfSwgaTIuc3RyZW5ndGggPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSArdDMsIGkyKSA6IHIyOwogICAgICAgIH0sIGkyOwogICAgICB9LCB0LmZvcmNlQ29sbGlkZSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgdmFyIG4yLCBlMiwgcjIsIGkyID0gMSwgbzIgPSAxOwogICAgICAgIGZ1bmN0aW9uIGEyKCkgewogICAgICAgICAgZm9yICh2YXIgdDMsIGEzLCBjMywgZjIsIHMyLCBsMiwgaDIsIGQyID0gbjIubGVuZ3RoLCBwMiA9IDA7IHAyIDwgbzI7ICsrcDIpCiAgICAgICAgICAgIGZvciAoYTMgPSAkYyhuMiwgSWMsIE9jKS52aXNpdEFmdGVyKHUyKSwgdDMgPSAwOyB0MyA8IGQyOyArK3QzKQogICAgICAgICAgICAgIGMzID0gbjJbdDNdLCBsMiA9IGUyW2MzLmluZGV4XSwgaDIgPSBsMiAqIGwyLCBmMiA9IGMzLnggKyBjMy52eCwgczIgPSBjMy55ICsgYzMudnksIGEzLnZpc2l0KGcyKTsKICAgICAgICAgIGZ1bmN0aW9uIGcyKHQ0LCBuMywgZTMsIG8zLCBhNCkgewogICAgICAgICAgICB2YXIgdTMgPSB0NC5kYXRhLCBkNCA9IHQ0LnIsIHAzID0gbDIgKyBkNDsKICAgICAgICAgICAgaWYgKCF1MykKICAgICAgICAgICAgICByZXR1cm4gbjMgPiBmMiArIHAzIHx8IG8zIDwgZjIgLSBwMyB8fCBlMyA+IHMyICsgcDMgfHwgYTQgPCBzMiAtIHAzOwogICAgICAgICAgICBpZiAodTMuaW5kZXggPiBjMy5pbmRleCkgewogICAgICAgICAgICAgIHZhciBnMyA9IGYyIC0gdTMueCAtIHUzLnZ4LCB5MiA9IHMyIC0gdTMueSAtIHUzLnZ5LCB2MiA9IGczICogZzMgKyB5MiAqIHkyOwogICAgICAgICAgICAgIHYyIDwgcDMgKiBwMyAmJiAoMCA9PT0gZzMgJiYgKHYyICs9IChnMyA9IFVjKHIyKSkgKiBnMyksIDAgPT09IHkyICYmICh2MiArPSAoeTIgPSBVYyhyMikpICogeTIpLCB2MiA9IChwMyAtICh2MiA9IE1hdGguc3FydCh2MikpKSAvIHYyICogaTIsIGMzLnZ4ICs9IChnMyAqPSB2MikgKiAocDMgPSAoZDQgKj0gZDQpIC8gKGgyICsgZDQpKSwgYzMudnkgKz0gKHkyICo9IHYyKSAqIHAzLCB1My52eCAtPSBnMyAqIChwMyA9IDEgLSBwMyksIHUzLnZ5IC09IHkyICogcDMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHUyKHQzKSB7CiAgICAgICAgICBpZiAodDMuZGF0YSkKICAgICAgICAgICAgcmV0dXJuIHQzLnIgPSBlMlt0My5kYXRhLmluZGV4XTsKICAgICAgICAgIGZvciAodmFyIG4zID0gdDMuciA9IDA7IG4zIDwgNDsgKytuMykKICAgICAgICAgICAgdDNbbjNdICYmIHQzW24zXS5yID4gdDMuciAmJiAodDMuciA9IHQzW24zXS5yKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYzIoKSB7CiAgICAgICAgICBpZiAobjIpIHsKICAgICAgICAgICAgdmFyIHIzLCBpMywgbzMgPSBuMi5sZW5ndGg7CiAgICAgICAgICAgIGZvciAoZTIgPSBuZXcgQXJyYXkobzMpLCByMyA9IDA7IHIzIDwgbzM7ICsrcjMpCiAgICAgICAgICAgICAgaTMgPSBuMltyM10sIGUyW2kzLmluZGV4XSA9ICt0MihpMywgcjMsIG4yKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQyICYmICh0MiA9IHFjKG51bGwgPT0gdDIgPyAxIDogK3QyKSksIGEyLmluaXRpYWxpemUgPSBmdW5jdGlvbih0MywgZTMpIHsKICAgICAgICAgIG4yID0gdDMsIHIyID0gZTMsIGMyKCk7CiAgICAgICAgfSwgYTIuaXRlcmF0aW9ucyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChvMiA9ICt0MywgYTIpIDogbzI7CiAgICAgICAgfSwgYTIuc3RyZW5ndGggPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaTIgPSArdDMsIGEyKSA6IGkyOwogICAgICAgIH0sIGEyLnJhZGl1cyA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4zID8gbjMgOiBxYygrbjMpLCBjMigpLCBhMikgOiB0MjsKICAgICAgICB9LCBhMjsKICAgICAgfSwgdC5mb3JjZUxpbmsgPSBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiwgZTIsIHIyLCBpMiwgbzIsIGEyLCB1MiA9IEJjLCBjMiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gMSAvIE1hdGgubWluKGkyW3QzLnNvdXJjZS5pbmRleF0sIGkyW3QzLnRhcmdldC5pbmRleF0pOwogICAgICAgIH0sIGYyID0gcWMoMzApLCBzMiA9IDE7CiAgICAgICAgZnVuY3Rpb24gbDIocjMpIHsKICAgICAgICAgIGZvciAodmFyIGkzID0gMCwgdTMgPSB0Mi5sZW5ndGg7IGkzIDwgczI7ICsraTMpCiAgICAgICAgICAgIGZvciAodmFyIGMzLCBmMywgbDMsIGgzLCBkNCwgcDMsIGcyLCB5MiA9IDA7IHkyIDwgdTM7ICsreTIpCiAgICAgICAgICAgICAgZjMgPSAoYzMgPSB0Mlt5Ml0pLnNvdXJjZSwgaDMgPSAobDMgPSBjMy50YXJnZXQpLnggKyBsMy52eCAtIGYzLnggLSBmMy52eCB8fCBVYyhhMiksIGQ0ID0gbDMueSArIGwzLnZ5IC0gZjMueSAtIGYzLnZ5IHx8IFVjKGEyKSwgaDMgKj0gcDMgPSAoKHAzID0gTWF0aC5zcXJ0KGgzICogaDMgKyBkNCAqIGQ0KSkgLSBlMlt5Ml0pIC8gcDMgKiByMyAqIG4yW3kyXSwgZDQgKj0gcDMsIGwzLnZ4IC09IGgzICogKGcyID0gbzJbeTJdKSwgbDMudnkgLT0gZDQgKiBnMiwgZjMudnggKz0gaDMgKiAoZzIgPSAxIC0gZzIpLCBmMy52eSArPSBkNCAqIGcyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBoMigpIHsKICAgICAgICAgIGlmIChyMikgewogICAgICAgICAgICB2YXIgYTMsIGMzLCBmMyA9IHIyLmxlbmd0aCwgczMgPSB0Mi5sZW5ndGgsIGwzID0gbmV3IE1hcChyMi5tYXAoKHQzLCBuMykgPT4gW3UyKHQzLCBuMywgcjIpLCB0M10pKTsKICAgICAgICAgICAgZm9yIChhMyA9IDAsIGkyID0gbmV3IEFycmF5KGYzKTsgYTMgPCBzMzsgKythMykKICAgICAgICAgICAgICAoYzMgPSB0MlthM10pLmluZGV4ID0gYTMsICJvYmplY3QiICE9IHR5cGVvZiBjMy5zb3VyY2UgJiYgKGMzLnNvdXJjZSA9IFljKGwzLCBjMy5zb3VyY2UpKSwgIm9iamVjdCIgIT0gdHlwZW9mIGMzLnRhcmdldCAmJiAoYzMudGFyZ2V0ID0gWWMobDMsIGMzLnRhcmdldCkpLCBpMltjMy5zb3VyY2UuaW5kZXhdID0gKGkyW2MzLnNvdXJjZS5pbmRleF0gfHwgMCkgKyAxLCBpMltjMy50YXJnZXQuaW5kZXhdID0gKGkyW2MzLnRhcmdldC5pbmRleF0gfHwgMCkgKyAxOwogICAgICAgICAgICBmb3IgKGEzID0gMCwgbzIgPSBuZXcgQXJyYXkoczMpOyBhMyA8IHMzOyArK2EzKQogICAgICAgICAgICAgIGMzID0gdDJbYTNdLCBvMlthM10gPSBpMltjMy5zb3VyY2UuaW5kZXhdIC8gKGkyW2MzLnNvdXJjZS5pbmRleF0gKyBpMltjMy50YXJnZXQuaW5kZXhdKTsKICAgICAgICAgICAgbjIgPSBuZXcgQXJyYXkoczMpLCBkMigpLCBlMiA9IG5ldyBBcnJheShzMyksIHAyKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGQyKCkgewogICAgICAgICAgaWYgKHIyKQogICAgICAgICAgICBmb3IgKHZhciBlMyA9IDAsIGkzID0gdDIubGVuZ3RoOyBlMyA8IGkzOyArK2UzKQogICAgICAgICAgICAgIG4yW2UzXSA9ICtjMih0MltlM10sIGUzLCB0Mik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHAyKCkgewogICAgICAgICAgaWYgKHIyKQogICAgICAgICAgICBmb3IgKHZhciBuMyA9IDAsIGkzID0gdDIubGVuZ3RoOyBuMyA8IGkzOyArK24zKQogICAgICAgICAgICAgIGUyW24zXSA9ICtmMih0MltuM10sIG4zLCB0Mik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsID09IHQyICYmICh0MiA9IFtdKSwgbDIuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgcjIgPSB0MywgYTIgPSBuMywgaDIoKTsKICAgICAgICB9LCBsMi5saW5rcyA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9IG4zLCBoMigpLCBsMikgOiB0MjsKICAgICAgICB9LCBsMi5pZCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh1MiA9IHQzLCBsMikgOiB1MjsKICAgICAgICB9LCBsMi5pdGVyYXRpb25zID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHMyID0gK3QzLCBsMikgOiBzMjsKICAgICAgICB9LCBsMi5zdHJlbmd0aCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBxYygrdDMpLCBkMigpLCBsMikgOiBjMjsKICAgICAgICB9LCBsMi5kaXN0YW5jZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChmMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBxYygrdDMpLCBwMigpLCBsMikgOiBmMjsKICAgICAgICB9LCBsMjsKICAgICAgfSwgdC5mb3JjZU1hbnlCb2R5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIgPSBxYygtMzApLCBhMiA9IDEsIHUyID0gMSAvIDAsIGMyID0gMC44MTsKICAgICAgICBmdW5jdGlvbiBmMihlMykgewogICAgICAgICAgdmFyIGkzLCBvMyA9IHQyLmxlbmd0aCwgYTMgPSAkYyh0MiwgWGMsIEdjKS52aXNpdEFmdGVyKGwyKTsKICAgICAgICAgIGZvciAocjIgPSBlMywgaTMgPSAwOyBpMyA8IG8zOyArK2kzKQogICAgICAgICAgICBuMiA9IHQyW2kzXSwgYTMudmlzaXQoaDIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzMigpIHsKICAgICAgICAgIGlmICh0MikgewogICAgICAgICAgICB2YXIgbjMsIGUzLCByMyA9IHQyLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChpMiA9IG5ldyBBcnJheShyMyksIG4zID0gMDsgbjMgPCByMzsgKytuMykKICAgICAgICAgICAgICBlMyA9IHQyW24zXSwgaTJbZTMuaW5kZXhdID0gK28yKGUzLCBuMywgdDIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsMih0MykgewogICAgICAgICAgdmFyIG4zLCBlMywgcjMsIG8zLCBhMywgdTMgPSAwLCBjMyA9IDA7CiAgICAgICAgICBpZiAodDMubGVuZ3RoKSB7CiAgICAgICAgICAgIGZvciAocjMgPSBvMyA9IGEzID0gMDsgYTMgPCA0OyArK2EzKQogICAgICAgICAgICAgIChuMyA9IHQzW2EzXSkgJiYgKGUzID0gTWF0aC5hYnMobjMudmFsdWUpKSAmJiAodTMgKz0gbjMudmFsdWUsIGMzICs9IGUzLCByMyArPSBlMyAqIG4zLngsIG8zICs9IGUzICogbjMueSk7CiAgICAgICAgICAgIHQzLnggPSByMyAvIGMzLCB0My55ID0gbzMgLyBjMzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIChuMyA9IHQzKS54ID0gbjMuZGF0YS54LCBuMy55ID0gbjMuZGF0YS55OwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgdTMgKz0gaTJbbjMuZGF0YS5pbmRleF07CiAgICAgICAgICAgIH0gd2hpbGUgKG4zID0gbjMubmV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICB0My52YWx1ZSA9IHUzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBoMih0MywgbzMsIGYzLCBzMykgewogICAgICAgICAgaWYgKCF0My52YWx1ZSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB2YXIgbDMgPSB0My54IC0gbjIueCwgaDMgPSB0My55IC0gbjIueSwgZDIgPSBzMyAtIG8zLCBwMiA9IGwzICogbDMgKyBoMyAqIGgzOwogICAgICAgICAgaWYgKGQyICogZDIgLyBjMiA8IHAyKQogICAgICAgICAgICByZXR1cm4gcDIgPCB1MiAmJiAoMCA9PT0gbDMgJiYgKHAyICs9IChsMyA9IFVjKGUyKSkgKiBsMyksIDAgPT09IGgzICYmIChwMiArPSAoaDMgPSBVYyhlMikpICogaDMpLCBwMiA8IGEyICYmIChwMiA9IE1hdGguc3FydChhMiAqIHAyKSksIG4yLnZ4ICs9IGwzICogdDMudmFsdWUgKiByMiAvIHAyLCBuMi52eSArPSBoMyAqIHQzLnZhbHVlICogcjIgLyBwMiksIHRydWU7CiAgICAgICAgICBpZiAoISh0My5sZW5ndGggfHwgcDIgPj0gdTIpKSB7CiAgICAgICAgICAgICh0My5kYXRhICE9PSBuMiB8fCB0My5uZXh0KSAmJiAoMCA9PT0gbDMgJiYgKHAyICs9IChsMyA9IFVjKGUyKSkgKiBsMyksIDAgPT09IGgzICYmIChwMiArPSAoaDMgPSBVYyhlMikpICogaDMpLCBwMiA8IGEyICYmIChwMiA9IE1hdGguc3FydChhMiAqIHAyKSkpOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgdDMuZGF0YSAhPT0gbjIgJiYgKGQyID0gaTJbdDMuZGF0YS5pbmRleF0gKiByMiAvIHAyLCBuMi52eCArPSBsMyAqIGQyLCBuMi52eSArPSBoMyAqIGQyKTsKICAgICAgICAgICAgfSB3aGlsZSAodDMgPSB0My5uZXh0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGYyLmluaXRpYWxpemUgPSBmdW5jdGlvbihuMywgcjMpIHsKICAgICAgICAgIHQyID0gbjMsIGUyID0gcjMsIHMyKCk7CiAgICAgICAgfSwgZjIuc3RyZW5ndGggPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobzIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogcWMoK3QzKSwgczIoKSwgZjIpIDogbzI7CiAgICAgICAgfSwgZjIuZGlzdGFuY2VNaW4gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIgPSB0MyAqIHQzLCBmMikgOiBNYXRoLnNxcnQoYTIpOwogICAgICAgIH0sIGYyLmRpc3RhbmNlTWF4ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHUyID0gdDMgKiB0MywgZjIpIDogTWF0aC5zcXJ0KHUyKTsKICAgICAgICB9LCBmMi50aGV0YSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjMiA9IHQzICogdDMsIGYyKSA6IE1hdGguc3FydChjMik7CiAgICAgICAgfSwgZjI7CiAgICAgIH0sIHQuZm9yY2VSYWRpYWwgPSBmdW5jdGlvbih0MiwgbjIsIGUyKSB7CiAgICAgICAgdmFyIHIyLCBpMiwgbzIsIGEyID0gcWMoMC4xKTsKICAgICAgICBmdW5jdGlvbiB1Mih0MykgewogICAgICAgICAgZm9yICh2YXIgYTMgPSAwLCB1MyA9IHIyLmxlbmd0aDsgYTMgPCB1MzsgKythMykgewogICAgICAgICAgICB2YXIgYzMgPSByMlthM10sIGYyID0gYzMueCAtIG4yIHx8IDFlLTYsIHMyID0gYzMueSAtIGUyIHx8IDFlLTYsIGwyID0gTWF0aC5zcXJ0KGYyICogZjIgKyBzMiAqIHMyKSwgaDIgPSAobzJbYTNdIC0gbDIpICogaTJbYTNdICogdDMgLyBsMjsKICAgICAgICAgICAgYzMudnggKz0gZjIgKiBoMiwgYzMudnkgKz0gczIgKiBoMjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYzIoKSB7CiAgICAgICAgICBpZiAocjIpIHsKICAgICAgICAgICAgdmFyIG4zLCBlMyA9IHIyLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChpMiA9IG5ldyBBcnJheShlMyksIG8yID0gbmV3IEFycmF5KGUzKSwgbjMgPSAwOyBuMyA8IGUzOyArK24zKQogICAgICAgICAgICAgIG8yW24zXSA9ICt0MihyMltuM10sIG4zLCByMiksIGkyW24zXSA9IGlzTmFOKG8yW24zXSkgPyAwIDogK2EyKHIyW24zXSwgbjMsIHIyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQyICYmICh0MiA9IHFjKCt0MikpLCBudWxsID09IG4yICYmIChuMiA9IDApLCBudWxsID09IGUyICYmIChlMiA9IDApLCB1Mi5pbml0aWFsaXplID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHIyID0gdDMsIGMyKCk7CiAgICAgICAgfSwgdTIuc3RyZW5ndGggPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogcWMoK3QzKSwgYzIoKSwgdTIpIDogYTI7CiAgICAgICAgfSwgdTIucmFkaXVzID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHQyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjMgPyBuMyA6IHFjKCtuMyksIGMyKCksIHUyKSA6IHQyOwogICAgICAgIH0sIHUyLnggPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobjIgPSArdDMsIHUyKSA6IG4yOwogICAgICAgIH0sIHUyLnkgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZTIgPSArdDMsIHUyKSA6IGUyOwogICAgICAgIH0sIHUyOwogICAgICB9LCB0LmZvcmNlU2ltdWxhdGlvbiA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgdmFyIG4yLCBlMiA9IDEsIHIyID0gMWUtMywgaTIgPSAxIC0gTWF0aC5wb3cocjIsIDEgLyAzMDApLCBvMiA9IDAsIGEyID0gMC42LCB1MiA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCksIGMyID0gTmkobDIpLCBmMiA9ICR0KCJ0aWNrIiwgImVuZCIpLCBzMiA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICAgICAgIGxldCB0MyA9IDE7CiAgICAgICAgICByZXR1cm4gKCkgPT4gKHQzID0gKExjICogdDMgKyBqYykgJSBIYykgLyBIYzsKICAgICAgICB9KCk7CiAgICAgICAgZnVuY3Rpb24gbDIoKSB7CiAgICAgICAgICBoMigpLCBmMi5jYWxsKCJ0aWNrIiwgbjIpLCBlMiA8IHIyICYmIChjMi5zdG9wKCksIGYyLmNhbGwoImVuZCIsIG4yKSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGgyKHIzKSB7CiAgICAgICAgICB2YXIgYzMsIGYzLCBzMyA9IHQyLmxlbmd0aDsKICAgICAgICAgIHZvaWQgMCA9PT0gcjMgJiYgKHIzID0gMSk7CiAgICAgICAgICBmb3IgKHZhciBsMyA9IDA7IGwzIDwgcjM7ICsrbDMpCiAgICAgICAgICAgIGZvciAoZTIgKz0gKG8yIC0gZTIpICogaTIsIHUyLmZvckVhY2goZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICB0MyhlMik7CiAgICAgICAgICAgIH0pLCBjMyA9IDA7IGMzIDwgczM7ICsrYzMpCiAgICAgICAgICAgICAgbnVsbCA9PSAoZjMgPSB0MltjM10pLmZ4ID8gZjMueCArPSBmMy52eCAqPSBhMiA6IChmMy54ID0gZjMuZngsIGYzLnZ4ID0gMCksIG51bGwgPT0gZjMuZnkgPyBmMy55ICs9IGYzLnZ5ICo9IGEyIDogKGYzLnkgPSBmMy5meSwgZjMudnkgPSAwKTsKICAgICAgICAgIHJldHVybiBuMjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZDIoKSB7CiAgICAgICAgICBmb3IgKHZhciBuMywgZTMgPSAwLCByMyA9IHQyLmxlbmd0aDsgZTMgPCByMzsgKytlMykgewogICAgICAgICAgICBpZiAoKG4zID0gdDJbZTNdKS5pbmRleCA9IGUzLCBudWxsICE9IG4zLmZ4ICYmIChuMy54ID0gbjMuZngpLCBudWxsICE9IG4zLmZ5ICYmIChuMy55ID0gbjMuZnkpLCBpc05hTihuMy54KSB8fCBpc05hTihuMy55KSkgewogICAgICAgICAgICAgIHZhciBpMyA9IDEwICogTWF0aC5zcXJ0KDAuNSArIGUzKSwgbzMgPSBlMyAqIFZjOwogICAgICAgICAgICAgIG4zLnggPSBpMyAqIE1hdGguY29zKG8zKSwgbjMueSA9IGkzICogTWF0aC5zaW4obzMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIChpc05hTihuMy52eCkgfHwgaXNOYU4objMudnkpKSAmJiAobjMudnggPSBuMy52eSA9IDApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwMihuMykgewogICAgICAgICAgcmV0dXJuIG4zLmluaXRpYWxpemUgJiYgbjMuaW5pdGlhbGl6ZSh0MiwgczIpLCBuMzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGwgPT0gdDIgJiYgKHQyID0gW10pLCBkMigpLCBuMiA9IHsgdGljazogaDIsIHJlc3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGMyLnJlc3RhcnQobDIpLCBuMjsKICAgICAgICB9LCBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBjMi5zdG9wKCksIG4yOwogICAgICAgIH0sIG5vZGVzOiBmdW5jdGlvbihlMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodDIgPSBlMywgZDIoKSwgdTIuZm9yRWFjaChwMiksIG4yKSA6IHQyOwogICAgICAgIH0sIGFscGhhOiBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZTIgPSArdDMsIG4yKSA6IGUyOwogICAgICAgIH0sIGFscGhhTWluOiBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSArdDMsIG4yKSA6IHIyOwogICAgICAgIH0sIGFscGhhRGVjYXk6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICt0MywgbjIpIDogK2kyOwogICAgICAgIH0sIGFscGhhVGFyZ2V0OiBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobzIgPSArdDMsIG4yKSA6IG8yOwogICAgICAgIH0sIHZlbG9jaXR5RGVjYXk6IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhMiA9IDEgLSB0MywgbjIpIDogMSAtIGEyOwogICAgICAgIH0sIHJhbmRvbVNvdXJjZTogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHMyID0gdDMsIHUyLmZvckVhY2gocDIpLCBuMikgOiBzMjsKICAgICAgICB9LCBmb3JjZTogZnVuY3Rpb24odDMsIGUzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyAobnVsbCA9PSBlMyA/IHUyLmRlbGV0ZSh0MykgOiB1Mi5zZXQodDMsIHAyKGUzKSksIG4yKSA6IHUyLmdldCh0Myk7CiAgICAgICAgfSwgZmluZDogZnVuY3Rpb24objMsIGUzLCByMykgewogICAgICAgICAgdmFyIGkzLCBvMywgYTMsIHUzLCBjMywgZjMgPSAwLCBzMyA9IHQyLmxlbmd0aDsKICAgICAgICAgIGZvciAobnVsbCA9PSByMyA/IHIzID0gMSAvIDAgOiByMyAqPSByMywgZjMgPSAwOyBmMyA8IHMzOyArK2YzKQogICAgICAgICAgICAoYTMgPSAoaTMgPSBuMyAtICh1MyA9IHQyW2YzXSkueCkgKiBpMyArIChvMyA9IGUzIC0gdTMueSkgKiBvMykgPCByMyAmJiAoYzMgPSB1MywgcjMgPSBhMyk7CiAgICAgICAgICByZXR1cm4gYzM7CiAgICAgICAgfSwgb246IGZ1bmN0aW9uKHQzLCBlMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gKGYyLm9uKHQzLCBlMyksIG4yKSA6IGYyLm9uKHQzKTsKICAgICAgICB9IH07CiAgICAgIH0sIHQuZm9yY2VYID0gZnVuY3Rpb24odDIpIHsKICAgICAgICB2YXIgbjIsIGUyLCByMiwgaTIgPSBxYygwLjEpOwogICAgICAgIGZ1bmN0aW9uIG8yKHQzKSB7CiAgICAgICAgICBmb3IgKHZhciBpMywgbzMgPSAwLCBhMyA9IG4yLmxlbmd0aDsgbzMgPCBhMzsgKytvMykKICAgICAgICAgICAgKGkzID0gbjJbbzNdKS52eCArPSAocjJbbzNdIC0gaTMueCkgKiBlMltvM10gKiB0MzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYTIoKSB7CiAgICAgICAgICBpZiAobjIpIHsKICAgICAgICAgICAgdmFyIG8zLCBhMyA9IG4yLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChlMiA9IG5ldyBBcnJheShhMyksIHIyID0gbmV3IEFycmF5KGEzKSwgbzMgPSAwOyBvMyA8IGEzOyArK28zKQogICAgICAgICAgICAgIGUyW28zXSA9IGlzTmFOKHIyW28zXSA9ICt0MihuMltvM10sIG8zLCBuMikpID8gMCA6ICtpMihuMltvM10sIG8zLCBuMik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAiZnVuY3Rpb24iICE9IHR5cGVvZiB0MiAmJiAodDIgPSBxYyhudWxsID09IHQyID8gMCA6ICt0MikpLCBvMi5pbml0aWFsaXplID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIG4yID0gdDMsIGEyKCk7CiAgICAgICAgfSwgbzIuc3RyZW5ndGggPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoaTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogcWMoK3QzKSwgYTIoKSwgbzIpIDogaTI7CiAgICAgICAgfSwgbzIueCA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4zID8gbjMgOiBxYygrbjMpLCBhMigpLCBvMikgOiB0MjsKICAgICAgICB9LCBvMjsKICAgICAgfSwgdC5mb3JjZVkgPSBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiwgZTIsIHIyLCBpMiA9IHFjKDAuMSk7CiAgICAgICAgZnVuY3Rpb24gbzIodDMpIHsKICAgICAgICAgIGZvciAodmFyIGkzLCBvMyA9IDAsIGEzID0gbjIubGVuZ3RoOyBvMyA8IGEzOyArK28zKQogICAgICAgICAgICAoaTMgPSBuMltvM10pLnZ5ICs9IChyMltvM10gLSBpMy55KSAqIGUyW28zXSAqIHQzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhMigpIHsKICAgICAgICAgIGlmIChuMikgewogICAgICAgICAgICB2YXIgbzMsIGEzID0gbjIubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGUyID0gbmV3IEFycmF5KGEzKSwgcjIgPSBuZXcgQXJyYXkoYTMpLCBvMyA9IDA7IG8zIDwgYTM7ICsrbzMpCiAgICAgICAgICAgICAgZTJbbzNdID0gaXNOYU4ocjJbbzNdID0gK3QyKG4yW28zXSwgbzMsIG4yKSkgPyAwIDogK2kyKG4yW28zXSwgbzMsIG4yKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICJmdW5jdGlvbiIgIT0gdHlwZW9mIHQyICYmICh0MiA9IHFjKG51bGwgPT0gdDIgPyAwIDogK3QyKSksIG8yLmluaXRpYWxpemUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgbjIgPSB0MywgYTIoKTsKICAgICAgICB9LCBvMi5zdHJlbmd0aCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBxYygrdDMpLCBhMigpLCBvMikgOiBpMjsKICAgICAgICB9LCBvMi55ID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHQyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjMgPyBuMyA6IHFjKCtuMyksIGEyKCksIG8yKSA6IHQyOwogICAgICAgIH0sIG8yOwogICAgICB9LCB0LmZvcm1hdERlZmF1bHRMb2NhbGUgPSBmZiwgdC5mb3JtYXRMb2NhbGUgPSBjZiwgdC5mb3JtYXRTcGVjaWZpZXIgPSBKYywgdC5mc3VtID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgY29uc3QgZTIgPSBuZXcgVCgpOwogICAgICAgIGlmICh2b2lkIDAgPT09IG4yKQogICAgICAgICAgZm9yIChsZXQgbjMgb2YgdDIpCiAgICAgICAgICAgIChuMyA9ICtuMykgJiYgZTIuYWRkKG4zKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgIGxldCByMiA9IC0xOwogICAgICAgICAgZm9yIChsZXQgaTIgb2YgdDIpCiAgICAgICAgICAgIChpMiA9ICtuMihpMiwgKytyMiwgdDIpKSAmJiBlMi5hZGQoaTIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gK2UyOwogICAgICB9LCB0Lmdlb0FsYmVycyA9IHhkLCB0Lmdlb0FsYmVyc1VzYSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0MiwgbjIsIGUyLCByMiwgaTIsIG8yLCBhMiA9IHhkKCksIHUyID0gbWQoKS5yb3RhdGUoWzE1NCwgMF0pLmNlbnRlcihbLTIsIDU4LjVdKS5wYXJhbGxlbHMoWzU1LCA2NV0pLCBjMiA9IG1kKCkucm90YXRlKFsxNTcsIDBdKS5jZW50ZXIoWy0zLCAxOS45XSkucGFyYWxsZWxzKFs4LCAxOF0pLCBmMiA9IHsgcG9pbnQ6IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgbzIgPSBbdDMsIG4zXTsKICAgICAgICB9IH07CiAgICAgICAgZnVuY3Rpb24gczIodDMpIHsKICAgICAgICAgIHZhciBuMyA9IHQzWzBdLCBhMyA9IHQzWzFdOwogICAgICAgICAgcmV0dXJuIG8yID0gbnVsbCwgZTIucG9pbnQobjMsIGEzKSwgbzIgfHwgKHIyLnBvaW50KG4zLCBhMyksIG8yKSB8fCAoaTIucG9pbnQobjMsIGEzKSwgbzIpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsMigpIHsKICAgICAgICAgIHJldHVybiB0MiA9IG4yID0gbnVsbCwgczI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzMi5pbnZlcnQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgdmFyIG4zID0gYTIuc2NhbGUoKSwgZTMgPSBhMi50cmFuc2xhdGUoKSwgcjMgPSAodDNbMF0gLSBlM1swXSkgLyBuMywgaTMgPSAodDNbMV0gLSBlM1sxXSkgLyBuMzsKICAgICAgICAgIHJldHVybiAoaTMgPj0gMC4xMiAmJiBpMyA8IDAuMjM0ICYmIHIzID49IC0wLjQyNSAmJiByMyA8IC0wLjIxNCA/IHUyIDogaTMgPj0gMC4xNjYgJiYgaTMgPCAwLjIzNCAmJiByMyA+PSAtMC4yMTQgJiYgcjMgPCAtMC4xMTUgPyBjMiA6IGEyKS5pbnZlcnQodDMpOwogICAgICAgIH0sIHMyLnN0cmVhbSA9IGZ1bmN0aW9uKGUzKSB7CiAgICAgICAgICByZXR1cm4gdDIgJiYgbjIgPT09IGUzID8gdDIgOiAocjMgPSBbYTIuc3RyZWFtKG4yID0gZTMpLCB1Mi5zdHJlYW0oZTMpLCBjMi5zdHJlYW0oZTMpXSwgaTMgPSByMy5sZW5ndGgsIHQyID0geyBwb2ludDogZnVuY3Rpb24odDMsIG4zKSB7CiAgICAgICAgICAgIGZvciAodmFyIGU0ID0gLTE7ICsrZTQgPCBpMzsgKQogICAgICAgICAgICAgIHIzW2U0XS5wb2ludCh0MywgbjMpOwogICAgICAgICAgfSwgc3BoZXJlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgdDMgPSAtMTsgKyt0MyA8IGkzOyApCiAgICAgICAgICAgICAgcjNbdDNdLnNwaGVyZSgpOwogICAgICAgICAgfSwgbGluZVN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgdDMgPSAtMTsgKyt0MyA8IGkzOyApCiAgICAgICAgICAgICAgcjNbdDNdLmxpbmVTdGFydCgpOwogICAgICAgICAgfSwgbGluZUVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZvciAodmFyIHQzID0gLTE7ICsrdDMgPCBpMzsgKQogICAgICAgICAgICAgIHIzW3QzXS5saW5lRW5kKCk7CiAgICAgICAgICB9LCBwb2x5Z29uU3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmb3IgKHZhciB0MyA9IC0xOyArK3QzIDwgaTM7ICkKICAgICAgICAgICAgICByM1t0M10ucG9seWdvblN0YXJ0KCk7CiAgICAgICAgICB9LCBwb2x5Z29uRW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZm9yICh2YXIgdDMgPSAtMTsgKyt0MyA8IGkzOyApCiAgICAgICAgICAgICAgcjNbdDNdLnBvbHlnb25FbmQoKTsKICAgICAgICAgIH0gfSk7CiAgICAgICAgICB2YXIgcjMsIGkzOwogICAgICAgIH0sIHMyLnByZWNpc2lvbiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhMi5wcmVjaXNpb24odDMpLCB1Mi5wcmVjaXNpb24odDMpLCBjMi5wcmVjaXNpb24odDMpLCBsMigpKSA6IGEyLnByZWNpc2lvbigpOwogICAgICAgIH0sIHMyLnNjYWxlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGEyLnNjYWxlKHQzKSwgdTIuc2NhbGUoMC4zNSAqIHQzKSwgYzIuc2NhbGUodDMpLCBzMi50cmFuc2xhdGUoYTIudHJhbnNsYXRlKCkpKSA6IGEyLnNjYWxlKCk7CiAgICAgICAgfSwgczIudHJhbnNsYXRlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIGEyLnRyYW5zbGF0ZSgpOwogICAgICAgICAgdmFyIG4zID0gYTIuc2NhbGUoKSwgbzMgPSArdDNbMF0sIHMzID0gK3QzWzFdOwogICAgICAgICAgcmV0dXJuIGUyID0gYTIudHJhbnNsYXRlKHQzKS5jbGlwRXh0ZW50KFtbbzMgLSAwLjQ1NSAqIG4zLCBzMyAtIDAuMjM4ICogbjNdLCBbbzMgKyAwLjQ1NSAqIG4zLCBzMyArIDAuMjM4ICogbjNdXSkuc3RyZWFtKGYyKSwgcjIgPSB1Mi50cmFuc2xhdGUoW28zIC0gMC4zMDcgKiBuMywgczMgKyAwLjIwMSAqIG4zXSkuY2xpcEV4dGVudChbW28zIC0gMC40MjUgKiBuMyArIGRmLCBzMyArIDAuMTIgKiBuMyArIGRmXSwgW28zIC0gMC4yMTQgKiBuMyAtIGRmLCBzMyArIDAuMjM0ICogbjMgLSBkZl1dKS5zdHJlYW0oZjIpLCBpMiA9IGMyLnRyYW5zbGF0ZShbbzMgLSAwLjIwNSAqIG4zLCBzMyArIDAuMjEyICogbjNdKS5jbGlwRXh0ZW50KFtbbzMgLSAwLjIxNCAqIG4zICsgZGYsIHMzICsgMC4xNjYgKiBuMyArIGRmXSwgW28zIC0gMC4xMTUgKiBuMyAtIGRmLCBzMyArIDAuMjM0ICogbjMgLSBkZl1dKS5zdHJlYW0oZjIpLCBsMigpOwogICAgICAgIH0sIHMyLmZpdEV4dGVudCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIHVkKHMyLCB0MywgbjMpOwogICAgICAgIH0sIHMyLmZpdFNpemUgPSBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiBjZChzMiwgdDMsIG4zKTsKICAgICAgICB9LCBzMi5maXRXaWR0aCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIGZkKHMyLCB0MywgbjMpOwogICAgICAgIH0sIHMyLmZpdEhlaWdodCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIHNkKHMyLCB0MywgbjMpOwogICAgICAgIH0sIHMyLnNjYWxlKDEwNzApOwogICAgICB9LCB0Lmdlb0FyZWEgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB1cyA9IG5ldyBUKCksIExmKHQyLCBjcyksIDIgKiB1czsKICAgICAgfSwgdC5nZW9BemltdXRoYWxFcXVhbEFyZWEgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4geWQoVGQpLnNjYWxlKDEyNC43NSkuY2xpcEFuZ2xlKDE3OS45OTkpOwogICAgICB9LCB0Lmdlb0F6aW11dGhhbEVxdWFsQXJlYVJhdyA9IFRkLCB0Lmdlb0F6aW11dGhhbEVxdWlkaXN0YW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHlkKEFkKS5zY2FsZSg3OS40MTg4KS5jbGlwQW5nbGUoMTc5Ljk5OSk7CiAgICAgIH0sIHQuZ2VvQXppbXV0aGFsRXF1aWRpc3RhbnRSYXcgPSBBZCwgdC5nZW9Cb3VuZHMgPSBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiwgZTIsIHIyLCBpMiwgbzIsIGEyLCB1MjsKICAgICAgICBpZiAoUWYgPSBLZiA9IC0oV2YgPSBaZiA9IDEgLyAwKSwgaXMgPSBbXSwgTGYodDIsIEZzKSwgZTIgPSBpcy5sZW5ndGgpIHsKICAgICAgICAgIGZvciAoaXMuc29ydChIcyksIG4yID0gMSwgbzIgPSBbcjIgPSBpc1swXV07IG4yIDwgZTI7ICsrbjIpCiAgICAgICAgICAgIFhzKHIyLCAoaTIgPSBpc1tuMl0pWzBdKSB8fCBYcyhyMiwgaTJbMV0pID8gKGpzKHIyWzBdLCBpMlsxXSkgPiBqcyhyMlswXSwgcjJbMV0pICYmIChyMlsxXSA9IGkyWzFdKSwganMoaTJbMF0sIHIyWzFdKSA+IGpzKHIyWzBdLCByMlsxXSkgJiYgKHIyWzBdID0gaTJbMF0pKSA6IG8yLnB1c2gocjIgPSBpMik7CiAgICAgICAgICBmb3IgKGEyID0gLTEgLyAwLCBuMiA9IDAsIHIyID0gbzJbZTIgPSBvMi5sZW5ndGggLSAxXTsgbjIgPD0gZTI7IHIyID0gaTIsICsrbjIpCiAgICAgICAgICAgIGkyID0gbzJbbjJdLCAodTIgPSBqcyhyMlsxXSwgaTJbMF0pKSA+IGEyICYmIChhMiA9IHUyLCBXZiA9IGkyWzBdLCBLZiA9IHIyWzFdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGlzID0gb3MgPSBudWxsLCBXZiA9PT0gMSAvIDAgfHwgWmYgPT09IDEgLyAwID8gW1tOYU4sIE5hTl0sIFtOYU4sIE5hTl1dIDogW1tXZiwgWmZdLCBbS2YsIFFmXV07CiAgICAgIH0sIHQuZ2VvQ2VudHJvaWQgPSBmdW5jdGlvbih0MikgewogICAgICAgIG1zID0geHMgPSB3cyA9IE1zID0gVHMgPSBBcyA9IFNzID0gRXMgPSAwLCBOcyA9IG5ldyBUKCksIGtzID0gbmV3IFQoKSwgQ3MgPSBuZXcgVCgpLCBMZih0MiwgR3MpOwogICAgICAgIHZhciBuMiA9ICtOcywgZTIgPSAra3MsIHIyID0gK0NzLCBpMiA9IEVmKG4yLCBlMiwgcjIpOwogICAgICAgIHJldHVybiBpMiA8IHBmICYmIChuMiA9IEFzLCBlMiA9IFNzLCByMiA9IEVzLCB4cyA8IGRmICYmIChuMiA9IHdzLCBlMiA9IE1zLCByMiA9IFRzKSwgKGkyID0gRWYobjIsIGUyLCByMikpIDwgcGYpID8gW05hTiwgTmFOXSA6IFtNZihlMiwgbjIpICogYmYsIFJmKHIyIC8gaTIpICogYmZdOwogICAgICB9LCB0Lmdlb0NpcmNsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0MiwgbjIsIGUyID0gaWwoWzAsIDBdKSwgcjIgPSBpbCg5MCksIGkyID0gaWwoNiksIG8yID0geyBwb2ludDogZnVuY3Rpb24oZTMsIHIzKSB7CiAgICAgICAgICB0Mi5wdXNoKGUzID0gbjIoZTMsIHIzKSksIGUzWzBdICo9IGJmLCBlM1sxXSAqPSBiZjsKICAgICAgICB9IH07CiAgICAgICAgZnVuY3Rpb24gYTIoKSB7CiAgICAgICAgICB2YXIgYTMgPSBlMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB1MiA9IHIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgKiBtZiwgYzIgPSBpMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpICogbWY7CiAgICAgICAgICByZXR1cm4gdDIgPSBbXSwgbjIgPSB1bCgtYTNbMF0gKiBtZiwgLWEzWzFdICogbWYsIDApLmludmVydCwgaGwobzIsIHUyLCBjMiwgMSksIGEzID0geyB0eXBlOiAiUG9seWdvbiIsIGNvb3JkaW5hdGVzOiBbdDJdIH0sIHQyID0gbjIgPSBudWxsLCBhMzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEyLmNlbnRlciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBpbChbK3QzWzBdLCArdDNbMV1dKSwgYTIpIDogZTI7CiAgICAgICAgfSwgYTIucmFkaXVzID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGlsKCt0MyksIGEyKSA6IHIyOwogICAgICAgIH0sIGEyLnByZWNpc2lvbiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBpbCgrdDMpLCBhMikgOiBpMjsKICAgICAgICB9LCBhMjsKICAgICAgfSwgdC5nZW9DbGlwQW50aW1lcmlkaWFuID0gVGwsIHQuZ2VvQ2xpcENpcmNsZSA9IEFsLCB0Lmdlb0NsaXBFeHRlbnQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIsIG4yLCBlMiwgcjIgPSAwLCBpMiA9IDAsIG8yID0gOTYwLCBhMiA9IDUwMDsKICAgICAgICByZXR1cm4gZTIgPSB7IHN0cmVhbTogZnVuY3Rpb24oZTMpIHsKICAgICAgICAgIHJldHVybiB0MiAmJiBuMiA9PT0gZTMgPyB0MiA6IHQyID0gemwocjIsIGkyLCBvMiwgYTIpKG4yID0gZTMpOwogICAgICAgIH0sIGV4dGVudDogZnVuY3Rpb24odTIpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gK3UyWzBdWzBdLCBpMiA9ICt1MlswXVsxXSwgbzIgPSArdTJbMV1bMF0sIGEyID0gK3UyWzFdWzFdLCB0MiA9IG4yID0gbnVsbCwgZTIpIDogW1tyMiwgaTJdLCBbbzIsIGEyXV07CiAgICAgICAgfSB9OwogICAgICB9LCB0Lmdlb0NsaXBSZWN0YW5nbGUgPSB6bCwgdC5nZW9Db25pY0NvbmZvcm1hbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfZChrZCkuc2NhbGUoMTA5LjUpLnBhcmFsbGVscyhbMzAsIDMwXSk7CiAgICAgIH0sIHQuZ2VvQ29uaWNDb25mb3JtYWxSYXcgPSBrZCwgdC5nZW9Db25pY0VxdWFsQXJlYSA9IG1kLCB0Lmdlb0NvbmljRXF1YWxBcmVhUmF3ID0gYmQsIHQuZ2VvQ29uaWNFcXVpZGlzdGFudCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfZChQZCkuc2NhbGUoMTMxLjE1NCkuY2VudGVyKFswLCAxMy45Mzg5XSk7CiAgICAgIH0sIHQuZ2VvQ29uaWNFcXVpZGlzdGFudFJhdyA9IFBkLCB0Lmdlb0NvbnRhaW5zID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuICh0MiAmJiBCbC5oYXNPd25Qcm9wZXJ0eSh0Mi50eXBlKSA/IEJsW3QyLnR5cGVdIDogTGwpKHQyLCBuMik7CiAgICAgIH0sIHQuZ2VvRGlzdGFuY2UgPSBPbCwgdC5nZW9FcXVhbEVhcnRoID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHlkKHFkKS5zY2FsZSgxNzcuMTU4KTsKICAgICAgfSwgdC5nZW9FcXVhbEVhcnRoUmF3ID0gcWQsIHQuZ2VvRXF1aXJlY3Rhbmd1bGFyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHlkKENkKS5zY2FsZSgxNTIuNjMpOwogICAgICB9LCB0Lmdlb0VxdWlyZWN0YW5ndWxhclJhdyA9IENkLCB0Lmdlb0dub21vbmljID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHlkKFVkKS5zY2FsZSgxNDQuMDQ5KS5jbGlwQW5nbGUoNjApOwogICAgICB9LCB0Lmdlb0dub21vbmljUmF3ID0gVWQsIHQuZ2VvR3JhdGljdWxlID0gS2wsIHQuZ2VvR3JhdGljdWxlMTAgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gS2woKSgpOwogICAgICB9LCB0Lmdlb0lkZW50aXR5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyLCBuMiwgZTIsIHIyLCBpMiwgbzIsIGEyLCB1MiA9IDEsIGMyID0gMCwgZjIgPSAwLCBzMiA9IDEsIGwyID0gMSwgaDIgPSAwLCBkMiA9IG51bGwsIHAyID0gMSwgZzIgPSAxLCB5MiA9IGlkKHsgcG9pbnQ6IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgdmFyIGUzID0gYjIoW3QzLCBuM10pOwogICAgICAgICAgdGhpcy5zdHJlYW0ucG9pbnQoZTNbMF0sIGUzWzFdKTsKICAgICAgICB9IH0pLCB2MiA9IGVoOwogICAgICAgIGZ1bmN0aW9uIF8yKCkgewogICAgICAgICAgcmV0dXJuIHAyID0gdTIgKiBzMiwgZzIgPSB1MiAqIGwyLCBvMiA9IGEyID0gbnVsbCwgYjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGIyKGUzKSB7CiAgICAgICAgICB2YXIgcjMgPSBlM1swXSAqIHAyLCBpMyA9IGUzWzFdICogZzI7CiAgICAgICAgICBpZiAoaDIpIHsKICAgICAgICAgICAgdmFyIG8zID0gaTMgKiB0MiAtIHIzICogbjI7CiAgICAgICAgICAgIHIzID0gcjMgKiB0MiArIGkzICogbjIsIGkzID0gbzM7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gW3IzICsgYzIsIGkzICsgZjJdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYjIuaW52ZXJ0ID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgIHZhciByMyA9IGUzWzBdIC0gYzIsIGkzID0gZTNbMV0gLSBmMjsKICAgICAgICAgIGlmIChoMikgewogICAgICAgICAgICB2YXIgbzMgPSBpMyAqIHQyICsgcjMgKiBuMjsKICAgICAgICAgICAgcjMgPSByMyAqIHQyIC0gaTMgKiBuMiwgaTMgPSBvMzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbcjMgLyBwMiwgaTMgLyBnMl07CiAgICAgICAgfSwgYjIuc3RyZWFtID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBvMiAmJiBhMiA9PT0gdDMgPyBvMiA6IG8yID0geTIodjIoYTIgPSB0MykpOwogICAgICAgIH0sIGIyLnBvc3RjbGlwID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHYyID0gdDMsIGQyID0gZTIgPSByMiA9IGkyID0gbnVsbCwgXzIoKSkgOiB2MjsKICAgICAgICB9LCBiMi5jbGlwRXh0ZW50ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHYyID0gbnVsbCA9PSB0MyA/IChkMiA9IGUyID0gcjIgPSBpMiA9IG51bGwsIGVoKSA6IHpsKGQyID0gK3QzWzBdWzBdLCBlMiA9ICt0M1swXVsxXSwgcjIgPSArdDNbMV1bMF0sIGkyID0gK3QzWzFdWzFdKSwgXzIoKSkgOiBudWxsID09IGQyID8gbnVsbCA6IFtbZDIsIGUyXSwgW3IyLCBpMl1dOwogICAgICAgIH0sIGIyLnNjYWxlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHUyID0gK3QzLCBfMigpKSA6IHUyOwogICAgICAgIH0sIGIyLnRyYW5zbGF0ZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjMiA9ICt0M1swXSwgZjIgPSArdDNbMV0sIF8yKCkpIDogW2MyLCBmMl07CiAgICAgICAgfSwgYjIuYW5nbGUgPSBmdW5jdGlvbihlMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobjIgPSBDZihoMiA9IGUzICUgMzYwICogbWYpLCB0MiA9IFRmKGgyKSwgXzIoKSkgOiBoMiAqIGJmOwogICAgICAgIH0sIGIyLnJlZmxlY3RYID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHMyID0gdDMgPyAtMSA6IDEsIF8yKCkpIDogczIgPCAwOwogICAgICAgIH0sIGIyLnJlZmxlY3RZID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGwyID0gdDMgPyAtMSA6IDEsIF8yKCkpIDogbDIgPCAwOwogICAgICAgIH0sIGIyLmZpdEV4dGVudCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIHVkKGIyLCB0MywgbjMpOwogICAgICAgIH0sIGIyLmZpdFNpemUgPSBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiBjZChiMiwgdDMsIG4zKTsKICAgICAgICB9LCBiMi5maXRXaWR0aCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIGZkKGIyLCB0MywgbjMpOwogICAgICAgIH0sIGIyLmZpdEhlaWdodCA9IGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIHNkKGIyLCB0MywgbjMpOwogICAgICAgIH0sIGIyOwogICAgICB9LCB0Lmdlb0ludGVycG9sYXRlID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gdDJbMF0gKiBtZiwgcjIgPSB0MlsxXSAqIG1mLCBpMiA9IG4yWzBdICogbWYsIG8yID0gbjJbMV0gKiBtZiwgYTIgPSBUZihyMiksIHUyID0gQ2YocjIpLCBjMiA9IFRmKG8yKSwgZjIgPSBDZihvMiksIHMyID0gYTIgKiBUZihlMiksIGwyID0gYTIgKiBDZihlMiksIGgyID0gYzIgKiBUZihpMiksIGQyID0gYzIgKiBDZihpMiksIHAyID0gMiAqIFJmKHpmKEZmKG8yIC0gcjIpICsgYTIgKiBjMiAqIEZmKGkyIC0gZTIpKSksIGcyID0gQ2YocDIpLCB5MiA9IHAyID8gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHZhciBuMyA9IENmKHQzICo9IHAyKSAvIGcyLCBlMyA9IENmKHAyIC0gdDMpIC8gZzIsIHIzID0gZTMgKiBzMiArIG4zICogaDIsIGkzID0gZTMgKiBsMiArIG4zICogZDIsIG8zID0gZTMgKiB1MiArIG4zICogZjI7CiAgICAgICAgICByZXR1cm4gW01mKGkzLCByMykgKiBiZiwgTWYobzMsIHpmKHIzICogcjMgKyBpMyAqIGkzKSkgKiBiZl07CiAgICAgICAgfSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIFtlMiAqIGJmLCByMiAqIGJmXTsKICAgICAgICB9OwogICAgICAgIHJldHVybiB5Mi5kaXN0YW5jZSA9IHAyLCB5MjsKICAgICAgfSwgdC5nZW9MZW5ndGggPSBxbCwgdC5nZW9NZXJjYXRvciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBFZChTZCkuc2NhbGUoOTYxIC8gX2YpOwogICAgICB9LCB0Lmdlb01lcmNhdG9yUmF3ID0gU2QsIHQuZ2VvTmF0dXJhbEVhcnRoMSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB5ZChJZCkuc2NhbGUoMTc1LjI5NSk7CiAgICAgIH0sIHQuZ2VvTmF0dXJhbEVhcnRoMVJhdyA9IElkLCB0Lmdlb09ydGhvZ3JhcGhpYyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB5ZChPZCkuc2NhbGUoMjQ5LjUpLmNsaXBBbmdsZSg5MCArIGRmKTsKICAgICAgfSwgdC5nZW9PcnRob2dyYXBoaWNSYXcgPSBPZCwgdC5nZW9QYXRoID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgbGV0IGUyLCByMiwgaTIgPSAzLCBvMiA9IDQuNTsKICAgICAgICBmdW5jdGlvbiBhMih0MykgewogICAgICAgICAgcmV0dXJuIHQzICYmICgiZnVuY3Rpb24iID09IHR5cGVvZiBvMiAmJiByMi5wb2ludFJhZGl1cygrbzIuYXBwbHkodGhpcywgYXJndW1lbnRzKSksIExmKHQzLCBlMihyMikpKSwgcjIucmVzdWx0KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhMi5hcmVhID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBMZih0MywgZTIoc2gpKSwgc2gucmVzdWx0KCk7CiAgICAgICAgfSwgYTIubWVhc3VyZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gTGYodDMsIGUyKEtoKSksIEtoLnJlc3VsdCgpOwogICAgICAgIH0sIGEyLmJvdW5kcyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gTGYodDMsIGUyKG1oKSksIG1oLnJlc3VsdCgpOwogICAgICAgIH0sIGEyLmNlbnRyb2lkID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBMZih0MywgZTIoT2gpKSwgT2gucmVzdWx0KCk7CiAgICAgICAgfSwgYTIucHJvamVjdGlvbiA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9IG51bGwgPT0gbjMgPyAodDIgPSBudWxsLCBlaCkgOiAodDIgPSBuMykuc3RyZWFtLCBhMikgOiB0MjsKICAgICAgICB9LCBhMi5jb250ZXh0ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gbnVsbCA9PSB0MyA/IChuMiA9IG51bGwsIG5ldyBlZChpMikpIDogbmV3IEJoKG4yID0gdDMpLCAiZnVuY3Rpb24iICE9IHR5cGVvZiBvMiAmJiByMi5wb2ludFJhZGl1cyhvMiksIGEyKSA6IG4yOwogICAgICAgIH0sIGEyLnBvaW50UmFkaXVzID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG8yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IChyMi5wb2ludFJhZGl1cygrdDMpLCArdDMpLCBhMikgOiBvMjsKICAgICAgICB9LCBhMi5kaWdpdHMgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gaTI7CiAgICAgICAgICBpZiAobnVsbCA9PSB0MykKICAgICAgICAgICAgaTIgPSBudWxsOwogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IG4zID0gTWF0aC5mbG9vcih0Myk7CiAgICAgICAgICAgIGlmICghKG4zID49IDApKQogICAgICAgICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKGBpbnZhbGlkIGRpZ2l0czogJHt0M31gKTsKICAgICAgICAgICAgaTIgPSBuMzsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBudWxsID09PSBuMiAmJiAocjIgPSBuZXcgZWQoaTIpKSwgYTI7CiAgICAgICAgfSwgYTIucHJvamVjdGlvbih0MikuZGlnaXRzKGkyKS5jb250ZXh0KG4yKTsKICAgICAgfSwgdC5nZW9Qcm9qZWN0aW9uID0geWQsIHQuZ2VvUHJvamVjdGlvbk11dGF0b3IgPSB2ZCwgdC5nZW9Sb3RhdGlvbiA9IGxsLCB0Lmdlb1N0ZXJlb2dyYXBoaWMgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4geWQoQmQpLnNjYWxlKDI1MCkuY2xpcEFuZ2xlKDE0Mik7CiAgICAgIH0sIHQuZ2VvU3RlcmVvZ3JhcGhpY1JhdyA9IEJkLCB0Lmdlb1N0cmVhbSA9IExmLCB0Lmdlb1RyYW5zZm9ybSA9IGZ1bmN0aW9uKHQyKSB7CiAgICAgICAgcmV0dXJuIHsgc3RyZWFtOiBpZCh0MikgfTsKICAgICAgfSwgdC5nZW9UcmFuc3ZlcnNlTWVyY2F0b3IgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBFZChZZCksIG4yID0gdDIuY2VudGVyLCBlMiA9IHQyLnJvdGF0ZTsKICAgICAgICByZXR1cm4gdDIuY2VudGVyID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gbjIoWy10M1sxXSwgdDNbMF1dKSA6IFsodDMgPSBuMigpKVsxXSwgLXQzWzBdXTsKICAgICAgICB9LCB0Mi5yb3RhdGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyBlMihbdDNbMF0sIHQzWzFdLCB0My5sZW5ndGggPiAyID8gdDNbMl0gKyA5MCA6IDkwXSkgOiBbKHQzID0gZTIoKSlbMF0sIHQzWzFdLCB0M1syXSAtIDkwXTsKICAgICAgICB9LCBlMihbMCwgMCwgOTBdKS5zY2FsZSgxNTkuMTU1KTsKICAgICAgfSwgdC5nZW9UcmFuc3ZlcnNlTWVyY2F0b3JSYXcgPSBZZCwgdC5ncmF5ID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIG5ldyB1cih0MiwgMCwgMCwgbnVsbCA9PSBuMiA/IDEgOiBuMik7CiAgICAgIH0sIHQuZ3JlYXRlc3QgPSBvdCwgdC5ncmVhdGVzdEluZGV4ID0gZnVuY3Rpb24odDIsIGUyID0gbikgewogICAgICAgIGlmICgxID09PSBlMi5sZW5ndGgpCiAgICAgICAgICByZXR1cm4gdHQodDIsIGUyKTsKICAgICAgICBsZXQgcjIsIGkyID0gLTEsIG8yID0gLTE7CiAgICAgICAgZm9yIChjb25zdCBuMiBvZiB0MikKICAgICAgICAgICsrbzIsIChpMiA8IDAgPyAwID09PSBlMihuMiwgbjIpIDogZTIobjIsIHIyKSA+IDApICYmIChyMiA9IG4yLCBpMiA9IG8yKTsKICAgICAgICByZXR1cm4gaTI7CiAgICAgIH0sIHQuZ3JvdXAgPSBDLCB0Lmdyb3VwU29ydCA9IGZ1bmN0aW9uKHQyLCBlMiwgcjIpIHsKICAgICAgICByZXR1cm4gKDIgIT09IGUyLmxlbmd0aCA/IFUoJCh0MiwgZTIsIHIyKSwgKFt0MywgZTNdLCBbcjMsIGkyXSkgPT4gbihlMywgaTIpIHx8IG4odDMsIHIzKSkgOiBVKEModDIsIHIyKSwgKFt0MywgcjNdLCBbaTIsIG8yXSkgPT4gZTIocjMsIG8yKSB8fCBuKHQzLCBpMikpKS5tYXAoKFt0M10pID0+IHQzKTsKICAgICAgfSwgdC5ncm91cHMgPSBQLCB0LmhjbCA9IGRyLCB0LmhpZXJhcmNoeSA9IEdkLCB0Lmhpc3RvZ3JhbSA9IFEsIHQuaHNsID0gSGUsIHQuaHRtbCA9IEVjLCB0LmltYWdlID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGUyLCByMikgewogICAgICAgICAgdmFyIGkyID0gbmV3IEltYWdlKCk7CiAgICAgICAgICBmb3IgKHZhciBvMiBpbiBuMikKICAgICAgICAgICAgaTJbbzJdID0gbjJbbzJdOwogICAgICAgICAgaTIub25lcnJvciA9IHIyLCBpMi5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZTIoaTIpOwogICAgICAgICAgfSwgaTIuc3JjID0gdDI7CiAgICAgICAgfSk7CiAgICAgIH0sIHQuaW5kZXggPSBmdW5jdGlvbih0MiwgLi4ubjIpIHsKICAgICAgICByZXR1cm4gRih0MiwgaywgUiwgbjIpOwogICAgICB9LCB0LmluZGV4ZXMgPSBmdW5jdGlvbih0MiwgLi4ubjIpIHsKICAgICAgICByZXR1cm4gRih0MiwgQXJyYXkuZnJvbSwgUiwgbjIpOwogICAgICB9LCB0LmludGVycG9sYXRlID0gR3IsIHQuaW50ZXJwb2xhdGVBcnJheSA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiAoSXIobjIpID8gVXIgOiBPcikodDIsIG4yKTsKICAgICAgfSwgdC5pbnRlcnBvbGF0ZUJhc2lzID0gRXIsIHQuaW50ZXJwb2xhdGVCYXNpc0Nsb3NlZCA9IE5yLCB0LmludGVycG9sYXRlQmx1ZXMgPSBYYiwgdC5pbnRlcnBvbGF0ZUJyQkcgPSBpYiwgdC5pbnRlcnBvbGF0ZUJ1R24gPSB3YiwgdC5pbnRlcnBvbGF0ZUJ1UHUgPSBUYiwgdC5pbnRlcnBvbGF0ZUNpdmlkaXMgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB0MiA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHQyKSksICJyZ2IoIiArIE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZCgtNC41NCAtIHQyICogKDM1LjM0IC0gdDIgKiAoMjM4MS43MyAtIHQyICogKDY0MDIuNyAtIHQyICogKDcwMjQuNzIgLSAyNzEwLjU3ICogdDIpKSkpKSkpICsgIiwgIiArIE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZCgzMi40OSArIHQyICogKDE3MC43MyArIHQyICogKDUyLjgyIC0gdDIgKiAoMTMxLjQ2IC0gdDIgKiAoMTc2LjU4IC0gNjcuMzcgKiB0MikpKSkpKSkgKyAiLCAiICsgTWF0aC5tYXgoMCwgTWF0aC5taW4oMjU1LCBNYXRoLnJvdW5kKDgxLjI0ICsgdDIgKiAoNDQyLjM2IC0gdDIgKiAoMjQ4Mi40MyAtIHQyICogKDYxNjcuMjQgLSB0MiAqICg2NjE0Ljk0IC0gMjQ3NS42NyAqIHQyKSkpKSkpKSArICIpIjsKICAgICAgfSwgdC5pbnRlcnBvbGF0ZUNvb2wgPSBvbSwgdC5pbnRlcnBvbGF0ZUN1YmVoZWxpeCA9IGxpLCB0LmludGVycG9sYXRlQ3ViZWhlbGl4RGVmYXVsdCA9IHJtLCB0LmludGVycG9sYXRlQ3ViZWhlbGl4TG9uZyA9IGhpLCB0LmludGVycG9sYXRlRGF0ZSA9IEJyLCB0LmludGVycG9sYXRlRGlzY3JldGUgPSBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiA9IHQyLmxlbmd0aDsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZTIpIHsKICAgICAgICAgIHJldHVybiB0MltNYXRoLm1heCgwLCBNYXRoLm1pbihuMiAtIDEsIE1hdGguZmxvb3IoZTIgKiBuMikpKV07CiAgICAgICAgfTsKICAgICAgfSwgdC5pbnRlcnBvbGF0ZUduQnUgPSBTYiwgdC5pbnRlcnBvbGF0ZUdyZWVucyA9IFZiLCB0LmludGVycG9sYXRlR3JleXMgPSBaYiwgdC5pbnRlcnBvbGF0ZUhjbCA9IGNpLCB0LmludGVycG9sYXRlSGNsTG9uZyA9IGZpLCB0LmludGVycG9sYXRlSHNsID0gb2ksIHQuaW50ZXJwb2xhdGVIc2xMb25nID0gYWksIHQuaW50ZXJwb2xhdGVIdWUgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICB2YXIgZTIgPSBQcigrdDIsICtuMik7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICB2YXIgbjMgPSBlMih0Myk7CiAgICAgICAgICByZXR1cm4gbjMgLSAzNjAgKiBNYXRoLmZsb29yKG4zIC8gMzYwKTsKICAgICAgICB9OwogICAgICB9LCB0LmludGVycG9sYXRlSW5mZXJubyA9IGRtLCB0LmludGVycG9sYXRlTGFiID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgdmFyIGUyID0gJHIoKHQyID0gYXIodDIpKS5sLCAobjIgPSBhcihuMikpLmwpLCByMiA9ICRyKHQyLmEsIG4yLmEpLCBpMiA9ICRyKHQyLmIsIG4yLmIpLCBvMiA9ICRyKHQyLm9wYWNpdHksIG4yLm9wYWNpdHkpOwogICAgICAgIHJldHVybiBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIHQyLmwgPSBlMihuMyksIHQyLmEgPSByMihuMyksIHQyLmIgPSBpMihuMyksIHQyLm9wYWNpdHkgPSBvMihuMyksIHQyICsgIiI7CiAgICAgICAgfTsKICAgICAgfSwgdC5pbnRlcnBvbGF0ZU1hZ21hID0gaG0sIHQuaW50ZXJwb2xhdGVOdW1iZXIgPSBZciwgdC5pbnRlcnBvbGF0ZU51bWJlckFycmF5ID0gVXIsIHQuaW50ZXJwb2xhdGVPYmplY3QgPSBMciwgdC5pbnRlcnBvbGF0ZU9yUmQgPSBOYiwgdC5pbnRlcnBvbGF0ZU9yYW5nZXMgPSBlbSwgdC5pbnRlcnBvbGF0ZVBSR24gPSBhYiwgdC5pbnRlcnBvbGF0ZVBpWUcgPSBjYiwgdC5pbnRlcnBvbGF0ZVBsYXNtYSA9IHBtLCB0LmludGVycG9sYXRlUHVCdSA9IHpiLCB0LmludGVycG9sYXRlUHVCdUduID0gQ2IsIHQuaW50ZXJwb2xhdGVQdU9yID0gc2IsIHQuaW50ZXJwb2xhdGVQdVJkID0gRGIsIHQuaW50ZXJwb2xhdGVQdXJwbGVzID0gUWIsIHQuaW50ZXJwb2xhdGVSYWluYm93ID0gZnVuY3Rpb24odDIpIHsKICAgICAgICAodDIgPCAwIHx8IHQyID4gMSkgJiYgKHQyIC09IE1hdGguZmxvb3IodDIpKTsKICAgICAgICB2YXIgbjIgPSBNYXRoLmFicyh0MiAtIDAuNSk7CiAgICAgICAgcmV0dXJuIGFtLmggPSAzNjAgKiB0MiAtIDEwMCwgYW0ucyA9IDEuNSAtIDEuNSAqIG4yLCBhbS5sID0gMC44IC0gMC45ICogbjIsIGFtICsgIiI7CiAgICAgIH0sIHQuaW50ZXJwb2xhdGVSZEJ1ID0gaGIsIHQuaW50ZXJwb2xhdGVSZEd5ID0gcGIsIHQuaW50ZXJwb2xhdGVSZFB1ID0gRmIsIHQuaW50ZXJwb2xhdGVSZFlsQnUgPSB5YiwgdC5pbnRlcnBvbGF0ZVJkWWxHbiA9IF9iLCB0LmludGVycG9sYXRlUmVkcyA9IHRtLCB0LmludGVycG9sYXRlUmdiID0gRHIsIHQuaW50ZXJwb2xhdGVSZ2JCYXNpcyA9IEZyLCB0LmludGVycG9sYXRlUmdiQmFzaXNDbG9zZWQgPSBxciwgdC5pbnRlcnBvbGF0ZVJvdW5kID0gVnIsIHQuaW50ZXJwb2xhdGVTaW5lYm93ID0gZnVuY3Rpb24odDIpIHsKICAgICAgICB2YXIgbjI7CiAgICAgICAgcmV0dXJuIHQyID0gKDAuNSAtIHQyKSAqIE1hdGguUEksIHVtLnIgPSAyNTUgKiAobjIgPSBNYXRoLnNpbih0MikpICogbjIsIHVtLmcgPSAyNTUgKiAobjIgPSBNYXRoLnNpbih0MiArIGNtKSkgKiBuMiwgdW0uYiA9IDI1NSAqIChuMiA9IE1hdGguc2luKHQyICsgZm0pKSAqIG4yLCB1bSArICIiOwogICAgICB9LCB0LmludGVycG9sYXRlU3BlY3RyYWwgPSBtYiwgdC5pbnRlcnBvbGF0ZVN0cmluZyA9IFhyLCB0LmludGVycG9sYXRlVHJhbnNmb3JtQ3NzID0gdGksIHQuaW50ZXJwb2xhdGVUcmFuc2Zvcm1TdmcgPSBuaSwgdC5pbnRlcnBvbGF0ZVR1cmJvID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gdDIgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB0MikpLCAicmdiKCIgKyBNYXRoLm1heCgwLCBNYXRoLm1pbigyNTUsIE1hdGgucm91bmQoMzQuNjEgKyB0MiAqICgxMTcyLjMzIC0gdDIgKiAoMTA3OTMuNTYgLSB0MiAqICgzMzMwMC4xMiAtIHQyICogKDM4Mzk0LjQ5IC0gMTQ4MjUuMDUgKiB0MikpKSkpKSkgKyAiLCAiICsgTWF0aC5tYXgoMCwgTWF0aC5taW4oMjU1LCBNYXRoLnJvdW5kKDIzLjMxICsgdDIgKiAoNTU3LjMzICsgdDIgKiAoMTIyNS4zMyAtIHQyICogKDM1NzQuOTYgLSB0MiAqICgxMDczLjc3ICsgNzA3LjU2ICogdDIpKSkpKSkpICsgIiwgIiArIE1hdGgubWF4KDAsIE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZCgyNy4yICsgdDIgKiAoMzIxMS4xIC0gdDIgKiAoMTUzMjcuOTcgLSB0MiAqICgyNzgxNCAtIHQyICogKDIyNTY5LjE4IC0gNjgzOC42NiAqIHQyKSkpKSkpKSArICIpIjsKICAgICAgfSwgdC5pbnRlcnBvbGF0ZVZpcmlkaXMgPSBsbSwgdC5pbnRlcnBvbGF0ZVdhcm0gPSBpbSwgdC5pbnRlcnBvbGF0ZVlsR24gPSBPYiwgdC5pbnRlcnBvbGF0ZVlsR25CdSA9IFViLCB0LmludGVycG9sYXRlWWxPckJyID0gWWIsIHQuaW50ZXJwb2xhdGVZbE9yUmQgPSBqYiwgdC5pbnRlcnBvbGF0ZVpvb20gPSByaSwgdC5pbnRlcnJ1cHQgPSBHaSwgdC5pbnRlcnNlY3Rpb24gPSBmdW5jdGlvbih0MiwgLi4ubjIpIHsKICAgICAgICB0MiA9IG5ldyBJbnRlcm5TZXQodDIpLCBuMiA9IG4yLm1hcCh2dCk7CiAgICAgICAgdDoKICAgICAgICAgIGZvciAoY29uc3QgZTIgb2YgdDIpCiAgICAgICAgICAgIGZvciAoY29uc3QgcjIgb2YgbjIpCiAgICAgICAgICAgICAgaWYgKCFyMi5oYXMoZTIpKSB7CiAgICAgICAgICAgICAgICB0Mi5kZWxldGUoZTIpOwogICAgICAgICAgICAgICAgY29udGludWUgdDsKICAgICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIHQyOwogICAgICB9LCB0LmludGVydmFsID0gZnVuY3Rpb24odDIsIG4yLCBlMikgewogICAgICAgIHZhciByMiA9IG5ldyBFaSgpLCBpMiA9IG4yOwogICAgICAgIHJldHVybiBudWxsID09IG4yID8gKHIyLnJlc3RhcnQodDIsIG4yLCBlMiksIHIyKSA6IChyMi5fcmVzdGFydCA9IHIyLnJlc3RhcnQsIHIyLnJlc3RhcnQgPSBmdW5jdGlvbih0MywgbjMsIGUzKSB7CiAgICAgICAgICBuMyA9ICtuMywgZTMgPSBudWxsID09IGUzID8gQWkoKSA6ICtlMywgcjIuX3Jlc3RhcnQoZnVuY3Rpb24gbzIoYTIpIHsKICAgICAgICAgICAgYTIgKz0gaTIsIHIyLl9yZXN0YXJ0KG8yLCBpMiArPSBuMywgZTMpLCB0MyhhMik7CiAgICAgICAgICB9LCBuMywgZTMpOwogICAgICAgIH0sIHIyLnJlc3RhcnQodDIsIG4yLCBlMiksIHIyKTsKICAgICAgfSwgdC5pc29Gb3JtYXQgPSBEXywgdC5pc29QYXJzZSA9IEZfLCB0Lmpzb24gPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gZmV0Y2godDIsIG4yKS50aGVuKFRjKTsKICAgICAgfSwgdC5sYWIgPSBhciwgdC5sY2ggPSBmdW5jdGlvbih0MiwgbjIsIGUyLCByMikgewogICAgICAgIHJldHVybiAxID09PSBhcmd1bWVudHMubGVuZ3RoID8gaHIodDIpIDogbmV3IHByKGUyLCBuMiwgdDIsIG51bGwgPT0gcjIgPyAxIDogcjIpOwogICAgICB9LCB0LmxlYXN0ID0gZnVuY3Rpb24odDIsIGUyID0gbikgewogICAgICAgIGxldCByMiwgaTIgPSBmYWxzZTsKICAgICAgICBpZiAoMSA9PT0gZTIubGVuZ3RoKSB7CiAgICAgICAgICBsZXQgbzI7CiAgICAgICAgICBmb3IgKGNvbnN0IGEyIG9mIHQyKSB7CiAgICAgICAgICAgIGNvbnN0IHQzID0gZTIoYTIpOwogICAgICAgICAgICAoaTIgPyBuKHQzLCBvMikgPCAwIDogMCA9PT0gbih0MywgdDMpKSAmJiAocjIgPSBhMiwgbzIgPSB0MywgaTIgPSB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UKICAgICAgICAgIGZvciAoY29uc3QgbjIgb2YgdDIpCiAgICAgICAgICAgIChpMiA/IGUyKG4yLCByMikgPCAwIDogMCA9PT0gZTIobjIsIG4yKSkgJiYgKHIyID0gbjIsIGkyID0gdHJ1ZSk7CiAgICAgICAgcmV0dXJuIHIyOwogICAgICB9LCB0LmxlYXN0SW5kZXggPSBodCwgdC5saW5lID0gQm0sIHQubGluZVJhZGlhbCA9IFdtLCB0LmxpbmsgPSBveCwgdC5saW5rSG9yaXpvbnRhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBveCh0eCk7CiAgICAgIH0sIHQubGlua1JhZGlhbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHQyID0gb3goZXgpOwogICAgICAgIHJldHVybiB0Mi5hbmdsZSA9IHQyLngsIGRlbGV0ZSB0Mi54LCB0Mi5yYWRpdXMgPSB0Mi55LCBkZWxldGUgdDIueSwgdDI7CiAgICAgIH0sIHQubGlua1ZlcnRpY2FsID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG94KG54KTsKICAgICAgfSwgdC5sb2NhbCA9IFFuLCB0Lm1hcCA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiB0MltTeW1ib2wuaXRlcmF0b3JdKQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigidmFsdWVzIGlzIG5vdCBpdGVyYWJsZSIpOwogICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBuMikKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm1hcHBlciBpcyBub3QgYSBmdW5jdGlvbiIpOwogICAgICAgIHJldHVybiBBcnJheS5mcm9tKHQyLCAoZTIsIHIyKSA9PiBuMihlMiwgcjIsIHQyKSk7CiAgICAgIH0sIHQubWF0Y2hlciA9IFZ0LCB0Lm1heCA9IEosIHQubWF4SW5kZXggPSB0dCwgdC5tZWFuID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgbGV0IGUyID0gMCwgcjIgPSAwOwogICAgICAgIGlmICh2b2lkIDAgPT09IG4yKQogICAgICAgICAgZm9yIChsZXQgbjMgb2YgdDIpCiAgICAgICAgICAgIG51bGwgIT0gbjMgJiYgKG4zID0gK24zKSA+PSBuMyAmJiAoKytlMiwgcjIgKz0gbjMpOwogICAgICAgIGVsc2UgewogICAgICAgICAgbGV0IGkyID0gLTE7CiAgICAgICAgICBmb3IgKGxldCBvMiBvZiB0MikKICAgICAgICAgICAgbnVsbCAhPSAobzIgPSBuMihvMiwgKytpMiwgdDIpKSAmJiAobzIgPSArbzIpID49IG8yICYmICgrK2UyLCByMiArPSBvMik7CiAgICAgICAgfQogICAgICAgIGlmIChlMikKICAgICAgICAgIHJldHVybiByMiAvIGUyOwogICAgICB9LCB0Lm1lZGlhbiA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiBhdCh0MiwgMC41LCBuMik7CiAgICAgIH0sIHQubWVkaWFuSW5kZXggPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICByZXR1cm4gY3QodDIsIDAuNSwgbjIpOwogICAgICB9LCB0Lm1lcmdlID0gZnQsIHQubWluID0gbnQsIHQubWluSW5kZXggPSBldCwgdC5tb2RlID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgY29uc3QgZTIgPSBuZXcgSW50ZXJuTWFwKCk7CiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbjIpCiAgICAgICAgICBmb3IgKGxldCBuMyBvZiB0MikKICAgICAgICAgICAgbnVsbCAhPSBuMyAmJiBuMyA+PSBuMyAmJiBlMi5zZXQobjMsIChlMi5nZXQobjMpIHx8IDApICsgMSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBsZXQgcjMgPSAtMTsKICAgICAgICAgIGZvciAobGV0IGkzIG9mIHQyKQogICAgICAgICAgICBudWxsICE9IChpMyA9IG4yKGkzLCArK3IzLCB0MikpICYmIGkzID49IGkzICYmIGUyLnNldChpMywgKGUyLmdldChpMykgfHwgMCkgKyAxKTsKICAgICAgICB9CiAgICAgICAgbGV0IHIyLCBpMiA9IDA7CiAgICAgICAgZm9yIChjb25zdCBbdDMsIG4zXSBvZiBlMikKICAgICAgICAgIG4zID4gaTIgJiYgKGkyID0gbjMsIHIyID0gdDMpOwogICAgICAgIHJldHVybiByMjsKICAgICAgfSwgdC5uYW1lc3BhY2UgPSBJdCwgdC5uYW1lc3BhY2VzID0gVXQsIHQubmljZSA9IFosIHQubm93ID0gQWksIHQucGFjayA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0MiA9IG51bGwsIG4yID0gMSwgZTIgPSAxLCByMiA9IG5wOwogICAgICAgIGZ1bmN0aW9uIGkyKGkzKSB7CiAgICAgICAgICBjb25zdCBvMiA9IGFwKCk7CiAgICAgICAgICByZXR1cm4gaTMueCA9IG4yIC8gMiwgaTMueSA9IGUyIC8gMiwgdDIgPyBpMy5lYWNoQmVmb3JlKHhwKHQyKSkuZWFjaEFmdGVyKHdwKHIyLCAwLjUsIG8yKSkuZWFjaEJlZm9yZShNcCgxKSkgOiBpMy5lYWNoQmVmb3JlKHhwKG1wKSkuZWFjaEFmdGVyKHdwKG5wLCAxLCBvMikpLmVhY2hBZnRlcih3cChyMiwgaTMuciAvIE1hdGgubWluKG4yLCBlMiksIG8yKSkuZWFjaEJlZm9yZShNcChNYXRoLm1pbihuMiwgZTIpIC8gKDIgKiBpMy5yKSkpLCBpMzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGkyLnJhZGl1cyA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9IEpkKG4zKSwgaTIpIDogdDI7CiAgICAgICAgfSwgaTIuc2l6ZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChuMiA9ICt0M1swXSwgZTIgPSArdDNbMV0sIGkyKSA6IFtuMiwgZTJdOwogICAgICAgIH0sIGkyLnBhZGRpbmcgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZXAoK3QzKSwgaTIpIDogcjI7CiAgICAgICAgfSwgaTI7CiAgICAgIH0sIHQucGFja0VuY2xvc2UgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB1cCh0MiwgYXAoKSk7CiAgICAgIH0sIHQucGFja1NpYmxpbmdzID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gYnAodDIsIGFwKCkpLCB0MjsKICAgICAgfSwgdC5wYWlycyA9IGZ1bmN0aW9uKHQyLCBuMiA9IHN0KSB7CiAgICAgICAgY29uc3QgZTIgPSBbXTsKICAgICAgICBsZXQgcjIsIGkyID0gZmFsc2U7CiAgICAgICAgZm9yIChjb25zdCBvMiBvZiB0MikKICAgICAgICAgIGkyICYmIGUyLnB1c2gobjIocjIsIG8yKSksIHIyID0gbzIsIGkyID0gdHJ1ZTsKICAgICAgICByZXR1cm4gZTI7CiAgICAgIH0sIHQucGFydGl0aW9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyID0gMSwgbjIgPSAxLCBlMiA9IDAsIHIyID0gZmFsc2U7CiAgICAgICAgZnVuY3Rpb24gaTIoaTMpIHsKICAgICAgICAgIHZhciBvMiA9IGkzLmhlaWdodCArIDE7CiAgICAgICAgICByZXR1cm4gaTMueDAgPSBpMy55MCA9IGUyLCBpMy54MSA9IHQyLCBpMy55MSA9IG4yIC8gbzIsIGkzLmVhY2hCZWZvcmUoLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKHQzLCBuMykgewogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ocjMpIHsKICAgICAgICAgICAgICByMy5jaGlsZHJlbiAmJiBBcChyMywgcjMueDAsIHQzICogKHIzLmRlcHRoICsgMSkgLyBuMywgcjMueDEsIHQzICogKHIzLmRlcHRoICsgMikgLyBuMyk7CiAgICAgICAgICAgICAgdmFyIGk0ID0gcjMueDAsIG8zID0gcjMueTAsIGEyID0gcjMueDEgLSBlMiwgdTIgPSByMy55MSAtIGUyOwogICAgICAgICAgICAgIGEyIDwgaTQgJiYgKGk0ID0gYTIgPSAoaTQgKyBhMikgLyAyKSwgdTIgPCBvMyAmJiAobzMgPSB1MiA9IChvMyArIHUyKSAvIDIpLCByMy54MCA9IGk0LCByMy55MCA9IG8zLCByMy54MSA9IGEyLCByMy55MSA9IHUyOwogICAgICAgICAgICB9OwogICAgICAgICAgfShuMiwgbzIpKSwgcjIgJiYgaTMuZWFjaEJlZm9yZShUcCksIGkzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIucm91bmQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSAhIXQzLCBpMikgOiByMjsKICAgICAgICB9LCBpMi5zaXplID0gZnVuY3Rpb24oZTMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHQyID0gK2UzWzBdLCBuMiA9ICtlM1sxXSwgaTIpIDogW3QyLCBuMl07CiAgICAgICAgfSwgaTIucGFkZGluZyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9ICt0MywgaTIpIDogZTI7CiAgICAgICAgfSwgaTI7CiAgICAgIH0sIHQucGF0aCA9IElhLCB0LnBhdGhSb3VuZCA9IGZ1bmN0aW9uKHQyID0gMykgewogICAgICAgIHJldHVybiBuZXcgVWEoK3QyKTsKICAgICAgfSwgdC5wZXJtdXRlID0gcSwgdC5waWUgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBqbSwgbjIgPSBMbSwgZTIgPSBudWxsLCByMiA9IGdtKDApLCBpMiA9IGdtKFNtKSwgbzIgPSBnbSgwKTsKICAgICAgICBmdW5jdGlvbiBhMihhMykgewogICAgICAgICAgdmFyIHUyLCBjMiwgZjIsIHMyLCBsMiwgaDIgPSAoYTMgPSBGbShhMykpLmxlbmd0aCwgZDIgPSAwLCBwMiA9IG5ldyBBcnJheShoMiksIGcyID0gbmV3IEFycmF5KGgyKSwgeTIgPSArcjIuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdjIgPSBNYXRoLm1pbihTbSwgTWF0aC5tYXgoLVNtLCBpMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIC0geTIpKSwgXzIgPSBNYXRoLm1pbihNYXRoLmFicyh2MikgLyBoMiwgbzIuYXBwbHkodGhpcywgYXJndW1lbnRzKSksIGIyID0gXzIgKiAodjIgPCAwID8gLTEgOiAxKTsKICAgICAgICAgIGZvciAodTIgPSAwOyB1MiA8IGgyOyArK3UyKQogICAgICAgICAgICAobDIgPSBnMltwMlt1Ml0gPSB1Ml0gPSArdDIoYTNbdTJdLCB1MiwgYTMpKSA+IDAgJiYgKGQyICs9IGwyKTsKICAgICAgICAgIGZvciAobnVsbCAhPSBuMiA/IHAyLnNvcnQoZnVuY3Rpb24odDMsIGUzKSB7CiAgICAgICAgICAgIHJldHVybiBuMihnMlt0M10sIGcyW2UzXSk7CiAgICAgICAgICB9KSA6IG51bGwgIT0gZTIgJiYgcDIuc29ydChmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgICAgcmV0dXJuIGUyKGEzW3QzXSwgYTNbbjNdKTsKICAgICAgICAgIH0pLCB1MiA9IDAsIGYyID0gZDIgPyAodjIgLSBoMiAqIGIyKSAvIGQyIDogMDsgdTIgPCBoMjsgKyt1MiwgeTIgPSBzMikKICAgICAgICAgICAgYzIgPSBwMlt1Ml0sIHMyID0geTIgKyAoKGwyID0gZzJbYzJdKSA+IDAgPyBsMiAqIGYyIDogMCkgKyBiMiwgZzJbYzJdID0geyBkYXRhOiBhM1tjMl0sIGluZGV4OiB1MiwgdmFsdWU6IGwyLCBzdGFydEFuZ2xlOiB5MiwgZW5kQW5nbGU6IHMyLCBwYWRBbmdsZTogXzIgfTsKICAgICAgICAgIHJldHVybiBnMjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEyLnZhbHVlID0gZnVuY3Rpb24objMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHQyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjMgPyBuMyA6IGdtKCtuMyksIGEyKSA6IHQyOwogICAgICAgIH0sIGEyLnNvcnRWYWx1ZXMgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobjIgPSB0MywgZTIgPSBudWxsLCBhMikgOiBuMjsKICAgICAgICB9LCBhMi5zb3J0ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGUyID0gdDMsIG4yID0gbnVsbCwgYTIpIDogZTI7CiAgICAgICAgfSwgYTIuc3RhcnRBbmdsZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBnbSgrdDMpLCBhMikgOiByMjsKICAgICAgICB9LCBhMi5lbmRBbmdsZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBnbSgrdDMpLCBhMikgOiBpMjsKICAgICAgICB9LCBhMi5wYWRBbmdsZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChvMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBnbSgrdDMpLCBhMikgOiBvMjsKICAgICAgICB9LCBhMjsKICAgICAgfSwgdC5waWVjZXdpc2UgPSBkaSwgdC5wb2ludFJhZGlhbCA9IEttLCB0LnBvaW50ZXIgPSBuZSwgdC5wb2ludGVycyA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIHJldHVybiB0Mi50YXJnZXQgJiYgKHQyID0gdGUodDIpLCB2b2lkIDAgPT09IG4yICYmIChuMiA9IHQyLmN1cnJlbnRUYXJnZXQpLCB0MiA9IHQyLnRvdWNoZXMgfHwgW3QyXSksIEFycmF5LmZyb20odDIsICh0MykgPT4gbmUodDMsIG4yKSk7CiAgICAgIH0sIHQucG9seWdvbkFyZWEgPSBmdW5jdGlvbih0MikgewogICAgICAgIGZvciAodmFyIG4yLCBlMiA9IC0xLCByMiA9IHQyLmxlbmd0aCwgaTIgPSB0MltyMiAtIDFdLCBvMiA9IDA7ICsrZTIgPCByMjsgKQogICAgICAgICAgbjIgPSBpMiwgaTIgPSB0MltlMl0sIG8yICs9IG4yWzFdICogaTJbMF0gLSBuMlswXSAqIGkyWzFdOwogICAgICAgIHJldHVybiBvMiAvIDI7CiAgICAgIH0sIHQucG9seWdvbkNlbnRyb2lkID0gZnVuY3Rpb24odDIpIHsKICAgICAgICBmb3IgKHZhciBuMiwgZTIsIHIyID0gLTEsIGkyID0gdDIubGVuZ3RoLCBvMiA9IDAsIGEyID0gMCwgdTIgPSB0MltpMiAtIDFdLCBjMiA9IDA7ICsrcjIgPCBpMjsgKQogICAgICAgICAgbjIgPSB1MiwgdTIgPSB0MltyMl0sIGMyICs9IGUyID0gbjJbMF0gKiB1MlsxXSAtIHUyWzBdICogbjJbMV0sIG8yICs9IChuMlswXSArIHUyWzBdKSAqIGUyLCBhMiArPSAobjJbMV0gKyB1MlsxXSkgKiBlMjsKICAgICAgICByZXR1cm4gW28yIC8gKGMyICo9IDMpLCBhMiAvIGMyXTsKICAgICAgfSwgdC5wb2x5Z29uQ29udGFpbnMgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBmb3IgKHZhciBlMiwgcjIsIGkyID0gdDIubGVuZ3RoLCBvMiA9IHQyW2kyIC0gMV0sIGEyID0gbjJbMF0sIHUyID0gbjJbMV0sIGMyID0gbzJbMF0sIGYyID0gbzJbMV0sIHMyID0gZmFsc2UsIGwyID0gMDsgbDIgPCBpMjsgKytsMikKICAgICAgICAgIGUyID0gKG8yID0gdDJbbDJdKVswXSwgKHIyID0gbzJbMV0pID4gdTIgIT0gZjIgPiB1MiAmJiBhMiA8IChjMiAtIGUyKSAqICh1MiAtIHIyKSAvIChmMiAtIHIyKSArIGUyICYmIChzMiA9ICFzMiksIGMyID0gZTIsIGYyID0gcjI7CiAgICAgICAgcmV0dXJuIHMyOwogICAgICB9LCB0LnBvbHlnb25IdWxsID0gZnVuY3Rpb24odDIpIHsKICAgICAgICBpZiAoKGUyID0gdDIubGVuZ3RoKSA8IDMpCiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB2YXIgbjIsIGUyLCByMiA9IG5ldyBBcnJheShlMiksIGkyID0gbmV3IEFycmF5KGUyKTsKICAgICAgICBmb3IgKG4yID0gMDsgbjIgPCBlMjsgKytuMikKICAgICAgICAgIHIyW24yXSA9IFsrdDJbbjJdWzBdLCArdDJbbjJdWzFdLCBuMl07CiAgICAgICAgZm9yIChyMi5zb3J0KEhwKSwgbjIgPSAwOyBuMiA8IGUyOyArK24yKQogICAgICAgICAgaTJbbjJdID0gW3IyW24yXVswXSwgLXIyW24yXVsxXV07CiAgICAgICAgdmFyIG8yID0gWHAocjIpLCBhMiA9IFhwKGkyKSwgdTIgPSBhMlswXSA9PT0gbzJbMF0sIGMyID0gYTJbYTIubGVuZ3RoIC0gMV0gPT09IG8yW28yLmxlbmd0aCAtIDFdLCBmMiA9IFtdOwogICAgICAgIGZvciAobjIgPSBvMi5sZW5ndGggLSAxOyBuMiA+PSAwOyAtLW4yKQogICAgICAgICAgZjIucHVzaCh0MltyMltvMltuMl1dWzJdXSk7CiAgICAgICAgZm9yIChuMiA9ICt1MjsgbjIgPCBhMi5sZW5ndGggLSBjMjsgKytuMikKICAgICAgICAgIGYyLnB1c2godDJbcjJbYTJbbjJdXVsyXV0pOwogICAgICAgIHJldHVybiBmMjsKICAgICAgfSwgdC5wb2x5Z29uTGVuZ3RoID0gZnVuY3Rpb24odDIpIHsKICAgICAgICBmb3IgKHZhciBuMiwgZTIsIHIyID0gLTEsIGkyID0gdDIubGVuZ3RoLCBvMiA9IHQyW2kyIC0gMV0sIGEyID0gbzJbMF0sIHUyID0gbzJbMV0sIGMyID0gMDsgKytyMiA8IGkyOyApCiAgICAgICAgICBuMiA9IGEyLCBlMiA9IHUyLCBuMiAtPSBhMiA9IChvMiA9IHQyW3IyXSlbMF0sIGUyIC09IHUyID0gbzJbMV0sIGMyICs9IE1hdGguaHlwb3QobjIsIGUyKTsKICAgICAgICByZXR1cm4gYzI7CiAgICAgIH0sIHQucHJlY2lzaW9uRml4ZWQgPSBzZiwgdC5wcmVjaXNpb25QcmVmaXggPSBsZiwgdC5wcmVjaXNpb25Sb3VuZCA9IGhmLCB0LnF1YWR0cmVlID0gJGMsIHQucXVhbnRpbGUgPSBhdCwgdC5xdWFudGlsZUluZGV4ID0gY3QsIHQucXVhbnRpbGVTb3J0ZWQgPSB1dCwgdC5xdWFudGl6ZSA9IGZ1bmN0aW9uKHQyLCBuMikgewogICAgICAgIGZvciAodmFyIGUyID0gbmV3IEFycmF5KG4yKSwgcjIgPSAwOyByMiA8IG4yOyArK3IyKQogICAgICAgICAgZTJbcjJdID0gdDIocjIgLyAobjIgLSAxKSk7CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9LCB0LnF1aWNrc2VsZWN0ID0gcnQsIHQucmFkaWFsQXJlYSA9IFptLCB0LnJhZGlhbExpbmUgPSBXbSwgdC5yYW5kb21CYXRlcyA9IEpwLCB0LnJhbmRvbUJlcm5vdWxsaSA9IGVnLCB0LnJhbmRvbUJldGEgPSBvZywgdC5yYW5kb21CaW5vbWlhbCA9IGFnLCB0LnJhbmRvbUNhdWNoeSA9IGNnLCB0LnJhbmRvbUV4cG9uZW50aWFsID0gdGcsIHQucmFuZG9tR2FtbWEgPSBpZywgdC5yYW5kb21HZW9tZXRyaWMgPSByZywgdC5yYW5kb21JbnQgPSBXcCwgdC5yYW5kb21JcndpbkhhbGwgPSBRcCwgdC5yYW5kb21MY2cgPSBmdW5jdGlvbih0MiA9IE1hdGgucmFuZG9tKCkpIHsKICAgICAgICBsZXQgbjIgPSAwIHwgKDAgPD0gdDIgJiYgdDIgPCAxID8gdDIgLyBsZyA6IE1hdGguYWJzKHQyKSk7CiAgICAgICAgcmV0dXJuICgpID0+IChuMiA9IDE2NjQ1MjUgKiBuMiArIDEwMTM5MDQyMjMgfCAwLCBsZyAqIChuMiA+Pj4gMCkpOwogICAgICB9LCB0LnJhbmRvbUxvZ05vcm1hbCA9IEtwLCB0LnJhbmRvbUxvZ2lzdGljID0gZmcsIHQucmFuZG9tTm9ybWFsID0gWnAsIHQucmFuZG9tUGFyZXRvID0gbmcsIHQucmFuZG9tUG9pc3NvbiA9IHNnLCB0LnJhbmRvbVVuaWZvcm0gPSBWcCwgdC5yYW5kb21XZWlidWxsID0gdWcsIHQucmFuZ2UgPSBsdCwgdC5yYW5rID0gZnVuY3Rpb24odDIsIGUyID0gbikgewogICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiB0MltTeW1ib2wuaXRlcmF0b3JdKQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigidmFsdWVzIGlzIG5vdCBpdGVyYWJsZSIpOwogICAgICAgIGxldCByMiA9IEFycmF5LmZyb20odDIpOwogICAgICAgIGNvbnN0IGkyID0gbmV3IEZsb2F0NjRBcnJheShyMi5sZW5ndGgpOwogICAgICAgIDIgIT09IGUyLmxlbmd0aCAmJiAocjIgPSByMi5tYXAoZTIpLCBlMiA9IG4pOwogICAgICAgIGNvbnN0IG8yID0gKHQzLCBuMikgPT4gZTIocjJbdDNdLCByMltuMl0pOwogICAgICAgIGxldCBhMiwgdTI7CiAgICAgICAgcmV0dXJuICh0MiA9IFVpbnQzMkFycmF5LmZyb20ocjIsICh0MywgbjIpID0+IG4yKSkuc29ydChlMiA9PT0gbiA/ICh0MywgbjIpID0+IE8ocjJbdDNdLCByMltuMl0pIDogSShvMikpLCB0Mi5mb3JFYWNoKCh0MywgbjIpID0+IHsKICAgICAgICAgIGNvbnN0IGUzID0gbzIodDMsIHZvaWQgMCA9PT0gYTIgPyB0MyA6IGEyKTsKICAgICAgICAgIGUzID49IDAgPyAoKHZvaWQgMCA9PT0gYTIgfHwgZTMgPiAwKSAmJiAoYTIgPSB0MywgdTIgPSBuMiksIGkyW3QzXSA9IHUyKSA6IGkyW3QzXSA9IE5hTjsKICAgICAgICB9KSwgaTI7CiAgICAgIH0sIHQucmVkdWNlID0gZnVuY3Rpb24odDIsIG4yLCBlMikgewogICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBuMikKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInJlZHVjZXIgaXMgbm90IGEgZnVuY3Rpb24iKTsKICAgICAgICBjb25zdCByMiA9IHQyW1N5bWJvbC5pdGVyYXRvcl0oKTsKICAgICAgICBsZXQgaTIsIG8yLCBhMiA9IC0xOwogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykgewogICAgICAgICAgaWYgKHsgZG9uZTogaTIsIHZhbHVlOiBlMiB9ID0gcjIubmV4dCgpLCBpMikKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgKythMjsKICAgICAgICB9CiAgICAgICAgZm9yICg7IHsgZG9uZTogaTIsIHZhbHVlOiBvMiB9ID0gcjIubmV4dCgpLCAhaTI7ICkKICAgICAgICAgIGUyID0gbjIoZTIsIG8yLCArK2EyLCB0Mik7CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9LCB0LnJldmVyc2UgPSBmdW5jdGlvbih0MikgewogICAgICAgIGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiB0MltTeW1ib2wuaXRlcmF0b3JdKQogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigidmFsdWVzIGlzIG5vdCBpdGVyYWJsZSIpOwogICAgICAgIHJldHVybiBBcnJheS5mcm9tKHQyKS5yZXZlcnNlKCk7CiAgICAgIH0sIHQucmdiID0gRmUsIHQucmliYm9uID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIFdhKCk7CiAgICAgIH0sIHQucmliYm9uQXJyb3cgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gV2EoVmEpOwogICAgICB9LCB0LnJvbGx1cCA9ICQsIHQucm9sbHVwcyA9IEQsIHQuc2NhbGVCYW5kID0geWcsIHQuc2NhbGVEaXZlcmdpbmcgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICB2YXIgbjIgPSBOZyhMXygpKG1nKSk7CiAgICAgICAgcmV0dXJuIG4yLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBCXyhuMiwgdDIoKSk7CiAgICAgICAgfSwgZGcuYXBwbHkobjIsIGFyZ3VtZW50cyk7CiAgICAgIH0sIHQuc2NhbGVEaXZlcmdpbmdMb2cgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICB2YXIgbjIgPSBGZyhMXygpKS5kb21haW4oWzAuMSwgMSwgMTBdKTsKICAgICAgICByZXR1cm4gbjIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIEJfKG4yLCB0MigpKS5iYXNlKG4yLmJhc2UoKSk7CiAgICAgICAgfSwgZGcuYXBwbHkobjIsIGFyZ3VtZW50cyk7CiAgICAgIH0sIHQuc2NhbGVEaXZlcmdpbmdQb3cgPSBqXywgdC5zY2FsZURpdmVyZ2luZ1NxcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gal8uYXBwbHkobnVsbCwgYXJndW1lbnRzKS5leHBvbmVudCgwLjUpOwogICAgICB9LCB0LnNjYWxlRGl2ZXJnaW5nU3ltbG9nID0gZnVuY3Rpb24gdDIoKSB7CiAgICAgICAgdmFyIG4yID0gSWcoTF8oKSk7CiAgICAgICAgcmV0dXJuIG4yLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBCXyhuMiwgdDIoKSkuY29uc3RhbnQobjIuY29uc3RhbnQoKSk7CiAgICAgICAgfSwgZGcuYXBwbHkobjIsIGFyZ3VtZW50cyk7CiAgICAgIH0sIHQuc2NhbGVJZGVudGl0eSA9IGZ1bmN0aW9uIHQyKG4yKSB7CiAgICAgICAgdmFyIGUyOwogICAgICAgIGZ1bmN0aW9uIHIyKHQzKSB7CiAgICAgICAgICByZXR1cm4gbnVsbCA9PSB0MyB8fCBpc05hTih0MyA9ICt0MykgPyBlMiA6IHQzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcjIuaW52ZXJ0ID0gcjIsIHIyLmRvbWFpbiA9IHIyLnJhbmdlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gQXJyYXkuZnJvbSh0MywgX2cpLCByMikgOiBuMi5zbGljZSgpOwogICAgICAgIH0sIHIyLnVua25vd24gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZTIgPSB0MywgcjIpIDogZTI7CiAgICAgICAgfSwgcjIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHQyKG4yKS51bmtub3duKGUyKTsKICAgICAgICB9LCBuMiA9IGFyZ3VtZW50cy5sZW5ndGggPyBBcnJheS5mcm9tKG4yLCBfZykgOiBbMCwgMV0sIE5nKHIyKTsKICAgICAgfSwgdC5zY2FsZUltcGxpY2l0ID0gcGcsIHQuc2NhbGVMaW5lYXIgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICB2YXIgbjIgPSBTZygpOwogICAgICAgIHJldHVybiBuMi5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gVGcobjIsIHQyKCkpOwogICAgICAgIH0sIGhnLmFwcGx5KG4yLCBhcmd1bWVudHMpLCBOZyhuMik7CiAgICAgIH0sIHQuc2NhbGVMb2cgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICBjb25zdCBuMiA9IEZnKEFnKCkpLmRvbWFpbihbMSwgMTBdKTsKICAgICAgICByZXR1cm4gbjIuY29weSA9ICgpID0+IFRnKG4yLCB0MigpKS5iYXNlKG4yLmJhc2UoKSksIGhnLmFwcGx5KG4yLCBhcmd1bWVudHMpLCBuMjsKICAgICAgfSwgdC5zY2FsZU9yZGluYWwgPSBnZywgdC5zY2FsZVBvaW50ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHZnKHlnLmFwcGx5KG51bGwsIGFyZ3VtZW50cykucGFkZGluZ0lubmVyKDEpKTsKICAgICAgfSwgdC5zY2FsZVBvdyA9IGpnLCB0LnNjYWxlUXVhbnRpbGUgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICB2YXIgZTIsIHIyID0gW10sIGkyID0gW10sIG8yID0gW107CiAgICAgICAgZnVuY3Rpb24gYTIoKSB7CiAgICAgICAgICB2YXIgdDMgPSAwLCBuMiA9IE1hdGgubWF4KDEsIGkyLmxlbmd0aCk7CiAgICAgICAgICBmb3IgKG8yID0gbmV3IEFycmF5KG4yIC0gMSk7ICsrdDMgPCBuMjsgKQogICAgICAgICAgICBvMlt0MyAtIDFdID0gdXQocjIsIHQzIC8gbjIpOwogICAgICAgICAgcmV0dXJuIHUyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1Mih0MykgewogICAgICAgICAgcmV0dXJuIG51bGwgPT0gdDMgfHwgaXNOYU4odDMgPSArdDMpID8gZTIgOiBpMltzKG8yLCB0MyldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdTIuaW52ZXJ0RXh0ZW50ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHZhciBuMiA9IGkyLmluZGV4T2YodDMpOwogICAgICAgICAgcmV0dXJuIG4yIDwgMCA/IFtOYU4sIE5hTl0gOiBbbjIgPiAwID8gbzJbbjIgLSAxXSA6IHIyWzBdLCBuMiA8IG8yLmxlbmd0aCA/IG8yW24yXSA6IHIyW3IyLmxlbmd0aCAtIDFdXTsKICAgICAgICB9LCB1Mi5kb21haW4gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKQogICAgICAgICAgICByZXR1cm4gcjIuc2xpY2UoKTsKICAgICAgICAgIHIyID0gW107CiAgICAgICAgICBmb3IgKGxldCBuMiBvZiB0MykKICAgICAgICAgICAgbnVsbCA9PSBuMiB8fCBpc05hTihuMiA9ICtuMikgfHwgcjIucHVzaChuMik7CiAgICAgICAgICByZXR1cm4gcjIuc29ydChuKSwgYTIoKTsKICAgICAgICB9LCB1Mi5yYW5nZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9IEFycmF5LmZyb20odDMpLCBhMigpKSA6IGkyLnNsaWNlKCk7CiAgICAgICAgfSwgdTIudW5rbm93biA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9IHQzLCB1MikgOiBlMjsKICAgICAgICB9LCB1Mi5xdWFudGlsZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBvMi5zbGljZSgpOwogICAgICAgIH0sIHUyLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0MigpLmRvbWFpbihyMikucmFuZ2UoaTIpLnVua25vd24oZTIpOwogICAgICAgIH0sIGhnLmFwcGx5KHUyLCBhcmd1bWVudHMpOwogICAgICB9LCB0LnNjYWxlUXVhbnRpemUgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICB2YXIgbjIsIGUyID0gMCwgcjIgPSAxLCBpMiA9IDEsIG8yID0gWzAuNV0sIGEyID0gWzAsIDFdOwogICAgICAgIGZ1bmN0aW9uIHUyKHQzKSB7CiAgICAgICAgICByZXR1cm4gbnVsbCAhPSB0MyAmJiB0MyA8PSB0MyA/IGEyW3MobzIsIHQzLCAwLCBpMildIDogbjI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGMyKCkgewogICAgICAgICAgdmFyIHQzID0gLTE7CiAgICAgICAgICBmb3IgKG8yID0gbmV3IEFycmF5KGkyKTsgKyt0MyA8IGkyOyApCiAgICAgICAgICAgIG8yW3QzXSA9ICgodDMgKyAxKSAqIHIyIC0gKHQzIC0gaTIpICogZTIpIC8gKGkyICsgMSk7CiAgICAgICAgICByZXR1cm4gdTI7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1Mi5kb21haW4gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoW2UyLCByMl0gPSB0MywgZTIgPSArZTIsIHIyID0gK3IyLCBjMigpKSA6IFtlMiwgcjJdOwogICAgICAgIH0sIHUyLnJhbmdlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGkyID0gKGEyID0gQXJyYXkuZnJvbSh0MykpLmxlbmd0aCAtIDEsIGMyKCkpIDogYTIuc2xpY2UoKTsKICAgICAgICB9LCB1Mi5pbnZlcnRFeHRlbnQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgdmFyIG4zID0gYTIuaW5kZXhPZih0Myk7CiAgICAgICAgICByZXR1cm4gbjMgPCAwID8gW05hTiwgTmFOXSA6IG4zIDwgMSA/IFtlMiwgbzJbMF1dIDogbjMgPj0gaTIgPyBbbzJbaTIgLSAxXSwgcjJdIDogW28yW24zIC0gMV0sIG8yW24zXV07CiAgICAgICAgfSwgdTIudW5rbm93biA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChuMiA9IHQzLCB1MikgOiB1MjsKICAgICAgICB9LCB1Mi50aHJlc2hvbGRzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gbzIuc2xpY2UoKTsKICAgICAgICB9LCB1Mi5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdDIoKS5kb21haW4oW2UyLCByMl0pLnJhbmdlKGEyKS51bmtub3duKG4yKTsKICAgICAgICB9LCBoZy5hcHBseShOZyh1MiksIGFyZ3VtZW50cyk7CiAgICAgIH0sIHQuc2NhbGVSYWRpYWwgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICB2YXIgbjIsIGUyID0gU2coKSwgcjIgPSBbMCwgMV0sIGkyID0gZmFsc2U7CiAgICAgICAgZnVuY3Rpb24gbzIodDMpIHsKICAgICAgICAgIHZhciByMyA9IGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnNpZ24odDQpICogTWF0aC5zcXJ0KE1hdGguYWJzKHQ0KSk7CiAgICAgICAgICB9KGUyKHQzKSk7CiAgICAgICAgICByZXR1cm4gaXNOYU4ocjMpID8gbjIgOiBpMiA/IE1hdGgucm91bmQocjMpIDogcjM7CiAgICAgICAgfQogICAgICAgIHJldHVybiBvMi5pbnZlcnQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGUyLmludmVydChIZyh0MykpOwogICAgICAgIH0sIG8yLmRvbWFpbiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMi5kb21haW4odDMpLCBvMikgOiBlMi5kb21haW4oKTsKICAgICAgICB9LCBvMi5yYW5nZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMi5yYW5nZSgocjIgPSBBcnJheS5mcm9tKHQzLCBfZykpLm1hcChIZykpLCBvMikgOiByMi5zbGljZSgpOwogICAgICAgIH0sIG8yLnJhbmdlUm91bmQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIG8yLnJhbmdlKHQzKS5yb3VuZCh0cnVlKTsKICAgICAgICB9LCBvMi5yb3VuZCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICEhdDMsIG8yKSA6IGkyOwogICAgICAgIH0sIG8yLmNsYW1wID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGUyLmNsYW1wKHQzKSwgbzIpIDogZTIuY2xhbXAoKTsKICAgICAgICB9LCBvMi51bmtub3duID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gdDMsIG8yKSA6IG4yOwogICAgICAgIH0sIG8yLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0MihlMi5kb21haW4oKSwgcjIpLnJvdW5kKGkyKS5jbGFtcChlMi5jbGFtcCgpKS51bmtub3duKG4yKTsKICAgICAgICB9LCBoZy5hcHBseShvMiwgYXJndW1lbnRzKSwgTmcobzIpOwogICAgICB9LCB0LnNjYWxlU2VxdWVudGlhbCA9IGZ1bmN0aW9uIHQyKCkgewogICAgICAgIHZhciBuMiA9IE5nKE9fKCkobWcpKTsKICAgICAgICByZXR1cm4gbjIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIEJfKG4yLCB0MigpKTsKICAgICAgICB9LCBkZy5hcHBseShuMiwgYXJndW1lbnRzKTsKICAgICAgfSwgdC5zY2FsZVNlcXVlbnRpYWxMb2cgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICB2YXIgbjIgPSBGZyhPXygpKS5kb21haW4oWzEsIDEwXSk7CiAgICAgICAgcmV0dXJuIG4yLmNvcHkgPSBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiBCXyhuMiwgdDIoKSkuYmFzZShuMi5iYXNlKCkpOwogICAgICAgIH0sIGRnLmFwcGx5KG4yLCBhcmd1bWVudHMpOwogICAgICB9LCB0LnNjYWxlU2VxdWVudGlhbFBvdyA9IFlfLCB0LnNjYWxlU2VxdWVudGlhbFF1YW50aWxlID0gZnVuY3Rpb24gdDIoKSB7CiAgICAgICAgdmFyIGUyID0gW10sIHIyID0gbWc7CiAgICAgICAgZnVuY3Rpb24gaTIodDMpIHsKICAgICAgICAgIGlmIChudWxsICE9IHQzICYmICFpc05hTih0MyA9ICt0MykpCiAgICAgICAgICAgIHJldHVybiByMigocyhlMiwgdDMsIDEpIC0gMSkgLyAoZTIubGVuZ3RoIC0gMSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuZG9tYWluID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkKICAgICAgICAgICAgcmV0dXJuIGUyLnNsaWNlKCk7CiAgICAgICAgICBlMiA9IFtdOwogICAgICAgICAgZm9yIChsZXQgbjIgb2YgdDMpCiAgICAgICAgICAgIG51bGwgPT0gbjIgfHwgaXNOYU4objIgPSArbjIpIHx8IGUyLnB1c2gobjIpOwogICAgICAgICAgcmV0dXJuIGUyLnNvcnQobiksIGkyOwogICAgICAgIH0sIGkyLmludGVycG9sYXRvciA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyMiA9IHQzLCBpMikgOiByMjsKICAgICAgICB9LCBpMi5yYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIGUyLm1hcCgodDMsIG4yKSA9PiByMihuMiAvIChlMi5sZW5ndGggLSAxKSkpOwogICAgICAgIH0sIGkyLnF1YW50aWxlcyA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogdDMgKyAxIH0sIChuMiwgcjMpID0+IGF0KGUyLCByMyAvIHQzKSk7CiAgICAgICAgfSwgaTIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHQyKHIyKS5kb21haW4oZTIpOwogICAgICAgIH0sIGRnLmFwcGx5KGkyLCBhcmd1bWVudHMpOwogICAgICB9LCB0LnNjYWxlU2VxdWVudGlhbFNxcnQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gWV8uYXBwbHkobnVsbCwgYXJndW1lbnRzKS5leHBvbmVudCgwLjUpOwogICAgICB9LCB0LnNjYWxlU2VxdWVudGlhbFN5bWxvZyA9IGZ1bmN0aW9uIHQyKCkgewogICAgICAgIHZhciBuMiA9IElnKE9fKCkpOwogICAgICAgIHJldHVybiBuMi5jb3B5ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gQl8objIsIHQyKCkpLmNvbnN0YW50KG4yLmNvbnN0YW50KCkpOwogICAgICAgIH0sIGRnLmFwcGx5KG4yLCBhcmd1bWVudHMpOwogICAgICB9LCB0LnNjYWxlU3FydCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBqZy5hcHBseShudWxsLCBhcmd1bWVudHMpLmV4cG9uZW50KDAuNSk7CiAgICAgIH0sIHQuc2NhbGVTeW1sb2cgPSBmdW5jdGlvbiB0MigpIHsKICAgICAgICB2YXIgbjIgPSBJZyhBZygpKTsKICAgICAgICByZXR1cm4gbjIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIFRnKG4yLCB0MigpKS5jb25zdGFudChuMi5jb25zdGFudCgpKTsKICAgICAgICB9LCBoZy5hcHBseShuMiwgYXJndW1lbnRzKTsKICAgICAgfSwgdC5zY2FsZVRocmVzaG9sZCA9IGZ1bmN0aW9uIHQyKCkgewogICAgICAgIHZhciBuMiwgZTIgPSBbMC41XSwgcjIgPSBbMCwgMV0sIGkyID0gMTsKICAgICAgICBmdW5jdGlvbiBvMih0MykgewogICAgICAgICAgcmV0dXJuIG51bGwgIT0gdDMgJiYgdDMgPD0gdDMgPyByMltzKGUyLCB0MywgMCwgaTIpXSA6IG4yOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbzIuZG9tYWluID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGUyID0gQXJyYXkuZnJvbSh0MyksIGkyID0gTWF0aC5taW4oZTIubGVuZ3RoLCByMi5sZW5ndGggLSAxKSwgbzIpIDogZTIuc2xpY2UoKTsKICAgICAgICB9LCBvMi5yYW5nZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChyMiA9IEFycmF5LmZyb20odDMpLCBpMiA9IE1hdGgubWluKGUyLmxlbmd0aCwgcjIubGVuZ3RoIC0gMSksIG8yKSA6IHIyLnNsaWNlKCk7CiAgICAgICAgfSwgbzIuaW52ZXJ0RXh0ZW50ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHZhciBuMyA9IHIyLmluZGV4T2YodDMpOwogICAgICAgICAgcmV0dXJuIFtlMltuMyAtIDFdLCBlMltuM11dOwogICAgICAgIH0sIG8yLnVua25vd24gPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobjIgPSB0MywgbzIpIDogbjI7CiAgICAgICAgfSwgbzIuY29weSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHQyKCkuZG9tYWluKGUyKS5yYW5nZShyMikudW5rbm93bihuMik7CiAgICAgICAgfSwgaGcuYXBwbHkobzIsIGFyZ3VtZW50cyk7CiAgICAgIH0sIHQuc2NhbGVUaW1lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGhnLmFwcGx5KElfKHV2LCBjdiwgdHYsIFp5LCB4eSwgcHksIHN5LCBheSwgaXksIHQudGltZUZvcm1hdCkuZG9tYWluKFtuZXcgRGF0ZSgyZTMsIDAsIDEpLCBuZXcgRGF0ZSgyZTMsIDAsIDIpXSksIGFyZ3VtZW50cyk7CiAgICAgIH0sIHQuc2NhbGVVdGMgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gaGcuYXBwbHkoSV8ob3YsIGF2LCBldiwgUXksIEZ5LCB5eSwgaHksIGN5LCBpeSwgdC51dGNGb3JtYXQpLmRvbWFpbihbRGF0ZS5VVEMoMmUzLCAwLCAxKSwgRGF0ZS5VVEMoMmUzLCAwLCAyKV0pLCBhcmd1bWVudHMpOwogICAgICB9LCB0LnNjYW4gPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBjb25zdCBlMiA9IGh0KHQyLCBuMik7CiAgICAgICAgcmV0dXJuIGUyIDwgMCA/IHZvaWQgMCA6IGUyOwogICAgICB9LCB0LnNjaGVtZUFjY2VudCA9IEdfLCB0LnNjaGVtZUJsdWVzID0gSGIsIHQuc2NoZW1lQnJCRyA9IHJiLCB0LnNjaGVtZUJ1R24gPSB4YiwgdC5zY2hlbWVCdVB1ID0gTWIsIHQuc2NoZW1lQ2F0ZWdvcnkxMCA9IFhfLCB0LnNjaGVtZURhcmsyID0gVl8sIHQuc2NoZW1lR25CdSA9IEFiLCB0LnNjaGVtZUdyZWVucyA9IEdiLCB0LnNjaGVtZUdyZXlzID0gV2IsIHQuc2NoZW1lT3JSZCA9IEViLCB0LnNjaGVtZU9yYW5nZXMgPSBubSwgdC5zY2hlbWVQUkduID0gb2IsIHQuc2NoZW1lUGFpcmVkID0gV18sIHQuc2NoZW1lUGFzdGVsMSA9IFpfLCB0LnNjaGVtZVBhc3RlbDIgPSBLXywgdC5zY2hlbWVQaVlHID0gdWIsIHQuc2NoZW1lUHVCdSA9IFBiLCB0LnNjaGVtZVB1QnVHbiA9IGtiLCB0LnNjaGVtZVB1T3IgPSBmYiwgdC5zY2hlbWVQdVJkID0gJGIsIHQuc2NoZW1lUHVycGxlcyA9IEtiLCB0LnNjaGVtZVJkQnUgPSBsYiwgdC5zY2hlbWVSZEd5ID0gZGIsIHQuc2NoZW1lUmRQdSA9IFJiLCB0LnNjaGVtZVJkWWxCdSA9IGdiLCB0LnNjaGVtZVJkWWxHbiA9IHZiLCB0LnNjaGVtZVJlZHMgPSBKYiwgdC5zY2hlbWVTZXQxID0gUV8sIHQuc2NoZW1lU2V0MiA9IEpfLCB0LnNjaGVtZVNldDMgPSB0YiwgdC5zY2hlbWVTcGVjdHJhbCA9IGJiLCB0LnNjaGVtZVRhYmxlYXUxMCA9IG5iLCB0LnNjaGVtZVlsR24gPSBJYiwgdC5zY2hlbWVZbEduQnUgPSBxYiwgdC5zY2hlbWVZbE9yQnIgPSBCYiwgdC5zY2hlbWVZbE9yUmQgPSBMYiwgdC5zZWxlY3QgPSBabiwgdC5zZWxlY3RBbGwgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiAic3RyaW5nIiA9PSB0eXBlb2YgdDIgPyBuZXcgVm4oW2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodDIpXSwgW2RvY3VtZW50LmRvY3VtZW50RWxlbWVudF0pIDogbmV3IFZuKFtIdCh0MildLCBHbik7CiAgICAgIH0sIHQuc2VsZWN0aW9uID0gV24sIHQuc2VsZWN0b3IgPSBqdCwgdC5zZWxlY3RvckFsbCA9IEd0LCB0LnNodWZmbGUgPSBkdCwgdC5zaHVmZmxlciA9IHB0LCB0LnNvbWUgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBpZiAoImZ1bmN0aW9uIiAhPSB0eXBlb2YgbjIpCiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJ0ZXN0IGlzIG5vdCBhIGZ1bmN0aW9uIik7CiAgICAgICAgbGV0IGUyID0gLTE7CiAgICAgICAgZm9yIChjb25zdCByMiBvZiB0MikKICAgICAgICAgIGlmIChuMihyMiwgKytlMiwgdDIpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sIHQuc29ydCA9IFUsIHQuc3RhY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBnbShbXSksIG4yID0gaHcsIGUyID0gbHcsIHIyID0gZHc7CiAgICAgICAgZnVuY3Rpb24gaTIoaTMpIHsKICAgICAgICAgIHZhciBvMiwgYTIsIHUyID0gQXJyYXkuZnJvbSh0Mi5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBwdyksIGMyID0gdTIubGVuZ3RoLCBmMiA9IC0xOwogICAgICAgICAgZm9yIChjb25zdCB0MyBvZiBpMykKICAgICAgICAgICAgZm9yIChvMiA9IDAsICsrZjI7IG8yIDwgYzI7ICsrbzIpCiAgICAgICAgICAgICAgKHUyW28yXVtmMl0gPSBbMCwgK3IyKHQzLCB1MltvMl0ua2V5LCBmMiwgaTMpXSkuZGF0YSA9IHQzOwogICAgICAgICAgZm9yIChvMiA9IDAsIGEyID0gRm0objIodTIpKTsgbzIgPCBjMjsgKytvMikKICAgICAgICAgICAgdTJbYTJbbzJdXS5pbmRleCA9IG8yOwogICAgICAgICAgcmV0dXJuIGUyKHUyLCBhMiksIHUyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIua2V5cyA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIG4zID8gbjMgOiBnbShBcnJheS5mcm9tKG4zKSksIGkyKSA6IHQyOwogICAgICAgIH0sIGkyLnZhbHVlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGdtKCt0MyksIGkyKSA6IHIyOwogICAgICAgIH0sIGkyLm9yZGVyID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gbnVsbCA9PSB0MyA/IGh3IDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGdtKEFycmF5LmZyb20odDMpKSwgaTIpIDogbjI7CiAgICAgICAgfSwgaTIub2Zmc2V0ID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGUyID0gbnVsbCA9PSB0MyA/IGx3IDogdDMsIGkyKSA6IGUyOwogICAgICAgIH0sIGkyOwogICAgICB9LCB0LnN0YWNrT2Zmc2V0RGl2ZXJnaW5nID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgaWYgKCh1MiA9IHQyLmxlbmd0aCkgPiAwKQogICAgICAgICAgZm9yICh2YXIgZTIsIHIyLCBpMiwgbzIsIGEyLCB1MiwgYzIgPSAwLCBmMiA9IHQyW24yWzBdXS5sZW5ndGg7IGMyIDwgZjI7ICsrYzIpCiAgICAgICAgICAgIGZvciAobzIgPSBhMiA9IDAsIGUyID0gMDsgZTIgPCB1MjsgKytlMikKICAgICAgICAgICAgICAoaTIgPSAocjIgPSB0MltuMltlMl1dW2MyXSlbMV0gLSByMlswXSkgPiAwID8gKHIyWzBdID0gbzIsIHIyWzFdID0gbzIgKz0gaTIpIDogaTIgPCAwID8gKHIyWzFdID0gYTIsIHIyWzBdID0gYTIgKz0gaTIpIDogKHIyWzBdID0gMCwgcjJbMV0gPSBpMik7CiAgICAgIH0sIHQuc3RhY2tPZmZzZXRFeHBhbmQgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBpZiAoKHIyID0gdDIubGVuZ3RoKSA+IDApIHsKICAgICAgICAgIGZvciAodmFyIGUyLCByMiwgaTIsIG8yID0gMCwgYTIgPSB0MlswXS5sZW5ndGg7IG8yIDwgYTI7ICsrbzIpIHsKICAgICAgICAgICAgZm9yIChpMiA9IGUyID0gMDsgZTIgPCByMjsgKytlMikKICAgICAgICAgICAgICBpMiArPSB0MltlMl1bbzJdWzFdIHx8IDA7CiAgICAgICAgICAgIGlmIChpMikKICAgICAgICAgICAgICBmb3IgKGUyID0gMDsgZTIgPCByMjsgKytlMikKICAgICAgICAgICAgICAgIHQyW2UyXVtvMl1bMV0gLz0gaTI7CiAgICAgICAgICB9CiAgICAgICAgICBsdyh0MiwgbjIpOwogICAgICAgIH0KICAgICAgfSwgdC5zdGFja09mZnNldE5vbmUgPSBsdywgdC5zdGFja09mZnNldFNpbGhvdWV0dGUgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBpZiAoKGUyID0gdDIubGVuZ3RoKSA+IDApIHsKICAgICAgICAgIGZvciAodmFyIGUyLCByMiA9IDAsIGkyID0gdDJbbjJbMF1dLCBvMiA9IGkyLmxlbmd0aDsgcjIgPCBvMjsgKytyMikgewogICAgICAgICAgICBmb3IgKHZhciBhMiA9IDAsIHUyID0gMDsgYTIgPCBlMjsgKythMikKICAgICAgICAgICAgICB1MiArPSB0MlthMl1bcjJdWzFdIHx8IDA7CiAgICAgICAgICAgIGkyW3IyXVsxXSArPSBpMltyMl1bMF0gPSAtdTIgLyAyOwogICAgICAgICAgfQogICAgICAgICAgbHcodDIsIG4yKTsKICAgICAgICB9CiAgICAgIH0sIHQuc3RhY2tPZmZzZXRXaWdnbGUgPSBmdW5jdGlvbih0MiwgbjIpIHsKICAgICAgICBpZiAoKGkyID0gdDIubGVuZ3RoKSA+IDAgJiYgKHIyID0gKGUyID0gdDJbbjJbMF1dKS5sZW5ndGgpID4gMCkgewogICAgICAgICAgZm9yICh2YXIgZTIsIHIyLCBpMiwgbzIgPSAwLCBhMiA9IDE7IGEyIDwgcjI7ICsrYTIpIHsKICAgICAgICAgICAgZm9yICh2YXIgdTIgPSAwLCBjMiA9IDAsIGYyID0gMDsgdTIgPCBpMjsgKyt1MikgewogICAgICAgICAgICAgIGZvciAodmFyIHMyID0gdDJbbjJbdTJdXSwgbDIgPSBzMlthMl1bMV0gfHwgMCwgaDIgPSAobDIgLSAoczJbYTIgLSAxXVsxXSB8fCAwKSkgLyAyLCBkMiA9IDA7IGQyIDwgdTI7ICsrZDIpIHsKICAgICAgICAgICAgICAgIHZhciBwMiA9IHQyW24yW2QyXV07CiAgICAgICAgICAgICAgICBoMiArPSAocDJbYTJdWzFdIHx8IDApIC0gKHAyW2EyIC0gMV1bMV0gfHwgMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGMyICs9IGwyLCBmMiArPSBoMiAqIGwyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUyW2EyIC0gMV1bMV0gKz0gZTJbYTIgLSAxXVswXSA9IG8yLCBjMiAmJiAobzIgLT0gZjIgLyBjMik7CiAgICAgICAgICB9CiAgICAgICAgICBlMlthMiAtIDFdWzFdICs9IGUyW2EyIC0gMV1bMF0gPSBvMiwgbHcodDIsIG4yKTsKICAgICAgICB9CiAgICAgIH0sIHQuc3RhY2tPcmRlckFwcGVhcmFuY2UgPSBndywgdC5zdGFja09yZGVyQXNjZW5kaW5nID0gdncsIHQuc3RhY2tPcmRlckRlc2NlbmRpbmcgPSBmdW5jdGlvbih0MikgewogICAgICAgIHJldHVybiB2dyh0MikucmV2ZXJzZSgpOwogICAgICB9LCB0LnN0YWNrT3JkZXJJbnNpZGVPdXQgPSBmdW5jdGlvbih0MikgewogICAgICAgIHZhciBuMiwgZTIsIHIyID0gdDIubGVuZ3RoLCBpMiA9IHQyLm1hcChfdyksIG8yID0gZ3codDIpLCBhMiA9IDAsIHUyID0gMCwgYzIgPSBbXSwgZjIgPSBbXTsKICAgICAgICBmb3IgKG4yID0gMDsgbjIgPCByMjsgKytuMikKICAgICAgICAgIGUyID0gbzJbbjJdLCBhMiA8IHUyID8gKGEyICs9IGkyW2UyXSwgYzIucHVzaChlMikpIDogKHUyICs9IGkyW2UyXSwgZjIucHVzaChlMikpOwogICAgICAgIHJldHVybiBmMi5yZXZlcnNlKCkuY29uY2F0KGMyKTsKICAgICAgfSwgdC5zdGFja09yZGVyTm9uZSA9IGh3LCB0LnN0YWNrT3JkZXJSZXZlcnNlID0gZnVuY3Rpb24odDIpIHsKICAgICAgICByZXR1cm4gaHcodDIpLnJldmVyc2UoKTsKICAgICAgfSwgdC5zdHJhdGlmeSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0MiwgbjIgPSBrcCwgZTIgPSBDcDsKICAgICAgICBmdW5jdGlvbiByMihyMykgewogICAgICAgICAgdmFyIGkyLCBvMiwgYTIsIHUyLCBjMiwgZjIsIHMyLCBsMiwgaDIgPSBBcnJheS5mcm9tKHIzKSwgZDIgPSBuMiwgcDIgPSBlMiwgZzIgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICAgICAgaWYgKG51bGwgIT0gdDIpIHsKICAgICAgICAgICAgY29uc3QgbjMgPSBoMi5tYXAoKG40LCBlNCkgPT4gZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICB0MyA9IGAke3QzfWA7CiAgICAgICAgICAgICAgbGV0IG41ID0gdDMubGVuZ3RoOwogICAgICAgICAgICAgIHpwKHQzLCBuNSAtIDEpICYmICF6cCh0MywgbjUgLSAyKSAmJiAodDMgPSB0My5zbGljZSgwLCAtMSkpOwogICAgICAgICAgICAgIHJldHVybiAiLyIgPT09IHQzWzBdID8gdDMgOiBgLyR7dDN9YDsKICAgICAgICAgICAgfSh0MihuNCwgZTQsIHIzKSkpLCBlMyA9IG4zLm1hcChQcCksIGkzID0gbmV3IFNldChuMykuYWRkKCIiKTsKICAgICAgICAgICAgZm9yIChjb25zdCB0MyBvZiBlMykKICAgICAgICAgICAgICBpMy5oYXModDMpIHx8IChpMy5hZGQodDMpLCBuMy5wdXNoKHQzKSwgZTMucHVzaChQcCh0MykpLCBoMi5wdXNoKE5wKSk7CiAgICAgICAgICAgIGQyID0gKHQzLCBlNCkgPT4gbjNbZTRdLCBwMiA9ICh0MywgbjQpID0+IGUzW240XTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoYTIgPSAwLCBpMiA9IGgyLmxlbmd0aDsgYTIgPCBpMjsgKythMikKICAgICAgICAgICAgbzIgPSBoMlthMl0sIGYyID0gaDJbYTJdID0gbmV3IFFkKG8yKSwgbnVsbCAhPSAoczIgPSBkMihvMiwgYTIsIHIzKSkgJiYgKHMyICs9ICIiKSAmJiAobDIgPSBmMi5pZCA9IHMyLCBnMi5zZXQobDIsIGcyLmhhcyhsMikgPyBFcCA6IGYyKSksIG51bGwgIT0gKHMyID0gcDIobzIsIGEyLCByMykpICYmIChzMiArPSAiIikgJiYgKGYyLnBhcmVudCA9IHMyKTsKICAgICAgICAgIGZvciAoYTIgPSAwOyBhMiA8IGkyOyArK2EyKQogICAgICAgICAgICBpZiAoczIgPSAoZjIgPSBoMlthMl0pLnBhcmVudCkgewogICAgICAgICAgICAgIGlmICghKGMyID0gZzIuZ2V0KHMyKSkpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm1pc3Npbmc6ICIgKyBzMik7CiAgICAgICAgICAgICAgaWYgKGMyID09PSBFcCkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYW1iaWd1b3VzOiAiICsgczIpOwogICAgICAgICAgICAgIGMyLmNoaWxkcmVuID8gYzIuY2hpbGRyZW4ucHVzaChmMikgOiBjMi5jaGlsZHJlbiA9IFtmMl0sIGYyLnBhcmVudCA9IGMyOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICh1MikKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigibXVsdGlwbGUgcm9vdHMiKTsKICAgICAgICAgICAgICB1MiA9IGYyOwogICAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXUyKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5vIHJvb3QiKTsKICAgICAgICAgIGlmIChudWxsICE9IHQyKSB7CiAgICAgICAgICAgIGZvciAoOyB1Mi5kYXRhID09PSBOcCAmJiAxID09PSB1Mi5jaGlsZHJlbi5sZW5ndGg7ICkKICAgICAgICAgICAgICB1MiA9IHUyLmNoaWxkcmVuWzBdLCAtLWkyOwogICAgICAgICAgICBmb3IgKGxldCB0MyA9IGgyLmxlbmd0aCAtIDE7IHQzID49IDAgJiYgKGYyID0gaDJbdDNdKS5kYXRhID09PSBOcDsgLS10MykKICAgICAgICAgICAgICBmMi5kYXRhID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh1Mi5wYXJlbnQgPSBTcCwgdTIuZWFjaEJlZm9yZShmdW5jdGlvbih0MykgewogICAgICAgICAgICB0My5kZXB0aCA9IHQzLnBhcmVudC5kZXB0aCArIDEsIC0taTI7CiAgICAgICAgICB9KS5lYWNoQmVmb3JlKEtkKSwgdTIucGFyZW50ID0gbnVsbCwgaTIgPiAwKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImN5Y2xlIik7CiAgICAgICAgICByZXR1cm4gdTI7CiAgICAgICAgfQogICAgICAgIHJldHVybiByMi5pZCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChuMiA9IEpkKHQzKSwgcjIpIDogbjI7CiAgICAgICAgfSwgcjIucGFyZW50SWQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZTIgPSBKZCh0MyksIHIyKSA6IGUyOwogICAgICAgIH0sIHIyLnBhdGggPSBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodDIgPSBKZChuMyksIHIyKSA6IHQyOwogICAgICAgIH0sIHIyOwogICAgICB9LCB0LnN0eWxlID0gX24sIHQuc3Vic2V0ID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgcmV0dXJuIF90KG4yLCB0Mik7CiAgICAgIH0sIHQuc3VtID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgbGV0IGUyID0gMDsKICAgICAgICBpZiAodm9pZCAwID09PSBuMikKICAgICAgICAgIGZvciAobGV0IG4zIG9mIHQyKQogICAgICAgICAgICAobjMgPSArbjMpICYmIChlMiArPSBuMyk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBsZXQgcjIgPSAtMTsKICAgICAgICAgIGZvciAobGV0IGkyIG9mIHQyKQogICAgICAgICAgICAoaTIgPSArbjIoaTIsICsrcjIsIHQyKSkgJiYgKGUyICs9IGkyKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGUyOwogICAgICB9LCB0LnN1cGVyc2V0ID0gX3QsIHQuc3ZnID0gTmMsIHQuc3ltYm9sID0gZnVuY3Rpb24odDIsIG4yKSB7CiAgICAgICAgbGV0IGUyID0gbnVsbCwgcjIgPSBObShpMik7CiAgICAgICAgZnVuY3Rpb24gaTIoKSB7CiAgICAgICAgICBsZXQgaTM7CiAgICAgICAgICBpZiAoZTIgfHwgKGUyID0gaTMgPSByMigpKSwgdDIuYXBwbHkodGhpcywgYXJndW1lbnRzKS5kcmF3KGUyLCArbjIuYXBwbHkodGhpcywgYXJndW1lbnRzKSksIGkzKQogICAgICAgICAgICByZXR1cm4gZTIgPSBudWxsLCBpMyArICIiIHx8IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0MiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQyID8gdDIgOiBnbSh0MiB8fCBjeCksIG4yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjIgPyBuMiA6IGdtKHZvaWQgMCA9PT0gbjIgPyA2NCA6ICtuMiksIGkyLnR5cGUgPSBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodDIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBuMyA/IG4zIDogZ20objMpLCBpMikgOiB0MjsKICAgICAgICB9LCBpMi5zaXplID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGdtKCt0MyksIGkyKSA6IG4yOwogICAgICAgIH0sIGkyLmNvbnRleHQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoZTIgPSBudWxsID09IHQzID8gbnVsbCA6IHQzLCBpMikgOiBlMjsKICAgICAgICB9LCBpMjsKICAgICAgfSwgdC5zeW1ib2xBc3RlcmlzayA9IHV4LCB0LnN5bWJvbENpcmNsZSA9IGN4LCB0LnN5bWJvbENyb3NzID0gZngsIHQuc3ltYm9sRGlhbW9uZCA9IGh4LCB0LnN5bWJvbERpYW1vbmQyID0gZHgsIHQuc3ltYm9sUGx1cyA9IHB4LCB0LnN5bWJvbFNxdWFyZSA9IGd4LCB0LnN5bWJvbFNxdWFyZTIgPSB5eCwgdC5zeW1ib2xTdGFyID0gbXgsIHQuc3ltYm9sVGltZXMgPSBDeCwgdC5zeW1ib2xUcmlhbmdsZSA9IHd4LCB0LnN5bWJvbFRyaWFuZ2xlMiA9IFR4LCB0LnN5bWJvbFd5ZSA9IGt4LCB0LnN5bWJvbFggPSBDeCwgdC5zeW1ib2xzID0gUHgsIHQuc3ltYm9sc0ZpbGwgPSBQeCwgdC5zeW1ib2xzU3Ryb2tlID0gengsIHQudGV4dCA9IG1jLCB0LnRocmVzaG9sZEZyZWVkbWFuRGlhY29uaXMgPSBmdW5jdGlvbih0MiwgbjIsIGUyKSB7CiAgICAgICAgY29uc3QgcjIgPSB2KHQyKSwgaTIgPSBhdCh0MiwgMC43NSkgLSBhdCh0MiwgMC4yNSk7CiAgICAgICAgcmV0dXJuIHIyICYmIGkyID8gTWF0aC5jZWlsKChlMiAtIG4yKSAvICgyICogaTIgKiBNYXRoLnBvdyhyMiwgLTEgLyAzKSkpIDogMTsKICAgICAgfSwgdC50aHJlc2hvbGRTY290dCA9IGZ1bmN0aW9uKHQyLCBuMiwgZTIpIHsKICAgICAgICBjb25zdCByMiA9IHYodDIpLCBpMiA9IHcodDIpOwogICAgICAgIHJldHVybiByMiAmJiBpMiA/IE1hdGguY2VpbCgoZTIgLSBuMikgKiBNYXRoLmNicnQocjIpIC8gKDMuNDkgKiBpMikpIDogMTsKICAgICAgfSwgdC50aHJlc2hvbGRTdHVyZ2VzID0gSywgdC50aWNrRm9ybWF0ID0gRWcsIHQudGlja0luY3JlbWVudCA9IFYsIHQudGlja1N0ZXAgPSBXLCB0LnRpY2tzID0gRywgdC50aW1lRGF5ID0gcHksIHQudGltZURheXMgPSBneSwgdC50aW1lRm9ybWF0RGVmYXVsdExvY2FsZSA9IFBfLCB0LnRpbWVGb3JtYXRMb2NhbGUgPSBodiwgdC50aW1lRnJpZGF5ID0gU3ksIHQudGltZUZyaWRheXMgPSAkeSwgdC50aW1lSG91ciA9IHN5LCB0LnRpbWVIb3VycyA9IGx5LCB0LnRpbWVJbnRlcnZhbCA9IFZnLCB0LnRpbWVNaWxsaXNlY29uZCA9IFdnLCB0LnRpbWVNaWxsaXNlY29uZHMgPSBaZywgdC50aW1lTWludXRlID0gYXksIHQudGltZU1pbnV0ZXMgPSB1eSwgdC50aW1lTW9uZGF5ID0gd3ksIHQudGltZU1vbmRheXMgPSBreSwgdC50aW1lTW9udGggPSBaeSwgdC50aW1lTW9udGhzID0gS3ksIHQudGltZVNhdHVyZGF5ID0gRXksIHQudGltZVNhdHVyZGF5cyA9IER5LCB0LnRpbWVTZWNvbmQgPSBpeSwgdC50aW1lU2Vjb25kcyA9IG95LCB0LnRpbWVTdW5kYXkgPSB4eSwgdC50aW1lU3VuZGF5cyA9IE55LCB0LnRpbWVUaHVyc2RheSA9IEF5LCB0LnRpbWVUaHVyc2RheXMgPSB6eSwgdC50aW1lVGlja0ludGVydmFsID0gY3YsIHQudGltZVRpY2tzID0gdXYsIHQudGltZVR1ZXNkYXkgPSBNeSwgdC50aW1lVHVlc2RheXMgPSBDeSwgdC50aW1lV2VkbmVzZGF5ID0gVHksIHQudGltZVdlZG5lc2RheXMgPSBQeSwgdC50aW1lV2VlayA9IHh5LCB0LnRpbWVXZWVrcyA9IE55LCB0LnRpbWVZZWFyID0gdHYsIHQudGltZVllYXJzID0gbnYsIHQudGltZW91dCA9ICRpLCB0LnRpbWVyID0gTmksIHQudGltZXJGbHVzaCA9IGtpLCB0LnRyYW5zaXRpb24gPSBnbywgdC50cmFuc3Bvc2UgPSBndCwgdC50cmVlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHQyID0gJHAsIG4yID0gMSwgZTIgPSAxLCByMiA9IG51bGw7CiAgICAgICAgZnVuY3Rpb24gaTIoaTMpIHsKICAgICAgICAgIHZhciBjMiA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgIGZvciAodmFyIG4zLCBlMywgcjMsIGk0LCBvMywgYTMgPSBuZXcgVXAodDMsIDApLCB1MyA9IFthM107IG4zID0gdTMucG9wKCk7ICkKICAgICAgICAgICAgICBpZiAocjMgPSBuMy5fLmNoaWxkcmVuKQogICAgICAgICAgICAgICAgZm9yIChuMy5jaGlsZHJlbiA9IG5ldyBBcnJheShvMyA9IHIzLmxlbmd0aCksIGk0ID0gbzMgLSAxOyBpNCA+PSAwOyAtLWk0KQogICAgICAgICAgICAgICAgICB1My5wdXNoKGUzID0gbjMuY2hpbGRyZW5baTRdID0gbmV3IFVwKHIzW2k0XSwgaTQpKSwgZTMucGFyZW50ID0gbjM7CiAgICAgICAgICAgIHJldHVybiAoYTMucGFyZW50ID0gbmV3IFVwKG51bGwsIDApKS5jaGlsZHJlbiA9IFthM10sIGEzOwogICAgICAgICAgfShpMyk7CiAgICAgICAgICBpZiAoYzIuZWFjaEFmdGVyKG8yKSwgYzIucGFyZW50Lm0gPSAtYzIueiwgYzIuZWFjaEJlZm9yZShhMiksIHIyKQogICAgICAgICAgICBpMy5lYWNoQmVmb3JlKHUyKTsKICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgZjIgPSBpMywgczIgPSBpMywgbDIgPSBpMzsKICAgICAgICAgICAgaTMuZWFjaEJlZm9yZShmdW5jdGlvbih0MykgewogICAgICAgICAgICAgIHQzLnggPCBmMi54ICYmIChmMiA9IHQzKSwgdDMueCA+IHMyLnggJiYgKHMyID0gdDMpLCB0My5kZXB0aCA+IGwyLmRlcHRoICYmIChsMiA9IHQzKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBoMiA9IGYyID09PSBzMiA/IDEgOiB0MihmMiwgczIpIC8gMiwgZDIgPSBoMiAtIGYyLngsIHAyID0gbjIgLyAoczIueCArIGgyICsgZDIpLCBnMiA9IGUyIC8gKGwyLmRlcHRoIHx8IDEpOwogICAgICAgICAgICBpMy5lYWNoQmVmb3JlKGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICAgICAgdDMueCA9ICh0My54ICsgZDIpICogcDIsIHQzLnkgPSB0My5kZXB0aCAqIGcyOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBpMzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbzIobjMpIHsKICAgICAgICAgIHZhciBlMyA9IG4zLmNoaWxkcmVuLCByMyA9IG4zLnBhcmVudC5jaGlsZHJlbiwgaTMgPSBuMy5pID8gcjNbbjMuaSAtIDFdIDogbnVsbDsKICAgICAgICAgIGlmIChlMykgewogICAgICAgICAgICAhZnVuY3Rpb24odDMpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBuNCwgZTQgPSAwLCByNCA9IDAsIGk0ID0gdDMuY2hpbGRyZW4sIG80ID0gaTQubGVuZ3RoOyAtLW80ID49IDA7ICkKICAgICAgICAgICAgICAgIChuNCA9IGk0W280XSkueiArPSBlNCwgbjQubSArPSBlNCwgZTQgKz0gbjQucyArIChyNCArPSBuNC5jKTsKICAgICAgICAgICAgfShuMyk7CiAgICAgICAgICAgIHZhciBvMyA9IChlM1swXS56ICsgZTNbZTMubGVuZ3RoIC0gMV0ueikgLyAyOwogICAgICAgICAgICBpMyA/IChuMy56ID0gaTMueiArIHQyKG4zLl8sIGkzLl8pLCBuMy5tID0gbjMueiAtIG8zKSA6IG4zLnogPSBvMzsKICAgICAgICAgIH0gZWxzZQogICAgICAgICAgICBpMyAmJiAobjMueiA9IGkzLnogKyB0MihuMy5fLCBpMy5fKSk7CiAgICAgICAgICBuMy5wYXJlbnQuQSA9IGZ1bmN0aW9uKG40LCBlNCwgcjQpIHsKICAgICAgICAgICAgaWYgKGU0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaTQsIG80ID0gbjQsIGEzID0gbjQsIHUzID0gZTQsIGMyID0gbzQucGFyZW50LmNoaWxkcmVuWzBdLCBmMiA9IG80Lm0sIHMyID0gYTMubSwgbDIgPSB1My5tLCBoMiA9IGMyLm07IHUzID0gUnAodTMpLCBvNCA9IERwKG80KSwgdTMgJiYgbzQ7ICkKICAgICAgICAgICAgICAgIGMyID0gRHAoYzIpLCAoYTMgPSBScChhMykpLmEgPSBuNCwgKGk0ID0gdTMueiArIGwyIC0gbzQueiAtIGYyICsgdDIodTMuXywgbzQuXykpID4gMCAmJiAoRnAocXAodTMsIG40LCByNCksIG40LCBpNCksIGYyICs9IGk0LCBzMiArPSBpNCksIGwyICs9IHUzLm0sIGYyICs9IG80Lm0sIGgyICs9IGMyLm0sIHMyICs9IGEzLm07CiAgICAgICAgICAgICAgdTMgJiYgIVJwKGEzKSAmJiAoYTMudCA9IHUzLCBhMy5tICs9IGwyIC0gczIpLCBvNCAmJiAhRHAoYzIpICYmIChjMi50ID0gbzQsIGMyLm0gKz0gZjIgLSBoMiwgcjQgPSBuNCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHI0OwogICAgICAgICAgfShuMywgaTMsIG4zLnBhcmVudC5BIHx8IHIzWzBdKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYTIodDMpIHsKICAgICAgICAgIHQzLl8ueCA9IHQzLnogKyB0My5wYXJlbnQubSwgdDMubSArPSB0My5wYXJlbnQubTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdTIodDMpIHsKICAgICAgICAgIHQzLnggKj0gbjIsIHQzLnkgPSB0My5kZXB0aCAqIGUyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaTIuc2VwYXJhdGlvbiA9IGZ1bmN0aW9uKG4zKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/ICh0MiA9IG4zLCBpMikgOiB0MjsKICAgICAgICB9LCBpMi5zaXplID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gZmFsc2UsIG4yID0gK3QzWzBdLCBlMiA9ICt0M1sxXSwgaTIpIDogcjIgPyBudWxsIDogW24yLCBlMl07CiAgICAgICAgfSwgaTIubm9kZVNpemUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAocjIgPSB0cnVlLCBuMiA9ICt0M1swXSwgZTIgPSArdDNbMV0sIGkyKSA6IHIyID8gW24yLCBlMl0gOiBudWxsOwogICAgICAgIH0sIGkyOwogICAgICB9LCB0LnRyZWVtYXAgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIgPSBZcCwgbjIgPSBmYWxzZSwgZTIgPSAxLCByMiA9IDEsIGkyID0gWzBdLCBvMiA9IG5wLCBhMiA9IG5wLCB1MiA9IG5wLCBjMiA9IG5wLCBmMiA9IG5wOwogICAgICAgIGZ1bmN0aW9uIHMyKHQzKSB7CiAgICAgICAgICByZXR1cm4gdDMueDAgPSB0My55MCA9IDAsIHQzLngxID0gZTIsIHQzLnkxID0gcjIsIHQzLmVhY2hCZWZvcmUobDIpLCBpMiA9IFswXSwgbjIgJiYgdDMuZWFjaEJlZm9yZShUcCksIHQzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBsMihuMykgewogICAgICAgICAgdmFyIGUzID0gaTJbbjMuZGVwdGhdLCByMyA9IG4zLngwICsgZTMsIHMzID0gbjMueTAgKyBlMywgbDMgPSBuMy54MSAtIGUzLCBoMiA9IG4zLnkxIC0gZTM7CiAgICAgICAgICBsMyA8IHIzICYmIChyMyA9IGwzID0gKHIzICsgbDMpIC8gMiksIGgyIDwgczMgJiYgKHMzID0gaDIgPSAoczMgKyBoMikgLyAyKSwgbjMueDAgPSByMywgbjMueTAgPSBzMywgbjMueDEgPSBsMywgbjMueTEgPSBoMiwgbjMuY2hpbGRyZW4gJiYgKGUzID0gaTJbbjMuZGVwdGggKyAxXSA9IG8yKG4zKSAvIDIsIHIzICs9IGYyKG4zKSAtIGUzLCBzMyArPSBhMihuMykgLSBlMywgKGwzIC09IHUyKG4zKSAtIGUzKSA8IHIzICYmIChyMyA9IGwzID0gKHIzICsgbDMpIC8gMiksIChoMiAtPSBjMihuMykgLSBlMykgPCBzMyAmJiAoczMgPSBoMiA9IChzMyArIGgyKSAvIDIpLCB0MihuMywgcjMsIHMzLCBsMywgaDIpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHMyLnJvdW5kID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG4yID0gISF0MywgczIpIDogbjI7CiAgICAgICAgfSwgczIuc2l6ZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChlMiA9ICt0M1swXSwgcjIgPSArdDNbMV0sIHMyKSA6IFtlMiwgcjJdOwogICAgICAgIH0sIHMyLnRpbGUgPSBmdW5jdGlvbihuMykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodDIgPSB0cChuMyksIHMyKSA6IHQyOwogICAgICAgIH0sIHMyLnBhZGRpbmcgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyBzMi5wYWRkaW5nSW5uZXIodDMpLnBhZGRpbmdPdXRlcih0MykgOiBzMi5wYWRkaW5nSW5uZXIoKTsKICAgICAgICB9LCBzMi5wYWRkaW5nSW5uZXIgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAobzIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZXAoK3QzKSwgczIpIDogbzI7CiAgICAgICAgfSwgczIucGFkZGluZ091dGVyID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gczIucGFkZGluZ1RvcCh0MykucGFkZGluZ1JpZ2h0KHQzKS5wYWRkaW5nQm90dG9tKHQzKS5wYWRkaW5nTGVmdCh0MykgOiBzMi5wYWRkaW5nVG9wKCk7CiAgICAgICAgfSwgczIucGFkZGluZ1RvcCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChhMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBlcCgrdDMpLCBzMikgOiBhMjsKICAgICAgICB9LCBzMi5wYWRkaW5nUmlnaHQgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogZXAoK3QzKSwgczIpIDogdTI7CiAgICAgICAgfSwgczIucGFkZGluZ0JvdHRvbSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBlcCgrdDMpLCBzMikgOiBjMjsKICAgICAgICB9LCBzMi5wYWRkaW5nTGVmdCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChmMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBlcCgrdDMpLCBzMikgOiBmMjsKICAgICAgICB9LCBzMjsKICAgICAgfSwgdC50cmVlbWFwQmluYXJ5ID0gZnVuY3Rpb24odDIsIG4yLCBlMiwgcjIsIGkyKSB7CiAgICAgICAgdmFyIG8yLCBhMiwgdTIgPSB0Mi5jaGlsZHJlbiwgYzIgPSB1Mi5sZW5ndGgsIGYyID0gbmV3IEFycmF5KGMyICsgMSk7CiAgICAgICAgZm9yIChmMlswXSA9IGEyID0gbzIgPSAwOyBvMiA8IGMyOyArK28yKQogICAgICAgICAgZjJbbzIgKyAxXSA9IGEyICs9IHUyW28yXS52YWx1ZTsKICAgICAgICAhZnVuY3Rpb24gdDMobjMsIGUzLCByMywgaTMsIG8zLCBhMywgYzMpIHsKICAgICAgICAgIGlmIChuMyA+PSBlMyAtIDEpIHsKICAgICAgICAgICAgdmFyIHMyID0gdTJbbjNdOwogICAgICAgICAgICByZXR1cm4gczIueDAgPSBpMywgczIueTAgPSBvMywgczIueDEgPSBhMywgdm9pZCAoczIueTEgPSBjMyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgbDIgPSBmMltuM10sIGgyID0gcjMgLyAyICsgbDIsIGQyID0gbjMgKyAxLCBwMiA9IGUzIC0gMTsKICAgICAgICAgIGZvciAoOyBkMiA8IHAyOyApIHsKICAgICAgICAgICAgdmFyIGcyID0gZDIgKyBwMiA+Pj4gMTsKICAgICAgICAgICAgZjJbZzJdIDwgaDIgPyBkMiA9IGcyICsgMSA6IHAyID0gZzI7CiAgICAgICAgICB9CiAgICAgICAgICBoMiAtIGYyW2QyIC0gMV0gPCBmMltkMl0gLSBoMiAmJiBuMyArIDEgPCBkMiAmJiAtLWQyOwogICAgICAgICAgdmFyIHkyID0gZjJbZDJdIC0gbDIsIHYyID0gcjMgLSB5MjsKICAgICAgICAgIGlmIChhMyAtIGkzID4gYzMgLSBvMykgewogICAgICAgICAgICB2YXIgXzIgPSByMyA/IChpMyAqIHYyICsgYTMgKiB5MikgLyByMyA6IGEzOwogICAgICAgICAgICB0MyhuMywgZDIsIHkyLCBpMywgbzMsIF8yLCBjMyksIHQzKGQyLCBlMywgdjIsIF8yLCBvMywgYTMsIGMzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBiMiA9IHIzID8gKG8zICogdjIgKyBjMyAqIHkyKSAvIHIzIDogYzM7CiAgICAgICAgICAgIHQzKG4zLCBkMiwgeTIsIGkzLCBvMywgYTMsIGIyKSwgdDMoZDIsIGUzLCB2MiwgaTMsIGIyLCBhMywgYzMpOwogICAgICAgICAgfQogICAgICAgIH0oMCwgYzIsIHQyLnZhbHVlLCBuMiwgZTIsIHIyLCBpMik7CiAgICAgIH0sIHQudHJlZW1hcERpY2UgPSBBcCwgdC50cmVlbWFwUmVzcXVhcmlmeSA9IExwLCB0LnRyZWVtYXBTbGljZSA9IElwLCB0LnRyZWVtYXBTbGljZURpY2UgPSBmdW5jdGlvbih0MiwgbjIsIGUyLCByMiwgaTIpIHsKICAgICAgICAoMSAmIHQyLmRlcHRoID8gSXAgOiBBcCkodDIsIG4yLCBlMiwgcjIsIGkyKTsKICAgICAgfSwgdC50cmVlbWFwU3F1YXJpZnkgPSBZcCwgdC50c3YgPSBNYywgdC50c3ZGb3JtYXQgPSBsYywgdC50c3ZGb3JtYXRCb2R5ID0gaGMsIHQudHN2Rm9ybWF0Um93ID0gcGMsIHQudHN2Rm9ybWF0Um93cyA9IGRjLCB0LnRzdkZvcm1hdFZhbHVlID0gZ2MsIHQudHN2UGFyc2UgPSBmYywgdC50c3ZQYXJzZVJvd3MgPSBzYywgdC51bmlvbiA9IGZ1bmN0aW9uKC4uLnQyKSB7CiAgICAgICAgY29uc3QgbjIgPSBuZXcgSW50ZXJuU2V0KCk7CiAgICAgICAgZm9yIChjb25zdCBlMiBvZiB0MikKICAgICAgICAgIGZvciAoY29uc3QgdDMgb2YgZTIpCiAgICAgICAgICAgIG4yLmFkZCh0Myk7CiAgICAgICAgcmV0dXJuIG4yOwogICAgICB9LCB0LnVuaXhEYXkgPSBfeSwgdC51bml4RGF5cyA9IGJ5LCB0LnV0Y0RheSA9IHl5LCB0LnV0Y0RheXMgPSB2eSwgdC51dGNGcmlkYXkgPSBCeSwgdC51dGNGcmlkYXlzID0gVnksIHQudXRjSG91ciA9IGh5LCB0LnV0Y0hvdXJzID0gZHksIHQudXRjTWlsbGlzZWNvbmQgPSBXZywgdC51dGNNaWxsaXNlY29uZHMgPSBaZywgdC51dGNNaW51dGUgPSBjeSwgdC51dGNNaW51dGVzID0gZnksIHQudXRjTW9uZGF5ID0gcXksIHQudXRjTW9uZGF5cyA9IGp5LCB0LnV0Y01vbnRoID0gUXksIHQudXRjTW9udGhzID0gSnksIHQudXRjU2F0dXJkYXkgPSBZeSwgdC51dGNTYXR1cmRheXMgPSBXeSwgdC51dGNTZWNvbmQgPSBpeSwgdC51dGNTZWNvbmRzID0gb3ksIHQudXRjU3VuZGF5ID0gRnksIHQudXRjU3VuZGF5cyA9IEx5LCB0LnV0Y1RodXJzZGF5ID0gT3ksIHQudXRjVGh1cnNkYXlzID0gR3ksIHQudXRjVGlja0ludGVydmFsID0gYXYsIHQudXRjVGlja3MgPSBvdiwgdC51dGNUdWVzZGF5ID0gVXksIHQudXRjVHVlc2RheXMgPSBIeSwgdC51dGNXZWRuZXNkYXkgPSBJeSwgdC51dGNXZWRuZXNkYXlzID0gWHksIHQudXRjV2VlayA9IEZ5LCB0LnV0Y1dlZWtzID0gTHksIHQudXRjWWVhciA9IGV2LCB0LnV0Y1llYXJzID0gcnYsIHQudmFyaWFuY2UgPSB4LCB0LnZlcnNpb24gPSAiNy44LjUiLCB0LndpbmRvdyA9IHBuLCB0LnhtbCA9IFNjLCB0LnppcCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBndChhcmd1bWVudHMpOwogICAgICB9LCB0Lnpvb20gPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdDIsIG4yLCBlMiwgcjIgPSBTdywgaTIgPSBFdywgbzIgPSBQdywgYTIgPSBrdywgdTIgPSBDdywgYzIgPSBbMCwgMSAvIDBdLCBmMiA9IFtbLTEgLyAwLCAtMSAvIDBdLCBbMSAvIDAsIDEgLyAwXV0sIHMyID0gMjUwLCBsMiA9IHJpLCBoMiA9ICR0KCJzdGFydCIsICJ6b29tIiwgImVuZCIpLCBkMiA9IDUwMCwgcDIgPSAxNTAsIGcyID0gMCwgeTIgPSAxMDsKICAgICAgICBmdW5jdGlvbiB2Mih0MykgewogICAgICAgICAgdDMucHJvcGVydHkoIl9fem9vbSIsIE53KS5vbigid2hlZWwuem9vbSIsIFQyLCB7IHBhc3NpdmU6IGZhbHNlIH0pLm9uKCJtb3VzZWRvd24uem9vbSIsIEEyKS5vbigiZGJsY2xpY2suem9vbSIsIFMyKS5maWx0ZXIodTIpLm9uKCJ0b3VjaHN0YXJ0Lnpvb20iLCBFMikub24oInRvdWNobW92ZS56b29tIiwgTjIpLm9uKCJ0b3VjaGVuZC56b29tIHRvdWNoY2FuY2VsLnpvb20iLCBrMikuc3R5bGUoIi13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvciIsICJyZ2JhKDAsMCwwLDApIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIF8yKHQzLCBuMykgewogICAgICAgICAgcmV0dXJuIChuMyA9IE1hdGgubWF4KGMyWzBdLCBNYXRoLm1pbihjMlsxXSwgbjMpKSkgPT09IHQzLmsgPyB0MyA6IG5ldyB4dyhuMywgdDMueCwgdDMueSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGIyKHQzLCBuMywgZTMpIHsKICAgICAgICAgIHZhciByMyA9IG4zWzBdIC0gZTNbMF0gKiB0My5rLCBpMyA9IG4zWzFdIC0gZTNbMV0gKiB0My5rOwogICAgICAgICAgcmV0dXJuIHIzID09PSB0My54ICYmIGkzID09PSB0My55ID8gdDMgOiBuZXcgeHcodDMuaywgcjMsIGkzKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbTIodDMpIHsKICAgICAgICAgIHJldHVybiBbKCt0M1swXVswXSArICt0M1sxXVswXSkgLyAyLCAoK3QzWzBdWzFdICsgK3QzWzFdWzFdKSAvIDJdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB4Mih0MywgbjMsIGUzLCByMykgewogICAgICAgICAgdDMub24oInN0YXJ0Lnpvb20iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdzIodGhpcywgYXJndW1lbnRzKS5ldmVudChyMykuc3RhcnQoKTsKICAgICAgICAgIH0pLm9uKCJpbnRlcnJ1cHQuem9vbSBlbmQuem9vbSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB3Mih0aGlzLCBhcmd1bWVudHMpLmV2ZW50KHIzKS5lbmQoKTsKICAgICAgICAgIH0pLnR3ZWVuKCJ6b29tIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciB0NCA9IHRoaXMsIG8zID0gYXJndW1lbnRzLCBhMyA9IHcyKHQ0LCBvMykuZXZlbnQocjMpLCB1MyA9IGkyLmFwcGx5KHQ0LCBvMyksIGMzID0gbnVsbCA9PSBlMyA/IG0yKHUzKSA6ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUzID8gZTMuYXBwbHkodDQsIG8zKSA6IGUzLCBmMyA9IE1hdGgubWF4KHUzWzFdWzBdIC0gdTNbMF1bMF0sIHUzWzFdWzFdIC0gdTNbMF1bMV0pLCBzMyA9IHQ0Ll9fem9vbSwgaDMgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBuMyA/IG4zLmFwcGx5KHQ0LCBvMykgOiBuMywgZDQgPSBsMihzMy5pbnZlcnQoYzMpLmNvbmNhdChmMyAvIHMzLmspLCBoMy5pbnZlcnQoYzMpLmNvbmNhdChmMyAvIGgzLmspKTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHQ1KSB7CiAgICAgICAgICAgICAgaWYgKDEgPT09IHQ1KQogICAgICAgICAgICAgICAgdDUgPSBoMzsKICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBuNCA9IGQ0KHQ1KSwgZTQgPSBmMyAvIG40WzJdOwogICAgICAgICAgICAgICAgdDUgPSBuZXcgeHcoZTQsIGMzWzBdIC0gbjRbMF0gKiBlNCwgYzNbMV0gLSBuNFsxXSAqIGU0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYTMuem9vbShudWxsLCB0NSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdzIodDMsIG4zLCBlMykgewogICAgICAgICAgcmV0dXJuICFlMyAmJiB0My5fX3pvb21pbmcgfHwgbmV3IE0yKHQzLCBuMyk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE0yKHQzLCBuMykgewogICAgICAgICAgdGhpcy50aGF0ID0gdDMsIHRoaXMuYXJncyA9IG4zLCB0aGlzLmFjdGl2ZSA9IDAsIHRoaXMuc291cmNlRXZlbnQgPSBudWxsLCB0aGlzLmV4dGVudCA9IGkyLmFwcGx5KHQzLCBuMyksIHRoaXMudGFwcyA9IDA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFQyKHQzLCAuLi5uMykgewogICAgICAgICAgaWYgKHIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHsKICAgICAgICAgICAgdmFyIGUzID0gdzIodGhpcywgbjMpLmV2ZW50KHQzKSwgaTMgPSB0aGlzLl9fem9vbSwgdTMgPSBNYXRoLm1heChjMlswXSwgTWF0aC5taW4oYzJbMV0sIGkzLmsgKiBNYXRoLnBvdygyLCBhMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSkpLCBzMyA9IG5lKHQzKTsKICAgICAgICAgICAgaWYgKGUzLndoZWVsKQogICAgICAgICAgICAgIGUzLm1vdXNlWzBdWzBdID09PSBzM1swXSAmJiBlMy5tb3VzZVswXVsxXSA9PT0gczNbMV0gfHwgKGUzLm1vdXNlWzFdID0gaTMuaW52ZXJ0KGUzLm1vdXNlWzBdID0gczMpKSwgY2xlYXJUaW1lb3V0KGUzLndoZWVsKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgaWYgKGkzLmsgPT09IHUzKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIGUzLm1vdXNlID0gW3MzLCBpMy5pbnZlcnQoczMpXSwgR2kodGhpcyksIGUzLnN0YXJ0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQXcodDMpLCBlMy53aGVlbCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgZTMud2hlZWwgPSBudWxsLCBlMy5lbmQoKTsKICAgICAgICAgICAgfSwgcDIpLCBlMy56b29tKCJtb3VzZSIsIG8yKGIyKF8yKGkzLCB1MyksIGUzLm1vdXNlWzBdLCBlMy5tb3VzZVsxXSksIGUzLmV4dGVudCwgZjIpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQTIodDMsIC4uLm4zKSB7CiAgICAgICAgICBpZiAoIWUyICYmIHIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHsKICAgICAgICAgICAgdmFyIGkzID0gdDMuY3VycmVudFRhcmdldCwgYTMgPSB3Mih0aGlzLCBuMywgdHJ1ZSkuZXZlbnQodDMpLCB1MyA9IFpuKHQzLnZpZXcpLm9uKCJtb3VzZW1vdmUuem9vbSIsIGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgICAgaWYgKEF3KHQ0KSwgIWEzLm1vdmVkKSB7CiAgICAgICAgICAgICAgICB2YXIgbjQgPSB0NC5jbGllbnRYIC0gczMsIGUzID0gdDQuY2xpZW50WSAtIGwzOwogICAgICAgICAgICAgICAgYTMubW92ZWQgPSBuNCAqIG40ICsgZTMgKiBlMyA+IGcyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhMy5ldmVudCh0NCkuem9vbSgibW91c2UiLCBvMihiMihhMy50aGF0Ll9fem9vbSwgYTMubW91c2VbMF0gPSBuZSh0NCwgaTMpLCBhMy5tb3VzZVsxXSksIGEzLmV4dGVudCwgZjIpKTsKICAgICAgICAgICAgfSwgdHJ1ZSkub24oIm1vdXNldXAuem9vbSIsIGZ1bmN0aW9uKHQ0KSB7CiAgICAgICAgICAgICAgdTMub24oIm1vdXNlbW92ZS56b29tIG1vdXNldXAuem9vbSIsIG51bGwpLCB1ZSh0NC52aWV3LCBhMy5tb3ZlZCksIEF3KHQ0KSwgYTMuZXZlbnQodDQpLmVuZCgpOwogICAgICAgICAgICB9LCB0cnVlKSwgYzMgPSBuZSh0MywgaTMpLCBzMyA9IHQzLmNsaWVudFgsIGwzID0gdDMuY2xpZW50WTsKICAgICAgICAgICAgYWUodDMudmlldyksIFR3KHQzKSwgYTMubW91c2UgPSBbYzMsIHRoaXMuX196b29tLmludmVydChjMyldLCBHaSh0aGlzKSwgYTMuc3RhcnQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gUzIodDMsIC4uLm4zKSB7CiAgICAgICAgICBpZiAocjIuYXBwbHkodGhpcywgYXJndW1lbnRzKSkgewogICAgICAgICAgICB2YXIgZTMgPSB0aGlzLl9fem9vbSwgYTMgPSBuZSh0My5jaGFuZ2VkVG91Y2hlcyA/IHQzLmNoYW5nZWRUb3VjaGVzWzBdIDogdDMsIHRoaXMpLCB1MyA9IGUzLmludmVydChhMyksIGMzID0gZTMuayAqICh0My5zaGlmdEtleSA/IDAuNSA6IDIpLCBsMyA9IG8yKGIyKF8yKGUzLCBjMyksIGEzLCB1MyksIGkyLmFwcGx5KHRoaXMsIG4zKSwgZjIpOwogICAgICAgICAgICBBdyh0MyksIHMyID4gMCA/IFpuKHRoaXMpLnRyYW5zaXRpb24oKS5kdXJhdGlvbihzMikuY2FsbCh4MiwgbDMsIGEzLCB0MykgOiBabih0aGlzKS5jYWxsKHYyLnRyYW5zZm9ybSwgbDMsIGEzLCB0Myk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEUyKGUzLCAuLi5pMykgewogICAgICAgICAgaWYgKHIyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHsKICAgICAgICAgICAgdmFyIG8zLCBhMywgdTMsIGMzLCBmMyA9IGUzLnRvdWNoZXMsIHMzID0gZjMubGVuZ3RoLCBsMyA9IHcyKHRoaXMsIGkzLCBlMy5jaGFuZ2VkVG91Y2hlcy5sZW5ndGggPT09IHMzKS5ldmVudChlMyk7CiAgICAgICAgICAgIGZvciAoVHcoZTMpLCBhMyA9IDA7IGEzIDwgczM7ICsrYTMpCiAgICAgICAgICAgICAgYzMgPSBbYzMgPSBuZSh1MyA9IGYzW2EzXSwgdGhpcyksIHRoaXMuX196b29tLmludmVydChjMyksIHUzLmlkZW50aWZpZXJdLCBsMy50b3VjaDAgPyBsMy50b3VjaDEgfHwgbDMudG91Y2gwWzJdID09PSBjM1syXSB8fCAobDMudG91Y2gxID0gYzMsIGwzLnRhcHMgPSAwKSA6IChsMy50b3VjaDAgPSBjMywgbzMgPSB0cnVlLCBsMy50YXBzID0gMSArICEhdDIpOwogICAgICAgICAgICB0MiAmJiAodDIgPSBjbGVhclRpbWVvdXQodDIpKSwgbzMgJiYgKGwzLnRhcHMgPCAyICYmIChuMiA9IGMzWzBdLCB0MiA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgdDIgPSBudWxsOwogICAgICAgICAgICB9LCBkMikpLCBHaSh0aGlzKSwgbDMuc3RhcnQoKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE4yKHQzLCAuLi5uMykgewogICAgICAgICAgaWYgKHRoaXMuX196b29taW5nKSB7CiAgICAgICAgICAgIHZhciBlMywgcjMsIGkzLCBhMywgdTMgPSB3Mih0aGlzLCBuMykuZXZlbnQodDMpLCBjMyA9IHQzLmNoYW5nZWRUb3VjaGVzLCBzMyA9IGMzLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChBdyh0MyksIGUzID0gMDsgZTMgPCBzMzsgKytlMykKICAgICAgICAgICAgICBpMyA9IG5lKHIzID0gYzNbZTNdLCB0aGlzKSwgdTMudG91Y2gwICYmIHUzLnRvdWNoMFsyXSA9PT0gcjMuaWRlbnRpZmllciA/IHUzLnRvdWNoMFswXSA9IGkzIDogdTMudG91Y2gxICYmIHUzLnRvdWNoMVsyXSA9PT0gcjMuaWRlbnRpZmllciAmJiAodTMudG91Y2gxWzBdID0gaTMpOwogICAgICAgICAgICBpZiAocjMgPSB1My50aGF0Ll9fem9vbSwgdTMudG91Y2gxKSB7CiAgICAgICAgICAgICAgdmFyIGwzID0gdTMudG91Y2gwWzBdLCBoMyA9IHUzLnRvdWNoMFsxXSwgZDQgPSB1My50b3VjaDFbMF0sIHAzID0gdTMudG91Y2gxWzFdLCBnMyA9IChnMyA9IGQ0WzBdIC0gbDNbMF0pICogZzMgKyAoZzMgPSBkNFsxXSAtIGwzWzFdKSAqIGczLCB5MyA9ICh5MyA9IHAzWzBdIC0gaDNbMF0pICogeTMgKyAoeTMgPSBwM1sxXSAtIGgzWzFdKSAqIHkzOwogICAgICAgICAgICAgIHIzID0gXzIocjMsIE1hdGguc3FydChnMyAvIHkzKSksIGkzID0gWyhsM1swXSArIGQ0WzBdKSAvIDIsIChsM1sxXSArIGQ0WzFdKSAvIDJdLCBhMyA9IFsoaDNbMF0gKyBwM1swXSkgLyAyLCAoaDNbMV0gKyBwM1sxXSkgLyAyXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoIXUzLnRvdWNoMCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICBpMyA9IHUzLnRvdWNoMFswXSwgYTMgPSB1My50b3VjaDBbMV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdTMuem9vbSgidG91Y2giLCBvMihiMihyMywgaTMsIGEzKSwgdTMuZXh0ZW50LCBmMikpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBrMih0MywgLi4ucjMpIHsKICAgICAgICAgIGlmICh0aGlzLl9fem9vbWluZykgewogICAgICAgICAgICB2YXIgaTMsIG8zLCBhMyA9IHcyKHRoaXMsIHIzKS5ldmVudCh0MyksIHUzID0gdDMuY2hhbmdlZFRvdWNoZXMsIGMzID0gdTMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKFR3KHQzKSwgZTIgJiYgY2xlYXJUaW1lb3V0KGUyKSwgZTIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGUyID0gbnVsbDsKICAgICAgICAgICAgfSwgZDIpLCBpMyA9IDA7IGkzIDwgYzM7ICsraTMpCiAgICAgICAgICAgICAgbzMgPSB1M1tpM10sIGEzLnRvdWNoMCAmJiBhMy50b3VjaDBbMl0gPT09IG8zLmlkZW50aWZpZXIgPyBkZWxldGUgYTMudG91Y2gwIDogYTMudG91Y2gxICYmIGEzLnRvdWNoMVsyXSA9PT0gbzMuaWRlbnRpZmllciAmJiBkZWxldGUgYTMudG91Y2gxOwogICAgICAgICAgICBpZiAoYTMudG91Y2gxICYmICFhMy50b3VjaDAgJiYgKGEzLnRvdWNoMCA9IGEzLnRvdWNoMSwgZGVsZXRlIGEzLnRvdWNoMSksIGEzLnRvdWNoMCkKICAgICAgICAgICAgICBhMy50b3VjaDBbMV0gPSB0aGlzLl9fem9vbS5pbnZlcnQoYTMudG91Y2gwWzBdKTsKICAgICAgICAgICAgZWxzZSBpZiAoYTMuZW5kKCksIDIgPT09IGEzLnRhcHMgJiYgKG8zID0gbmUobzMsIHRoaXMpLCBNYXRoLmh5cG90KG4yWzBdIC0gbzNbMF0sIG4yWzFdIC0gbzNbMV0pIDwgeTIpKSB7CiAgICAgICAgICAgICAgdmFyIGYzID0gWm4odGhpcykub24oImRibGNsaWNrLnpvb20iKTsKICAgICAgICAgICAgICBmMyAmJiBmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB2Mi50cmFuc2Zvcm0gPSBmdW5jdGlvbih0MywgbjMsIGUzLCByMykgewogICAgICAgICAgdmFyIGkzID0gdDMuc2VsZWN0aW9uID8gdDMuc2VsZWN0aW9uKCkgOiB0MzsKICAgICAgICAgIGkzLnByb3BlcnR5KCJfX3pvb20iLCBOdyksIHQzICE9PSBpMyA/IHgyKHQzLCBuMywgZTMsIHIzKSA6IGkzLmludGVycnVwdCgpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHcyKHRoaXMsIGFyZ3VtZW50cykuZXZlbnQocjMpLnN0YXJ0KCkuem9vbShudWxsLCAiZnVuY3Rpb24iID09IHR5cGVvZiBuMyA/IG4zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBuMykuZW5kKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9LCB2Mi5zY2FsZUJ5ID0gZnVuY3Rpb24odDMsIG4zLCBlMywgcjMpIHsKICAgICAgICAgIHYyLnNjYWxlVG8odDMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fX3pvb20uayAqICgiZnVuY3Rpb24iID09IHR5cGVvZiBuMyA/IG4zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBuMyk7CiAgICAgICAgICB9LCBlMywgcjMpOwogICAgICAgIH0sIHYyLnNjYWxlVG8gPSBmdW5jdGlvbih0MywgbjMsIGUzLCByMykgewogICAgICAgICAgdjIudHJhbnNmb3JtKHQzLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHQ0ID0gaTIuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgcjQgPSB0aGlzLl9fem9vbSwgYTMgPSBudWxsID09IGUzID8gbTIodDQpIDogImZ1bmN0aW9uIiA9PSB0eXBlb2YgZTMgPyBlMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogZTMsIHUzID0gcjQuaW52ZXJ0KGEzKSwgYzMgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBuMyA/IG4zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiBuMzsKICAgICAgICAgICAgcmV0dXJuIG8yKGIyKF8yKHI0LCBjMyksIGEzLCB1MyksIHQ0LCBmMik7CiAgICAgICAgICB9LCBlMywgcjMpOwogICAgICAgIH0sIHYyLnRyYW5zbGF0ZUJ5ID0gZnVuY3Rpb24odDMsIG4zLCBlMywgcjMpIHsKICAgICAgICAgIHYyLnRyYW5zZm9ybSh0MywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBvMih0aGlzLl9fem9vbS50cmFuc2xhdGUoImZ1bmN0aW9uIiA9PSB0eXBlb2YgbjMgPyBuMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogbjMsICJmdW5jdGlvbiIgPT0gdHlwZW9mIGUzID8gZTMuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGUzKSwgaTIuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgZjIpOwogICAgICAgICAgfSwgbnVsbCwgcjMpOwogICAgICAgIH0sIHYyLnRyYW5zbGF0ZVRvID0gZnVuY3Rpb24odDMsIG4zLCBlMywgcjMsIGEzKSB7CiAgICAgICAgICB2Mi50cmFuc2Zvcm0odDMsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgdDQgPSBpMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBhNCA9IHRoaXMuX196b29tLCB1MyA9IG51bGwgPT0gcjMgPyBtMih0NCkgOiAiZnVuY3Rpb24iID09IHR5cGVvZiByMyA/IHIzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgOiByMzsKICAgICAgICAgICAgcmV0dXJuIG8yKHd3LnRyYW5zbGF0ZSh1M1swXSwgdTNbMV0pLnNjYWxlKGE0LmspLnRyYW5zbGF0ZSgiZnVuY3Rpb24iID09IHR5cGVvZiBuMyA/IC1uMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogLW4zLCAiZnVuY3Rpb24iID09IHR5cGVvZiBlMyA/IC1lMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogLWUzKSwgdDQsIGYyKTsKICAgICAgICAgIH0sIHIzLCBhMyk7CiAgICAgICAgfSwgTTIucHJvdG90eXBlID0geyBldmVudDogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiB0MyAmJiAodGhpcy5zb3VyY2VFdmVudCA9IHQzKSwgdGhpczsKICAgICAgICB9LCBzdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMSA9PSArK3RoaXMuYWN0aXZlICYmICh0aGlzLnRoYXQuX196b29taW5nID0gdGhpcywgdGhpcy5lbWl0KCJzdGFydCIpKSwgdGhpczsKICAgICAgICB9LCB6b29tOiBmdW5jdGlvbih0MywgbjMpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm1vdXNlICYmICJtb3VzZSIgIT09IHQzICYmICh0aGlzLm1vdXNlWzFdID0gbjMuaW52ZXJ0KHRoaXMubW91c2VbMF0pKSwgdGhpcy50b3VjaDAgJiYgInRvdWNoIiAhPT0gdDMgJiYgKHRoaXMudG91Y2gwWzFdID0gbjMuaW52ZXJ0KHRoaXMudG91Y2gwWzBdKSksIHRoaXMudG91Y2gxICYmICJ0b3VjaCIgIT09IHQzICYmICh0aGlzLnRvdWNoMVsxXSA9IG4zLmludmVydCh0aGlzLnRvdWNoMVswXSkpLCB0aGlzLnRoYXQuX196b29tID0gbjMsIHRoaXMuZW1pdCgiem9vbSIpLCB0aGlzOwogICAgICAgIH0sIGVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gMCA9PSAtLXRoaXMuYWN0aXZlICYmIChkZWxldGUgdGhpcy50aGF0Ll9fem9vbWluZywgdGhpcy5lbWl0KCJlbmQiKSksIHRoaXM7CiAgICAgICAgfSwgZW1pdDogZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHZhciBuMyA9IFpuKHRoaXMudGhhdCkuZGF0dW0oKTsKICAgICAgICAgIGgyLmNhbGwodDMsIHRoaXMudGhhdCwgbmV3IG13KHQzLCB7IHNvdXJjZUV2ZW50OiB0aGlzLnNvdXJjZUV2ZW50LCB0YXJnZXQ6IHYyLCB0eXBlOiB0MywgdHJhbnNmb3JtOiB0aGlzLnRoYXQuX196b29tLCBkaXNwYXRjaDogaDIgfSksIG4zKTsKICAgICAgICB9IH0sIHYyLndoZWVsRGVsdGEgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAoYTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogYncoK3QzKSwgdjIpIDogYTI7CiAgICAgICAgfSwgdjIuZmlsdGVyID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHIyID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdDMgPyB0MyA6IGJ3KCEhdDMpLCB2MikgOiByMjsKICAgICAgICB9LCB2Mi50b3VjaGFibGUgPSBmdW5jdGlvbih0MykgewogICAgICAgICAgcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPyAodTIgPSAiZnVuY3Rpb24iID09IHR5cGVvZiB0MyA/IHQzIDogYncoISF0MyksIHYyKSA6IHUyOwogICAgICAgIH0sIHYyLmV4dGVudCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChpMiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIHQzID8gdDMgOiBidyhbWyt0M1swXVswXSwgK3QzWzBdWzFdXSwgWyt0M1sxXVswXSwgK3QzWzFdWzFdXV0pLCB2MikgOiBpMjsKICAgICAgICB9LCB2Mi5zY2FsZUV4dGVudCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChjMlswXSA9ICt0M1swXSwgYzJbMV0gPSArdDNbMV0sIHYyKSA6IFtjMlswXSwgYzJbMV1dOwogICAgICAgIH0sIHYyLnRyYW5zbGF0ZUV4dGVudCA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChmMlswXVswXSA9ICt0M1swXVswXSwgZjJbMV1bMF0gPSArdDNbMV1bMF0sIGYyWzBdWzFdID0gK3QzWzBdWzFdLCBmMlsxXVsxXSA9ICt0M1sxXVsxXSwgdjIpIDogW1tmMlswXVswXSwgZjJbMF1bMV1dLCBbZjJbMV1bMF0sIGYyWzFdWzFdXV07CiAgICAgICAgfSwgdjIuY29uc3RyYWluID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKG8yID0gdDMsIHYyKSA6IG8yOwogICAgICAgIH0sIHYyLmR1cmF0aW9uID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHMyID0gK3QzLCB2MikgOiBzMjsKICAgICAgICB9LCB2Mi5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uKHQzKSB7CiAgICAgICAgICByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA/IChsMiA9IHQzLCB2MikgOiBsMjsKICAgICAgICB9LCB2Mi5vbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHQzID0gaDIub24uYXBwbHkoaDIsIGFyZ3VtZW50cyk7CiAgICAgICAgICByZXR1cm4gdDMgPT09IGgyID8gdjIgOiB0MzsKICAgICAgICB9LCB2Mi5jbGlja0Rpc3RhbmNlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKGcyID0gKHQzID0gK3QzKSAqIHQzLCB2MikgOiBNYXRoLnNxcnQoZzIpOwogICAgICAgIH0sIHYyLnRhcERpc3RhbmNlID0gZnVuY3Rpb24odDMpIHsKICAgICAgICAgIHJldHVybiBhcmd1bWVudHMubGVuZ3RoID8gKHkyID0gK3QzLCB2MikgOiB5MjsKICAgICAgICB9LCB2MjsKICAgICAgfSwgdC56b29tSWRlbnRpdHkgPSB3dywgdC56b29tVHJhbnNmb3JtID0gTXc7CiAgICB9KTsKICB9Cn0pOwoKLy8ganMvZWRnZWRyYXcuanMKdmFyIGQzID0gX190b0VTTShyZXF1aXJlX2QzX21pbigpKTsKZnVuY3Rpb24gcmVuZGVyKHsgbW9kZWwsIGVsIH0pIHsKICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgibWF0cml4LWNvbnRhaW5lciIsICJlZGdlZHJhdyIpOwogIGVsLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7CiAgY29uc3QgbmFtZXMgPSBtb2RlbC5nZXQoIm5hbWVzIik7CiAgY29uc3Qgbm9kZXMgPSBuYW1lcy5tYXAoKG5hbWUpID0+ICh7IGlkOiBuYW1lLCB4OiAxMDAsIHk6IDEwMCB9KSk7CiAgY29uc3Qgbm9kZU9yZGVyID0gbmV3IE1hcChuYW1lcy5tYXAoKG5hbWUsIGluZGV4KSA9PiBbbmFtZSwgaW5kZXhdKSk7CiAgY29uc3Qgbm9kZUJ5SWQgPSBuZXcgTWFwKG5vZGVzLm1hcCgobm9kZTIpID0+IFtub2RlMi5pZCwgbm9kZTJdKSk7CiAgbGV0IGxpbmtzID0gW107CiAgbGV0IHNlbGVjdGVkTm9kZSA9IG51bGw7CiAgbGV0IGRpcmVjdGVkID0gbW9kZWwuZ2V0KCJkaXJlY3RlZCIpOwogIGZ1bmN0aW9uIGh5ZHJhdGVMaW5rcyhyYXdMaW5rcykgewogICAgcmV0dXJuIChyYXdMaW5rcyB8fCBbXSkubWFwKChsaW5rKSA9PiB7CiAgICAgIGlmICghbGluayB8fCB0eXBlb2YgbGluayAhPT0gIm9iamVjdCIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4geyBzb3VyY2U6IG5vZGVCeUlkLmdldChsaW5rLnNvdXJjZSksIHRhcmdldDogbm9kZUJ5SWQuZ2V0KGxpbmsudGFyZ2V0KSB9OwogICAgfSkuZmlsdGVyKChsaW5rKSA9PiBsaW5rICYmIGxpbmsuc291cmNlICYmIGxpbmsudGFyZ2V0KTsKICB9CiAgY29uc3Qgd2lkdGggPSA2MDA7CiAgY29uc3QgaGVpZ2h0ID0gNDAwOwogIGNvbnN0IHN2ZyA9IGQzLnNlbGVjdChjb250YWluZXIpLmFwcGVuZCgic3ZnIikuYXR0cigid2lkdGgiLCB3aWR0aCkuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KTsKICBzdmcuYXBwZW5kKCJkZWZzIikuYXBwZW5kKCJtYXJrZXIiKS5hdHRyKCJpZCIsICJhcnJvd2hlYWQiKS5hdHRyKCJ2aWV3Qm94IiwgIi0wIC01IDEwIDEwIikuYXR0cigicmVmWCIsIDEzKS5hdHRyKCJyZWZZIiwgMCkuYXR0cigib3JpZW50IiwgImF1dG8iKS5hdHRyKCJtYXJrZXJXaWR0aCIsIDYpLmF0dHIoIm1hcmtlckhlaWdodCIsIDYpLmFwcGVuZCgicGF0aCIpLmF0dHIoImQiLCAiTTAsLTVMMTAsMEwwLDUiKS5hdHRyKCJjbGFzcyIsICJhcnJvdyIpOwogIGxpbmtzID0gaHlkcmF0ZUxpbmtzKG1vZGVsLmdldCgibGlua3MiKSk7CiAgY29uc3Qgc2ltdWxhdGlvbiA9IGQzLmZvcmNlU2ltdWxhdGlvbihub2RlcykuZm9yY2UoImxpbmsiLCBkMy5mb3JjZUxpbmsobGlua3MpLmlkKChkKSA9PiBkLmlkKS5kaXN0YW5jZSgxMDApKS5mb3JjZSgiY2hhcmdlIiwgZDMuZm9yY2VNYW55Qm9keSgpLnN0cmVuZ3RoKC01MCkpLmZvcmNlKCJjZW50ZXIiLCBkMy5mb3JjZUNlbnRlcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpKS5mb3JjZSgiY29sbGlkZSIsIGQzLmZvcmNlQ29sbGlkZSgpLnJhZGl1cygzMCkpLm9uKCJ0aWNrIiwgdGlja2VkKTsKICBjb25zdCBsaW5rR3JvdXAgPSBzdmcuYXBwZW5kKCJnIik7CiAgY29uc3Qgbm9kZUdyb3VwID0gc3ZnLmFwcGVuZCgiZyIpOwogIGNvbnN0IG5vZGUgPSBub2RlR3JvdXAuc2VsZWN0QWxsKCIubm9kZSIpLmRhdGEobm9kZXMpLmpvaW4oImNpcmNsZSIpLmF0dHIoImNsYXNzIiwgIm5vZGUiKS5hdHRyKCJyIiwgMTApLm9uKCJjbGljayIsIGhhbmRsZU5vZGVDbGljayk7CiAgY29uc3QgbGFiZWxzID0gbm9kZUdyb3VwLnNlbGVjdEFsbCgiLmxhYmVsIikuZGF0YShub2Rlcykuam9pbigidGV4dCIpLmF0dHIoImNsYXNzIiwgImxhYmVsIikuYXR0cigiZHgiLCAxNSkuYXR0cigiZHkiLCA0KS50ZXh0KChkKSA9PiBkLmlkKTsKICBmdW5jdGlvbiBjYW5vbmljYWxpemVFZGdlKGEsIGIpIHsKICAgIGlmIChub2RlT3JkZXIuZ2V0KGEuaWQpIDw9IG5vZGVPcmRlci5nZXQoYi5pZCkpIHsKICAgICAgcmV0dXJuIHsgc291cmNlOiBhLCB0YXJnZXQ6IGIgfTsKICAgIH0KICAgIHJldHVybiB7IHNvdXJjZTogYiwgdGFyZ2V0OiBhIH07CiAgfQogIGZ1bmN0aW9uIGhhbmRsZU5vZGVDbGljayhldmVudCwgZCkgewogICAgaWYgKCFzZWxlY3RlZE5vZGUpIHsKICAgICAgc2VsZWN0ZWROb2RlID0gZDsKICAgICAgbm9kZS5jbGFzc2VkKCJzZWxlY3RlZCIsIChuKSA9PiBuID09PSBzZWxlY3RlZE5vZGUpOwogICAgfSBlbHNlIGlmIChzZWxlY3RlZE5vZGUgPT09IGQpIHsKICAgICAgc2VsZWN0ZWROb2RlID0gbnVsbDsKICAgICAgbm9kZS5jbGFzc2VkKCJzZWxlY3RlZCIsIGZhbHNlKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGV4aXN0aW5nRm9yd2FyZExpbmsgPSBsaW5rcy5maW5kKAogICAgICAgIChsKSA9PiBsLnNvdXJjZSA9PT0gc2VsZWN0ZWROb2RlICYmIGwudGFyZ2V0ID09PSBkIHx8IGwuc291cmNlLmlkID09PSBzZWxlY3RlZE5vZGUuaWQgJiYgbC50YXJnZXQuaWQgPT09IGQuaWQKICAgICAgKTsKICAgICAgY29uc3QgZXhpc3RpbmdSZXZlcnNlTGluayA9IGxpbmtzLmZpbmQoCiAgICAgICAgKGwpID0+IGwuc291cmNlID09PSBkICYmIGwudGFyZ2V0ID09PSBzZWxlY3RlZE5vZGUgfHwgbC5zb3VyY2UuaWQgPT09IGQuaWQgJiYgbC50YXJnZXQuaWQgPT09IHNlbGVjdGVkTm9kZS5pZAogICAgICApOwogICAgICBjb25zdCBleGlzdGluZ1VuZGlyZWN0ZWRMaW5rID0gZXhpc3RpbmdGb3J3YXJkTGluayB8fCBleGlzdGluZ1JldmVyc2VMaW5rOwogICAgICBpZiAoIWRpcmVjdGVkKSB7CiAgICAgICAgaWYgKGV4aXN0aW5nVW5kaXJlY3RlZExpbmspIHsKICAgICAgICAgIGxpbmtzID0gbGlua3MuZmlsdGVyKChsKSA9PiBsICE9PSBleGlzdGluZ1VuZGlyZWN0ZWRMaW5rKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGlua3MucHVzaChjYW5vbmljYWxpemVFZGdlKHNlbGVjdGVkTm9kZSwgZCkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoZXhpc3RpbmdSZXZlcnNlTGluaykgewogICAgICAgICAgbGlua3MgPSBsaW5rcy5maWx0ZXIoKGwpID0+IGwgIT09IGV4aXN0aW5nUmV2ZXJzZUxpbmspOwogICAgICAgIH0KICAgICAgICBpZiAoIWV4aXN0aW5nRm9yd2FyZExpbmspIHsKICAgICAgICAgIGxpbmtzLnB1c2goeyBzb3VyY2U6IHNlbGVjdGVkTm9kZSwgdGFyZ2V0OiBkIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICBzaW11bGF0aW9uLmZvcmNlKCJsaW5rIikubGlua3MobGlua3MpOwogICAgICBzZWxlY3RlZE5vZGUgPSBudWxsOwogICAgICBub2RlLmNsYXNzZWQoInNlbGVjdGVkIiwgZmFsc2UpOwogICAgICB1cGRhdGVMaW5rcygpOwogICAgfQogICAgbW9kZWwuc2V0KCJsaW5rcyIsIGxpbmtzLm1hcCgobCkgPT4gKHsgc291cmNlOiBsLnNvdXJjZS5pZCwgdGFyZ2V0OiBsLnRhcmdldC5pZCB9KSkpOwogICAgY29uc29sZS5sb2cobGlua3MubWFwKChsKSA9PiAoeyBzb3VyY2U6IGwuc291cmNlLmlkLCB0YXJnZXQ6IGwudGFyZ2V0LmlkIH0pKSk7CiAgICBtb2RlbC5zYXZlX2NoYW5nZXMoKTsKICB9CiAgZnVuY3Rpb24gdXBkYXRlTGlua3MoKSB7CiAgICBjb25zdCBsaW5rID0gbGlua0dyb3VwLnNlbGVjdEFsbCgiLmxpbmsiKS5kYXRhKGxpbmtzKS5qb2luKCJwYXRoIikuYXR0cigiY2xhc3MiLCAibGluayIpLmF0dHIoIm1hcmtlci1lbmQiLCBkaXJlY3RlZCA/ICJ1cmwoI2Fycm93aGVhZCkiIDogbnVsbCkuYXR0cigiZCIsIChkKSA9PiB7CiAgICAgIGNvbnN0IGR4ID0gZC50YXJnZXQueCAtIGQuc291cmNlLng7CiAgICAgIGNvbnN0IGR5ID0gZC50YXJnZXQueSAtIGQuc291cmNlLnk7CiAgICAgIHJldHVybiBgTSR7ZC5zb3VyY2UueH0sJHtkLnNvdXJjZS55fUwke2QudGFyZ2V0Lnh9LCR7ZC50YXJnZXQueX1gOwogICAgfSkub24oImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQsIGQpIHsKICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIGxpbmtzID0gbGlua3MuZmlsdGVyKChsKSA9PiBsICE9PSBkKTsKICAgICAgc2ltdWxhdGlvbi5mb3JjZSgibGluayIpLmxpbmtzKGxpbmtzKTsKICAgICAgdXBkYXRlTGlua3MoKTsKICAgICAgbW9kZWwuc2V0KCJsaW5rcyIsIGxpbmtzLm1hcCgobCkgPT4gKHsgc291cmNlOiBsLnNvdXJjZS5pZCwgdGFyZ2V0OiBsLnRhcmdldC5pZCB9KSkpOwogICAgICBjb25zb2xlLmxvZyhsaW5rcy5tYXAoKGwpID0+ICh7IHNvdXJjZTogbC5zb3VyY2UuaWQsIHRhcmdldDogbC50YXJnZXQuaWQgfSkpKTsKICAgICAgbW9kZWwuc2F2ZV9jaGFuZ2VzKCk7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gdGlja2VkKCkgewogICAgbm9kZS5hdHRyKCJjeCIsIChkKSA9PiBkLnggPSBNYXRoLm1heCgxNSwgTWF0aC5taW4od2lkdGggLSAxNSwgZC54KSkpLmF0dHIoImN5IiwgKGQpID0+IGQueSA9IE1hdGgubWF4KDE1LCBNYXRoLm1pbihoZWlnaHQgLSAxNSwgZC55KSkpOwogICAgbGFiZWxzLmF0dHIoIngiLCAoZCkgPT4gZC54KS5hdHRyKCJ5IiwgKGQpID0+IGQueSk7CiAgICB1cGRhdGVMaW5rcygpOwogIH0KICBjb25zdCBkcmFnMiA9IGQzLmRyYWcoKS5vbigiZHJhZyIsIGZ1bmN0aW9uKGV2ZW50LCBkKSB7CiAgICBkLnggPSBldmVudC54OwogICAgZC55ID0gZXZlbnQueTsKICAgIHNpbXVsYXRpb24uYWxwaGEoMC4xKS5yZXN0YXJ0KCk7CiAgfSk7CiAgbm9kZS5jYWxsKGRyYWcyKTsKICBtb2RlbC5vbigiY2hhbmdlOmRpcmVjdGVkIiwgKCkgPT4gewogICAgZGlyZWN0ZWQgPSBtb2RlbC5nZXQoImRpcmVjdGVkIik7CiAgICB1cGRhdGVMaW5rcygpOwogIH0pOwogIG1vZGVsLm9uKCJjaGFuZ2U6bGlua3MiLCAoKSA9PiB7CiAgICBsaW5rcyA9IGh5ZHJhdGVMaW5rcyhtb2RlbC5nZXQoImxpbmtzIikpOwogICAgc2ltdWxhdGlvbi5mb3JjZSgibGluayIpLmxpbmtzKGxpbmtzKTsKICAgIHVwZGF0ZUxpbmtzKCk7CiAgfSk7Cn0KdmFyIGVkZ2VkcmF3X2RlZmF1bHQgPSB7IHJlbmRlciB9OwpleHBvcnQgewogIGVkZ2VkcmF3X2RlZmF1bHQgYXMgZGVmYXVsdAp9Owo=&quot;' data-js-hash='&quot;50b062c47b664822e90fee9e159bc8be&quot;'></marimo-anywidget></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "27184cebac300c632341fd7b5d07137d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">The widget has all sorts of useful attributes and properties that you can retreive. These update as you interact with the widget.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "lEQa",
      "code_hash": "90c24b16b2ec72bf3c9bed2fe51e7b5c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "application/json": "[\"a\", \"b\", \"c\", \"d\"]"
          }
        }
      ],
      "console": []
    },
    {
      "id": "PKri",
      "code_hash": "326250c7b4760f7544ccda810ee8e4cb",
      "outputs": [
        {
          "type": "data",
          "data": {
            "application/json": "[]"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Xref",
      "code_hash": "28d12b19f6b9cc9a136ba631dbb6a2e2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<pre class='text-xs'>array([[0., 0., 0., 0.],\n       [0., 0., 0., 0.],\n       [0., 0., 0., 0.],\n       [0., 0., 0., 0.]])</pre>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "914e06167f6610270c870a4d0736a0eb",
      "outputs": [
        {
          "type": "data",
          "data": {
            "application/json": "[]"
          }
        }
      ],
      "console": []
    },
    {
      "id": "BYtC",
      "code_hash": "24c2e3a2498b6d0066ffbc40da87de2b",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"cycle-detection\">Cycle Detection</h2>\n<span class=\"paragraph\">The widget can detect cycles in the graph. You can specify whether to treat the graph as directed or undirected.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "RGSE",
      "code_hash": "4d5ed38fdbf0f7631078151e34949eb9",
      "outputs": [
        {
          "type": "data",
          "data": {
            "application/json": "[false, false]"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Kclp",
      "code_hash": null,
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    }
  ]
}